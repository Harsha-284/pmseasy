<!-- Change the style in style_map.css -->


<?php include 'conn.php';
include 'udf.php';

if (!isset($_SESSION['username']))
	header('Location:login.php');
else if ($_SESSION['groupid'] < 5) {
	function pms_info_status()
	{
		$row = execute("select u.address1,h.landline,h.stars,h.bank,h.hotelcheckintime,(select count(*) from hotel_facilities hf join facilities f on f.id=hf.facility where f.type=1 and hf.hotel=h.id)goodfor,(select count(*) from hotel_facilities hf join facilities f on f.id=hf.facility where f.type>1 and hf.hotel=h.id) facilities,(select count(*) from pictures where propertyid=h.id and type='Hotel')images,(select count(*) from discounts where hotel=h.id)discounts,(select count(*) from roomnumbers rn join roomtypes r where r.hotel=h.id and r.adults>0)rooms,(select count(*) from roomtypes r where r.hotel=h.id and r.fulldaytariff>0)htlrates,h.paymentterm, (select count(*) from taxes where hotel=h.id)taxes from hotels h join users u on u.id=h.user where h.id=$_SESSION[hotel]"); ?>

<?php
			$is_all_module = 1;
			if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
				$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

				// Ensure $decoded_data is a valid array
				if (is_array($decoded_data) && isset($decoded_data['Hotel Setup'])) {
					$is_all_module = !empty($decoded_data['Hotel Setup']['Allow']) ? 1 : 0;
				}
			}
			if ($is_all_module) {
				?>
<div style="    width: 100%;
	margin-top: 10px;
	margin-bottom: 38px;
	height: 85px;
	margin-left: 0;">
  <a href="?Pg=basicinfo">
    <?php if ($row['stars'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Basic Info
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Basic Info
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=contactinfo">
    <?php if ($row['landline'] == "") { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Contact Info
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Contact Info
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=usefulinfo">
    <?php if ($row['goodfor'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Useful Info
    </div>
    <?php

					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Useful Info
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=facilities">
    <?php if ($row['facilities'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Facilities / Amenities
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Facilities / Amenities
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=hotelimages">
    <?php if ($row['images'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Images
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Images
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=additionalservicies">
    <?php if ($row['bank'] == "") { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Additional Services
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Additional Services
    </div>
    <?php
					} ?>
  </a>
  <!-- <a href="?Pg=setroomtypes">
				<?php if ($row['rooms'] == 0) { ?>
					<div class="hotellinkblocks" style="background-color:orange;">
						<i class="fa fa-spinner"></i> Room Allocation
					</div>
					<?php
				} else { ?>
					<div class="hotellinkblocks" style="background-color:#8CC152;">
						<i class="fa fa-check"></i> Room Allocation
					</div>
					<?php
				} ?>
			</a> -->
  <a href="?Pg=roomdetails">
    <?php if ($row['rooms'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Room Setup
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Room Setup
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=hotelnormalrates">
    <?php if ($row['htlrates'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Hourly Rate Setup
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Hourly Rate Setup
    </div>
    <?php
					} ?>
  </a>
  <!-- <a href="?Pg=frotelnormalrates">
				<?php if ($row['frtlrates'] == 0) { ?>
					<div class="hotellinkblocks" style="background-color:orange;">
						<i class="fa fa-spinner"></i> Frotel Rate Setup
					</div>
					<?php
				} else { ?>
					<div class="hotellinkblocks" style="background-color:#8CC152;">
						<i class="fa fa-check"></i> Frotel Rate Setup
					</div>
					<?php
				} ?>
			</a> -->
  <a href="?Pg=hoteltaxsetup">
    <?php if ($row['taxes'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Hotel Tax Setup
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Hotel Tax Setup
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=payment">
    <?php if ($row['paymentterm'] == 0) { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Payment Terms
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Payment Terms
    </div>
    <?php
					} ?>
  </a>

  <a href="?Pg=hotelpolicy">
    <?php if ($row['hotelcheckintime'] == "") { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> Hotel Agreement
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> Hotel Agreement
    </div>
    <?php
					} ?>
  </a>
  <a href="?Pg=cmsetup">
    <?php if ($row['hotelcheckintime'] == "") { ?>
    <div class="hotellinkblocks available">
      <i class="fa fa-spinner"></i> CM setup
    </div>
    <?php
					} else { ?>
    <div class="hotellinkblocks available" style="font-size: 12px;">
      <i class="fa fa-check"></i> CM setup
    </div>
    <?php
					} ?>
  </a>
</div>
<?php
			}
	?>
<?php
		} ?>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="author" content="Frotels Pvt. Ltd.">
  <title>Frotels - Admin Panel</title>
  <?php include("head.php"); ?>
  <link rel="stylesheet" type="text/css" href="css/style_map.css">
  <style type="text/css">
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  </style>
  <script src="js/commonfunction.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body class="tooltips" <?php if ($_GET['Pg'] == "promocodes")
			echo "OnLoad='hideall()'"; ?> <?= col("Pg") == "hotelnormalrates" ? "onLoad='preview_rates()'" : "" ?>>
  <div class="wrapper">
    <div class="top-navbar <?= col("Pg") == "specialrates" ? "toggle" : "" ?>">
      <div class="top-navbar-inner">
        <div class="logo-brand" style="display: flex; align-items: center;">
          <a href="admin.php<?= ($_SESSION['groupid'] == 1) ? "?Pg=myhotels" : "" ?>" style="width:100%;"><img
              src="images/Pmslogo.png" alt="Company logo" style="max-width:220px; height:50px !important;"></a>
        </div>
        <div class="top-nav-content">
          <div class="btn-collapse-sidebar-left">
            <i class="fa fa-bars"></i>
          </div>

          <div class="btn-collapse-nav" data-toggle="collapse" data-target="#main-fixed-nav">
            <i class="fa fa-plus icon-plus"></i>
          </div>

          <ul class="nav-user navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Hi, <strong><?= $_SESSION['username'] ?></strong>
              </a>
              <ul class="dropdown-menu square primary margin-list-rounded with-triangle">
                <!-- <li><a href='LBF_editprofile.php?id=<?= $_SESSION['id'] ?>' class='fancybox2 fancybox.iframe'>My Profile</a></li> -->
                <li><a href="?Pg=changepassword">Change password</a></li>
                <li><a href="?Pg=be_api_token">API Token</a></li>
                <li class="divider"></li>
                <li><a href="login.php?Pg=Logout">Log out</a></li>
              </ul>
            </li>
          </ul>

          <div class="collapse navbar-collapse" id="main-fixed-nav">
            <form class="navbar-form navbar-left" role="search" action="?Pg=dailysales" method="POST">
              <div class="form-group">
                <input type="text" name="global_search" class="form-control" placeholder="Search #BRN"
                  value="<?= col("global_search") ?>">
              </div>
            </form>
            <?php if ($_SESSION['groupid'] == 0) { ?>
            <form class="navbar-form navbar-left" method="POST">
              <div class="form-group" style="display:<?php if (col("Pg") != "myhotels")
											echo "block";
										else
											echo "none"; ?>">
                <?= $current_city ?>
              </div>
            </form>
            <?php
							}
							if ($_SESSION['groupid'] == 0 or $_SESSION['groupid'] == 1) { ?>
            <form class="navbar-form navbar-left" method="POST">
              <div class="form-group">
                <?= $current_hotel ?>
              </div>
            </form>
            <?php
							} ?>
          </div>

        </div>
      </div>
    </div>

  <div class="sidebar-left sidebar-nicescroller <?= col("Pg") == "specialrates" ? "toggle" : "" ?>">
				<ul class="sidebar-menu">


					<?php if ($_SESSION['groupid'] == 0) { ?>
						<li <?php if (!isset($_GET['Pg'])) echo "class='active'"; ?>>
							<a href="?Pg=froteldash">
								<i class="fa fa-dashboard icon-sidebar"></i>
								Dashboard
							</a>
						</li>
					<?php
					} else { ?>
						<li <?php if (!isset($_GET['Pg'])) echo "class='active'"; ?>>
							<a href="admin.php<?= ($_SESSION['groupid'] == 1) ? "?Pg=myhotels" : "" ?>">
								<i class="fa fa-dashboard icon-sidebar"></i>
								Dashboard
							</a>
						</li>
					<?php
					}
					if ($_SESSION['groupid'] <= 2 and 0) { ?>
						<li <?php if (col('Pg') == "basicinfo" or col('Pg') == "contactinfo" or col('Pg') == "usefulinfo" or col('Pg') == "facilities" or col('Pg') == "hotelimages" or col('Pg') == "hotelpolicy" or col('Pg') == "frotelpolicy" or col('Pg') == "bankdetails" or col('Pg') == "paymentterms") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-cutlery icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Hotels
							</a>
							<ul class="submenu <?= $visible ?>">
								<li <?php if (col("Pg") == "basicinfo") echo "class='active'" ?>><a href="?Pg=basicinfo">Basic Info</a></li>
								<li <?php if (col("Pg") == "contactinfo") echo "class='active'" ?>><a href="?Pg=contactinfo">Contact Info</a></li>
								<li <?php if (col("Pg") == "usefulinfo") echo "class='active'" ?>><a href="?Pg=usefulinfo">Useful Info</a></li>
								<li <?php if (col("Pg") == "facilities") echo "class='active'" ?>><a href="?Pg=facilities">Facilities</a></li>
								<li <?php if (col("Pg") == "hotelimages") echo "class='active'" ?>><a href="?Pg=hotelimages">Images</a></li>
								<li <?php if (col("Pg") == "hotelpolicy") echo "class='active'" ?>><a href="?Pg=hotelpolicy">Hotel Policy</a></li>
								<li <?php if (col("Pg") == "frotelpolicy") echo "class='active'" ?>><a href="?Pg=frotelpolicy">Frotel Policy</a></li>
								<li <?php if (col("Pg") == "bankdetails") echo "class='active'" ?>><a href="?Pg=bankdetails">Bank Details</a></li>
								<li <?php if (col("Pg") == "paymentterms") echo "class='active'" ?>><a href="?Pg=paymentterms">Payment Terms</a></li>
							</ul>
						</li>
					<?php
					}

					if ($_SESSION['groupid'] == 0) { ?>
						<li <?php if (col('Pg') == "registerhotel") echo "class='active'" ?>>
							<a href="?Pg=registerhotel">
								<i class="fa fa-times icon-sidebar"></i>
								Hotel Signup
							</a>
						</li>
						<?php $counts = $conn->query("
    SELECT
        COUNT(CASE WHEN ps.end_date >= CURDATE() AND ps.start_date <= CURDATE() THEN 1 END) AS active_count,
        COUNT(CASE WHEN ps.end_date < CURDATE() THEN 1 END) AS expired_count,
        COUNT(CASE WHEN ps.hotel_id IS NULL THEN 1 END) AS pending_count
    FROM hotels h
    JOIN users u ON u.id = h.user
    LEFT JOIN (
        SELECT ps1.*
        FROM pms_subscriptions ps1
        JOIN (
            SELECT hotel_id, MAX(id) AS max_id
            FROM pms_subscriptions
            GROUP BY hotel_id
        ) latest_sub ON ps1.hotel_id = latest_sub.hotel_id AND ps1.id = latest_sub.max_id
    ) ps ON ps.hotel_id = h.id
    WHERE u.active = 1 AND u.groupid = 2
");

						$activeCount = $expiredCount = $pendingCount = 0;
						if ($counts && $row = $counts->fetch_assoc()) {
							$activeCount = $row['active_count'];
							$expiredCount = $row['expired_count'];
							$pendingCount = $row['pending_count'];
						} ?>
						<li <?php if (col('Pg') == "activeSubscription") echo "class='active'" ?>>
							<a href="?Pg=activeSubscription">
								<i class="fa fa-times icon-sidebar"></i>
								Active Subscriptions <span class="badge badge-info span-sidebar"><?= $activeCount ?></span>
							</a>
						</li>
						<li <?php if (col('Pg') == "expiredSubscription") echo "class='active'" ?>>
							<a href="?Pg=expiredSubscription">
								<i class="fa fa-times icon-sidebar"></i>
								Expired Subscriptions <span class="badge badge-info span-sidebar"><?= $expiredCount  ?></span>
							</a>
						</li>
						<li <?php if (col('Pg') == "pendingsubscription") echo "class='active'" ?>>
							<a href="?Pg=pendingsubscription">
								<i class="fa fa-times icon-sidebar"></i>
								Pending Subscriptions <span class="badge badge-info span-sidebar"><?= $pendingCount ?></span>
							</a>
						</li>
						<li <?php if (col('Pg') == "admin_gst_report") echo "class='active'" ?>>
							<a href="?Pg=admin_gst_report">
								<i class="fa fa-times icon-sidebar"></i>
								GST & Invoices
							</a>
						</li>
					<?php
					}
					if ($_SESSION['groupid'] == 0) { ?>
						<li <?php if (col("Pg") == "cities" or col("Pg") == "locations") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-cog icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Basic Data
							</a>
							<ul class="submenu <?= $visible ?>">
								<?php if ($_SESSION['groupid'] <= 1 or page_access("cities")) { ?>
									<li <?php if (col("Pg") == "cities") echo "class='active'" ?>><a href="?Pg=cities">Cities</a></li>
								<?php
								}
								if ($_SESSION['groupid'] <= 1 or page_access("locations")) { ?>
									<li <?php if (col("Pg") == "locations") echo "class='active'" ?>><a href="?Pg=locations">Localities</a></li>
								<?php
								} ?>
							</ul>
						</li>
						<?php
					}
					$isAllow = 1;
					if ($_SESSION['groupid'] <= 4) {
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['DashBoard'])) {
								$isAllow = !empty($decoded_data['DashBoard']['Allow']) ? 1 : 0;
							}
						}
						if ($isAllow) { ?>
							<li <?php if (col('Pg') == "hoteldashboard") echo "class='active'" ?>>
								<a href="?Pg=hoteldashboard">
									<i class="fa fa-dashboard icon-sidebar"></i>
									My Dashboard
								</a>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] <= 4) {
						$isAllow = 1;
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['Booking Map'])) {
								$isAllow = !empty($decoded_data['Booking Map']['Allow']) ? 1 : 0;
							}
						}
						if ($isAllow) { ?>
							<li <?php if (col('Pg') == "bookingmap") echo "class='active'" ?>>
								<a href="?Pg=bookingmap" onclick=updatelocalstrage()>
									<i class="fa fa-tag icon-sidebar"></i>
									Bookmap
								</a>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] <= 2) { ?>
						<li <?php if (col('Pg') == "setroomtypes" or col('Pg') == "roomdetails" or col('Pg') == "roomsavailability" or col('Pg') == "hotelnormalrates" or col('Pg') == "specialrates" or col('Pg') == "multiple_room_blocking" or col('Pg') == "cmsetup") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-key icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Rooms
							</a>
							<ul class="submenu <?= $visible ?>">
								<li <?php if (col("Pg") == "setroomtypes") echo "class='active'" ?>><a href="?Pg=setroomtypes">Set Room Types</a></li>
								<li <?php if (col("Pg") == "roomdetails") echo "class='active'" ?>><a href="?Pg=roomdetails">Room Details</a></li>
								<li <?php if (col("Pg") == "roomsavailability") echo "class='active'" ?>><a href="?Pg=roomsavailability">Set Room Availability</a></li>
								<li <?php if (col("Pg") == "roomsavailabilityview") echo "class='active'" ?>><a href="?Pg=roomsavailabilityview">View Room Availability</a></li>
								<li <?php if (col("Pg") == "setroomplanrate") echo "class='active'" ?>><a href="?Pg=setroomplanrate">Set Room Rate</a></li>
								<li <?php if (col("Pg") == "setroomplanrateview") echo "class='active'" ?>><a href="?Pg=setroomplanrateview">View Room Rate</a></li>
								<li <?php if (col("Pg") == "setseasonalroomplanrate") echo "class='active'" ?>><a href="?Pg=setseasonalroomplanrate">Set Seasonal Room Rate</a></li>
								<li <?php if (col("Pg") == "setseasonalroomplanrateview") echo "class='active'" ?>><a href="?Pg=setseasonalroomplanrateview">View Seasonal Room Rate</a></li>
								<li <?php if (col("Pg") == "cmsetup") echo "class='active'" ?>><a href="?Pg=cmsetup">CM setup</a></li>
								<!-- <li <?php if (col("Pg") == "hotelnormalrates") echo "class='active'" ?>><a href="?Pg=hotelnormalrates">Hourly Rate Setup</a></li> -->
								<!-- <li <?php if (col("Pg") == "specialrates") echo "class='active'" ?>><a href="?Pg=specialrates">Special Rates</a></li> -->
								<li <?php if (col("Pg") == "multiple_room_blocking") echo "class='active'" ?>><a href="?Pg=multiple_room_blocking">Bulk Room Activities</a></li>
								<li <?php if (col("Pg") == "view_bulkroom") echo "class='active'" ?>><a href="?Pg=view_bulkroom">View Bulk Room Activities</a></li>
							</ul>
						</li>
						<?php
					}
					if ($_SESSION['groupid'] <= 4) {
						$isAllow = 1;
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['Assign Room'])) {
								$isAllow = !empty($decoded_data['Assign Room']['Allow']) ? 1 : 0;
							}
						}
						if ($isAllow) {  ?>
							<li <?php if (col('Pg') == "assignroom") echo "class='active'" ?>>
								<a href="?Pg=assignroom" onclick=updateLocalStorageAssign()>
									<i class="fa fa-tag icon-sidebar"></i>
									Assigned Room
								</a>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] == 0)
					//if($_SESSION['groupid'] <= 2 and 0)
					{ ?>
						<li <?php if (col('Pg') == "partnerhotel" or col('Pg') == "agent" or col('Pg') == "corporate" or col('Pg') == "user" or col('Pg') == "taxreport" or col('Pg') == "cancellationreport") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-book icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Cancellation
							</a>
							<ul class="submenu <?= $visible ?>">
								<!-- <li <?php if (col("Pg") == "partnerhotel") echo "class='active'" ?>><a href="?Pg=partnerhotel">Partner Hotel </a></li> -->
								<!-- <li <?php if (col("Pg") == "agent") echo "class='active'" ?>><a href="?Pg=agent">Agent</a></li> -->
								<!-- <li <?php if (col("Pg") == "corporate") echo "class='active'" ?>><a href="?Pg=corporate">Corporate</a></li> -->
								<!-- <li <?php if (col("Pg") == "user") echo "class='active'" ?>><a href="?Pg=users">User</a></li> -->
								<!-- <li <?php if (col("Pg") == "taxreport") echo "class='active'" ?>><a href="?Pg=taxreport">Tax Report</a></li> -->

								<li <?php if (col('Pg') == "cancellationrequests") echo "class='active'" ?>><a href="?Pg=cancellationrequests">Cancellation Requests</a></li>
								<li <?php if (col("Pg") == "cancellationreport") echo "class='active'" ?>><a href="?Pg=cancellationreport">Cancellation Report</a></li>
							</ul>
						</li>
					<?php
					}
					if ($_SESSION['groupid'] == 0)
					//if($_SESSION['groupid'] <= 2 and 0)
					{ ?>
						<li <?php if (col("Pg") == "bookings") echo "class='active'" ?>>
							<a href="?Pg=bookings">
								<i class="fa fa-file icon-sidebar"></i>
								Booking Report
							</a>
						</li>
					<?php
					}
					if ($_SESSION['groupid'] == 0)
					//if($_SESSION['groupid'] <= 2 and 0)
					{ ?>
						<li <?php if (col('Pg') == "hotelchains" or col('Pg') == "bookings" or col('Pg') == "abandonedbookings" or col('Pg') == "weeklysales" or col('Pg') == "monthlysales" or col('Pg') == "quarterlysales" or col('Pg') == "yearlysales" or col('Pg') == "users" or col('Pg') == "totalmoneysavedforusers" or col('Pg') == "hotels" or col('Pg') == "hotelchainpartners" or col('Pg') == "agents" or col('Pg') == "corporates" or col('Pg') == "hotelsondiscounttoday" or col('Pg') == "frotelscouponreport" or col('Pg') == "partnertieupspending" or col('Pg') == "checkinlist") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-file icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Invoice and GST
							</a>
							<ul class="submenu <?= $visible ?>">
								<li <?php if (col("Pg") == "invoices") echo "class='active'" ?>><a href="?Pg=invoices">Invoices</a></li>
								<li <?php if (col("Pg") == "gstreport") echo "class='active'" ?>><a href="?Pg=gstreport">GST Report</a></li>
								<li <?php if (col("Pg") == "invoicesetup") echo "class='active'" ?>><a href="?Pg=invoicesetup">Invoice Setup</a></li>

							</ul>
						</li>
						<?php
					}

					if ($_SESSION['groupid'] >= 2) {
						$isBookingReport = 1;
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['MIS Reports'])) {
								$isBookingReport = !empty($decoded_data['MIS Reports']['Allow']) ? 1 : 0;
							}
						}
						if ($isBookingReport) { ?>
							<li <?php if (col('Pg') == "hotelchains" or col('Pg') == "bookings" or col('Pg') == "abandonedbookings" or col('Pg') == "weeklysales" or col('Pg') == "monthlysales" or col('Pg') == "quarterlysales" or col('Pg') == "yearlysales" or col('Pg') == "users" or col('Pg') == "totalmoneysavedforusers" or col('Pg') == "hotels" or col('Pg') == "hotelchainpartners" or col('Pg') == "agents" or col('Pg') == "corporates" or col('Pg') == "hotelsondiscounttoday" or col('Pg') == "frotelscouponreport" or col('Pg') == "partnertieupspending" or col('Pg') == "checkinlist") {
									echo "class='active'";
									$visible = "visible";
								} else $visible = ""; ?>>
								<a href="#">
									<i class="fa fa-desktop icon-sidebar"></i>
									<i class="fa fa-angle-right chevron-icon-sidebar"></i>
									MIS Reports
								</a>
								<ul class="submenu <?= $visible ?>">
									<li <?php if (col("Pg") == "bookings") echo "class='active'" ?>><a href="?Pg=bookings">Bookings</a></li>
								</ul>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] == 0) { ?>
						<li <?php if (col('Pg') == "hotelstaff") echo "class='active'" ?>>
							<a href="?Pg=hotelstaff">
								<i class="fa fa-times icon-sidebar"></i>
								Hotel staff
							</a>
						</li>
					<?php
					}
					if ($_SESSION['groupid'] == 0) { ?>
						<li <?php if (col('Pg') == "hotel_task_log") echo "class='active'" ?>>
							<a href="?Pg=hotel_task_log">
								<i class="fa fa-times icon-sidebar"></i>
								Hotel Task Log
							</a>
						</li>
					<?php
					}
					?>
					<li <?php if (col('Pg') == "agentregistration" or col('Pg') == "agentview" or col('Pg') == "agentcommission") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-file icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								Agent
							</a>
							<ul class="submenu <?= $visible ?>">
								<li <?php if (col("Pg") == "agentregistration") echo "class='active'" ?>><a href="?Pg=agentregistration">Agent Registration</a></li>
								<li <?php if (col("Pg") == "agentview") echo "class='active'" ?>><a href="?Pg=agentview">View all agent</a></li>
								<li <?php if (col("Pg") == "agentcommission") echo "class='active'" ?>><a href="?Pg=agentcommission">Agent Commission</a></li>
							</ul>
					</li>
					<?php
					if ($_SESSION['groupid'] <= 2) { ?>
						<!-- <li <?php if (col('Pg') == "cancellationrequests") echo "class='active'" ?>>
							<a href="?Pg=cancellationrequests">
								<i class="fa fa-times icon-sidebar"></i>
								Cancellation Requests
							</a>
						</li> -->
					<?php
					}
					// ---------------------------------------------

					if ($_SESSION['groupid'] == 0) { ?>
						<!-- <li <?php if (col('Pg') == "froteltaxsetup") echo "class='active'" ?>>
							<a href="?Pg=froteltaxsetup">
								<i class="fa fa-scissors icon-sidebar"></i>
								Frotel Tax Setup
							</a>
						</li> -->
					<?php
					}
					if ($_SESSION['groupid'] <= 2) { ?>
						<!-- <li <?php if (col('Pg') == "hoteltaxsetup") echo "class='active'" ?>>
							<a href="?Pg=hoteltaxsetup">
								<i class="fa fa-scissors icon-sidebar"></i>
								Hotel Tax Setup
							</a>
						</li> -->
					<?php
					}
					if ($_SESSION['groupid'] <= 2) { ?>
						<!-- <li <?php if (col('Pg') == "discounts") echo "class='active'" ?>>
							<a href="?Pg=discounts">
								<i class="fa fa-smile-o icon-sidebar"></i>
								Discounts
							</a>
						</li> -->
					<?php
					}
					if ($_SESSION['groupid'] == 0) { ?>
						<!-- <li <?php if (col('Pg') == "promocodes") echo "class='active'" ?>>
							<a href="?Pg=promocodes">
								<i class="fa fa-credit-card icon-sidebar"></i>
								Promocodes
							</a>
						</li> -->
						<?php
					}

					$isAllow = 1;
					if ($_SESSION['groupid'] > 2) {
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['Rooms'])) {
								$isAllow = !empty($decoded_data['Rooms']['Allow']) ? 1 : 0;
							}
						}
						if ($isAllow) { ?>
							<li <?php if (col('Pg') == "setroomtypes" or col('Pg') == "roomdetails" or col('Pg') == "roomsavailability" or col('Pg') == "hotelnormalrates" or col('Pg') == "specialrates" or col('Pg') == "multiple_room_blocking" or col('Pg') == "cmsetup") {
									echo "class='active'";
									$visible = "visible";
								} else $visible = ""; ?>>
								<a href="#">
									<i class="fa fa-key icon-sidebar"></i>
									<i class="fa fa-angle-right chevron-icon-sidebar"></i>
									Rooms
								</a>
								<ul class="submenu <?= $visible ?>">
									<li <?php if (col("Pg") == "setroomtypes") echo "class='active'" ?>><a href="?Pg=setroomtypes">Set Room Types</a></li>
									<li <?php if (col("Pg") == "roomdetails") echo "class='active'" ?>><a href="?Pg=roomdetails">Room Details</a></li>
									<li <?php if (col("Pg") == "setroomplanrate") echo "class='active'" ?>><a href="?Pg=setroomplanrate">Set Room Rate</a></li>
									<li <?php if (col("Pg") == "setseasonalroomplanrate") echo "class='active'" ?>><a href="?Pg=setseasonalroomplanrate">Set Seasonal Room Rate</a></li>
									<li <?php if (col("Pg") == "roomsavailability") echo "class='active'" ?>><a href="?Pg=roomsavailability">Set Availability</a></li>
									<li <?php if (col("Pg") == "cmsetup") echo "class='active'" ?>><a href="?Pg=cmsetup">CM setup</a></li>
									<!-- <li <?php if (col("Pg") == "hotelnormalrates") echo "class='active'" ?>><a href="?Pg=hotelnormalrates">Hourly Rate Setup</a></li> -->
									<!-- <li <?php if (col("Pg") == "specialrates") echo "class='active'" ?>><a href="?Pg=specialrates">Special Rates</a></li> -->
									<li <?php if (col("Pg") == "multiple_room_blocking") echo "class='active'" ?>><a href="?Pg=multiple_room_blocking">Bulk Room Activities</a></li>
								</ul>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] >= 2) {
						$isAllow = 1;
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['Hotel Staff Details'])) {
								$isAllow = !empty($decoded_data['Hotel Staff Details']['Allow']) ? 1 : 0;
							}
						}
						if ($isAllow) { ?>
							<li <?php if (col('Pg') == "hotelstaff") echo "class='active'" ?>>
								<a href="?Pg=hotelstaff">
									<i class="fa fa-times icon-sidebar"></i>
									Hotel staff
								</a>
							</li>
						<?php
						}
					}
					if ($_SESSION['groupid'] >= 2) {
						$isHotelLog = 1;
						if (isset($_SESSION['groupid']) && $_SESSION['groupid'] >= 3 && $_SESSION['groupid'] <= 4) {
							$decoded_data = json_decode(html_entity_decode($_SESSION['permission']), true);

							// Ensure $decoded_data is a valid array
							if (is_array($decoded_data) && isset($decoded_data['Hotel Task Log'])) {
								$isHotelLog = !empty($decoded_data['Hotel Task Log']['Allow']) ? 1 : 0;
							}
						}
						if ($isHotelLog) { ?>
							<li <?php if (col('Pg') == "hotel_task_log") echo "class='active'" ?>>
								<a href="?Pg=hotel_task_log">
									<i class="fa fa-times icon-sidebar"></i>
									Hotel Task Log
								</a>
							</li>
						<?php
						}
					}

					if ($_SESSION['groupid'] <= 4) {
						if ($isAssign || $isEdit || $isDelete) { ?>
							<li <?php if (col('Pg') == "roominventory") echo "class='active'" ?>>
								<a href="?Pg=roominventory" onclick=updateLocalStorageAvailibility()>
									<i class="fa fa-tag icon-sidebar"></i>
									Show Availability
								</a>
							</li>
						<?php
						}
					}


					if ($_SESSION['groupid'] == 0)
					//if($_SESSION['groupid'] <= 2 and 0)
					{ ?>
						<li <?php if (col('Pg') == "hotelchains" or col('Pg') == "bookings" or col('Pg') == "abandonedbookings" or col('Pg') == "weeklysales" or col('Pg') == "monthlysales" or col('Pg') == "quarterlysales" or col('Pg') == "yearlysales" or col('Pg') == "users" or col('Pg') == "totalmoneysavedforusers" or col('Pg') == "hotels" or col('Pg') == "hotelchainpartners" or col('Pg') == "agents" or col('Pg') == "corporates" or col('Pg') == "hotelsondiscounttoday" or col('Pg') == "frotelscouponreport" or col('Pg') == "partnertieupspending" or col('Pg') == "checkinlist") {
								echo "class='active'";
								$visible = "visible";
							} else $visible = ""; ?>>
							<a href="#">
								<i class="fa fa-desktop icon-sidebar"></i>
								<i class="fa fa-angle-right chevron-icon-sidebar"></i>
								MIS Reports
							</a>
							<ul class="submenu <?= $visible ?>">
								<!-- <li <?php if (col("Pg") == "hotelchains") echo "class='active'" ?>><a href="?Pg=hotelchains">Hotel Chains</a></li> -->
								<!-- <li <?php if (col("Pg") == "hotels") echo "class='active'" ?>><a href="?Pg=hotels">Hotels</a></li> -->
								<!-- <li <?php if (col("Pg") == "bookings") echo "class='active'" ?>><a href="?Pg=bookings">Bookings</a></li> -->
								<!-- <li <?php if (col("Pg") == "abandonedbookings") echo "class='active'" ?>><a href="?Pg=abandonedbookings">Abandoned Bookings</a></li>
								<li <?php if (col("Pg") == "users") echo "class='active'" ?>><a href="?Pg=users">Travelers</a></li> -->
								<!-- <li <?php if (col("Pg") == "weeklysales") echo "class='active'" ?>><a href="?Pg=weeklysales">Weekly Sales</a></li>
									<li <?php if (col("Pg") == "monthlysales") echo "class='active'" ?>><a href="?Pg=monthlysales">Monthly Sales</a></li>
									<li <?php if (col("Pg") == "quarterlysales") echo "class='active'" ?>><a href="?Pg=quarterlysales">Quarterly Sales</a></li>
									<li <?php if (col("Pg") == "yearlysales") echo "class='active'" ?>><a href="?Pg=yearlysales">Yearly Sales</a></li> -->
								<!-- 
								<li <?php if (col("Pg") == "moneysavedforusers") echo "class='active'" ?>><a href="?Pg=moneysavedforusers">Money Saved For Users</a></li>

								<li <?php if (col("Pg") == "hotelchainpartners") echo "class='active'" ?>><a href="?Pg=hotelchainpartners">Hotel Chain Partners</a></li>
								<li <?php if (col("Pg") == "agents") echo "class='active'" ?>><a href="?Pg=agents">Agents</a></li>
								<li <?php if (col("Pg") == "corporates") echo "class='active'" ?>><a href="?Pg=corporates">Corporates</a></li>
								<li <?php if (col("Pg") == "hotelsondiscounttoday") echo "class='active'" ?>><a href="?Pg=hotelsondiscounttoday">Hotels on Discount today</a></li>
								<li <?php if (col("Pg") == "frotelscouponreport") echo "class='active'" ?>><a href="?Pg=frotelscouponreport">Frotels Coupon Report</a></li>
								<li <?php if (col("Pg") == "partnertieupspending") echo "class='active'" ?>><a href="?Pg=partnertieupspending">Partner Tie Ups Pending</a></li>
								<li <?php if (col("Pg") == "checkinlist") echo "class='active'" ?>><a href="?Pg=checkinlist">Check in List</a></li> -->
							</ul>
						</li>
					<?php
					}



					if ($_SESSION['hotel'] > 0) {
						$c1 = "";
						$c2 = "";
						$c3 = "";
						$c4 = "";
						$c5 = "";

						$rs_row = execute("select frotellisting,daybooking,nightbooking,allowbulkbooking,unmarriedcouple from hotels where id=$_SESSION[hotel]");
						if ($rs_row['frotellisting'])
							$c1 = "checked";
						if ($rs_row['daybooking'])
							$c2 = "checked";
						if ($rs_row['nightbooking'])
							$c3 = "checked";
						if ($rs_row['unmarriedcouple'])
							$c4 = "checked";
						if ($rs_row['allowbulkbooking'])
							$c5 = "checked"; ?>

						<!-- <li class="static">DECISIONS</li>
						<li class="text-content">
							<div class="switch">
								<div class="onoffswitch blank">
									<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="switch1" onChange="toggleswitch('frotellisting')" <?= $c1 ?>>
									<label class="onoffswitch-label" for="switch1">
										<span class="onoffswitch-inner"></span>
										<span class="onoffswitch-switch"></span>
									</label>
								</div>
							</div>
							Show listing on frotel portal
						</li>
						<li class="text-content">
							<div class="switch">
								<div class="onoffswitch blank">
									<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="switch3" onChange="toggleswitch('nightbooking')" <?= $c3 ?>>
									<label class="onoffswitch-label" for="switch3">
										<span class="onoffswitch-inner"></span>
										<span class="onoffswitch-switch"></span>
									</label>
								</div>
							</div>
							Allow hourly night booking
						</li>
						<li class="text-content">
							<div class="switch">
								<div class="onoffswitch blank">
									<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="switch4" onChange="toggleswitch('unmarriedcouple')" <?= $c4 ?>>
									<label class="onoffswitch-label" for="switch4">
										<span class="onoffswitch-inner"></span>
										<span class="onoffswitch-switch"></span>
									</label>
								</div>
							</div>
							Allow unmarried coulples
						</li>
						<li class="text-content">
							<div class="switch">
								<div class="onoffswitch blank">
									<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="switch5" onChange="toggleswitch('allowbulkbooking')" <?= $c5 ?>>
									<label class="onoffswitch-label" for="switch5">
										<span class="onoffswitch-inner"></span>
										<span class="onoffswitch-switch"></span>
									</label>
								</div>
							</div>
							Allow group booking
						</li> -->
					<?php
					} ?>
				</ul>
			</div>
    <div class="page-content <?= col("Pg") == "specialrates" ? "toggle" : "" ?>">
      <div class="container-fluid" style="padding-right: 30px;
	padding-left: 30px;">
        <div class="container-fluid" style="padding-right:30px; padding-left:30px">
          <?php if ($_GET['Pg'] != "") {
							$page_access = page_access($_GET['Pg']);

							if ($_GET['Pg'] == "basicinfo" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['hotel'])) {
									$address1 = $_POST['address1'];
									$address2 = $_POST['address2'];
									$landmark = $_POST['landmark'];
									$locality = $_POST['locality'];
									$newlocality = $_POST['newlocality'];
									$website = $_POST['website'];
									$smalldesc = $_POST['smalldesc'];
									$detaileddesc = $_POST['detaileddesc'];
									$latitude = $_POST['latitude'];
									$longitude = $_POST['longitude'];
									$stars = $_POST['stars'];
									$propertytype = $_POST['propertytype'];
									$bulkbooking = $_POST['bulkbooking'];
									$city = $_POST['city'];
									$keywords = $_POST['meta_keywords'];
									$description = $_POST['meta_description'];

									if ($locality > 0)
										$location = $locality;
									else {
										$row = execute("select city from users where id=$_SESSION[id]");
										$location = insert("insert into locations (city,location,approved) values ($city,'$newlocality',1)");
									}

									$hotelid = $_SESSION['hotel'];

									$conn->query("update hotels set location=$location,propertytype='$propertytype',latitude='$latitude',longitude='$longitude', minidescription='$smalldesc',fulldescription='$detaileddesc',allowbulkbooking=$bulkbooking,meta_keywords='$keywords',stars=$stars, meta_description='$description' where id=$hotelid");

									$conn->query("update users u join hotels h on h.user=u.id set u.address1='$address1',u.address2='$address2',u.landmark='$landmark', u.website='$website',u.city=(select city from locations where id=$location) where h.id=$_SESSION[hotel]");

									$clrclass = "success";
									$msg = "Hotel info updated";
								}
								pms_info_status(); ?>

          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <form method="post" action="">
              <h4 class="small-title">BASIC INFO</h4>
              <?php alertbox($clrclass, $msg);
										$msg = "";
										$row = execute("select u.company,u.address1,u.address2,u.landmark,u.city as cityid,c.city,s.id as state,con.country,h.location, u.website,h.minidescription,h.fulldescription,h.latitude,h.longitude,h.propertytype,h.stars,h.allowbulkbooking,h.meta_keywords, h.meta_description from hotels h join users u on u.id=h.user left join cities c on c.id=u.city left join states s on s.id=c.state left join countries con on con.id=s.country where h.id=$_SESSION[hotel]"); ?>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Hotel Name</label>
                    <input type="text" class="form-control" name="hotel" value="<?= $row['company'] ?>" readonly>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Address Line 1</label>
                    <input type="text" class="form-control" name="address1" value="<?= $row['address1'] ?>" required>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Address Line 2</label>
                    <input type="text" class="form-control" name="address2" value="<?= $row['address2'] ?>" required>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Pincode</label><!-- Pankaj asked to change landmark to pincode -->
                    <input type="text" class="form-control" name="landmark" value="<?= $row['landmark'] ?>">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Country</label>
                    <input type="text" class="form-control" name="country" value="<?= $row['country'] ?>" readonly>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>State</label>
                    <select class="form-control" name="state" id="state" onChange="getcities(this.value)">
                      <option value="">Select State</option>
                      <?php $rs = $conn->query("select * from states order by id");
														while ($rs_row = $rs->fetch_assoc()) { ?>
                      <option value="<?= $rs_row['id'] ?>" <?= selected($rs_row['id'], $row['state']) ?>>
                        <?= $rs_row['state'] ?></option>
                      <?php
														} ?>
                    </select>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>City</label>
                    <select class="form-control" name="city" id="city" onChange="getlocations(this.value)">
                      <?php $rs = $conn->query("select * from cities where state=$row[state] order by id");
														if ($rs->num_rows > 0) {
															while ($rs_row = $rs->fetch_assoc()) { ?>
                      <option value="<?= $rs_row['id'] ?>" <?= selected($rs_row['id'], $row['cityid']) ?>>
                        <?= $rs_row['city'] ?></option>
                      <?php
															}
														} ?>
                    </select>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Locality</label>
                    <select class="form-control" id="locality" name="locality" onChange="checklocality(this.value)"
                      required>
                      <option value="">Select Locality</option>
                      <option value="0">Add new location</option>
                      <?php $rs = $conn->query("select id,location from locations where city=$row[cityid] order by location");
														if ($rs->num_rows > 0) {
															while ($rs_row = $rs->fetch_assoc()) { ?>
                      <option value="<?= $rs_row['id'] ?>" <?= selected($rs_row['id'], $row['location']) ?>>
                        <?= $rs_row['location'] ?></option>
                      <?php
															}
														} ?>
                    </select>
                    <div id="localitydiv" style="display:none">
                      <br><input type="text" id="newlocality" name="newlocality" class="form-control" name="newlocality"
                        placeholder="Enter locality here">
                    </div>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Property Type</label>
                    <select class="form-control" name="propertytype">
                      <option value="Hotel" <?= selected($row['propertytype'], "Hotel") ?>>Hotel
                      </option>
                      <option value="Resort" <?= selected($row['propertytype'], "Resort") ?>>Resort
                      </option>
                      <option value="Motel" <?= selected($row['propertytype'], "Motel") ?>>Motel
                      </option>
                      <option value="Bed n Breakfast" <?= selected($row['propertytype'], "Bed n Breakfast") ?>>Bed n
                        Breakfast</option>
                      <option value="Hostel" <?= selected($row['propertytype'], "Hostel") ?>>Hostel
                      </option>
                      <option value="Home Stay" <?= selected($row['propertytype'], "Home Stay") ?>>
                        Home Stay</option>
                      <option value="Service Apartment" <?= selected($row['propertytype'], "Service Apartment") ?>>
                        Service Apartment</option>
                      <option value="Bungalow" <?= selected($row['propertytype'], "Bungalow") ?>>
                        Bungalow</option>
                      <option value="Villa" <?= selected($row['propertytype'], "Villa") ?>>Villa
                      </option>
                      <option value="Lodge" <?= selected($row['propertytype'], "Lodge") ?>>Lodge
                      </option>
                      <option value="Guest House" <?= selected($row['propertytype'], "Guest House") ?>>Guest House
                      </option>
                      <option value="Other" <?= selected($row['propertytype'], "Other") ?>>Other
                      </option>
                    </select>
                  </div>
                </div>
              </div><br>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Allow Agents For Bulk Booking</label>
                    <div style="margin-left:-10px;">
                      <div class="radio-6">
                        <input type="radio" class="form-control" name="bulkbooking" value="1"
                          <?= checked($row['allowbulkbooking'], 1) ?>>Yes
                      </div>
                      <div class="radio-6">
                        <input type="radio" class="form-control" name="bulkbooking" value="0"
                          <?= checked($row['allowbulkbooking'], 0) ?>>No
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Hotel Rating</label>
                    <select class="form-control" name="stars" required>
                      <option value="">Select Hotel Rating</option>
                      <option value="1" <?= selected($row['stars'], "1") ?>>1 Star</option>
                      <option value="2" <?= selected($row['stars'], "2") ?>>2 Star</option>
                      <option value="3" <?= selected($row['stars'], "3") ?>>3 Star</option>
                      <option value="4" <?= selected($row['stars'], "4") ?>>4 Star</option>
                      <option value="5" <?= selected($row['stars'], "5") ?>>5 Star</option>
                    </select>
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Website</label>
                    <input type="text" class="form-control" name="website" value="<?= $row['website'] ?>">
                  </div>
                </div>
                <div class="col-xs-12" style="font-size:13px;padding-bottom:10px;">
                  <b>Note:</b> What is bulk / group booking? We allow our Agent network to take bulk
                  Hotel booking for big groups. If you allow bulk/group booking, we will list / show /
                  reflect your property on our portal against such enquires from our Agents. If you
                  select yes, you need to define maximum people allowed in each room type & rate per
                  extra person allowed in bulk booking section while you are defining room types.
                </div>
              </div>
              <div class="row">
                <div class="col-xs-6">
                  <label>Small Description</label>
                  <textarea class="form-control" rows="4" name="smalldesc"><?= $row['minidescription'] ?></textarea>
                </div>
                <div class="col-xs-6">
                  <label>Detailed Description</label>
                  <textarea class="form-control" rows="4" name="detaileddesc"><?= $row['fulldescription'] ?></textarea>
                </div>
              </div>
              <h4 class="small-text">Show Hotel Location on Map</h4>
              <div class="row">
                <div class="col-xs-12">
                  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
                  <script type="text/javascript"
                    src='https://maps.google.com/maps/api/js?key=AIzaSyBLZ9ZLnTdY6vAdJ9ty5OSYDeqvyfDXGgQ&sensor=false&libraries=places'>
                  </script>
                  <script src="locationpicker/locationpicker.jquery.min.js"></script>
                  <input type="hidden" class="form-control" id="us3-radius" />
                  <div class="row">
                    <div class="col-xs-6">
                      <div class="form-group">
                        <label>Location</label>
                        <input type="text" class="form-control" id="us3-address" value="Mumbai" />
                      </div>
                    </div>
                    <div class="col-xs-3">
                      <div class="form-group">
                        <label>Latitude</label>
                        <input type="text" class="form-control" name="latitude" value="<?= $row['latitude'] ?>"
                          id="us3-lat" readonly />
                      </div>
                    </div>
                    <div class="col-xs-3">
                      <div class="form-group">
                        <label>Longitude</label>
                        <input type="text" class="form-control" name="longitude" value="<?= $row['longitude'] ?>"
                          id="us3-lon" readonly />
                      </div>
                    </div>
                    <div class="col-xs-12">
                      <p class="help-block">Please type your location & drag location marker to
                        your hotel's exact location.</p>
                    </div>
                    <div class="col-xs-12">
                      <div id="us3" style="width:100%; height:400px;"></div>
                    </div>
                    <?php if ($row['latitude'] == "" and $row['longitude'] == "") {
														$zoom = 10;
													} else {
														$zoom = 16;
													}
													if ($row['latitude'] != "")
														$latitude = $row['latitude'];
													else
														$latitude = 21;

													if ($row['longitude'] != "")
														$longitude = $row['longitude'];
													else
														$longitude = 78; ?>
                    <script>
                    $('#us3').locationpicker({
                      location: {
                        latitude: <?= $latitude ?>,
                        longitude: <?= $longitude ?>
                      },
                      radius: 0,
                      zoom: <?= $zoom ?>,
                      inputBinding: {
                        latitudeInput: $('#us3-lat'),
                        longitudeInput: $('#us3-lon'),
                        radiusInput: $('#us3-radius'),
                        locationNameInput: $('#us3-address')
                      },
                      enableAutocomplete: true,
                      onchanged: function(currentLocation, radius, isMarkerDropped) {
                        // Uncomment line below to show alert on each Location Changed event
                        //alert("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");
                      }
                    });
                    </script>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="form-group"><br></div>
              </div>
              <h4 class="small-text">SEO Related</h4>
              <div class="row">
                <div class="col-xs-6">
                  <label>Keywords</label>
                  <textarea class="form-control" name="meta_keywords" rows="4"><?= $row['meta_keywords'] ?></textarea>
                </div>
                <div class="col-xs-6">
                  <label>Description</label>
                  <textarea class="form-control" name="meta_description"
                    rows="4"><?= $row['meta_description'] ?></textarea>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <br><input type="submit" class="btn btn-primary" value="Save">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "contactinfo" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['conper'])) {
									$conper = $_POST['conper'];
									$conperemail = $_POST['conperemail'];
									$conpercontact = $_POST['conpercontact'];
									$hotellandline = $_POST['hotellandline'];
									$gm = $_POST['gm'];
									$gmemail = $_POST['gmemail'];
									$gmcontact = $_POST['gmcontact'];
									$owner = $_POST['owner'];
									$owneremail = $_POST['owneremail'];
									$ownercontact = $_POST['ownercontact'];
									$accountant = $_POST['accountant'];
									$accountantemail = $_POST['accountantemail'];
									$accountantcontact = $_POST['accountantcontact'];
									$anotherposition = $_POST['anotherposition'];
									$apconper = $_POST['apconper'];
									$apemail = $_POST['apemail'];
									$apcontact = $_POST['apcontact'];
									$anotherposition2 = $_POST['anotherposition2'];
									$apconper2 = $_POST['apconper2'];
									$apemail2 = $_POST['apemail2'];
									$apcontact2 = $_POST['apcontact2'];
									$anotherposition3 = $_POST['anotherposition3'];
									$apconper3 = $_POST['apconper3'];
									$apemail3 = $_POST['apemail3'];
									$apcontact3 = $_POST['apcontact3'];

									//$qry = "update users set  where id=$_SESSION[id]";
									//$conn->query($qry);
					
									$qry = "update hotels h join users u on u.id=h.user set u.fullname='$conper',u.email='$conperemail',u.contact='$conpercontact', h.landline='$hotellandline', h.generalmanager='$gm', h.gmemail='$gmemail',h.gmcontact='$gmcontact',h.owner='$owner', h.owneremail= '$owneremail',h.ownercontact='$ownercontact',h.accountant='$accountant',h.acemail='$accountantemail',h.accontact= '$accountantcontact',h.extraposition='$anotherposition',h.extrapositionname='$apconper',h.extrapositionemail='$apemail', h.extrapositioncontact='$apcontact',h.extraposition2='$anotherposition2',h.extrapositionname2='$apconper2',h.extrapositionemail2= '$apemail2',h.extrapositioncontact2='$apcontact2',h.extraposition3='$anotherposition3',h.extrapositionname3='$apconper3', h.extrapositionemail3='$apemail3',h.extrapositioncontact3='$apcontact3' where h.id=$_SESSION[hotel]";
									$conn->query($qry);

									$clrclass = "success";
									$msg = "Contact info updated";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <h4 class="small-title">CONTACT INFO</h4>
            <?php alertbox($clrclass, $msg);
									$msg = "";
									$row = execute("select u.fullname,u.email,u.contact,h.landline,h.generalmanager,h.gmemail,h.gmcontact,h.owner,h.owneremail, h.ownercontact,h.accountant,h.acemail,h.accontact,h.extraposition,h.extrapositionname,h.extrapositionemail,h.extrapositioncontact,h.extraposition2,h.extrapositionname2,h.extrapositionemail2,h.extrapositioncontact2,h.extraposition3,h.extrapositionname3,h.extrapositionemail3,h.extrapositioncontact3 from hotels h join users u on u.id=h.user where h.id=$_SESSION[hotel]"); ?>
            <form method="post" action="">
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="conper" value="<?= $row['fullname'] ?>"
                      title="Front Desk Manager / Booking Manager (All booking related communicatin will be addressed to this person)"
                      required>
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="conperemail" value="<?= $row['email'] ?>"
                      title="On this email address you will get all the notificatin regarding booking from Frotels.com"
                      required>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Mobile No.</label>
                    <input type="text" class="form-control" name="conpercontact" value="<?= $row['contact'] ?>"
                      title="On this number you will get all the notificatin regarding booking from Frotels.com"
                      required>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Hotel Landline</label>
                    <input type="text" class="form-control" name="hotellandline" value="<?= $row['landline'] ?>"
                      title="Hotel's landline number" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>General Manager</label>
                    <input type="text" class="form-control" name="gm" value="<?= $row['generalmanager'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="gmemail" value="<?= $row['gmemail'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="gmcontact" value="<?= $row['gmcontact'] ?>" title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Owner</label>
                    <input type="text" class="form-control" name="owner" value="<?= $row['owner'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="owneremail" value="<?= $row['owneremail'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="ownercontact" value="<?= $row['ownercontact'] ?>"
                      title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Accountant</label>
                    <input type="text" class="form-control" name="accountant" value="<?= $row['accountant'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="accountantemail" value="<?= $row['acemail'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="accountantcontact" value="<?= $row['accontact'] ?>"
                      title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Another Position (if any)</label>
                    <input type="text" class="form-control" name="anotherposition" value="<?= $row['extraposition'] ?>"
                      title="Position name e.g. Booking Manager">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="apconper" value="<?= $row['extrapositionname'] ?>"
                      title="Name of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="apemail" value="<?= $row['extrapositionemail'] ?>"
                      title="Email of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="apcontact" value="<?= $row['extrapositioncontact'] ?>"
                      title="Contact no. of concerned person">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Another Position (if any)</label>
                    <input type="text" class="form-control" name="anotherposition2"
                      value="<?= $row['extraposition2'] ?>" title="Position name e.g. Booking Manager">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="apconper2" value="<?= $row['extrapositionname2'] ?>"
                      title="Name of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="apemail2" value="<?= $row['extrapositionemail2'] ?>"
                      title="Email of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="apcontact2"
                      value="<?= $row['extrapositioncontact2'] ?>" title="Contact no. of concerned person">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Another Position (if any)</label>
                    <input type="text" class="form-control" name="anotherposition3"
                      value="<?= $row['extraposition3'] ?>" title="Position name e.g. Booking Manager">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="apconper3" value="<?= $row['extrapositionname3'] ?>"
                      title="Name of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="apemail3" value="<?= $row['extrapositionemail3'] ?>"
                      title="Email of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="apcontact3"
                      value="<?= $row['extrapositioncontact3'] ?>" title="Contact no. of concerned person">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="Save">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "usefulinfo" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['goodfor']) or isset($_POST['landmark'])) {
									$conn->query("delete hf from hotel_facilities hf join facilities f on f.id=hf.facility where hf.hotel=$_SESSION[hotel] and f.type=1");
									$sql = "insert into hotel_facilities (hotel,facility) values ";
									foreach ($_POST['goodfor'] as $goodfor) {
										if ($sql == "insert into hotel_facilities (hotel,facility) values ")
											$sql .= "($_SESSION[hotel],$goodfor)";
										else
											$sql .= ",($_SESSION[hotel],$goodfor)";
									}
									if ($sql != "insert into hotel_facilities (hotel,facility) values ")
										$conn->query($sql);

									$conn->query("delete from hotel_proximities where hotel=$_SESSION[hotel]");
									$sql = "insert into hotel_proximities (hotel,proximity,landmarkname,km) values ";
									foreach ($_POST['landmark'] as $key => $landmark) {
										$landmarkname = $_POST['landmarkname'][$key];
										$distance = $_POST['distance'][$key];

										if ($sql == "insert into hotel_proximities (hotel,proximity,landmarkname,km) values ")
											$sql .= "($_SESSION[hotel],$landmark,'$landmarkname',$distance)";
										else
											$sql .= ",($_SESSION[hotel],$landmark,'$landmarkname',$distance)";
									}
									if ($sql != "insert into hotel_proximities (hotel,proximity,landmarkname,km) values ")
										$conn->query($sql);

									$clrclass = "success";
									$msg = "Useful Info updated";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <h4 class="small-title">USEFUL INFO</h4>
            <?php alertbox($clrclass, $msg);
									$msg = ""; ?>
            <form method="post" action="?Pg=usefulinfo">
              <div class="row">
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>Hotel Good For</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=1");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="goodfor[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div style="clear:both;"><br></div>
                <div class="col-xs-9">
                  <div class="form-group">
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select p.id,p.proximity,coalesce(hp.proximity,0)matched,hp.landmarkname,hp.km from proximities p left join hotel_proximities hp on (p.id=hp.proximity and hp.hotel=$_SESSION[hotel])");
														$row = $result->fetch_assoc(); ?>
                      <div class="radio-4">
                        <label>Hotel's Distance From</label>
                        <div>
                          <input type="checkbox" class="form-control" id="landmark1" name="landmark[]" value="1"
                            onChange="distancefrom(this.value)" checked>Airport
                        </div>
                      </div>
                      <div class="radio-4">
                        <label>Name</label>
                        <div>
                          <input type="text" class="form-control" id="landmarkname1" name="landmarkname[]"
                            placeholder="E.g. IGI Airport" value="<?= $row['landmarkname'] ?>" required>
                        </div>
                      </div>
                      <div class="radio-2">
                        <label>Distance in KM</label>
                        <div>
                          <input type="text" class="form-control" id="distance1" name="distance[]" placeholder="E.g. 2"
                            title="Enter only number. Don't write KM" value="<?= $row['km'] ?>" required>
                        </div>
                      </div>

                      <?php while ($row = $result->fetch_assoc()) {
															$disabled = ($row['id'] == $row['matched'] or $row['id'] <= 3) ? "" : "disabled";
															$checked = ($row['id'] == $row['matched'] or $row['id'] <= 3) ? "checked" : ""; ?>

                      <div class="radio-4">
                        <input type="checkbox" class="form-control" id="landmark<?= $row['id'] ?>" name="landmark[]"
                          value="<?= $row['id'] ?>" onChange="distancefrom(this.value)" <?= $checked ?>
                          <?= ($row['id'] <= 3) ? "required" : ""; ?>><?= $row['proximity'] ?>
                      </div>
                      <div class="radio-4">
                        <input type="text" class="form-control" id="landmarkname<?= $row['id'] ?>" name="landmarkname[]"
                          <?= $disabled ?> value="<?= $row['landmarkname'] ?>"
                          <?= ($row['id'] <= 3) ? "required" : ""; ?>>
                      </div>
                      <div class="radio-2">
                        <input type="text" class="form-control" id="distance<?= $row['id'] ?>" name="distance[]"
                          title="Enter only number. Don't write KM" <?= $disabled ?> value="<?= $row['km'] ?>"
                          <?= ($row['id'] <= 3) ? "required" : ""; ?>>
                      </div>
                      <?php
														} ?>

                      <!-- <div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark3" name="landmark[]" value="3" onChange="distancefrom(this.value)">Main Bus Stop
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname3" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance3" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark4" name="landmark[]" value="4" onChange="distancefrom(this.value)">City Centre
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname4" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance4" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark5" name="landmark[]" value="5" onChange="distancefrom(this.value)">Closest Railway Station
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname5" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance5" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark6" name="landmark[]" value="6" onChange="distancefrom(this.value)">Closest Bus Stop
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname6" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance6" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark7" name="landmark[]" value="7" onChange="distancefrom(this.value)">Any Famous Religious Place
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname7" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance7" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark8" name="landmark[]" value="8" onChange="distancefrom(this.value)">Any Famous Market Place
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname8" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance8" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark9" name="landmark[]" value="9" onChange="distancefrom(this.value)">Any Famous Hospital
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname9" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance9" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div>

														<div class="radio-4">
															<input type="checkbox" class="form-control" id="landmark10" name="landmark[]" value="10" onChange="distancefrom(this.value)">Any Famous Exam Centre
														</div>
														<div class="radio-4">
															<input type="text" class="form-control" id="landmarkname10" name="landmarkname[]" disabled>
														</div>
														<div class="radio-2">
															<input type="text" class="form-control" id="distance10" name="distance[]" title="Enter only number. Don't write KM" disabled>
														</div> -->
                    </div>
                  </div>
                </div>
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="Save">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "facilities" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['facility'])) {
									$dining = col("dining", 0);
									$wifi = col("wifi", 0);
									$traveldesk = col("traveldesk", 0);
									$gym = col("gym", 0);
									$parking = col("parking", 0);
									$tv = col("tv", 0);

									$conn->query("update hotels set dining=$dining,wifi=$wifi,traveldesk=$traveldesk,gym=$gym,parking=$parking,tv=$tv where id=$_SESSION[hotel]");

									$conn->query("delete hf from hotel_facilities hf join facilities f on f.id=hf.facility where hf.hotel=$_SESSION[hotel] and f.type>1");
									$sql = "insert into hotel_facilities (hotel,facility) values ";
									foreach ($_POST['facility'] as $facility) {
										if ($sql == "insert into hotel_facilities (hotel,facility) values ")
											$sql .= "($_SESSION[hotel],$facility)";
										else
											$sql .= ",($_SESSION[hotel],$facility)";
									}
									if ($sql != "insert into hotel_facilities (hotel,facility) values ")
										$conn->query($sql);

									$clrclass = "success";
									$msg = "Facilities Info updated";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <h4 class="small-title">FACILITIES / AMENITIES</h4>
            <?php alertbox($clrclass, $msg);
									$msg = ""; ?>
            <form method="post" name="myform" action="?Pg=facilities">
              <div class="row">
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>HOTEL Facilities (For showing icons in search results)</label>
                    <div style="margin-left:-10px;">
                      <?php $row = execute("select dining,wifi,traveldesk,gym,parking,tv from hotels where id=$_SESSION[hotel]"); ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="diningico" name="dining" value="1"
                          <?= checked($row['dining'], 1) ?> onChange="auto_select('diningico')"><img
                          src="../images/listing-page/dining-a.png" width="16" height="16" border="0" alt=""> Dining
                      </div>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="wifiico" name="wifi" value="1"
                          <?= checked($row['wifi'], 1) ?> onChange="auto_select('wifiico')"><img
                          src="../images/listing-page/wifi-a.png" width="18" height="14" border="0" alt=""> Free Wifi
                      </div>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="traveldeskico" name="traveldesk" value="1"
                          <?= checked($row['traveldesk'], 1) ?> onChange="auto_select('traveldeskico')"><img
                          src="../images/listing-page/travel-desk-a.png" width="20" height="15" border="0" alt="">
                        Traveldesk
                      </div>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="gymico" name="gym" value="1"
                          <?= checked($row['gym'], 1) ?> onChange="auto_select('gymico')"><img
                          src="../images/listing-page/gym-a.png" width="32" height="13" border="0" alt=""> Gym
                      </div>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="parkingico" name="parking" value="1"
                          <?= checked($row['parking'], 1) ?> onChange="auto_select('parkingico')"><img
                          src="../images/listing-page/parking-a.png" width="16" height="16" border="0" alt=""> Parking
                      </div>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" id="tvico" name="tv" value="1"
                          <?= checked($row['tv'], 1) ?>><img src="../images/listing-page/tv-a.png" width="18"
                          height="15" border="0" alt=""> TV
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>HOTEL Facilities</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=2");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="facility[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>
                          onChange="auto_select('<?= str_replace(" ", "_", $row['facility']) ?>')"
                          id="<?= str_replace(" ", "_", $row['facility']) ?>"><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>Food & Beverages</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=3");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="facility[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div style="clear:both;"><br></div>
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>For Children</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=4");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="facility[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div style="clear:both;"><br></div>
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>Wellness Centre / Spa</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=5");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="facility[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div style="clear:both;"><br></div>
                <div class="col-xs-12">
                  <div class="form-group">
                    <label>Activities & Sports Facility</label>
                    <div style="margin-left:-10px;">
                      <?php $result = $conn->query("select f.id,f.facility,coalesce(hf.facility,0)matched from facilities f left join hotel_facilities hf on (f.id=hf.facility and hf.hotel=$_SESSION[hotel]) where f.type=6");
														while ($row = $result->fetch_assoc()) { ?>
                      <div class="radio-3">
                        <input type="checkbox" class="form-control" name="facility[]" value="<?= $row['id'] ?>"
                          <?= checked($row['id'], $row['matched']) ?>><?= $row['facility'] ?>
                      </div>
                      <?php
														} ?>
                    </div>
                  </div>
                </div>
                <div style="clear:both;"><br></div>
                <div class="col-xs-12">
                  <input type="button" class="btn btn-primary" onClick="validate_facilities()" value="Save">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "hotelimages" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_FILES['propic'])) {
									if ($_FILES['propic']['name'] != "") {
										$result = $conn->query("select id,path from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Hotel Profile Picture'");
										if ($result->num_rows > 0) {
											$row = $result->fetch_assoc();
											$path = $row['path'];
											$picid = $row['id'];

											deletefile("images/propertypics/hotel/big/" . $path);
											deletefile("images/propertypics/hotel/medium/" . $path);
											deletefile("images/propertypics/hotel/small/" . $path);
											$conn->query("delete from pictures where id=$picid");
										}
										insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','Hotel Profile Picture','" . saveimage("propic", "images/propertypics/hotel/", 0) . "')");
									}
									if ($_FILES['parkinglot']['name'] != "") {
										$result = $conn->query("select id,path from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Parking Lot'");
										if ($result->num_rows > 0) {
											$row = $result->fetch_assoc();
											$path = $row['path'];
											$picid = $row['id'];

											deletefile("images/propertypics/hotel/big/" . $path);
											deletefile("images/propertypics/hotel/medium/" . $path);
											deletefile("images/propertypics/hotel/small/" . $path);
											$conn->query("delete from pictures where id=$picid");
										}
										insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','Parking Lot','" . saveimage("parkinglot", "images/propertypics/hotel/", 0) . "')");
									}
									if ($_FILES['reception']['name'] != "") {
										$result = $conn->query("select id,path from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Reception'");
										if ($result->num_rows > 0) {
											$row = $result->fetch_assoc();
											$path = $row['path'];
											$picid = $row['id'];

											deletefile("images/propertypics/hotel/big/" . $path);
											deletefile("images/propertypics/hotel/medium/" . $path);
											deletefile("images/propertypics/hotel/small/" . $path);
											$conn->query("delete from pictures where id=$picid");
										}
										insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','Reception','" . saveimage("reception", "images/propertypics/hotel/", 0) . "')");
									}
									if ($_FILES['restaurant']['name'] != "") {
										$result = $conn->query("select id,path from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Restaurant'");
										if ($result->num_rows > 0) {
											$row = $result->fetch_assoc();
											$path = $row['path'];
											$picid = $row['id'];

											deletefile("images/propertypics/hotel/big/" . $path);
											deletefile("images/propertypics/hotel/medium/" . $path);
											deletefile("images/propertypics/hotel/small/" . $path);
											$conn->query("delete from pictures where id=$picid");
										}
										insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','Restaurant','" . saveimage("restaurant", "images/propertypics/hotel/", 0) . "')");
									}
									if ($_FILES['lobby']['name'] != "") {
										$result = $conn->query("select id,path from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Lobby'");
										if ($result->num_rows > 0) {
											$row = $result->fetch_assoc();
											$path = $row['path'];
											$picid = $row['id'];

											deletefile("images/propertypics/hotel/big/" . $path);
											deletefile("images/propertypics/hotel/medium/" . $path);
											deletefile("images/propertypics/hotel/small/" . $path);
											$conn->query("delete from pictures where id=$picid");
										}
										insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','Lobby','" . saveimage("lobby", "images/propertypics/hotel/", 0) . "')");
									}

									foreach ($_FILES['morepics']['name'] as $key => $newpic) {
										if ($_FILES['morepics']['name'][$key] != "") {
											$title = nosql($_POST['morepicstitle'][$key]);
											insert("insert into pictures (propertyid,type,title,path) values ($_SESSION[hotel],'Hotel','$title','" . saveimage("morepics", "images/propertypics/hotel/", 0, $key) . "')");
										}
									}

									$msg = "Picture(s) uploaded successfully.";
									$clrclass = "success";
								}

								if (col('video360') != "") {
									$conn->query("update hotels set video360='$_POST[video360]' where id=$_SESSION[hotel]");
								}

								if (col('deleteid') != "") {
									$row = execute("select p.propertyid,h.admin,p.path from pictures p join hotels h on (h.id=p.propertyid and type='Hotel') where p.id=$_POST[deleteid]");
									$hotel = $row['propertyid'];
									$hadmin = $row['admin'];
									$path = $row['path'];

									if ($_SESSION['groupid'] == 0 or $_SESSION['id'] == $hadmin or $_SESSION['hotel'] == $hotel) {
										$conn->query("delete from pictures where id=$_POST[deleteid]");
										deletefile("images/propertypics/hotel/big/$path");
										deletefile("images/propertypics/hotel/medium/$path");
										deletefile("images/propertypics/hotel/small/$path");

										$msg = "Picture has been deleted";
										$clrclass = "success";
									} else {
										$msg = "You do not have permission to delete this picture";
										$clrclass = "danger";
									}
								}

								if (col('deleteid2') != "") {
									$conn->query("update hotels set video360='' where id=$_SESSION[hotel]");

									$msg = "Video has been removed";
									$clrclass = "success";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL <small>Pictures</small></h1>
          <div class="the-box">
            <h4 class="small-title">Hotel Pictures</h4>
            <?php alertbox($clrclass, $msg);
									$msg = "";
									modal("Image", "image");
									modal2("Video", "video"); ?>
            <form name="filter_form" method="POST">
              <input type="hidden" name="deleteid" id="deleteid">
              <input type="hidden" name="deleteid2" id="deleteid2">
              <input type="hidden" name="verifyid" id="verifyid">
              <input type="hidden" name="blockid" id="blockid">
              <input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
            </form>
            <form name="imageform" method="post" enctype="multipart/form-data">
              <div class="magnific-popup-wrap">
                <div class="row">
                  <div class="col-xs-2" style="width:20%">
                    <label>Hotel Profile Picture</label>
                    <div style="height:159px;">
                      <?php $result = $conn->query("select id,title,path,approved from pictures where propertyid=$_SESSION[hotel] and type='Hotel' and title='Hotel Profile Picture'");
														if ($result->num_rows > 0) {
															$row = $result->fetch_assoc();
															$path = $row['path'];
															$approved = $row['approved'];

															if ($approved == 1)
																$approvalflag = "<i class='fa fa-flag' style='color:#8CC152;float:right;padding-right:2px;' title='Approved Image'></i>";
															else
																$approvalflag = "<i class='fa fa-flag' style='color:#E9573F;float:right;padding-right:2px;' title='Admin Approval Pending'></i>";

															$image = "<div style='height:129px;'>
																		<a class='zooming' href='images/propertypics/hotel/big/$path' title='Profile Picture'>
																			<img src='images/propertypics/hotel/medium/$path' alt='Image' class='mfp-fade img-responsive'>
																		</a>
																	  </div>
																	  <div style='margin: 5px 0px;'>
																	  <span class='label label-default' title='This image can not be deleted'>Remove</span>
																	  $approvalflag
																	  </div>";
														} else
															$image = "<img src='images/NOIMAGE568555985.png' alt='Image' class='mfp-fade item-gallery img-responsive'>";
														echo $image; ?>
                    </div>
                    <div class="form-group">
                      <div class="input-group">
                        <input type="text" class="form-control" id="" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="propic" id="propic">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <label>Reception</label>
                    <?php imageblock('Reception') ?>
                    <div class="form-group">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="reception">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <label>Parking Lot</label>
                    <?php imageblock('Parking Lot') ?>
                    <div class="form-group">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="parkinglot">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <label>Restaurant / Dinning Area</label>
                    <?php imageblock('Restaurant') ?>
                    <div class="form-group">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="restaurant">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <label>Lobby</label>
                    <?php imageblock('Lobby') ?>
                    <div class="form-group">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="lobby">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <?php $result = $conn->query("select id,title,path,approved from pictures where type='Hotel' and propertyid=$_SESSION[hotel] and title not in ('Hotel Profile Picture','Parking Lot','Reception','Restaurant','Lobby')");
											if ($result->num_rows > 0) { ?>
                <hr>
                <h4 class="small-title">Other pictures</h4>
                <div class="row">
                  <?php while ($row = $result->fetch_assoc()) {
														if ($row['approved'] == 1)
															$approvalflag = "<i class='fa fa-flag' style='color:#8CC152;float:right;padding-right:2px;' title='Approved Image'></i>";
														else
															$approvalflag = "<i class='fa fa-flag' style='color:#E9573F;float:right;padding-right:2px;' title='Admin Approval Pending'></i>"; ?>
                  <div class="col-xs-2" style="width:20%">
                    <label><?= $row['title'] ?></label>
                    <div style="height:129px;">
                      <a class="zooming" href="images/propertypics/hotel/big/<?= $row['path'] ?>"
                        title="<?= $row['title'] ?>">
                        <img src="images/propertypics/hotel/medium/<?= $row['path'] ?>" alt="Image"
                          class="mfp-fade img-responsive">
                      </a>
                    </div>
                    <div style="margin: 5px 0px;">
                      <a href="javascript:void(0)" class="redlink" onClick='modal_button_updater(<?= $row['id'] ?>)'>
                        <span class="label label-danger" data-toggle="modal"
                          data-target="#DangerModalColor2">Remove</span>
                      </a>
                      <?= $approvalflag ?>
                    </div>
                  </div>
                  <?php
													} ?>
                </div>
                <?php
											} ?>
                <hr>
                <h4 class="small-title">Add more pictures</h4>
                <div class="row">
                  <div class="col-xs-2" style="width:20%">
                    <div class="form-group">
                      <input type="text" class="form-control" name="morepicstitle[]" style="margin-bottom:5px;"
                        placeholder="Picture Title">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="morepics[]">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <div class="form-group">
                      <input type="text" class="form-control" name="morepicstitle[]" style="margin-bottom:5px;"
                        placeholder="Picture Title">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="morepics[]">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <div class="form-group">
                      <input type="text" class="form-control" name="morepicstitle[]" style="margin-bottom:5px;"
                        placeholder="Picture Title">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="morepics[]">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <div class="form-group">
                      <input type="text" class="form-control" name="morepicstitle[]" style="margin-bottom:5px;"
                        placeholder="Picture Title">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="morepics[]">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-2" style="width:20%">
                    <div class="form-group">
                      <input type="text" class="form-control" name="morepicstitle[]" style="margin-bottom:5px;"
                        placeholder="Picture Title">
                      <div class="input-group">
                        <input type="text" class="form-control" readonly>
                        <span class="input-group-btn">
                          <span class="btn btn-default btn-file">
                            Browse...<input type="file" name="morepics[]">
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <hr>
                <h4 class="small-title">Add 360&deg; Video Link (Youtube)</h4>
                <?php $row = execute("select video360 from hotels where id=$_SESSION[hotel]"); ?>
                <div class="row">
                  <div class="col-xs-12">
                    <div class="form-group">
                      <input type="url" name="video360" class="form-control" value="<?= $row['video360'] ?>">
                    </div>
                  </div>
                </div>
                <?php if ($row['video360'] != "") {
												$temp = explode("v=", $row['video360']);
												if (isset($temp[1]))
													$v360 = $temp[1];
												else
													$v360 = "";
												if ($v360 != "") { ?>
                <div class="row">
                  <div class="col-xs-12">
                    <iframe style="width:100%; min-height:300px"
                      src="https://www.youtube.com/embed/<?= $v360 ?>"></iframe>
                  </div>
                  <div class="col-xs-12">
                    <div class="form-group">
                      <a href="javascript:void(0)" class="redlink"
                        onClick='modal_button_updater2(<?= $_SESSION['hotel'] ?>)'>
                        <span class="label label-danger" data-toggle="modal" data-target="#InfoModalColor2">Remove this
                          video</span>
                      </a>
                    </div>
                  </div>
                </div>
                <?php
												}
											} ?>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="Upload">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "hotelpolicy" and $page_access) {
								if (col("checkintime") != "") {
									$hotelcheckintime = $_POST['checkintime'];
									$hotelcheckouttime = $_POST['checkouttime'];
									$marriedcouplesallowed = $_POST['marriedcouplesallowed'];
									$unmarriedcouplesallowed = $_POST['unmarriedcouplesallowed'];
									$samecityguestallowed = $_POST['samecityguestallowed'];
									$posercancellationrefund = $_POST['posercancellationrefund'];
									$cancellationpriorto24hours = $_POST['cancellationpriorto24hours'];
									$cancellationlessthan24hours = $_POST['cancellationlessthan24hours'];
									$p821a = $_POST['p821a'];
									$p821b = $_POST['p821b'];
									$p822a = $_POST['p822a'];
									$p822b = $_POST['p822b'];
									$guestsofguest = $_POST['guestsofguest'];
									$petsallowed = $_POST['petsallowed'];

									$conn->query("update hotels set hotelcheckintime='$hotelcheckintime',hotelcheckouttime='$hotelcheckouttime',marriedcouplesallowed= '$marriedcouplesallowed',unmarriedcouplesallowed='$unmarriedcouplesallowed',samecityguestallowed=$samecityguestallowed, posercancellationrefund='$posercancellationrefund',cancellationpriorto24hours='$cancellationpriorto24hours', cancellationlessthan24hours='$cancellationlessthan24hours',p821a='$p821a', p821b='$p821b',p822a='$p822a',p822b='$p822b', guestsofguest='$guestsofguest',petsallowed=$petsallowed where id=$_SESSION[hotel]");

									$clrclass = "success";
									$msg = "Hotel policy has been updated";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <script type="text/javascript">
            function hotelpolicy() {
              if (document.getElementById('iagree').checked)
                return true;
              else {
                alert("You must agree with hotel policy!");
                return false;
              }
            }
            </script>
            <h4 class="small-title">HOTEL POLICY</h4>
            <?php alertbox($clrclass, $msg);
									$msg = "";
									$row = execute("select u.company,l.location,(case when h.hotelcheckintime='' then '12:00 PM' else hotelcheckintime end) as hotelcheckintime,(case when h.hotelcheckouttime='' then '11:00 AM' else h.hotelcheckouttime end)hotelcheckouttime, h.marriedcouplesallowed,h.unmarriedcouplesallowed, h.posercancellationrefund,h.cancellationpriorto24hours,h.cancellationlessthan24hours,h.p821a,h.p821b,h.p822a,h.p822b,h.guestsofguest, h.petsallowed,h.samecityguestallowed from hotels h join users u on u.id=h.user join locations l on l.id=h.location where h.id=$_SESSION[hotel]", 1); ?>
            <form method="post" action="" onSubmit="return hotelpolicy()">
              <div class="row">
                <div class="col-xs-12">
                  <table border=0 cellpadding=0 cellspacing=0 width=100% style='border-collapse:
												 collapse;table-layout:fixed;width:635pt'>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=11 class=xl88>Policies &amp; Understandings Agreement between
                        Frotels Pvt. Ltd. &amp; the Hotel</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=19 style='mso-height-source:userset;height:14.45pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=11 rowspan=4 class=xl85 width=685 style='width:519pt'>This
                        Policy Understanding Agreement (hereinafter referred to as 'Agreement')
                        is between <font class="font8">Frotels.com</font>
                        <font class="font0">, For
                          Frotels Private Limited, incorporate under the Companies Act, 2013
                          having its Registered Office at 2/B/208, Queens Park, Parnaka, Vasai
                          (West): 401 201 (hereinafter referred to as 'Portal', which
                          expression shall unless
                          repugnant to the context herein, include its successors and
                          permitted assigns);<br>
                          <br>
                        </font>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>& you i.e.</td>
                      <td colspan=9 class=xl73 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=2 class=xl86>Hotel Name</td>
                      <td class=xl81></td>
                      <td class=xl71><input type="text" name="hotelname" style="width:270px"
                          value="<?= $row['company'] ?>" disabled></td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=2>Located At</td>
                      <td class=xl81></td>
                      <td class=xl71><input type="text" name="locationname" style="width:270px"
                          value="<?= $row['location'] ?>" disabled></td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=23 style='mso-height-source:userset;height:17.45pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=11 rowspan=2 class=xl91 width=685 style='width:519pt'>
                        Subscribing electronically to this service with his/its details captured
                        separately. (Portal and the Hotel are hereinafter individually called
                        'Party' and collectively, 'the Parties')</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=19 style='mso-height-source:userset;height:14.45pt'>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=11 rowspan=4 class=xl85 width=685 style='width:519pt'>The
                        following terms and conditions constitute definitive agreement between
                        Hotel and the Portal. By clicking the 'Accept' or similar option, the
                        Hotel agrees
                        to terms of this Agreement along with the terms of use and privacy
                        policy available on the Website. This Agreement shall be read along with
                        the aforesaid and in case of any inconsistency; the terms and conditions
                        of this
                        Agreement shall prevail.</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td colspan=11 class=xl92>Hotel &/ Frotel acknowledges, understands and
                        accepts</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=19 style='mso-height-source:userset;height:14.45pt'>
                      <td class=xl70>&nbsp;</td>
                      <td rowspan=2 class=xl94>1</td>
                      <td colspan=10 rowspan=2 class=xl93 width=623 style='width:472pt'>That
                        Portal has given them two options/sections under which their property
                        will get listed namely <font class="font7">Frotels &amp;/ Hotels. And
                          Hotel is free to opt either or both the options, to maximize their
                          inventory utilization.</font>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 class=xl74 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>2</td>
                      <td colspan=10 class=xl80>Check in & Check out Time:</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>2.1</td>
                      <td colspan=10 class=xl92>For Frotels Section (Hotels by Hours):</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 rowspan=3 class=xl85 width=623 style='width:472pt'>That
                        Portal will sell hotel room/ inventory listed with them on hourly basis
                        under its Frotels section on their website/App. And also that Hotel
                        agrees to allow Flexible Check-In & Check out Timing for the bookings
                        captured through Frotels.com to their guests under Frotels section.</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>2.2</td>
                      <td colspan=10 class=xl92>For Hotels Section: For regular Hotel bookings
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=2 class=xl86>Check In Time</td>
                      <td colspan=2 class=xl81 style='border-right:1.0pt solid black'>
                        <input type="text" name="checkintime" class="timepicker" value="<?= $row['hotelcheckintime'] ?>"
                          style="width:70px">
                      </td>
                      <td class=xl70 style='border-left:none'>&nbsp;</td>
                      <td colspan=2 class=xl86>Check Out Time</td>
                      <td colspan=2 class=xl81>
                        <input type="text" name="checkouttime" class="timepicker"
                          value="<?= $row['hotelcheckouttime'] ?>" style="width:70px">
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>3</td>
                      <td colspan=10 rowspan=2 class=xl93 width=623 style='width:472pt'>That
                        portal has defined <font class="font7">Day hours as 9 am to 7 pm & Night
                          hours as 7 pm to 9 am</font>
                        <font class="font6"> so that hotel may set different
                          rates for day use & night use for booking purpose in Extranet.
                        </font>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>4</td>
                      <td colspan=6 class=xl86>Does Hotel allow Married Couples with valid ID
                        proof?</td>
                      <td>
                        <select name="marriedcouplesallowed" required>
                          <option value="">Select</option>
                          <option value="1" <?= selected($row['marriedcouplesallowed'], "1") ?>>Yes</option>
                          <option value="0" <?= selected($row['marriedcouplesallowed'], "0") ?>>No</option>
                        </select>
                      </td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>5</td>
                      <td colspan=6 class=xl86>Does Hotel allow Unmarried Couples with valid ID
                        proof ?</td>
                      <td></td>
                      <td>
                        <select name="unmarriedcouplesallowed">
                          <option value="">Select</option>
                          <option value="1" <?= selected($row['unmarriedcouplesallowed'], "1") ?>>Yes</option>
                          <option value="0" <?= selected($row['unmarriedcouplesallowed'], "0") ?>>No</option>
                        </select>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=8 style='mso-ignore:colspan'></td>
                      <td align=left valign=top>
                        <span style='mso-ignore:vglayout2'>
                          <table cellpadding=0 cellspacing=0>
                            <tr>
                              <td height=21 width=62 style='height:15.75pt;width:47pt'>
                              </td>
                            </tr>
                          </table>
                        </span>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>6</td>
                      <td colspan=7 class=xl86>Does hotel allow the guest/s from the same city as
                        the hotel itself ?</td>
                      <td>
                        <select name="samecityguestallowed">
                          <option value="">Select</option>
                          <option value="1" <?= selected($row['samecityguestallowed'], "1") ?>>
                            Yes</option>
                          <option value="0" <?= selected($row['samecityguestallowed'], "0") ?>>
                            No</option>
                        </select>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=19 style='mso-height-source:userset;height:14.45pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>7</td>
                      <td colspan=10 height=19 width=623 style='height:14.45pt;width:472pt' align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td colspan=10 height=19 class=xl85 width=623 style='height:14.45pt;
																	width:472pt'>For the guests posing as a 'Married Couple' but fail to produce valid id proof during
                              check-in</td>
                          </tr>
                        </table>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=6 style='mso-ignore:colspan'>Booking will get cancelled and
                        guest will get refund of</td>
                      <td></td>
                      <td>
                        <select name="posercancellationrefund">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['posercancellationrefund'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['posercancellationrefund'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['posercancellationrefund'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['posercancellationrefund'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['posercancellationrefund'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['posercancellationrefund'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['posercancellationrefund'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['posercancellationrefund'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['posercancellationrefund'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['posercancellationrefund'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['posercancellationrefund'], "100") ?>>100%</option>
                        </select>
                      </td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>8</td>
                      <td colspan=10 class=xl96>Cancellation Policy</td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>8.1</td>
                      <td class=xl80>Day Use</td>
                      <td colspan=7 class=xl80 style='mso-ignore:colspan'></td>
                      <td align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td height=21 class=xl80 width=62 style='height:15.75pt;width:47pt'></td>
                          </tr>
                        </table>
                      </td>
                      <td class=xl80></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=5 style='mso-ignore:colspan'>Cancellations prior to 24 hours
                        will get refund of</td>
                      <td colspan=2 style='mso-ignore:colspan'></td>
                      <td>
                        <select name="cancellationpriorto24hours">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['cancellationpriorto24hours'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['cancellationpriorto24hours'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['cancellationpriorto24hours'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['cancellationpriorto24hours'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['cancellationpriorto24hours'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['cancellationpriorto24hours'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['cancellationpriorto24hours'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['cancellationpriorto24hours'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['cancellationpriorto24hours'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['cancellationpriorto24hours'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['cancellationpriorto24hours'], "100") ?>>100%</option>
                        </select>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=7 style='mso-ignore:colspan'>Cancellations less than 24 hours
                        until check- In time, will get refund of</td>
                      <td>
                        <select name="cancellationlessthan24hours">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['cancellationlessthan24hours'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['cancellationlessthan24hours'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['cancellationlessthan24hours'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['cancellationlessthan24hours'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['cancellationlessthan24hours'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['cancellationlessthan24hours'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['cancellationlessthan24hours'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['cancellationlessthan24hours'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['cancellationlessthan24hours'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['cancellationlessthan24hours'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['cancellationlessthan24hours'], "100") ?>>100%</option>
                        </select>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>8.2</td>
                      <td colspan=2 style='mso-ignore:colspan'>Multiple Day Stay</td>
                      <td colspan=8 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>8.2.1</td>
                      <td colspan=4 style='mso-ignore:colspan'>Cancellations after check- in / no
                        show</td>
                      <td colspan=4 style='mso-ignore:colspan'></td>
                      <td align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td height=21 width=62 style='height:15.75pt;width:47pt'></td>
                          </tr>
                        </table>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75>a.</td>
                      <td colspan=5 style='mso-ignore:colspan'>Booking will get cancelled & will
                        get refund of</td>
                      <td></td>
                      <td>
                        <select name="p821a">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['p821a'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['p821a'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['p821a'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['p821a'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['p821a'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['p821a'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['p821a'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['p821a'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['p821a'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['p821a'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['p821a'], "100") ?>>100%
                          </option>
                        </select>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75></td>
                      <td colspan=2 style='mso-ignore:colspan'></td>
                      <td>OR</td>
                      <td colspan=3 style='mso-ignore:colspan'></td>
                      <td class=xl81 style='border-top:none'>&nbsp;</td>
                      <td align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td height=21 class=xl82 width=62 style='height:15.75pt;border-top:none; width:47pt'>&nbsp;
                            </td>
                          </tr>
                        </table>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75>b.</td>
                      <td colspan=6 style='mso-ignore:colspan'>Booking will get cancelled, will
                        get refund of (days)</td>
                      <td>
                        <select name="p821b">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['p821b'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['p821b'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['p821b'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['p821b'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['p821b'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['p821b'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['p821b'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['p821b'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['p821b'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['p821b'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['p821b'], "100") ?>>100%
                          </option>
                        </select>
                      </td>
                      <td colspan=2>Day / Days</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75></td>
                      <td colspan=9 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>8.2.2</td>
                      <td colspan=4 class=xl80>To shorten the stay</td>
                      <td colspan=6 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75>a.</td>
                      <td colspan=5 style='mso-ignore:colspan'>Booking will get cancelled & will
                        get refund of</td>
                      <td></td>
                      <td>
                        <select name="p822a">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['p822a'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['p822a'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['p822a'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['p822a'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['p822a'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['p822a'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['p822a'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['p822a'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['p822a'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['p822a'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['p822a'], "100") ?>>100%
                          </option>
                        </select>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75></td>
                      <td colspan=2 style='mso-ignore:colspan'></td>
                      <td>OR</td>
                      <td colspan=3 style='mso-ignore:colspan'></td>
                      <td class=xl81 style='border-top:none'>&nbsp;</td>
                      <td align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td height=21 class=xl82 width=62 style='height:15.75pt;border-top:none;width:47pt'>&nbsp;
                            </td>
                          </tr>
                        </table>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td class=xl75>b.</td>
                      <td colspan=6 style='mso-ignore:colspan'>Booking will get cancelled, will
                        get refund of (days)</td>
                      <td>
                        <select name="p822b">
                          <option value="">Select</option>
                          <option value="0" <?= selected($row['p822b'], "0") ?>>0%</option>
                          <option value="10" <?= selected($row['p822b'], "10") ?>>10%</option>
                          <option value="20" <?= selected($row['p822b'], "20") ?>>20%</option>
                          <option value="30" <?= selected($row['p822b'], "30") ?>>30%</option>
                          <option value="40" <?= selected($row['p822b'], "40") ?>>40%</option>
                          <option value="50" <?= selected($row['p822b'], "50") ?>>50%</option>
                          <option value="60" <?= selected($row['p822b'], "60") ?>>60%</option>
                          <option value="70" <?= selected($row['p822b'], "70") ?>>70%</option>
                          <option value="80" <?= selected($row['p822b'], "80") ?>>80%</option>
                          <option value="90" <?= selected($row['p822b'], "90") ?>>90%</option>
                          <option value="100" <?= selected($row['p822b'], "100") ?>>100%
                          </option>
                        </select>
                      </td>
                      <td colspan=2>Day / Days</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=8 style='mso-ignore:colspan'></td>
                      <td align=left valign=top>
                        <table cellpadding=0 cellspacing=0>
                          <tr>
                            <td height=21 width=62 style='height:15.75pt;width:47pt'></td>
                          </tr>
                        </table>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>9</td>
                      <td colspan=5 style='mso-ignore:colspan'>Guest of the guest allowed in the
                        room?</td>
                      <td colspan=2 style='mso-ignore:colspan'></td>
                      <td>
                        <select name="guestsofguest">
                          <option value="">Select</option>
                          <option value="1" <?= selected($row['guestsofguest'], "1") ?>>Yes
                          </option>
                          <option value="0" <?= selected($row['guestsofguest'], "0") ?>>No
                          </option>
                        </select>
                      </td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65>10</td>
                      <td colspan=3 style='mso-ignore:colspan'>Pets allowed in the Hotel?</td>
                      <td colspan=4 style='mso-ignore:colspan'></td>
                      <td>
                        <select name="petsallowed">
                          <option value="">Select</option>
                          <option value="1" <?= selected($row['petsallowed'], "1") ?>>Yes
                          </option>
                          <option value="0" <?= selected($row['petsallowed'], "0") ?>>No
                          </option>
                        </select>
                      </td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td rowspan=4 class=xl94>11</td>
                      <td colspan=9 rowspan=4 class=xl85 width=561 style='width:425pt'>That portal
                        is not responsible for any unacceptable behavior of the guest/s at the
                        hotel & vice versa. As portal is just a medium for online bookings &
                        holds no responsibility towards any disputes between the guests & hotels
                        caused due to quality of the services / facilities / amenities or for
                        any other reason.</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td class=xl70>&nbsp;</td>
                      <td rowspan=3 class=xl94>12</td>
                      <td colspan=9 rowspan=3 class=xl85 width=561 style='width:425pt'>It is
                        understood by Hotel that Portal has given them the option of not
                        reflecting their inventory on the portal if Hotel inventory is 100%
                        booked. It means if
                        Hotel's inventory is reflecting on Frotels.com, Hotel needs to honor the
                        booking sent by the portal.</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td height=21 style='height:15.75pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=21 style='height:15.75pt'>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=2 class=xl83><input type="checkbox" name="iagree" id="iagree" value="1"> Agree</td>
                      <td></td>
                      <td colspan=6 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                    <tr height=20 style='height:15.0pt'>
                      <td height=20 style='height:15.0pt'></td>
                      <td class=xl70>&nbsp;</td>
                      <td class=xl65></td>
                      <td colspan=10 style='mso-ignore:colspan'></td>
                      <td class=xl71>&nbsp;</td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="OK">
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "paymentterms" and $page_access and 0) {
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL</h1>
          <div class="the-box">
            <h4 class="small-title">CONTACT INFO</h4>
            <?php alertbox($clrclass, $msg);
									$msg = "";
									$row = execute("select u.fullname,u.email,u.contact,h.landline,h.generalmanager,h.gmemail,h.gmcontact,h.owner,h.owneremail, h.ownercontact,h.accountant,h.acemail,h.accontact,h.extraposition,h.extrapositionname,h.extrapositionemail,h.extrapositioncontact from hotels h join users u on u.id=h.user where u.id=$_SESSION[id]"); ?>
            <form method="post" action="">
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="conper" value="<?= $row['fullname'] ?>"
                      title="Front Desk Manager / Booking Manager (All booking related communicatin will be addressed to this person)">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="conperemail" value="<?= $row['email'] ?>"
                      title="On this email address you will get all the notificatin regarding booking from Frotels.com">
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Mobile No.</label>
                    <input type="text" class="form-control" name="conpercontact" value="<?= $row['contact'] ?>"
                      title="On this number you will get all the notificatin regarding booking from Frotels.com">
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Hotel Landline</label>
                    <input type="text" class="form-control" name="hotellandline" value="<?= $row['landline'] ?>"
                      title="Hotel's landline number">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>General Manager</label>
                    <input type="text" class="form-control" name="gm" value="<?= $row['generalmanager'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="gmemail" value="<?= $row['gmemail'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="gmcontact" value="<?= $row['gmcontact'] ?>" title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Owner</label>
                    <input type="text" class="form-control" name="owner" value="<?= $row['owner'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="owneremail" value="<?= $row['owneremail'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="ownercontact" value="<?= $row['ownercontact'] ?>"
                      title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Accountant</label>
                    <input type="text" class="form-control" name="accountant" value="<?= $row['accountant'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="accountantemail" value="<?= $row['acemail'] ?>"
                      title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="accountantcontact" value="<?= $row['accontact'] ?>"
                      title="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Another Position (if any)</label>
                    <input type="text" class="form-control" name="anotherposition" value="<?= $row['extraposition'] ?>"
                      title="Position name e.g. Booking Manager">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Concerned Person</label>
                    <input type="text" class="form-control" name="apconper" value="<?= $row['extrapositionname'] ?>"
                      title="Name of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control" name="apemail" value="<?= $row['extrapositionemail'] ?>"
                      title="Email of concerned person">
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label>Contact No.</label>
                    <input type="text" class="form-control" name="apcontact" value="<?= $row['extrapositioncontact'] ?>"
                      title="Contact no. of concerned person">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="Save">
                </div>
              </div>
            </form>
          </div>
          <?php
							}
							// vrusharth- additional servicies
							else if ($_GET['Pg'] == "additionalservicies" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['accountholder'])) {
									$accountholder = $_POST['accountholder'];
									$accountnumber = $_POST['accountnumber'];
									$type = $_POST['type'];
									$bank = $_POST['bank'];
									$ifsc = $_POST['ifsc'];
									$branch = $_POST['branch'];
									$pan = $_POST['pan'];
									$nameonpan = $_POST['nameonpan'];
									$stnumber = $_POST['stnumber'];

									$conn->query("update hotels set accountholder='$accountholder',accountnumber='$accountnumber',accounttype='$type',bank='$bank', ifsc='$ifsc',branch='$branch',pan='$pan',nameonpan='$nameonpan',stnumber='$stnumber' where id=$_SESSION[hotel]");

									if ($_FILES['pancopy']['name'] != "" or $_FILES['stcopy']['name'] != "") {
										$row = execute("select pancopy,stcopy from hotels where id=$_SESSION[hotel]");
										if ($_FILES['pancopy']['name'] != "") {
											if ($row['pancopy'] != "")
												deletefile("images/documents/pancard/" . $row['pancopy']);
											$conn->query("update hotels set pancopy='" . saveimage("pancopy", "images/documents/pancard/", 1000) . "' where id=$_SESSION[hotel]");
										}
									}

									$msg = "Bank details updated.";
									$clrclass = "success";
								}

								$invoice = execute("select isgst from invoice_setup where hotel='$_SESSION[hotel]'");

								$isgst = $invoice['isgst'];
								$display_gst = $isgst ? "" : 'display:none;';

								pms_info_status(); ?>
          <h1 class="page-heading">Additional Servicies</h1>
          <div class="the-box">
            <div id="messageBox-additional-service"></div>
            <script>
            function showMessageBoxadditionalservice(content, type) {
              const messageBox = document.getElementById('messageBox-additional-service');

              // Determine the alert class based on the type parameter
              let alertClass;
              switch (type) {
                case 'success':
                  alertClass = 'alert-success';
                  break;
                case 'error':
                  alertClass = 'alert-danger';
                  break;
                case 'warning':
                  alertClass = 'alert-warning';
                  break;
                default:
                  alertClass = 'alert-info';
              }

              // Populate the messageBox with the content and appropriate styling
              messageBox.innerHTML = `
										<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:-36px; right:0px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
											<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
											<p style="width:90%;">${content}</p>
										</div>`;

              // Show the message box
              messageBox.style.display = "block";

              // Automatically hide the message box after 4 seconds
              setTimeout(() => {
                messageBox.style.display = "none";
              }, 4000);
            }
            </script>




            <div id="messageBox"></div>

            <?php $result = $conn->query("select id,roomtype,fulldaytariff,cmroomid from roomtypes where hotel=$_SESSION[hotel]");
									if ($result->num_rows > 0) { ?>
            <div class="panel with-nav-tabs panel-success" style="margin-bottom: 5px">

              <div id="panel-collapse-1" class="collapse in">
                <div class="tab-content">



                  <?php $i = 0;
													$hotelcode = execute("select u.cm_company_name, h.user from hotels h JOIN users u ON h.user = u.id where h.id = $_SESSION[hotel]");

													while ($row = $result->fetch_assoc()) { ?>
                  <div class="tab-pane fade <?= (!$i) ? "in active" : "" ?>" id="wizard-1-step<?= $row['id'] ?>">
                    <div class="table-body">
                      <?php
																	$rate_plan = $conn->query("select id,room_rate_plan,roomtype,cm_rate_plan from room_rate_plans where roomtype=$row[id] and deleted=0");
																	if ($rate_plan->num_rows > 0) { ?>


                      <table class="table">
                        <thead>
                          <tr style="border: 1px solid #ddd">
                            <th scope="col">No.</th>
                            <th scope="col">Services</th>
                            <th scope="col" style="text-align: center; <?= $display_gst ?>">
                              GST/VAT(%)</th>
                            <th style="<?= $display_gst ?>" scope="col">TAX(%)</th>
                            <th scope="col">Charges()</th>
                            <th style="<?= $display_gst ?>" scope="col">HSN</th>
                            <th scope="col" style="text-align: center;">Action</th>
                          </tr>
                        </thead>
                        <style>
                        .onoffswitch-inner:before {
                          content: "GST";
                        }

                        .onoffswitch-inner:after {
                          content: "VAT";
                        }
                        </style>


                        <tbody id="additionalservices-tb">
                          <?php
																				$row = execute("SELECT service, gst, charge, hsn, id, vat, tax FROM additional_services WHERE hotel='$_SESSION[hotel]' and ishotelroomtax=1");
																				$gstChecked = $row['gst'] == 1 ? 'checked' : '';  // Check GST if gst == 1
																				$vatChecked = $row['vat'] == 1 ? 'checked' : '';  // Check VAT if vat == 1
																				?>
                          <tr style="<?= $display_gst ?>">
                            <th scope="row">0</th>
                            <td style="width: 0px">
                              <input id="intial-room-tax-name" style="border: 1px solid #ddd; width:270px" type="text"
                                value="Lodgin&Boarding" disabled>
                            </td>
                            <td>
                              <div class="radio" style="margin: 0px 0px">
                                <label style="margin: 0px 5px; font-size: 15px;">
                                  <input type="radio" name="intial-room-tax" value="gst" <?= $gstChecked ?> required
                                    data-bv-notempty-message="The tax type is required"
                                    onchange="checkForInitialRoomTaxChanges()"
                                    data-original-value="<?= $gstChecked ? 'gst' : '' ?>" />
                                  GST
                                </label>
                                <label style="margin: 0px 5px; font-size: 15px;">
                                  <input type="radio" name="intial-room-tax" value="vat" <?= $vatChecked ?> required
                                    data-bv-notempty-message="The tax type is required"
                                    onchange="checkForInitialRoomTaxChanges()"
                                    data-original-value="<?= $vatChecked ? 'vat' : '' ?>" />
                                  VAT
                                </label>
                              </div>
                            </td>
                            <td>
                              <input value="<?= $row['tax'] ?>" id="intial-room-tax-percent"
                                style="border: 1px solid #ddd; width: 100%" type="number"
                                oninput="checkForInitialRoomTaxChanges()" data-original-value="<?= $row['tax'] ?>">
                            </td>
                            <td>
                              <input id="intial-room-tax-charges" style="border: 1px solid #ddd; width: 100%"
                                type="number" disabled>
                            </td>
                            <td>
                              <input value="<?= $row['hsn'] ?>" id="intial-room-tax-hsn"
                                style="border: 1px solid #ddd; width: 100%" type="text"
                                oninput="checkForInitialRoomTaxChanges()" data-original-value="<?= $row['hsn'] ?>">
                            </td>
                            <td style="width: 143px;">
                              <button class="btn available" id="intial-room-tax-update-btn"
                                onclick="intialroomtaxsetup()" disabled>Update</button>
                              <button id="delete-btn-<?= $i ?>" class="btn booked" disabled>Delete</button>
                            </td>
                          </tr>



                          <script>
                          function checkForInitialRoomTaxChanges() {
                            // Fetch all necessary fields
                            const fields = [
                              document.querySelector(
                                'input[name="intial-room-tax"]:checked'), // Radio button (GST/VAT)
                              document.getElementById('intial-room-tax-percent'), // Tax Percent
                              document.getElementById('intial-room-tax-hsn') // HSN
                            ];

                            let hasChanged = false;

                            // Iterate over fields and check if they differ from their original value
                            fields.forEach(field => {
                              const originalValue = field.getAttribute('data-original-value');
                              if (field.type === 'radio' && field.checked) {
                                const selectedValue = field.value;
                                if (selectedValue !== originalValue) {
                                  hasChanged = true;
                                }
                              } else if (field.value !== originalValue) {
                                hasChanged = true;
                              }
                            });

                            // Enable or disable the update button based on changes
                            const updateBtn = document.getElementById('intial-room-tax-update-btn');
                            updateBtn.disabled = !hasChanged;
                          }
                          </script>

                          <?php
																				$result = $conn->query("SELECT service, gst, charge, hsn, id, vat, tax FROM additional_services WHERE hotel='$_SESSION[hotel]' and ishotelroomtax=0 and deleted=0");
																				if ($result->num_rows > 0) {
																					if ($isgst) {
																						$i = 1;
																					}
																					$i = 0;
																					while ($row = $result->fetch_assoc()) {
																						$i = $i + 1;
																						$gstChecked = $row['gst'] == 1 ? 'checked' : '';  // Check GST if gst == 1
																						$vatChecked = $row['vat'] == 1 ? 'checked' : '';  // Check VAT if vat == 1
																						?>
                          <tr>
                            <th scope="row"><?= $i ?></th>
                            <td style="width: 0px">
                              <input id="past-service-name-<?= $i ?>" style="border: 1px solid #ddd; width:270px"
                                type="text" placeholder="ServiceName" value="<?= $row['service'] ?>"
                                oninput="checkForChanges('<?= $i ?>')" data-original-value="<?= $row['service'] ?>">
                            </td>
                            <td style="<?= $display_gst ?>">
                              <div class="radio" style="margin: 0px 0px">
                                <label style="margin: 0px 5px">
                                  <input type="radio" name="tax-<?= $i ?>" value="gst" <?= $gstChecked ?> required
                                    data-bv-notempty-message="The tax type is required"
                                    onchange="checkForChanges('<?= $i ?>')"
                                    data-original-value="<?= $gstChecked ? 'gst' : '' ?>" />
                                  GST
                                </label>
                                <label style="margin: 0px 5px">
                                  <input type="radio" name="tax-<?= $i ?>" value="vat" <?= $vatChecked ?> required
                                    data-bv-notempty-message="The tax type is required"
                                    onchange="checkForChanges('<?= $i ?>')"
                                    data-original-value="<?= $vatChecked ? 'vat' : '' ?>" />
                                  VAT
                                </label>
                              </div>
                            </td>
                            <td style="<?= $display_gst ?>">
                              <input id="past-service-tax-<?= $i ?>" style="border: 1px solid #ddd; width: 100%"
                                type="number" value="<?= $row['tax'] ?>" oninput="checkForChanges('<?= $i ?>')"
                                data-original-value="<?= $row['tax'] ?>">
                            </td>
                            <td>
                              <input id="past-service-charge-<?= $i ?>" style="border: 1px solid #ddd; width: 100%"
                                type="number" value="<?= $row['charge'] ?>" oninput="checkForChanges('<?= $i ?>')"
                                data-original-value="<?= $row['charge'] ?>">
                            </td>
                            <td style="<?= $display_gst ?>">
                              <input id="past-service-hsn-<?= $i ?>" style="border: 1px solid #ddd; width:100%"
                                type="text" value="<?= $row['hsn'] ?>" oninput="checkForChanges('<?= $i ?>')"
                                data-original-value="<?= $row['hsn'] ?>">
                            </td>
                            <td id="additional-services-update" style="width: 143px">
                              <button id="update-btn-<?= $i ?>" onClick="updateservice('<?= $row['id'] ?>','<?= $i ?>')"
                                class="btn available" disabled>Update</button>
                              <button id="delete-btn-<?= $i ?>" onClick="deleteAdditionalServices('<?= $row['id'] ?>')"
                                class="btn booked">Delete</button>
                            </td>
                          </tr>
                          <?php
																					}
																				}
																				?>
                        </tbody>





                      </table>





                      <script>
                      let isgst = JSON.parse(<?= json_encode($isgst); ?>);
                      let display_gst = isgst ? 'block' : 'none';

                      function deleteAdditionalServices(serviceid) {
                        $.ajax({
                          type: 'POST',
                          url: 'bookingajax.php',
                          data: {
                            serviceid: serviceid,
                            user: <?= $_SESSION['id'] ?>,
                            hotel: <?= $_SESSION['hotel'] ?>,
                            action: 'delete_additional_services'
                          },
                          success: function(response) {
                            let res = JSON.parse(response);
                            console.log(res);
                            showMessageBoxadditionalservice("Service Deleted", "success")
                            setTimeout(() => {
                              location.reload()
                            }, 1000);

                            // Handle response
                            // You can display a success or failure message here based on the result
                          }
                        });
                      }

                      function checkForChanges(i) {
                        const fields = [
                          document.getElementById('past-service-name-' + i),
                          document.querySelector('input[name="tax-' + i + '"]:checked'),
                          document.getElementById('past-service-tax-' + i),
                          document.getElementById('past-service-charge-' + i),
                          document.getElementById('past-service-hsn-' + i)
                        ];

                        let hasChanged = false;

                        fields.forEach(field => {
                          const originalValue = field.getAttribute('data-original-value');
                          if (field.type === 'radio' && field.checked) {
                            const selectedValue = field.value;
                            if (selectedValue !== originalValue) {
                              hasChanged = true;
                            }
                          } else if (field.value !== originalValue) {
                            hasChanged = true;
                          }
                        });

                        const updateBtn = document.getElementById('update-btn-' + i);
                        updateBtn.disabled = !hasChanged;
                      }




                      // Variable to store the initial number of rows (before any additions)
                      let initialRowCount = document.getElementById('additionalservices-tb').rows.length;
                      var deletelen = 0

                      function oncli() {
                        deletelen = deletelen + 1
                        let cell1, cell2, cell3, cell4, cell5, cell6, cell7
                        if (deletelen > 0) {
                          document.getElementById('addservicebutton').style.visibility = "visible";
                        }
                        let tbod = document.getElementById('additionalservices-tb');

                        // Create a new row
                        let newRow = document.createElement('tr');

                        // Create each column (td) with input elements
                        cell1 = document.createElement('th');
                        cell1.scope = "row";
                        cell1.innerText = isgst ? tbod.rows.length + 1 : tbod.rows
                          .length; // Adjusts the row number dynamically

                        cell2 = document.createElement('td');
                        cell2.style.width = "0px"
                        let input2 = document.createElement('input');
                        input2.type = "text";
                        input2.placeholder = "ServiceName";
                        input2.style.border = "1px solid #ddd";
                        input2.style.width = "270px";
                        cell2.appendChild(input2);

                        if (isgst) {
                          cell3 = document.createElement('td');
                          let input3 = document.createElement('input');
                          input3.type = "number";
                          input3.value = "18";
                          input3.style.border = "1px solid #ddd";
                          input3.style.width = "100%";
                          cell3.appendChild(input3);
                        }

                        cell4 = document.createElement('td');
                        let input4 = document.createElement('input');
                        input4.type = "number";
                        input4.style.border = "1px solid #ddd";
                        input4.style.width = "100%";
                        cell4.appendChild(input4);

                        if (isgst) {
                          cell5 = document.createElement('td');
                          let input5 = document.createElement('input');
                          input5.type = "text";
                          input5.style.border = "1px solid #ddd";
                          input5.style.width = "100%";
                          cell5.appendChild(input5);
                        }

                        cell6 = document.createElement('td');

                        // Create the delete button
                        let button = document.createElement('button');
                        button.id = `delete-button-${tbod.rows.length + 1}`;
                        button.className = "btn booked";
                        button.innerText = "Delete";
                        button.style.color = "#fff";
                        button.style.float = "right";
                        button.onclick = function() {
                          deleterow();
                        }; // Setting the click handler

                        // Append the button to the cell
                        cell6.appendChild(button);

                        if (isgst) {
                          // Create cell7 for the radio buttons
                          cell7 = document.createElement('td');

                          // Create the radio buttons div
                          let radioDiv = document.createElement('div');
                          radioDiv.className = "radio";
                          radioDiv.style.margin = "0px 0px";

                          // Create the first radio button for GST
                          let gstLabel = document.createElement('label');
                          let gstInput = document.createElement('input');
                          gstInput.type = 'radio';
                          gstInput.name =
                            `tax-${tbod.rows.length + 1}`; // Name the radio buttons the same to group them
                          gstInput.value = 'gst';
                          gstInput.checked = true; // Set GST as the default checked radio button
                          gstInput.required = true;
                          gstInput.setAttribute('data-bv-notempty-message', 'The tax type is required');
                          gstLabel.appendChild(gstInput);
                          gstLabel.style.margin = "0px 5px";
                          gstLabel.appendChild(document.createTextNode(' GST'));

                          // Create the second radio button for VAT
                          let vatLabel = document.createElement('label');
                          let vatInput = document.createElement('input');
                          vatInput.type = 'radio';
                          vatInput.name = `tax-${tbod.rows.length + 1}`; // Same name as GST for mutual exclusivity
                          vatInput.value = 'vat';
                          vatInput.required = true;
                          vatInput.setAttribute('data-bv-notempty-message', 'The tax type is required');
                          vatLabel.style.margin = "0px 5px";
                          vatLabel.appendChild(vatInput);
                          vatLabel.appendChild(document.createTextNode(' VAT'));

                          // Append the radio buttons to the div
                          radioDiv.appendChild(gstLabel);
                          radioDiv.appendChild(vatLabel);

                          // Append the radio div to the cell
                          cell7.appendChild(radioDiv);

                        }

                        // Append the created cells to the new row
                        newRow.appendChild(cell1);
                        newRow.appendChild(cell2);
                        if (isgst) {
                          newRow.appendChild(cell7);
                          newRow.appendChild(cell3);
                        }
                        newRow.appendChild(cell4);
                        if (isgst) {
                          newRow.appendChild(cell5);
                        }
                        newRow.appendChild(cell6);

                        // Append the new row to the tbody
                        tbod.appendChild(newRow);
                      }


                      function deleterow() {
                        deletelen = deletelen - 1
                        console.log(deletelen)
                        if (deletelen == 0) {
                          document.getElementById('addservicebutton').style.visibility = "hidden";
                        }

                        let x = document.getElementById('additionalservices-tb')
                        x.removeChild(x.lastElementChild)
                      }

                      function handleclick() {
                        let tbod = document.getElementById('additionalservices-tb');
                        let services = [];
                        let gst = [];
                        let charges = [];
                        let hsn = [];
                        let vat = [];
                        let tax = [];

                        let validationFailed = false;
                        let errorMessage = "";

                        // Loop through only the newly added rows (after initialRowCount)
                        for (let i = initialRowCount; i < tbod.rows.length; i++) {
                          let row = tbod.rows[i];
                          let service = row.cells[1].querySelector('input').value;
                          let charge = isgst ? row.cells[4].querySelector('input').value : row.cells[2].querySelector(
                            'input').value;
                          let hsnCode = isgst ? row.cells[5].querySelector('input').value : '';
                          let taxValue = isgst ? row.cells[3].querySelector('input').value : 0;

                          // Validate empty inputs
                          if ((!service || !charge || !hsnCode || !taxValue) && isgst) {
                            validationFailed = true;
                            errorMessage = "All input fields must be filled out.";
                            break;
                          }

                          // Validate positive charges and HSN
                          if (charge < 0 || hsnCode < 0) {
                            validationFailed = true;
                            errorMessage = "Charges and HSN code must be positive values.";
                            break;
                          }

                          // Validate tax range (between 0 and 100)
                          if (taxValue < 0 || taxValue > 100) {
                            validationFailed = true;
                            errorMessage = "Tax percentage must be between 0 and 100.";
                            break;
                          }

                          // Push values to respective arrays
                          services.push(service);
                          charges.push(charge);
                          hsn.push(hsnCode);
                          tax.push(taxValue);
                          let selectedTax = row.cells[2].querySelector('input[type="radio"]:checked');
                          // Check if the selected radio button is GST or VAT
                          if (isgst) {
                            // Select the correct radio button by targeting their common name attribute
                            if (selectedTax && selectedTax.value === 'gst') {
                              gst.push(1); // GST is selected
                              vat.push(0);
                            } else if (selectedTax && selectedTax.value === 'vat') {
                              gst.push(0); // VAT is selected
                              vat.push(1);
                            }
                          } else {
                            gst.push(0)
                            vat.push(0)
                          }
                        }

                        // If validation failed, show an error and return
                        if (validationFailed) {
                          showMessageBoxadditionalservice(errorMessage, "warning");
                          return;
                        }

                        console.log(services, gst, charges, hsn, vat, tax)

                        $.ajax({
                          type: 'POST',
                          url: 'bookingajax.php',
                          data: {
                            services: services,
                            gst: gst,
                            charges: charges,
                            hsn: hsn,
                            tax: tax,
                            vat: vat,
                            hotel: <?= $_SESSION['hotel'] ?>,
                            action: 'add_additional_service',
                            user: <?= $_SESSION['id'] ?>,
                          },
                          success: function(response) {
                            let res = JSON.parse(response);
                            console.log(res);
                            showMessageBoxadditionalservice("New Service Added", "success")
                            setTimeout(() => {
                              location.reload()
                            }, 1000);

                            // Handle response
                            // You can display a success or failure message here based on the result
                          }
                        });
                      }


                      function updateservice(serviceid, index) {
                        let tax = isgst ? document.getElementById(`past-service-tax-${index}`).value : 0;
                        let service = document.getElementById(`past-service-name-${index}`).value;
                        let charge = document.getElementById(`past-service-charge-${index}`).value;
                        let hsn = isgst ? document.getElementById(`past-service-hsn-${index}`).value : '';
                        let gst = vat = 0

                        // Validation checks
                        let validationFailed = false;
                        let errorMessage = "";

                        // Validate empty inputs
                        if ((!service || !charge || !hsn || !tax) && isgst) {
                          validationFailed = true;
                          errorMessage = "All input fields must be filled out.";
                        }

                        // Validate positive charges and HSN
                        if (charge < 0 || hsn < 0) {
                          validationFailed = true;
                          errorMessage = "Charges and HSN code must be positive values.";
                        }

                        // Validate tax range (between 0 and 100)
                        if (tax < 0 || tax > 100) {
                          validationFailed = true;
                          errorMessage = "Tax percentage must be between 0 and 100.";
                        }

                        // If validation failed, show an error and return
                        if (validationFailed) {
                          showMessageBoxadditionalservice(errorMessage, "warning");
                          return;
                        }

                        // Check if GST or VAT is selected
                        if (isgst) {
                          if (document.querySelector(`input[name="tax-${index}"]:checked`).value === 'gst') {
                            gst = 1;
                          } else {
                            vat = 1;
                          }
                        }


                        $.ajax({
                          type: 'POST',
                          url: 'bookingajax.php',
                          data: {
                            charges: charge,
                            serviceid: serviceid,
                            service: service,
                            gst: gst,
                            vat: vat,
                            tax: tax,
                            hsn: hsn,
                            action: 'update_additonal_services',
                            user: <?= $_SESSION['id'] ?>,
                            hotel: <?= $_SESSION['hotel'] ?>
                          },
                          success: function(response) {
                            let res = JSON.parse(response);
                            console.log(res);
                            location.reload()

                            showMessageBoxadditionalservice("Service Updated", "success")

                            // Handle response
                            // You can display a success or failure message here based on the result
                          }
                        });

                      }

                      function intialroomtaxsetup(params) {
                        let tax = document.getElementById(`intial-room-tax-percent`).value;
                        let service = document.getElementById(`intial-room-tax-name`).value;
                        let hsn = document.getElementById(`intial-room-tax-hsn`).value;
                        let gst = vat = 0
                        if (document.querySelector(`input[name="intial-room-tax"]:checked`).value === 'gst') {
                          gst = 1
                        } else {
                          vat = 1
                        }

                        $.ajax({
                          type: 'POST',
                          url: 'bookingajax.php',
                          data: {
                            charges: "",
                            service: service,
                            gst: gst,
                            vat: vat,
                            tax: tax,
                            hsn: hsn,
                            action: 'add_hotel_room_setup',
                            hotel: <?= $_SESSION['hotel'] ?>,
                            user: <?= $_SESSION['id'] ?>,
                          },
                          success: function(response) {
                            let res = JSON.parse(response);
                            console.log(res);
                            location.reload()
                            showMessageBoxadditionalservice("Service Updated", "success")

                            // Handle response
                            // You can display a success or failure message here based on the result
                          }
                        });
                      }
                      </script>

                      <?php
																	} else {
																		echo "No Rate Plan Is Selected For The Given RoomType";
																	} ?>
                    </div>

                    <div id="addservicebutton" class="submit-button"
                      style="visibility:hidden; float:right; margin:5px 0px">
                      <button id="submit-button-<?= $i ?>" onClick="handleclick()" class="btn btn-primary">Add new
                        service</button>
                    </div>

                  </div>
                  <?php $i++;
													} ?>
                </div>
              </div>
            </div>
            <div id="create-additional-services" class="btn-group">
              <a onclick=oncli()>
                <button type="button" class="btn btn-success"><i class="fa fa-plus"></i> Add Additional
                  services</button>
              </a>
            </div>

            <!-- <script>
										let permissions = <?= decode_permissions($_SESSION['permission']) ?>;
										let group_id = <?= $_SESSION['groupid'] ?>;
										let initialRowCount1 = document.getElementById('additionalservices-tb').rows.length;
\


										if (group_id >= 3 && group_id <= 4) {
											if (!permissions.additional_services.Create) {
												document.getElementById('create-additional-services').style.display = 'none';
											}
											if (!permissions.additional_services.Delete) {
												document.getElementById(`delete-btn-0`).style.display = 'none';
											}
											if (!permissions.additional_services.Edit) {
												document.getElementById(`intial-room-tax-update-btn`).style.display = 'none';
											}

											for (let i = 1; i <= initialRowCount1; i++) {
												if (!permissions.additional_services.Delete) {
													document.getElementById(`delete-btn-${i}`).style.display = 'none';
												}
												if (!permissions.additional_services.Edit) {
													document.getElementById(`update-btn-${i}`).style.display = 'none';
												}
											}

										}
									</script> -->
            <?php
									} else { ?>
            No full day tariff for any room is defined
            <?php
									} ?>
          </div>












          <?php
							} else if ($_GET['Pg'] == "bankdetails" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['accountholder'])) {
									$accountholder = $_POST['accountholder'];
									$accountnumber = $_POST['accountnumber'];
									$type = $_POST['type'];
									$bank = $_POST['bank'];
									$ifsc = $_POST['ifsc'];
									$branch = $_POST['branch'];
									$pan = $_POST['pan'];
									$nameonpan = $_POST['nameonpan'];
									$stnumber = $_POST['stnumber'];

									$conn->query("update hotels set accountholder='$accountholder',accountnumber='$accountnumber',accounttype='$type',bank='$bank', ifsc='$ifsc',branch='$branch',pan='$pan',nameonpan='$nameonpan',stnumber='$stnumber' where id=$_SESSION[hotel]");

									if ($_FILES['pancopy']['name'] != "" or $_FILES['stcopy']['name'] != "") {
										$row = execute("select pancopy,stcopy from hotels where id=$_SESSION[hotel]");
										if ($_FILES['pancopy']['name'] != "") {
											if ($row['pancopy'] != "")
												deletefile("images/documents/pancard/" . $row['pancopy']);
											$conn->query("update hotels set pancopy='" . saveimage("pancopy", "images/documents/pancard/", 1000) . "' where id=$_SESSION[hotel]");
										}
									}

									$msg = "Bank details updated.";
									$clrclass = "success";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL <small>Bank Details</small></h1>
          <div class="the-box" style="padding-bottom:0px">
            <h4 class="small-title">BANK DETAILS</h4>
            <?php alertbox($clrclass, $msg);
									$msg = "";
									$row = execute("select accountholder,accountnumber,accounttype,bank,ifsc,branch,pan,nameonpan,stnumber,pancopy,stcopy from hotels where id=$_SESSION[hotel]"); ?>
            <form method="post" action="" enctype="multipart/form-data">
              <div class="row">
                <div class="col-xs-4">
                  <h4 class="small-title" style="margin-bottom:8px;">Account Details</h4>
                  <div class="form-group">
                    <label>Account Holder's Name</label>
                    <input type="text" class="form-control" name="accountholder" value="<?= $row['accountholder'] ?>"
                      title="">
                  </div>
                  <div class="form-group">
                    <label>Account Number</label>
                    <input type="text" class="form-control" name="accountnumber" value="<?= $row['accountnumber'] ?>"
                      title="">
                  </div>
                  <div class="form-group">
                    <label>Type of Account</label>
                    <select name="type" class="form-control">
                      <option <?= selected("Saving", $row['accounttype']) ?>>Saving</option>
                      <option <?= selected("Current", $row['accounttype']) ?>>Current</option>
                    </select>
                  </div>
                </div>
                <div class="col-xs-4">
                  <h4 class="small-title" style="margin-bottom:8px;">Bank Details</h4>
                  <div class="form-group">
                    <label>Bank Name</label>
                    <input type="text" class="form-control" name="bank" value="<?= $row['bank'] ?>" title="">
                  </div>
                  <div class="form-group">
                    <label>IFSC code</label>
                    <input type="text" class="form-control" name="ifsc" value="<?= $row['ifsc'] ?>" title="">
                  </div>
                  <div class="form-group">
                    <label>Branch Name</label>
                    <input type="text" class="form-control" name="branch" value="<?= $row['branch'] ?>" title="">
                  </div>
                </div>
                <div class="col-xs-4">
                  <h4 class="small-title" style="margin-bottom:8px;">PAN Details</h4>
                  <div class="form-group">
                    <label>PAN Number</label>
                    <input type="text" class="form-control" name="pan" value="<?= $row['pan'] ?>" title="">
                  </div>
                  <div class="form-group">
                    <label>Name on PAN card</label>
                    <input type="text" class="form-control" name="nameonpan" value="<?= $row['nameonpan'] ?>" title="">
                  </div>
                  <div class="form-group inline-popups">
                    <label>Upload</label> <?php if ($row['pancopy'] != "") { ?><a href="#pancard" style="float:right;"
                      data-effect="mfp-zoom-in"><i class="fa fa-eye"></i></a><?php } ?>
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Cancelled Cheque Copy" readonly>
                      <span class="input-group-btn">
                        <span class="btn btn-default btn-file">
                          Browse...<input type="file" name="pancopy">
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="col-xs-3" style="display:none">
                  <h4 class="small-title" style="margin-bottom:8px;">Service Tax Details</h4>
                  <div class="form-group">
                    <label>Service Tax Number</label>
                    <input type="text" class="form-control" name="stnumber" value="<?= $row['stnumber'] ?>" title="">
                  </div>
                  <div class="form-group inline-popups">
                    <label>Upload</label>
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="ST registration copy" readonly>
                      <span class="input-group-btn">
                        <span class="btn btn-default btn-file">
                          Browse...<input type="file" name="stcopy">
                        </span>
                      </span>
                    </div>
                  </div>
                  <div style="text-align:right; margin-top:40px;">
                    <input type="submit" class="btn btn-primary" value="Save">
                  </div>
                </div>
              </div>
              <div class="row" style="height: 55px;">
                <div class="col-xs-12">
                  <input type="submit" class="btn btn-primary" value="Save">
                </div>
              </div>
            </form>
            <div id="pancard" class="white-popup mfp-with-anim mfp-hide">
              <img src="images/documents/pancard/<?= $row['pancopy'] ?>" width="800" border="0" alt="">
            </div>
            <div id="stregistration" class="white-popup mfp-with-anim mfp-hide">
              <img src="images/documents/stregistration/<?= $row['stcopy'] ?>" width="800" border="0" alt="">
            </div>
          </div>
          <?php
							} else if ($_GET['Pg'] == "setroomtypes" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['roomtypes'])) {
									$roomtypes = $_POST['roomtypes'];
									$numofrooms = $_POST['numofrooms'];

									foreach ($roomtypes as $key => $roomtype) {
										if ($roomtype != "") {
											$roomtypeid = insert("insert into roomtypes (hotel,roomtype) values ($_SESSION[hotel],'$roomtype')");

											for ($i = 1; $i <= $numofrooms[$key]; $i++) {
												if ($numofrooms[$key] != "")
													insert("insert into roomnumbers (roomtype) values ($roomtypeid)");
											}
										}
									} ?>
          <script type="text/javascript">
          window.location = "?Pg=roomdetails&msg=24";
          </script>
          <?php
								}
								pms_info_status(); ?>

																		<div class="row" style="margin-left: -13px;
    margin-right: -11px;">
																			<div class="col-xs-6" >
																				<div class="the-box" style="height: 274px;">
																					<h4 class="small-title">SET ROOM TYPES</h4>
																					<div class="row" style="margin-bottom:30px">
																						<div class="col-xs-12">
																							<label style="width:280px;float:left;font-size:13px;">How many new room types
																								you want to enter?</label>

																						</div>
																					</div>
																					<div class="row">
																						<div class="col-xs-12" >
																							<input type="number" class="form-control"
																								style="width:55px;margin-right:20px;float:left; margin-top:45px;" name="numofroomtypes"
																								id="numofroomtypes" title="Enter the no. of room types you have e.g. 3"
																								min="1" max="99">
																							<input type="button" class="btn btn-info" value="OK"
																								onClick="setroomtypes(document.getElementById('numofroomtypes').value)"
																								style="float:left;margin-right:143px; margin-top:45px;">
																							<a href=""><input type="button" class="btn btn-warning pull-right" style="margin-top:-30px;"
																									value="Cancel, Go back to room setup"></a>
																						</div>
																					</div>
																					<form method="post" action="">
																						<div id="roomtypeblock"></div>
																					</form>
																				</div>
																			</div>
																			<div class="col-xs-6">
																				<div class="the-box">
																					<h4 class="small-title">PREVIOUSLY ADDED ROOMS</h4>
																					<div class="row">
												<?php $result = $conn->query("select r.id,r.roomtype,count(rn.id)cnt from roomnumbers rn right join roomtypes r on r.id=rn.roomtype where r.hotel=$_SESSION[hotel] group by r.id");
												if ($result->num_rows > 0) {
													while ($row = $result->fetch_assoc()) { ?>
                  <div class="col-xs-12 addedRooms" style="margin-bottom:15px;">
                    <a href="LBF_roomnumbers.php?id=<?= $row['id'] ?>"
                      class="fancybox2 fancybox-demo fancybox.iframe"><?= $row['roomtype'] . " (" . $row['cnt'] . ")" ?></a>
                  </div>
                  <?php
													}
												} else { ?>
                  <div class="col-xs-12">No previously added room types found</div>
                  <?php
												} ?>
                </div>
              </div>
            </div>
          </div>
          <?php
							} else if ($_GET['Pg'] == "roomdetails" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['roomtypes'])) {
									$roomtypes = $_POST['roomtypes'];
									$numofrooms = $_POST['numofrooms'];

									foreach ($roomtypes as $key => $roomtype) {
										$roomtypeid = insert("insert into roomtypes (hotel,roomtype) values ($_SESSION[hotel],'$roomtype')");

										for ($i = 1; $i <= $numofrooms[$key]; $i++) {
											insert("insert into roomnumbers (roomtype) values ($roomtypeid)");
										}
									} ?>
          <script type="text/javascript">
          window.location = "?Pg=roomdetails&msg=24";
          </script>
          <?php
								}
								pms_info_status(); ?>

          <div id="toast-roomsetup" style="display: none"></div>
          <script>
          function showToastroomsetup(content, type) {
            // Get the toast div element
            const toast = document.getElementById('toast-roomsetup');

            // Map the alert type to Bootstrap's alert classes (or define your own)
            let alertClass;
            switch (type) {
              case 'success':
                alertClass = 'alert-success';
                break;
              case 'error':
                alertClass = 'alert-danger';
                break;
              case 'warning':
                alertClass = 'alert-warning';
                break;
              default:
                alertClass = 'alert-info'; // Default case for other types
            }

            // Set the inner HTML content for the toast, dynamically adding the message and the alert class
            toast.innerHTML = `
									<div style="position:absolute; z-index:50; width:30%; padding: 5px 14px; height:30px; top:178px; right:53px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
										<button style="width: 50px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
										<p style="width:90%;">${content}</p>
									</div>
								`;

            // Show the toast
            toast.style.display = "block";

            // Automatically hide the toast after 5 seconds
            setTimeout(() => {
              toast.style.display = "none";
            }, 4000);
          }
          </script>
          <div class="the-box">
                                      <h1 class="page-heading">Room Details</h1>


            <?php if (col("msg") == 24) {
										$msg = "Room types added successfully";
										$clrclass = "success";
										alertbox($clrclass, $msg);
									} ?>
            <div class="btn-toolbar top-table" role="toolbar">

              <div class="btn-group">
                <a href="?Pg=setroomtypes"><button type="button" class="btn btn-success" style="margin-left: 788px;
    margin-top: -48px;"><i class="fa fa-plus"></i> Add
                    room types</button></a>
              </div>
            </div>
            <div class="table-responsive">
              <?php $result = $conn->query("select id,roomtype,fulldaytariff,v360,adults,children,active,(case when exists(select * from roomnumbers where roomtype=r.id and roomnumber<>'') then 1 else 0 end)roomnumcnt,(select count(*) from roomnumbers where roomtype=r.id)totalrooms,(case when exists(select * from room_facilities where roomtype=r.id) then 1 else 0 end)roomfacilitycnt,(case when exists(select * from pictures where type='Room' and propertyid=r.id) then (select count(*) from pictures where type='Room' and propertyid=r.id) else 0 end)roompiccnt,(case when exists(select 1 from roomtype_hourly_facilities where roomtype=r.id) then 1 else 0 end)hourlyfacilities from roomtypes r where hotel=$_SESSION[hotel]");

										if ($result->num_rows > 0) { ?>
              <table class="table table-th-block table-hover">
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Room Type</th>
                    <th>Fullday Tariff (&#8377;)</th>
                    <th>Inventory</th>
                    <th>Amenities</th>
                    <th>Hourly Amenities</th>
                    <th>Pictures</th>
                    <th>Occupancy</th>
                    <th>Room Rate</th>
                    <th>360&deg; Video</th>
                    <th>View</th>
                    <th>On / Off</th>
                  </tr>
                </thead>
                <tbody>
                  <?php $i = 0;

													while ($row = $result->fetch_assoc()) {
														$i++;
														if ($row['active'] == 1)
															$checked = "checked";
														else
															$checked = "";

														if ($row['roomnumcnt'] == 0) {
															$roomnumberl = "orange";
															$roomnumberi = "spinner";
														} else {
															$roomnumberl = "primary";
															$roomnumberi = "check";
														}
														if ($row['roomfacilitycnt'] == 0) {
															$roomfacilityl = "orange";
															$roomfacilityi = "spinner";
														} else {
															$roomfacilityl = "primary";
															$roomfacilityi = "check";
														}
														if ($row['hourlyfacilities'] == 0) {
															$hourlyroomfacilityl = "orange";
															$hourlyroomfacilityi = "spinner";
														} else {
															$hourlyroomfacilityl = "primary";
															$hourlyroomfacilityi = "check";
														}
														if ($row['roompiccnt'] == 0) {
															$roompicl = "orange";
															$roompici = "spinner";
														} else {
															$roompicl = "primary";
															$roompici = "check";
														}
														if ($row['v360'] == "") {
															$v360l = "orange";
															$v360i = "spinner";
														} else {
															$v360l = "primary";
															$v360i = "check";
														}
														if ($row['adults'] == 0 and $row['children'] == 0 and $row['bulkbooking'] == 0) {
															$occl = "orange";
															$occi = "spinner";
														} else {
															$occl = "primary";
															$occi = "check";
														} ?>
                  <tr>
                    <td><?= $i ?></td>
                    <td id="<?= $row['id'] ?>"><?= $row['roomtype'] ?> <a href="javascript:void(0)"
                        style="color:#808080"
                        onClick="update_roomtype_name(<?= $row['id'] ?>,'<?= $row['roomtype'] ?>')" title="Edit"><i
                          class="fa fa-pencil"></i></a></td>
                    <td id="fdt<?= $row['id'] ?>"><?= $row['fulldaytariff'] ?> <a href="javascript:void(0)"
                        style="color:#808080"
                        onClick="update_fullday_tariff(<?= $row['id'] ?>,<?= $row['fulldaytariff'] ?>)" title="Edit"><i
                          class="fa fa-pencil"></i></a></td>

                    <td id='td1id<?= $i ?>'><a href="LBF_roomnumbers.php?id=<?= $row['id'] ?>"
                        class="fancybox2 fancybox.iframe"><span class="label label-<?= $roomnumberl ?>"><i
                            class="fa fa-<?= $roomnumberi ?>"></i> No. of rooms
                          [<?= $row['totalrooms'] ?>]</span></a></td>

                    <td id='td2id<?= $i ?>'><a href="LBF_roomamenities.php?id=<?= $row['id'] ?>"
                        class="fancybox fancybox.iframe"><span class="label label-<?= $roomfacilityl ?>"><i
                            class="fa fa-<?= $roomfacilityi ?>"></i> Amenities</span></a>
                    </td>

                    <td id='td6id<?= $i ?>'><a href="LBF_hourlyamenities.php?id=<?= $row['id'] ?>"
                        class="fancybox fancybox.iframe"><span class="label label-<?= $hourlyroomfacilityl ?>"><i
                            class="fa fa-<?= $hourlyroomfacilityi ?>"></i> Hourly
                          Amenities</span></a></td>

                    <td id='td3id<?= $i ?>'><a href="LBF_roompics.php?id=<?= $row['id'] ?>&cntr=<?= $i ?>"
                        class="fancybox fancybox.iframe"><span class="label label-<?= $roompicl ?>"><i
                            class="fa fa-<?= $roompici ?>"></i> Pictures
                          [<?= $row['roompiccnt'] ?>]</span></a></td>
                    <td id='td5id<?= $i ?>'><a href="LBF_roomoccupancy.php?id=<?= $row['id'] ?>"
                        class="fancybox2 fancybox.iframe"><span class="label label-<?= $occl ?>"><i
                            class="fa fa-<?= $occi ?>"></i>
                          Occupancy</span></a></td>


                    <td id='td1id<?= $i ?>'><a href="LBF_rateplan.php?id=<?= $row['id'] ?>"
                        class="fancybox2 fancybox.iframe"><span class="label label-<?= $roomnumberl ?>"><i
                            class="fa fa-<?= $roomnumberi ?>"></i> Rate Plan </span></a>
                    </td>


                    <td id='td4id<?= $i ?>'><a href="LBF_360degvideo.php?id=<?= $row['id'] ?>&cntr=<?= $i ?>"
                        class="fancybox fancybox.iframe"><span class="label label-<?= $v360l ?>"><i
                            class="fa fa-<?= $v360i ?>"></i> 360&deg; video</span></a></td>
                    <td><a href="LBF_viewroomdetails.php?id=<?= $row['id'] ?>" class="fancybox fancybox.iframe"><span
                          class="label label-purple">View</span></a></td>
                    <td valign="middle">
                      <div class="onoffswitch" style='margin-top:3px'>
                        <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox"
                          id="toggleswitch<?= $i ?>" <?= $checked ?>
                          onChange="toggleroomtype(<?= $row['id'] ?>,<?= $i ?>)">
                        <label class="onoffswitch-label" for="toggleswitch<?= $i ?>">
                          <span class="onoffswitch-inner"></span>
                          <span class="onoffswitch-switch"></span>
                        </label>
                      </div>
                    </td>
                  </tr>
                  <?php
													}

													?>
                </tbody>
              </table>
              <?php
										} ?>
            </div>
          </div>
          <?php
							} else if ($_GET['Pg'] == "roomsavailability" and $_SESSION['hotel'] > 0 and $page_access) {
								pms_info_status();

								if (isset($_POST['roomtypes'])) {
									$fromdate = dateindia($_POST['fromdate']);
									$todate = dateindia($_POST['todate']);
									$roomtypes = $_POST['roomtypes'];

									$row = execute("select count(*)cnt from rate_plans where hotel=$_SESSION[hotel] and ((validfrom between '$fromdate' and '$todate') or (validto between '$fromdate' and '$todate'))");

									if ($row['cnt']) {
										$row = execute("select id from rate_plans where hotel=$_SESSION[hotel] and ((validfrom between '$fromdate' and '$todate') or (validto between '$fromdate' and '$todate'))");
										$rate_plan = $row['id'];
									} else
										$rate_plan = insert("insert into rate_plans (hotel,validfrom,validto) values ($_SESSION[hotel],'$fromdate','$todate')");

									foreach ($roomtypes as $key => $roomtype) {
										$time_slots = $_POST['time_slots_' . ($key + 1)];

										$clock = array();
										$blocked_ranges = array(array("start", "end"));
										$blocked_time_ranges = array(array("start", "end"));

										for ($i = 0; $i < 48; $i++)
											$clock[$i] = $i + 1;

										$blocked_slots = array_diff($clock, $time_slots);

										$flag = 0;
										$w = 0;

										for ($i = 1; $i <= 48; $i++) {
											if (in_array($i, $blocked_slots)) {
												if (!$flag) {
													$blocked_ranges[$w]["start"] = $i;
													$blocked_ranges[$w]["end"] = $i;
													$flag = 1;
												} else {
													if (!in_array($i + 1, $blocked_slots)) {
														$blocked_ranges[$w]["end"] = $i;
														$w++;
														$flag = 0;
													}
												}
											}
										}

										//echo "<pre>".print_r($blocked_ranges,true)."</pre>";
					
										if ($blocked_ranges) {
											foreach ($blocked_ranges as $key => $blocked_range) {
												if (isset($blocked_range["start"])) {
													if (fmod($blocked_range["start"], 2)) {
														$s = floor(($blocked_range["start"] - 1) / 2) . ":00";
													} else {
														$s = floor(($blocked_range["start"] - 1) / 2) . ":30";
													}

													if (fmod($blocked_range["end"], 2)) {
														$e = floor(($blocked_range["end"] - 1) / 2) . ":30";
													} else {
														$e = (floor(($blocked_range["end"] - 1) / 2) + 1 == 24 ? "0" : floor(($blocked_range["end"] - 1) / 2) + 1) . ":00";
													}

													$blocked_time_ranges[$key]["start"] = $s;
													$blocked_time_ranges[$key]["end"] = $e;

													//echo $blocked_time_ranges[$key]["start"];
												}
											}
										}

										if (isset($blocked_time_ranges)) {
											$b_slots_inserted = 0;
											foreach ($blocked_time_ranges as $blocked_time_range) {
												if (isset($blocked_time_range["start"])) {
													$conn->query("insert into blocked_slots (rpid,roomtype,starttime,endtime) values ($rate_plan,$roomtype,'" . $blocked_time_range["start"] . "', '" . $blocked_time_range["end"] . "')");
													$b_slots_inserted++;
												}
											}
											if (!$b_slots_inserted)
												$conn->query("insert into blocked_slots (rpid,roomtype,starttime,endtime) values ($rate_plan,$roomtype,'00:00', '00:00')");
										}
									}

									$msg = "Room availability has been set";
									$clrclass = "success";
								} ?>

          <script type="text/javascript">
          function validate_slots() {
            for (i = 1; i <= 48; i++) {
              if (document.getElementById("cb" + i).checked)
                return true;
            }
            alert("Please select the time slot");
            return false;
          }
          </script>
          <div class="the-box">

            <?php if ($msg != "")
										alertbox($clrclass, $msg); ?>
            <form method="post" action="" onSubmit="return validate_slots()">
                                        <h1 class="page-heading">Set Room Availablity</h1>

              <?php //$result = $conn->query("select id,roomtype from roomtypes r where not exists(select 1 from special_rates where roomtype=r.id and rdate < curdate()) and not exists(select 1 from blocked_slots where roomtype=r.id) and r.hotel=$_SESSION[hotel]");
										
													$result = $conn->query("select id,roomtype from roomtypes where hotel=$_SESSION[hotel]");

													if ($result->num_rows > 0) {
														//$rs_row = execute("select * from rate_plans where ");
														?>
																							<div class="row" style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
																								<div class="col-xs-2">
																									<div class="form-group">
																										<label>From Date</label>
																										<input type="text" class="form-control" id="datepicker1"
																											data-date-format="dd-mm-yyyy" name="fromdate" value="<?= date("d-m-Y") ?>">
																									</div>
																								</div>
																								<div class="col-xs-2">
																									<div class="form-group">
																										<label>To Date</label>
																										<input type="text" class="form-control" id="datepicker2"
																											data-date-format="dd-mm-yyyy" name="todate"
																											value="<?= (new \DateTime(Date("Y-m-d")))->modify("+1 years")->modify("-1 days")->format("d-m-Y") ?>">
																									</div>
																								</div>
																							</div>
																							<br>
																							<div class="row">
												<?php $a = 1;
												while ($row = $result->fetch_assoc()) { ?>
                <div class="col-xs-12">
                  <div class="form-group">
                    <input type="checkbox" name="roomtypes[]" value="<?= $row['id'] ?>"
                      onChange="if(this.checked)document.getElementById('ra'+this.value).style.display='block'; else document.getElementById('ra'+this.value).style.display='none';">
                    <strong></strong> <?= $row['roomtype'] ?>
                  </div>
                </div>
                <div class="col-xs-12" id="ra<?= $row['id'] ?>" style="display:none">
                  <table class="table table-striped table-condensed">
                    <tbody>
                      <?php for ($i = 1; $i <= 48; $i++) { ?>
                      <tr class="cb_tr">
                        <td class="cb_td" id="td<?= $a ?>_<?= $i ?>">
                          <?php if (fmod($i, 2)) { ?>
                          <span class="time"><?= floor(($i - 1) / 2) ?>:00</span>
                          <?php
																			} else { ?>
                          <span class="time">&nbsp;</span>
                          <?php
																			} ?>
                          <div class="checkboxOne">
                            <input checked class="cb_cb" name="time_slots_<?= $a ?>[]" type="checkbox"
                              id="cb<?= $a ?>_<?= $i ?>" value="<?= $i ?>" title="" onChange="display_checked_slots()"
                              roomtype="<?= $a ?>" />
                            <label for="cb<?= $a ?>_<?= $i ?>"></label>
                          </div>
                          <?php if (!fmod($i, 2)) { ?>
                          <span class="time"><?= floor(($i - 1) / 2) ?>:30</span>
                          <?php
																			} else { ?>
                          <span class="time">&nbsp;</span>
                          <?php
																			} ?>
                        </td>
                      </tr>
                      <?php
																} ?>
                    </tbody>
                  </table>
                  <div class="row">
                    <div class="col-xs-2">
                      <div class="form-group">
                        <label>Selected Slots</label>
                        <div id="slots_list_<?= $a ?>">
                          <div>No slots are selected</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <?php $a++;
												} ?>
              </div>
              <div class="row">
                <div class="col-xs-12 form-group">
                  <input type="submit" class="btn btn-primary" value="Update"
                    style="background-color: #e45452; border-color: #e45452;">
                </div>
              </div>
              <?php
													} else { ?>
              <div class="row">
                <div class="col-xs-12">
                  Room availability for this hotel has already been set.
                </div>
              </div>
              <?php
													} ?>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "roomsavailabilityview" and $_SESSION['hotel'] > 0 and $page_access) {
								pms_info_status();

								?>



          <?php
									/* ---------- pull every room type once for the dropdown ---------- */
									$allTypes = $conn->query("
    SELECT id, roomtype
    FROM roomtypes
    WHERE hotel = $_SESSION[hotel]
    ORDER BY roomtype
");

									/* which room type (if any) did the user pick? */
									$selectedId = (isset($_GET['roomtype']) && ctype_digit($_GET['roomtype']))
										? (int) $_GET['roomtype']
										: '';
									?>

          <div class="the-box">
            
            <h1 class="page-heading">view seasonal room rate</h1>
                
            <!-- filter form -->
            <form id="roomFilter " method="get" style="margin-bottom:15px;">
              <!-- preserve the page youre on -->
               
              <input type="hidden" name="Pg" value="<?= htmlspecialchars($_GET['Pg'] ?? 'roomsavailabilityview') ?>">
                
              <label for="roomtype">Filter by Room Type:</label>
              <select name="roomtype" id="roomtype" class="form-control chosen-select"
                onchange="document.getElementById('roomFilter').submit();" style="width: 220px;">
                <option value="">All room types</option>
                <?php while ($rt = $allTypes->fetch_assoc()): ?>
                <option value="<?= $rt['id'] ?>" <?= $rt['id'] == $selectedId ? 'selected' : '' ?>>
                  <?= htmlspecialchars($rt['roomtype']) ?>
                </option>
                <?php endwhile; ?>
              </select>
            </form>



            <div class="table-responsive">
              <?php
											$today = date("Y-m-d");

											// Step 1: Get all distinct room types that have blocked slots
/* ---------- STEP 1: room types to show ---------- */
											if ($selectedId) {
												/* user picked *one* room type */
												$roomtypes = $conn->query("
        SELECT id, roomtype
        FROM roomtypes
        WHERE hotel = $_SESSION[hotel]
          AND id = $selectedId
    ");
											} else {
												/* original behaviour: every room type that has blocked slots */
												$roomtypes = $conn->query("
        SELECT DISTINCT r.id, r.roomtype
        FROM roomtypes r
        JOIN blocked_slots bs ON bs.roomtype = r.id
        JOIN rate_plans rp   ON rp.id      = bs.rpid
        WHERE rp.hotel = $_SESSION[hotel]
    ");
											}

											/* ----- the rest of your existing while ($rt = ...) loop follows ----- */


											while ($rt = $roomtypes->fetch_assoc()) {
												$roomtypeId = $rt['id'];
												$roomtypeName = $rt['roomtype'];

												echo "<h4 style='margin-top: 30px; font-weight: bold;'>Room Type: {$roomtypeName}</h4>";

												// Step 2: Fetch all rate plans for this room type
												$qry = "
        SELECT rp.id, rp.validfrom, rp.validto 
        FROM rate_plans rp 
        JOIN blocked_slots bs ON bs.rpid = rp.id 
        WHERE bs.roomtype = $roomtypeId AND rp.hotel = $_SESSION[hotel]
        GROUP BY rp.id, rp.validfrom, rp.validto 
    ";
												$result = $conn->query($qry);

												// Arrays for ordered grouping
												$currentPlans = [];
												$futurePlans = [];
												$pastPlans = [];

												while ($row = $result->fetch_assoc()) {
													$validFrom = date_create($row['validfrom']);
													$validTo = date_create($row['validto']);
													$validFromStr = $validFrom->format("Y-m-d");
													$validToStr = $validTo->format("Y-m-d");

													if ($today >= $validFromStr && $today <= $validToStr) {
														$currentPlans[] = $row;
													} elseif ($validFromStr > $today) {
														$futurePlans[] = $row;
													} else {
														$pastPlans[] = $row;
													}
												}

												// Merge in required order: Current  Future  Past
												$orderedPlans = array_merge($currentPlans, $futurePlans, $pastPlans);

												// Step 3: Display all in one table
												if (!empty($orderedPlans)) {
													echo '<table class="table table-th-block">
                <thead>
                    <tr class="tr-1">
                        <th>Sr.</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Range</th>
                    </tr>
                </thead>
                <tbody>';

													$i = 1;
													foreach ($orderedPlans as $row) {
														$validFrom = date_create($row['validfrom']);
														$validTo = date_create($row['validto']);

														$validFromStr = $validFrom->format('Y-m-d');
														$validToStr = $validTo->format('Y-m-d');

														/* work out status */
														if ($today >= $validFromStr && $today <= $validToStr) {
															$status = 'Active';           // present
															$rowStyle = '';                 // normal background
														} elseif ($validFromStr > $today) {
															$status = 'Future';
															$rowStyle = '';                 // normal background
														} else {
															$status = 'Past';
															$rowStyle = "";   // grey
														}

														echo "<tr {$rowStyle}>
            <td>{$i}</td>
            <td>" . $validFrom->format('d-m-Y') . "</td>
            <td>" . $validTo->format('d-m-Y') . "</td>
            <td>{$status}</td>                <!-- show status -->
          </tr>";
														$i++;
													}

													echo '</tbody></table>';
												}
											}
											?>


            </div>
          </div>
          <?php
							} else if ($_GET['Pg'] == "specialrates" and $_SESSION['hotel'] > 0 and $page_access) {
								if (col("toggle_roomnumber") != "") {
									if (col("toggle_status")) {
										$conn->query("delete from blocked_roomnumbers where roomnumber=$_POST[toggle_roomnumber] and bdate='$_POST[tdate]'");
									} else
										$conn->query("insert into blocked_roomnumbers (roomnumber,bdate) values ($_POST[toggle_roomnumber],'$_POST[tdate]')");
								}
								pms_info_status() ?>
          <script type="text/javascript">
          function update_rate_ondate(id, tariff, roomtype) {
            document.getElementById(id).innerHTML = "<input type='number' min='0' step='1' id='t" + id +
              "' class='form-control' value='" + tariff + "' onKeydown=\"if(event.keyCode == 13)save_rate_ondate('" +
              id + "',this.value," + roomtype + ")\" style='width:60px'>";
          }
          </script>
          <script type="text/javascript">
          function toggle_availability(roomnumber, rdate) {
            document.getElementById("toggle_roomnumber").value = roomnumber;
            document.getElementById("tdate").value = rdate;

            if (document.getElementById("d" + rdate).checked)
              document.getElementById("toggle_status").value = 1;
            else
              document.getElementById("toggle_status").value = 0;

            document.frm1.submit();
          }
          </script>
          <h1 class="page-heading">ROOMS <small>AVAILABILITY & RATES</small></h1>
          <div class="the-box">
            <h4 class="small-title">SET SPECIAL RATES & AVAILABILITY OF THE ROOMS</h4>
            <style type="text/css">
            .legend-box {
              width: 12px;
              height: 12px;
              float: left
            }

            .legend-text {
              width: 75px;
              height: 15px;
              margin-left: 3px;
              margin-top: -3px;
              float: left;
            }
            </style>
            <div>
              <div class="legend-box" style="background:#60CC70"></div>
              <div class="legend-text">Availbale</div>

              <div class="legend-box" style="background:#6070CC"></div>
              <div class="legend-text">Blocked</div>

              <div class="legend-box" style="background:#F14546"></div>
              <div class="legend-text">Booked</div>
            </div>
            <br>
            <?php alertbox($clrclass, $msg) ?>
            <form method="post" name="frm1" action="">
              <div class="row">
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Roomtype</label>
                    <select name="roomtype" id="roomtype" class="form-control"
                      onChange="document.getElementById('roomnumber').value='';form.submit()">
                      <option value="">Select Roomtype</option>
                      <?php $result = $conn->query("select id,roomtype from roomtypes where hotel=$_SESSION[hotel] and fulldaytariff>0");
														while ($row = $result->fetch_assoc()) { ?>
                      <option value="<?= $row['id'] ?>" <?= selected($row['id'], col("roomtype")) ?>>
                        <?= $row['roomtype'] ?></option>
                      <?php
														} ?>
                    </select>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Room Number</label>
                    <select name="roomnumber" id="roomnumber" class="form-control" onChange="form.submit()">
                      <option value="">Select Roomtype</option>
                      <?php if (col("roomtype") != "") {
															$result = $conn->query("select id,roomnumber from roomnumbers where roomtype=$_POST[roomtype]");
															while ($row = $result->fetch_assoc()) { ?>
                      <option value="<?= $row['id'] ?>" <?= selected($row['id'], col("roomnumber")) ?>>
                        <?= $row['roomnumber'] ?></option>
                      <?php
															}
														} ?>
                    </select>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>Month</label>
                    <select name="month_year" class="form-control" onChange="form.submit()">
                      <option value="">Select Month</option>
                      <?php $curdate = new \DateTime();
														for ($i = 1; $i < 13; $i++) { ?>
																													<option value="<?= $curdate->format("m|Y") ?>"
																<?= selected($curdate->format("m|Y"), col("month_year")) ?>>
																<?= $curdate->format("M Y") ?></option>
															<?php $curdate->modify("+1 months");
														} ?>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <div class="table-responsive" style="overflow-x:scroll;zoom:67%">
                    <?php if (col("month_year") != "" and col("roomnumber") != "") {
														$temp = explode("|", $_POST['month_year']);
														$days_in_month = cal_days_in_month(CAL_GREGORIAN, $temp[0], $temp[1]);
														$month_short_name = substr(get_month_name($temp[0]), 0, 3);
														$day_of_week = date_create($temp[1] . "-" . $temp[0] . "-1")->format("w");
														$blocked_days = array();

														$row = execute("select fulldaytariff from roomtypes where id=$_POST[roomtype]");
														$fulldaytariff = $row['fulldaytariff']; ?>
                    <input type="hidden" name="toggle_roomnumber" id="toggle_roomnumber">
                    <input type="hidden" name="toggle_status" id="toggle_status">
                    <input type="hidden" name="tdate" id="tdate">
                    <table class="table table-th-block table-hover">
                      <tr>
                        <th style="width:20%">Inventory Availiblity</th>
                        <?php $today = new \DateTime();
																for ($i = 1; $i <= $days_in_month; $i++) {
																	$bdate = $temp[1] . "-" . $temp[0] . "-" . $i;

																	if (date_create($bdate) <= $today)
																		$disabled = "disabled";
																	else
																		$disabled = "";

																	$rs_row = execute("select count(*)cnt from blocked_roomnumbers where roomnumber=$_POST[roomnumber] and bdate='$bdate'");

																	$blocked_days[$i - 1] = $rs_row['cnt']; ?>
                        <th>
                          <input type="checkbox" value="1" <?= $rs_row['cnt'] ? "" : "checked" ?> id="d<?= $bdate ?>"
                            onChange="toggle_availability(<?= $_POST['roomnumber'] ?>,'<?= $bdate ?>')"
                            <?= $disabled ?>>
                        </th>
                        <?php
																} ?>
                      </tr>
                      <tr>
                        <th>Month Allocation</th>
                        <?php for ($i = 1; $i <= $days_in_month; $i++) { ?>
                        <th>
                          <?= $month_short_name . " " . ($i < 10 ? "0" . $i : $i) . " " . weekdayname($day_of_week, "short") ?>
                        </th>
                        <?php $day_of_week++;
																	if ($day_of_week == 7)
																		$day_of_week = 0;
																} ?>
                      </tr>
                      <tr>
                        <th>Rate Per Night</th>
                        <?php for ($i = 1; $i <= $days_in_month; $i++) {
																	$bdate = $temp[1] . "-" . $temp[0] . "-" . $i;
																	$row = execute("select rate from special_rates where roomtype=$_POST[roomtype] and rdate='$bdate'");
																	$tariff = $row != "" ? $row['rate'] : $fulldaytariff; ?>
                        <th id="<?= $bdate ?>">
                          <?php if (date_create($bdate) > $today) { ?>
                          <a href="javascript:void(0)"
                            onClick="update_rate_ondate('<?= $bdate ?>',<?= $tariff ?>,<?= $_POST['roomtype'] ?>)">
                            <?= $tariff ?>
                          </a>
                          <?php
																		} else
																			echo $tariff; ?>
                        </th>
                        <?php
																} ?>
                      </tr>
                      <tr>
                        <td>
                          <div>00:00&nbsp;-&nbsp;00:30</div>
                          <div>00:30&nbsp;-&nbsp;01:00</div>
                          <div>01:00&nbsp;-&nbsp;01:30</div>
                          <div>01:30&nbsp;-&nbsp;02:00</div>
                          <div>02:00&nbsp;-&nbsp;02:30</div>
                          <div>02:30&nbsp;-&nbsp;03:00</div>
                          <div>03:00&nbsp;-&nbsp;03:30</div>
                          <div>03:30&nbsp;-&nbsp;04:00</div>
                          <div>04:00&nbsp;-&nbsp;04:30</div>
                          <div>04:30&nbsp;-&nbsp;05:00</div>
                          <div>05:00&nbsp;-&nbsp;05:30</div>
                          <div>05:30&nbsp;-&nbsp;06:00</div>
                          <div>06:00&nbsp;-&nbsp;06:30</div>
                          <div>06:30&nbsp;-&nbsp;07:00</div>
                          <div>07:00&nbsp;-&nbsp;07:30</div>
                          <div>07:30&nbsp;-&nbsp;08:00</div>
                          <div>08:00&nbsp;-&nbsp;08:30</div>
                          <div>08:30&nbsp;-&nbsp;09:00</div>
                          <div>09:00&nbsp;-&nbsp;09:30</div>
                          <div>09:30&nbsp;-&nbsp;10:00</div>
                          <div>10:00&nbsp;-&nbsp;10:30</div>
                          <div>10:30&nbsp;-&nbsp;11:00</div>
                          <div>11:00&nbsp;-&nbsp;11:30</div>
                          <div>11:30&nbsp;-&nbsp;12:00</div>
                          <div>12:00&nbsp;-&nbsp;12:30</div>
                          <div>12:30&nbsp;-&nbsp;13:00</div>
                          <div>13:00&nbsp;-&nbsp;13:30</div>
                          <div>13:30&nbsp;-&nbsp;14:00</div>
                          <div>14:00&nbsp;-&nbsp;14:30</div>
                          <div>14:30&nbsp;-&nbsp;15:00</div>
                          <div>15:00&nbsp;-&nbsp;15:30</div>
                          <div>15:30&nbsp;-&nbsp;16:00</div>
                          <div>16:00&nbsp;-&nbsp;16:30</div>
                          <div>16:30&nbsp;-&nbsp;17:00</div>
                          <div>17:00&nbsp;-&nbsp;17:30</div>
                          <div>17:30&nbsp;-&nbsp;18:00</div>
                          <div>18:00&nbsp;-&nbsp;18:30</div>
                          <div>18:30&nbsp;-&nbsp;19:00</div>
                          <div>19:00&nbsp;-&nbsp;19:30</div>
                          <div>19:30&nbsp;-&nbsp;20:00</div>
                          <div>20:00&nbsp;-&nbsp;20:30</div>
                          <div>20:30&nbsp;-&nbsp;21:00</div>
                          <div>21:00&nbsp;-&nbsp;21:30</div>
                          <div>21:30&nbsp;-&nbsp;22:00</div>
                          <div>22:00&nbsp;-&nbsp;22:30</div>
                          <div>22:30&nbsp;-&nbsp;23:00</div>
                          <div>23:00&nbsp;-&nbsp;23:30</div>
                          <div>23:30&nbsp;-&nbsp;00:00</div>
                        </td>
                        <?php for ($i = 1; $i <= $days_in_month; $i++) {
																	$booking_blocked_slots1 = array();
																	$booking_blocked_slots2 = array();
																	$special_blocked_slots1 = array();
																	$special_blocked_slots2 = array();
																	$normal_blocked_slots1 = array();
																	$normal_blocked_slots2 = array();
																	$booking_day = array();

																	$bdate = $temp[1] . "-" . $temp[0] . "-" . $i;

																	$cmd_row = execute("select id from rate_plans where hotel=$_SESSION[hotel] and ('$bdate' between validfrom and validto)");
																	$rpid = $cmd_row['id'];

																	$q = "select b.checkindatetime,b.checkoutdatetime,b.hours from bookings b join room_distribution rd on rd.bookingid=b.id where rd.roomnumber=$_POST[roomnumber] and ('$bdate' between cast(b.checkindatetime as date) and cast(b.checkoutdatetime as date)) and (b.paid=1 or b.ticker>now())";

																	//echo $i==23?$q:"";
												
																	$cmd = $conn->query($q);

																	if ($cmd->num_rows > 0) {
																		$m = 0;
																		while ($cmd_row = $cmd->fetch_assoc()) {
																			if (!$cmd_row['hours']) {
																				if (date_create($cmd_row['checkindatetime'])->format("Y-m-d") == $bdate) { //echo "XXX".date_create($cmd_row['checkindatetime'])->format("Y-m-d");
																					$booking_blocked_slots1[$m] = 25;
																					$booking_blocked_slots2[$m] = 48;
																					$booking_day[$i - 1] = 1;
																				} else if (date_create($cmd_row['checkoutdatetime'])->format("Y-m-d") == $bdate) { //echo "YYY".date_create($cmd_row['checkoutdatetime'])->format("Y-m-d");
																					$booking_blocked_slots1[$m] = 1;
																					$booking_blocked_slots2[$m] = 22;
																					$booking_day[$i - 1] = 1;
																				} else { //echo "ZZZ".date_create($cmd_row['checkindatetime'])->format("Y-m-d");
																					$blocked_days[$i - 1] = 1;
																					$booking_day[$i - 1] = 1;
																				}
																			} else { //echo "AAA";
																				$hhh = (int) date_create($cmd_row['checkindatetime'])->format("H");
																				$mmm = (int) date_create($cmd_row['checkindatetime'])->format("i");

																				if ($mmm == 30)
																					$sltid = ($hhh * 2) + 1;
																				else
																					$sltid = ($hhh + 1) * 2;

																				$booking_blocked_slots1[$m] = $sltid;
																				$booking_blocked_slots2[$m] = $sltid + ($cmd_row['hours'] * 2);
																				$booking_day[$i - 1] = 1;
																			}
																			$m++;
																		}

																		//echo "<pre>".print_r($booking_blocked_slots1,true)."</pre>";
																	}

																	$special = 0;

																	$cmd = $conn->query("select sbs.rpid,sbs.starttime,sbs.endtime,ts1.slot as start_slot,ts2.slot as end_slot from special_blocked_slots sbs join time_slots ts1 on cast(ts1.stime as time)=sbs.starttime join time_slots ts2 on cast(ts2.etime as time)=sbs.endtime where sbs.bdate='$bdate' and sbs.roomnumber=$_POST[roomnumber]");

																	if ($cmd->num_rows > 0) {
																		$x = 0;
																		while ($cmd_row = $cmd->fetch_assoc()) {
																			$special_blocked_slots1[$x] = $cmd_row['start_slot'];
																			$special_blocked_slots2[$x] = $cmd_row['end_slot'];
																			$rpid = $cmd_row['rpid'];
																			$x++;
																		}
																		$special = 1;
																	}

																	$rs = $conn->query("select coalesce(bs.rpid,0)rpid,bs.starttime,bs.endtime,ts1.slot as start_slot, ts2.slot as end_slot from rate_plans rp join blocked_slots bs on rp.id=bs.rpid join time_slots ts1 on cast(ts1.stime as time)= bs.starttime join time_slots ts2 on cast(ts2.stime as time)=bs.endtime where rp.hotel=$_SESSION[hotel] and bs.roomtype=$_POST[roomtype] and ('$bdate' between rp.validfrom and rp.validto)");

																	$x = 0;

																	while ($rs_row = $rs->fetch_assoc()) {
																		$normal_blocked_slots1[$x] = $rs_row['start_slot'];
																		$normal_blocked_slots2[$x] = $rs_row['end_slot'];
																		$rpid = $rs_row['rpid'];
																		$x++;
																	}

																	if (isset($booking_day[$i - 1])) {
																		if ($booking_day[$i - 1])
																			$anchor = "href='javascript:alert(\"Room availability can not be changed when room is booked on that day.\")'";
																		else
																			$anchor = "href='LBF_updateroomavailability.php?rpid=" . $rpid . "&id=" . $_POST['roomnumber'] . "&rdate=" . $bdate . "' class='fancybox4 fancybox.iframe'";
																	} else {
																		if (isset($blocked_days[$i - 1])) {
																			if ($blocked_days[$i - 1])
																				$anchor = "href='javascript:alert(\"Room is not available on this day.\")'";
																			else
																				$anchor = "href='LBF_updateroomavailability.php?rpid=" . $rpid . "&id=" . $_POST['roomnumber'] . "&rdate=" . $bdate . "' class='fancybox4 fancybox.iframe'";
																		} else
																			$anchor = "href='LBF_updateroomavailability.php?rpid=" . $rpid . "&id=" . $_POST['roomnumber'] . "&rdate=" . $bdate . "' class='fancybox4 fancybox.iframe'";
																	}

																	if (date_create($bdate) <= $today)
																		$anchor = "href='javascript:void(0)' onClick='alert(\"Room availability of past and current dates can not be changed\")'"; ?>
                        <td>
                          <a <?= $anchor ?>>
                            <?php $j = 1;

																			//print_r($booking_blocked_slots1);
																			//echo "<br>";
																			//print_r($special_blocked_slots1);
														
																			//echo sizeof($booking_blocked_slots1);
														
																			while ($j <= 48 and 1) {
																				if ($blocked_days[$i - 1]) { ?>
                            <div style="background:#6070CC">&nbsp;</div>
                            <?php $j++;
																				} else {
																					if (sizeof($booking_blocked_slots1 > 0)) { //echo "A";
																						if (in_array($j, $booking_blocked_slots1)) {
																							echo "B";
																							$k = array_keys($booking_blocked_slots1, $j);
																							$s = $j;
																							$e = $booking_blocked_slots2[$k[0]] == 1 && $s != 1 ? 49 : $booking_blocked_slots2[$k[0]];

																							for ($p = $s; $p <= $e; $p++) { ?>
                            <div style="background:#F14546">&nbsp;</div>
                            <?php $j++;
																							}
																						} else if (sizeof($special_blocked_slots1 > 0)) { //echo "C";
																							if (in_array($j, $special_blocked_slots1)) {
																								$k = array_keys($special_blocked_slots1, $j);
																								$s = $j;
																								$e = $special_blocked_slots2[$k[0]] == 1 && $s != 1 ? 48 : $special_blocked_slots2[$k[0]];

																								for ($p = $s; $p <= $e; $p++) { ?>
                            <div style="background:#6070CC">&nbsp;</div>
                            <?php $j++;
																								}
																							} else if (sizeof($normal_blocked_slots1 > 0)) { //echo "D";
																								if (in_array($j, $normal_blocked_slots1) and !$special) { //echo "E";
																									$k = array_keys($normal_blocked_slots1, $j);
																									$s = $j;
																									$e = $normal_blocked_slots2[$k[0]] == 1 && $s != 1 ? 49 : $normal_blocked_slots2[$k[0]];

																									if (!($s == 1 and $e == 1)) {
																										for ($p = $s; $p < $e; $p++) { ?>
                            <div style="background:#6070CC">&nbsp;</div>
                            <?php $j++;
																										}
																									} else { //echo "F";
																										?>
                            <div style="background:#60CC70">&nbsp;</div>
                            <?php $j++;
																									}
																								} else { //echo "F";
																									?>
                            <div style="background:#60CC70">&nbsp;</div>
                            <?php $j++;
																								}
																							} else { ?>
                            <div style="background:#60CC70">&nbsp;</div>
                            <?php $j++;
																							}
																						} else { ?>
                            <div style="background:#60CC70">&nbsp;</div>
                            <?php $j++;
																						}
																					} else { ?>
                            <div style="background:#60CC70">&nbsp;</div>
                            <?php $j++;
																					}
																				}
																			} ?>
                          </a>
                        </td>
                        <?php
																} ?>
                      </tr>
                    </table>
                    <?php
													} ?>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <?php
							} else if ($_GET['Pg'] == "hotelnormalrates" and $_SESSION['hotel'] > 0 and $page_access) {
								if (col("weekendloader") != "") {
									$weekendloader = $_POST['weekendloader'];
									$nightloader = $_POST['nightloader'];
									$h2 = $_POST['h2'];
									$h3 = $_POST['h3'];
									$h4 = $_POST['h4'];
									$h5 = $_POST['h5'];
									$h6 = $_POST['h6'];
									$h7 = $_POST['h7'];
									$h8 = $_POST['h8'];
									$h9 = $_POST['h9'];
									$h10 = $_POST['h10'];

									$conn->query("update hotels set weekendloader=$weekendloader,nightloader=$nightloader,h2=$h2,h3=$h3,h4=$h4,h5=$h5,h6=$h6,h7=$h7, h8=$h8,h9=$h9,h10=$h10 where id=$_SESSION[hotel]");

									$clrclass = "success";
									$msg = "Hotel rates saved successfully";
								}
								pms_info_status(); ?>
          <h1 class="page-heading">HOTEL RATE SETUP</h1>
          <div class="the-box">
            <h4 class="small-title">WEEKEND & NIGHT LOADER</h4>


            <?php alertbox($clrclass, $msg);

									$row = execute("select weekendloader,nightloader,h2,h3,h4,h5,h6,h7,h8,h9,h10 from hotels where id=$_SESSION[hotel]");

									$weekendloader = alt_val($row['weekendloader'], 10);
									$nightloader = alt_val($row['nightloader'], 5);
									$h2 = alt_val($row['h2'], 35);
									$h3 = alt_val($row['h3'], 40);
									$h4 = alt_val($row['h4'], 45);
									$h5 = alt_val($row['h5'], 50);
									$h6 = alt_val($row['h6'], 55);
									$h7 = alt_val($row['h7'], 60);
									$h8 = alt_val($row['h8'], 65);
									$h9 = alt_val($row['h9'], 70);
									$h10 = alt_val($row['h10'], 75); ?>
            <form method="post" action="?Pg=hotelnormalrates">
              <div class="row">
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Weekend Loader(%) of fullday tariff</label>
                    <input type="number" name="weekendloader" id="weekendloader" value="<?= $weekendloader ?>"
                      class="form-control" min="-100" max="100" onKeyup="preview_rates()">
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="form-group">
                    <label>Night Loader(%) of fullday tariff</label>
                    <input type="number" name="nightloader" id="nightloader" value="<?= $nightloader ?>"
                      class="form-control" min="-100" max="100" onKeyup="preview_rates()">
                  </div>
                </div>
              </div>
              <div class="row" style="margin-bottom:-30px">
                <div class="col-xs-12">
                  <h4>Hourly Rate Setup</h4>
                  <div class="table-responsive">
                    <table class="table table-th-block table-hover">
                      <thead>
                        <tr>
                          <th>Hours</th>
                          <th style="text-align:center">2</th>
                          <th style="text-align:center">3</th>
                          <th style="text-align:center">4</th>
                          <th style="text-align:center">5</th>
                          <th style="text-align:center">6</th>
                          <th style="text-align:center">7</th>
                          <th style="text-align:center">8</th>
                          <th style="text-align:center">9</th>
                          <th style="text-align:center">10</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Rate(%)</td>
                          <td><input type="number" name="h2" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h2 ?>" id="h2" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h3" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h3 ?>" id="h3" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h4" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h4 ?>" id="h4" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h5" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h5 ?>" id="h5" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h6" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h6 ?>" id="h6" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h7" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h7 ?>" id="h7" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h8" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h8 ?>" id="h8" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h9" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h9 ?>" id="h9" onKeyup="preview_rates()"></td>
                          <td><input type="number" name="h10" style="text-align:center" class="form-control" min="-100"
                              max="100" value="<?= $h10 ?>" id="h10" onKeyup="preview_rates()"></td>
                        </tr>
                        <tr>
                          <td colspan="10">
                            <input type="submit" class="btn btn-primary" value="Save">
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </form>
            <script type="text/javascript">
            function preview_rates() {
              weekendloader = parseFloat(document.getElementById("weekendloader").value != "" ? document.getElementById(
                "weekendloader").value : 0);
              nightloader = parseFloat(document.getElementById("nightloader").value != "" ? document.getElementById(
                "nightloader").value : 0);

              var h = new Array();
              h[0] = 0;
              h[1] = 0;
              h[2] = parseFloat(document.getElementById("h2").value != "" ? document.getElementById("h2").value : 0);
              h[3] = parseFloat(document.getElementById("h3").value != "" ? document.getElementById("h3").value : 0);
              h[4] = parseFloat(document.getElementById("h4").value != "" ? document.getElementById("h4").value : 0);
              h[5] = parseFloat(document.getElementById("h5").value != "" ? document.getElementById("h5").value : 0);
              h[6] = parseFloat(document.getElementById("h6").value != "" ? document.getElementById("h6").value : 0);
              h[7] = parseFloat(document.getElementById("h7").value != "" ? document.getElementById("h7").value : 0);
              h[8] = parseFloat(document.getElementById("h8").value != "" ? document.getElementById("h8").value : 0);
              h[9] = parseFloat(document.getElementById("h9").value != "" ? document.getElementById("h9").value : 0);
              h[10] = parseFloat(document.getElementById("h10").value != "" ? document.getElementById("h10").value : 0);

              var roomtypes = new Array();
              var fulldaytariffs = new Array();

              <?php $i = 0;
											$result = $conn->query("select id,fulldaytariff from roomtypes where hotel=$_SESSION[hotel] and fulldaytariff>0");
											while ($row = $result->fetch_assoc()) { ?>
              roomtypes[<?= $i ?>] = <?= $row['id'] ?>;
              fulldaytariffs[<?= $i ?>] = parseFloat(<?= $row['fulldaytariff'] ?>);
              <?php $i++;
											}
											$i--; ?>

              for (x = 0; x <= <?= $i ?>; x++) {
                var rid = roomtypes[x];
                var fdt = parseFloat(fulldaytariffs[x]);

                for (p = 2; p <= 10; p++) {
                  a = document.getElementById("wddh" + p + "r" + rid).value = Math.round(fdt * h[p] * 0.01);
                  b = document.getElementById("wdnh" + p + "r" + rid).value = Math.round(a + (a * nightloader * 0.01));
                  c = document.getElementById("wedh" + p + "r" + rid).value = Math.round(a + (a * weekendloader *
                    0.01));
                  d = document.getElementById("wenh" + p + "r" + rid).value = Math.round(c + (c * nightloader * 0.01));
                }
              }
            }
            </script>
            <h4 class="small-title">RATES PREVIEW</h4>
            <?php $result = $conn->query("select id,roomtype,fulldaytariff from roomtypes where hotel=$_SESSION[hotel] and fulldaytariff>0 order by id");
									if ($result->num_rows > 0) { ?>
            <div class="panel with-nav-tabs panel-success">
              <div class="panel-heading" style="margin-left:30px;">
                <ul class="nav nav-tabs">
                  <?php $i = 0;
													while ($row = $result->fetch_assoc()) { ?>
                  <li <?= (!$i) ? "class='active'" : "" ?>><a href="#wizard-1-step<?= $row['id'] ?>"
                      data-toggle="tab"><?= $row['roomtype'] ?></a></li>
                  <?php $i++;
													}
													mysqli_data_seek($result, 0); ?>
                </ul>
              </div>
              <div id="panel-collapse-1" class="collapse in" style="padding-top:10px;">
                <div class="tab-content">
                  <?php $i = 0;
													while ($row = $result->fetch_assoc()) { ?>
                  <div class="tab-pane fade <?= (!$i) ? "in active" : "" ?>" id="wizard-1-step<?= $row['id'] ?>">
                    <div class="panel-body">
                      <!-- <h4>Rates of '<?= strtoupper($row['roomtype']) ?>'</h4> -->
                      <h4>ON <b>&#8377; <?= indianamount($row['fulldaytariff']) ?></b> FULLDAY
                        TARIFF</h4>
                      <div class="row">
                        <div class="col-xs-3">
                          <label>No. of Hours</label>
                        </div>
                        <div class="col-xs-1">
                          <center><label>2</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>3</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>4</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>5</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>6</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>7</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>8</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>9</label></center>
                        </div>
                        <div class="col-xs-1">
                          <center><label>10</label></center>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-3">
                          Day Rates (Weekdays)
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh2r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh3r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh4r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh5r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh6r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh7r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh8r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh9r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wddh10r<?= $row['id'] ?>" value="" readonly>
                        </div>
                      </div>
                      <div class="row form-group">
                        <div class="col-xs-3">
                          Night Rates (Weekdays)
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh2r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh3r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh4r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh5r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh6r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh7r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh8r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh9r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wdnh10r<?= $row['id'] ?>" value="" readonly>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-3">
                          Day Rates (Weekends)
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh2r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh3r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh4r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh5r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh6r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh7r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh8r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh9r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wedh10r<?= $row['id'] ?>" value="" readonly>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-3">
                          Night Rates (Weekends)
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh2r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh3r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh4r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh5r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh6r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh7r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh8r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh9r<?= $row['id'] ?>" value="" readonly>
                        </div>
                        <div class="col-xs-1">
                          <input type="text" class="form-control" id="wenh10r<?= $row['id'] ?>" value="" readonly>
                        </div>
                      </div>
                    </div>
                  </div>
                  <?php $i++;
													} ?>
                </div>
              </div>
            </div>
            <?php
									} else { ?>
            No full day tariff for any room is defined
            <?php
									} ?>
          </div>
          <?php
							}
							// set room plan rate
							else if ($_GET['Pg'] == "setroomplanrate" and $_SESSION['hotel'] > 0 and $page_access) {

								$msg = "";

								$clrclass = "success";
								pms_info_status(); ?>

          <div id="messageBox-room-rate-plan"></div>
          <script>
          function showMessageBoxsetroomplanrate(content, type) {
            const messageBox = document.getElementById('messageBox-room-rate-plan');

            // Determine the alert class based on the type parameter
            let alertClass;
            switch (type) {
              case 'success':
                alertClass = 'alert-success';
                break;
              case 'error':
                alertClass = 'alert-danger';
                break;
              case 'warning':
                alertClass = 'alert-warning';
                break;
              default:
                alertClass = 'alert-info';
            }

            // Populate the messageBox with the content and appropriate styling
            messageBox.innerHTML = `
										<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:202px; right:52px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
											<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
											<p style="width:90%;">${content}</p>
										</div>`;

            // Show the message box
            messageBox.style.display = "block";

            // Automatically hide the message box after 4 seconds
            setTimeout(() => {
              messageBox.style.display = "none";
            }, 4000);
          }
          </script>


          <div class="the-box">
            <h1 class="page-heading">set room rate</h1>
            <!-- <h4 class="small-title">Rate plan code</h4> -->

																									<div class="row" style="margin-right: -15px;margin-left: -12px;margin-bottom: -6px; margin-top: -50px;">
																										<div class="col-xs-4">

																										</div>

																										<div class="col-xs-2"></div>
																										<div class="col-xs-2"></div>
																										<div class="col-xs-2">
																											<div class="form-group">
																												<label>From Date:</label>
																												<input type="date" name="roomratefromdate" class="form-control"
																													id="roomrateplanfromdate" required>
																											</div>
																										</div>
																										<div class="col-xs-2">
																											<div class="form-group">
																												<label>To Date:</label>
																												<input type="date" name="roomratetodate" class="form-control"
																													id="roomrateplanTodate" required>
																											</div>
																										</div>
																									</div>
																									<!-- <h4 class="small-title">RATES PREVIEW</h4> -->
																									<div id="messageBox"></div>
									<?php $result = $conn->query("select id,roomtype,fulldaytariff,cmroomid from roomtypes where hotel=$_SESSION[hotel]");
									if ($result->num_rows > 0) { ?>
																										<div class="panel with-nav-tabs panel-success" style="border-color:#fff;">

              <div class="panel-heading" style=" background-color: #fff;">
                <ul class="nav nav-tabs"
                  style="display: flex; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; width: 100%; padding-bottom: 10px; margin-bottom: 0;">
                  <?php $i = 0;
													while ($row = $result->fetch_assoc()) { ?>
                  <li <?= (!$i) ? "class='active'" : "" ?> style="flex: 0 0 auto; background-color: #da5553;">
                    <a href="#wizard-1-step<?= $row['id'] ?>" data-toggle="tab"><?= $row['roomtype'] ?></a>
                  </li>
                  <?php $i++;
													}
													mysqli_data_seek($result, 0); ?>
                </ul>
              </div>
              <div id="panel-collapse-1" class="collapse in" style="padding-top:20px;">
                <div class="tab-content">
                  <?php $i = 0;
													$hotelcode = execute("select u.cm_company_name, h.user from hotels h JOIN users u ON h.user = u.id where h.id = $_SESSION[hotel]");

													while ($row = $result->fetch_assoc()) { ?>
                  <div class="tab-pane fade <?= (!$i) ? "in active" : "" ?>" id="wizard-1-step<?= $row['id'] ?>">
                    <div class="table-body">
                      <?php
																	$rate_plan = $conn->query("select id,room_rate_plan,roomtype,cm_rate_plan from room_rate_plans where roomtype=$row[id] and deleted=0");
																	if ($rate_plan->num_rows > 0) { ?>
                      <table class="table">
                        <thead>
                          <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Rate Plan</th>
                            <th scope="col">Rate()</th>

                          </tr>
                        </thead>
                        <tbody>
                          <?php
																				$j = 0;
																				$rate_row_ids = [];
																				$now_obj = new DateTime();
																				$now = $now_obj->format("Y-m-d");
																				while ($rate_row = $rate_plan->fetch_assoc()) {
																					$rate_price = execute("select fulldaytariff from room_rate_plans_validity where rateplanid=$rate_row[id] and validfrom<= '$now'and validto>='$now'");
																					$j++;
																					?>
                          <tr>
                            <th scope="row"><?= $j ?></th>
                            <td><?= $rate_row['room_rate_plan'] ?></td>
                            <td><input style="border: 1px solid #ddd; padding:5px 10px;"
                                value="<?= $rate_price['fulldaytariff'] ?>" id="set-room-plan-rate-<?= $i ?>-<?= $j ?>"
                                type="number" aria-label="<?= $rate_row['id'] ?>" oninput="checkInputs('<?= $i ?>');"
                                alt="<?= $rate_row['cm_rate_plan'] ?>">
                            </td>
                            </td>
                          </tr>
                          <?php } ?>

                        </tbody>
                      </table>

                      <div class="submit-button"
                        style="float:left; margin:10px 0px; font-size:13px; background-color:#db462c">
                        <button style="color:white;" id="submit-button-<?= $i ?>"
                          onClick="roomPlanRate('<?= $i ?>','<?= $j ?>','<?= $hotelcode['cm_company_name'] ?>','<?= $row['cmroomid'] ?>')"
                          class="btn" disabled>Submit</button>
                      </div>

                      <?php
																	} else {
																		echo "No Rate Plan Is Selected For The Given RoomType";
																	} ?>
                    </div>
                  </div>
                  <?php $i++;
													} ?>
                </div>
              </div>
            </div>
            <?php
									} else { ?>
            No full day tariff for any room is defined
            <?php
									} ?>
          </div>
          <script>
          function checkInputs(tabIndex) {
            const inputs = [];
            let i = 1;
            while (true) {
              const input = document.getElementById(`set-room-plan-rate-${tabIndex}-${i}`);
              if (!input) break;
              inputs.push(input);
              i++;
            }

            const submitButton = document.querySelector(`#submit-button-${tabIndex}`);

            const allFilled = inputs.every(input => input.value.trim() !== '');

            submitButton.disabled = !allFilled;
          }
          let today = new Date();
          let nextMonth = new Date();
          nextMonth.setMonth(today.getMonth() + 1);

          let formattedToday = today.toISOString().split('T')[0];
          let formattedNextMonth = nextMonth.toISOString().split('T')[0];

          document.getElementById('roomrateplanfromdate').value = formattedToday;
          document.getElementById('roomrateplanTodate').value = formattedNextMonth;


          function formatDateTime(dateTimeString) {
            const dateObj = new Date(dateTimeString);

            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');

            return `${year}-${month}-${day}`;
          }

          function roomPlanRate(i, j, hotelCode, rate_plan) {
            let rate_id_arr = []
            let rate_price_arr = []
            let cm_room_rate_plans = []

            for (let k = 0; k < j; k++) {
              rate_id_arr.push(document.getElementById(`set-room-plan-rate-${i}-${k + 1}`).ariaLabel)
              rate_price_arr.push(document.getElementById(`set-room-plan-rate-${i}-${k + 1}`).value)
              cm_room_rate_plans.push(document.getElementById(`set-room-plan-rate-${i}-${k + 1}`).alt)
            }

            let roomplantodate = formatDateTime(document.querySelector(`input[name="roomratetodate"]`).value);
            let roomplanfromdate = formatDateTime(document.querySelector(`input[name="roomratefromdate"]`).value);

            $.ajax({
              type: 'POST',
              url: 'bookingajax.php',
              data: {
                id: rate_id_arr,
                rate: rate_price_arr,
                validfrom: roomplanfromdate,
                validto: roomplantodate,
                action: 'room_plan_rate_set',
                user: <?= $_SESSION['id'] ?>,
                hotel: <?= $_SESSION['hotel'] ?>
              },
              success: function(response) {
                res = JSON.parse(response)

                if (res.status === 'success') {

                  updateCmRoomRates(roomplanfromdate, roomplantodate, cm_room_rate_plans, rate_price_arr,
                    rate_plan, hotelCode, j);

                  document.getElementById('messageBox').innerHTML = `<div class='alert alert-success alert-block square fade in alert-dismissable'>
													<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
													<p>
													${res.message}
													</p>
												</div>`;
                } else if (res.status === 'fail') {
                  document.getElementById('messageBox').innerHTML = `<div class='alert alert-success alert-block square fade in alert-dismissable'>
													<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
													<p>
													${res.message}
													</p>
												</div>`;
                }
              }
            });
          }

          function updateCmRoomRates(startdate, enddate, cmroomtype_arr, rate_arr, cmroomratePlan, hotelCode, index) {
            let rates = []

            for (let i = 0; i < index; i++) {
              rates.push({
                "roomCode": cmroomratePlan,
                "rate": rate_arr[i],
                "rateplanCode": cmroomtype_arr[i]
              })
            }
            const body = {
              "hotelCode": hotelCode,
              "updates": [{
                "startDate": startdate,
                "endDate": enddate,
                "rates": rates
              }]
            }


            fetch('https://live.aiosell.com/api/v2/cm/update-rates/banqueteasy', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(body)
              })
              .then(response => response.json())
              .then(data => {
                // Handle the response from the API
                console.log('Success:', data);
                // showMessageBoxsetroomplanrate("Room rate plan added", "success")
              })
              .catch(error => {
                // Handle any errors
                console.error('Error:', error);
              });
          }
          </script>
          <?php
							} else if ($_GET['Pg'] == "setroomplanrateview" and $_SESSION['hotel'] > 0 and $page_access) {

								$msg = "";

								$clrclass = "success";
								pms_info_status(); ?>

          <div id="messageBox-room-rate-plan"></div>
          <div class="the-box">
            <!-- <h4 class="small-title">Rate plan code</h4> -->
            <!-- <h4 class="small-title">RATES PREVIEW</h4> -->
            <?php
										$allTypes = $conn->query("
    SELECT id, roomtype
    FROM roomtypes
    WHERE hotel = $_SESSION[hotel]
    ORDER BY roomtype
");
										$selected = (isset($_GET['roomtype']) && ctype_digit($_GET['roomtype']))
											? (int) $_GET['roomtype'] : '';
										?>
            <form id="roomFilter" method="get" style="margin-bottom:15px;">
              <input type="hidden" name="Pg" value="<?= htmlspecialchars($_GET['Pg'] ?? 'setroomplanrateview') ?>">
              <label>Filter by Room Type:</label>
              <select name="roomtype" class="form-control chosen-select" onchange="this.form.submit()"
                style="width:220px;">
                <option value="">All room types</option>
                <?php while ($t = $allTypes->fetch_assoc()): ?>
                <option value="<?= $t['id'] ?>" <?= $t['id'] == $selected ? 'selected' : '' ?>>
                  <?= htmlspecialchars($t['roomtype']) ?>
                </option>
                <?php endwhile; ?>
              </select>
            </form>
            <?php
										$today = date('Y-m-d');

										/* room types to show */
										$roomtypesSQL = $selected
											? "SELECT id,roomtype FROM roomtypes WHERE hotel=$_SESSION[hotel] AND id=$selected"
											: "SELECT DISTINCT r.id,r.roomtype
       FROM roomtypes r
       JOIN room_rate_plans rp ON rp.roomtype=r.id
       JOIN room_rate_plans_validity v ON v.rateplanid=rp.id
      WHERE r.hotel=$_SESSION[hotel]";
										$roomtypes = $conn->query($roomtypesSQL);

										while ($rt = $roomtypes->fetch_assoc()):
											$rtId = $rt['id'];
											$rtName = $rt['roomtype'];
											?>
            <h4 style="margin-top:30px;font-weight:bold;">Room Type: <?= htmlspecialchars($rtName) ?></h4>

            <?php
											/* fetch every validity window for every rate-plan of this room type */
											$q = "
 SELECT rp.id        AS rpid,
        rp.room_rate_plan,
        v.validfrom,
        v.validto,
        v.fulldaytariff
   FROM room_rate_plans rp
   JOIN room_rate_plans_validity v ON v.rateplanid = rp.id
  WHERE rp.roomtype   = $rtId
    AND rp.deleted    = 0
  ORDER BY v.validfrom
";

											$res = $conn->query($q);

											$current = [];
											$future = [];
											$past = [];
											while ($row = $res->fetch_assoc()) {
												$from = $row['validfrom'];
												$to = $row['validto'];
												if ($today >= $from && $today <= $to)
													$current[] = $row;
												elseif ($from > $today)
													$future[] = $row;
												else
													$past[] = $row;
											}
											$rows = array_merge($current, $future, $past);

											if (!$rows) {
												echo "No validity defined<br>";
												continue;
											}
											?>
            <table class="table table-th-block">
              <thead>
                <tr>
                  <th>Sr.</th>
                  <th>Rate Plan</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Rate ()</th> <!-- NEW -->
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <?php
													$idx = 1;
													foreach ($rows as $r):
														$isPast = ($r['validto'] < $today);
														$rowStyle = $isPast ? "style='background:#e0e0e0'" : "";
														$status = $isPast ? 'Past' : (($today >= $r['validfrom']) ? 'Active' : 'Future');
														?>
                <tr <?= $rowStyle ?>>
                  <td><?= $idx++ ?></td>
                  <td><?= htmlspecialchars($r['room_rate_plan']) ?></td>
                  <td><?= date('d-m-Y', strtotime($r['validfrom'])) ?></td>
                  <td><?= date('d-m-Y', strtotime($r['validto'])) ?></td>
                  <td><?= number_format($r['fulldaytariff'], 2) ?></td> <!-- NEW -->
                  <td><?= $status ?></td>
                </tr>
                <?php endforeach; ?>
              </tbody>
            </table>


            <?php endwhile; /* next room type */ ?>

            <?php
							}
							// set seasonal room plan rate
							else if ($_GET['Pg'] == "setseasonalroomplanrate" and $_SESSION['hotel'] > 0 and $page_access) {

								$msg = "";

								$clrclass = "success";
								pms_info_status(); ?>

            <div id="messageBox-seasonal-rate"></div>
            <script>
            function showMessageBoxsetseasonalrate(content, type) {
              const messageBox = document.getElementById('messageBox-seasonal-rate');

              // Determine the alert class based on the type parameter
              let alertClass;
              switch (type) {
                case 'success':
                  alertClass = 'alert-success';
                  break;
                case 'error':
                  alertClass = 'alert-danger';
                  break;
                case 'warning':
                  alertClass = 'alert-warning';
                  break;
                default:
                  alertClass = 'alert-info';
              }

              // Populate the messageBox with the content and appropriate styling
              messageBox.innerHTML = `
										<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:202px; right:52px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
											<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
											<p style="width:90%;">${content}</p>
										</div>`;

              // Show the message box
              messageBox.style.display = "block";

              // Automatically hide the message box after 4 seconds
              setTimeout(() => {
                messageBox.style.display = "none";
              }, 4000);
            }
            </script>

            <div class="the-box">
              <!-- <h4 class="small-title">Rate plan code</h4> -->

              <div class="row" style="margin-right: -15px;margin-left: -12px;margin-bottom: -6px;">
                <div class="col-xs-4">
                  <h1 class="page-heading" style="padding:24px 0 0 11px">SET SEASONAL ROOM RATE</h1>
                </div>

                <div class="col-xs-2"></div>
                <div class="col-xs-2"></div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>From Date</label>
                    <input type="date" name="roomratefromdate" class="form-control" id="roomrateplanfromdate1" required>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="form-group">
                    <label>To Date</label>
                    <input type="date" name="roomratetodate" class="form-control" id="roomrateplanTodate1" required>
                  </div>
                </div>
              </div>
              <!-- <h4 class="small-title">RATES PREVIEW</h4> -->
              <div id="messageBox"></div>
              <?php $result = $conn->query("select id,roomtype,fulldaytariff,cmroomid from roomtypes where hotel=$_SESSION[hotel]");
										if ($result->num_rows > 0) { ?>
																													<div class="panel with-nav-tabs panel-success" style="border-color: #fff;">

                <div class="panel-heading" style=" background-color: #fff;">
                  <ul class="nav nav-tabs"
                    style="display: flex; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; width: 100%; padding-bottom: 10px; margin-bottom: 0;">
                    <?php $i = 0;
														while ($row = $result->fetch_assoc()) { ?>
                    <li <?= (!$i) ? "class='active'"  : "" ?> style="flex: 0 0 auto; background-color: #da5553;">
                      <a  href="#wizard-1-step<?= $row['id'] ?>" data-toggle="tab"><?= $row['roomtype'] ?></a>
                    </li>
                    <?php $i++;
														}
														mysqli_data_seek($result, 0); ?>
                  </ul>
                </div>
                <div id="panel-collapse-1" class="collapse in" style="padding-top:20px;">
                  <div class="tab-content">
                    <?php $i = 0;
														while ($row = $result->fetch_assoc()) {
															$rate_name_arr = [];
															?>
                    <div class="tab-pane fade <?= (!$i) ? "in active" : "" ?>" id="wizard-1-step<?= $row['id'] ?>">
                      <div class="table-body">
                        <?php
																		$rate_plan = $conn->query("select id,room_rate_plan,roomtype,cm_rate_plan from room_rate_plans where roomtype=$row[id] and deleted=0");

																		if ($rate_plan->num_rows > 0) { ?>
                        <table class="table">
                          <thead>
                            <tr>
                              <th scope="col">No.</th>
                              <th scope="col">Rate Plan</th>
                              <th scope="col">Rate()</th>
                              <th scope="col" style="text-align: center;">Action</th>
                            </tr>
                          </thead>
                          <tbody id="seasonal-tbody-<?= $row['id'] ?>">
                            <?php
																					$j = 0;
																					$rate_name_arr = []; // Reset rate_name_arr for each room type
																					$rate_id_arr = []; // Reset rate_name_arr for each room type
																					while ($rate_row = $rate_plan->fetch_assoc()) {
																						$rate_name_arr[] = $rate_row['room_rate_plan'];
																						$rate_id_arr[] = $rate_row['id'];
																						$past_rate = execute("select fulldaytariff from seasonal_rate_plans_validity where rateplanid=$rate_row[id];");
																						$j++;
																						if ($past_rate !== null) {
																							?>

                            <tr>
                              <th scope="row"><?= $j ?></th>
                              <td><?= $rate_row['room_rate_plan'] ?></td>
                              <td>
                                <input style="border: 1px solid #ddd" value="<?= $past_rate['fulldaytariff'] ?>"
                                  type="number" id="rate-input-<?= $j ?>"
                                  data-original-value="<?= $past_rate['fulldaytariff'] ?>"
                                  oninput="checkForRoomRateChanges(<?= $j ?>)">
                              </td>
                              <td style="width: 150px;">
                                <button class="btn available" id="initial-room-tax-update-btn-<?= $j ?>" disabled>Update
                                </button>
                                <button class="btn booked" id="initial-room-tax-delete-btn-<?= $j ?>">Delete
                                </button>
                              </td>
                            </tr>


                            <?php } ?>
                            <?php } ?>
                          </tbody>
                        </table>


                        <script>
                        function checkForRoomRateChanges(index) {
                          // Fetch the necessary input field
                          const inputField = document.getElementById(`rate-input-${index}`);

                          // Check if the input field exists
                          if (!inputField) {
                            console.error(`Input field with ID rate-input-${index} not found`);
                            return;
                          }

                          // Fetch the original value and convert both current and original values to numbers
                          const originalValue = parseFloat(inputField.getAttribute('data-original-value'));
                          const currentValue = parseFloat(inputField.value);

                          // Check if the input is valid
                          if (isNaN(currentValue)) {
                            console.warn(`Current value of input ${index} is not a valid number`);
                            return;
                          }

                          // Check if the current value differs from the original value
                          const hasChanged = currentValue !== originalValue;

                          // Log values to see what's being compared
                          console.log(
                            `Original value: ${originalValue}, Current value: ${currentValue}, Has Changed: ${hasChanged}, ${index}`
                          );

                          // Enable or disable the update button based on the value change
                          const updateBtn = document.getElementById(`initial-room-tax-update-btn-${index}`);

                          if (!updateBtn) {
                            console.error(`Update button with ID initial-room-tax-update-btn-${index} not found`);
                            return;
                          }

                          // Enable/disable the button
                          updateBtn.disabled = !hasChanged;
                        }
                        </script>

                        <div class="submit-button" style="left; margin:10px 10px;">
                          <a
                            onclick="addseasonalrate('<?= $row['id'] ?>', <?= htmlspecialchars(json_encode(array('key' => $rate_name_arr))) ?>, <?= htmlspecialchars(json_encode(array('key' => $rate_id_arr))) ?>)">
                            <button type="button" class="btn btn-success" fdprocessedid="6dp7vc"><i
                                class="fa fa-plus"></i> Add
                              Seasonal Rate </button>
                          </a>
                        </div>

                        <?php
																		} else {
																			echo "No Rate Plan Is Selected For The Given RoomType";
																		} ?>
                      </div>

                    </div>
                    <?php $i++;
														} ?>
                  </div>

                </div>
              </div>
              <?php
										} else { ?>
              No full day tariff for any room is defined
              <?php
										} ?>
            </div>
            <script>
            let rowCounters = {}; // Initialize an object to track counters for each roomtype

            function addseasonalrate(roomTypeId, rateplans, rateplanids) {

              if (!rowCounters[roomTypeId]) {
                rowCounters[roomTypeId] = <?= $j ?>; // Set initial count for each roomtype
              }

              let tbody = document.getElementById('seasonal-tbody-' + roomTypeId);
              rowCounters[roomTypeId]++; // Increment the counter for the specific roomTypeId

              let option = rateplans.key.map((plans, index) =>
                `<option data-rateplan-id="${rateplanids.key[index]}" value="${plans}">${plans}</option>`).join('')

              let newRow = document.createElement('tr');
              newRow.innerHTML = `
																			<th scope="row">${rowCounters[roomTypeId]}</th>
																			<td>
																				<select style="width: 145px;height: 26px;border: 1px solid #ddd" id="set-room-plan-rate-${roomTypeId}-${rowCounters[roomTypeId]}" aria-label="new-${rowCounters[roomTypeId]}" alt="new-rate-plan">
																					<option value="">Select Rate Plan</option>
																					${option}
																				</select>
																			</td>

																			<td>
																				<input style="border: 1px solid #ddd" id="set-room-plan-rate1-${roomTypeId}-${rowCounters[roomTypeId]}" type="number" aria-label="new-${rowCounters[roomTypeId]}" alt="new-rate-plan">
																			</td>
																			<td>
																				<a>
																					<button onClick="saveSpecificRate(${roomTypeId}, ${rowCounters[roomTypeId]})" class="btn btn available" style="color: #fff; width: 60px">Save</button>
																				</a>
																			</td>
																		`;
              tbody.appendChild(newRow);
            }

            function saveSpecificRate(roomTypeId, rowIndex) {
              // Get the specific rate plan select input and the rate input
              let ratePlanSelect = document.querySelector(`#set-room-plan-rate-${roomTypeId}-${rowIndex}`);
              // Get the selected option
              let selectedOption = ratePlanSelect.selectedOptions[0];

              let ratePlanId = selectedOption.getAttribute('data-rateplan-id');
              let rateInput = document.querySelector(`#set-room-plan-rate1-${roomTypeId}-${rowIndex}`).value;

              let roomplantodate = formatDateTime(document.querySelector(`input[name="roomratetodate"]`).value);
              let roomplanfromdate = formatDateTime(document.querySelector(`input[name="roomratefromdate"]`).value);

              $.ajax({
                type: 'POST',
                url: 'bookingajax.php',
                data: {
                  id: ratePlanId,
                  rate: rateInput,
                  validfrom: roomplanfromdate,
                  validto: roomplantodate,
                  action: 'seasonal_plan_rate_set',
                  user: <?= $_SESSION['id'] ?>,
                  hotel: <?= $_SESSION['hotel'] ?>
                },
                success: function(response) {
                  res = JSON.parse(response)
                  if (res.status === 'success') {
                    document.getElementById('messageBox').innerHTML = `<div class='alert alert-success alert-block square fade in alert-dismissable'>
																						<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
																						<p>
																						${res.message}
																						</p>
																					</div>`;
                  } else if (res.status === 'fail') {
                    document.getElementById('messageBox').innerHTML = `<div class='alert alert-success alert-block square fade in alert-dismissable'>
																						<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
																						<p>
																						${res.message}
																						</p>
																					</div>`;
                  }
                }
              });
            }
            </script>
            <script>
            let today1 = new Date();
            let nextMonth1 = new Date();
            nextMonth1.setMonth(today1.getMonth() + 1);

            let formattedToday1 = today1.toISOString().split('T')[0];
            let formattedNextMonth1 = nextMonth1.toISOString().split('T')[0];

            document.getElementById('roomrateplanfromdate1').value = formattedToday1;
            document.getElementById('roomrateplanTodate1').value = formattedNextMonth1;


            function formatDateTime(dateTimeString) {
              const dateObj = new Date(dateTimeString);

              const year = dateObj.getFullYear();
              const month = String(dateObj.getMonth() + 1).padStart(2, '0');
              const day = String(dateObj.getDate()).padStart(2, '0');

              return `${year}-${month}-${day}`;
            }
            </script>
            <?php
							} else if ($_GET['Pg'] == "setseasonalroomplanrateview" and $_SESSION['hotel'] > 0 and $page_access) {

								$msg = "";

								$clrclass = "success";
								pms_info_status(); ?>
            <div id="messageBox-seasonal-rate"></div>
            <div class="the-box">
              <!-- <h4 class="small-title">Rate plan code</h4> -->
              <?php
											/* build dropdown data once */
											$allTypes = $conn->query("
    SELECT id, roomtype
    FROM roomtypes
    WHERE hotel = $_SESSION[hotel]
    ORDER BY roomtype
");
											$chosen = (isset($_GET['roomtype']) && ctype_digit($_GET['roomtype']))
												? (int) $_GET['roomtype'] : '';
											?>
              <form id="roomFilter" method="get" style="margin-bottom:15px;">
                <input type="hidden" name="Pg"
                  value="<?= htmlspecialchars($_GET['Pg'] ?? 'setseasonalroomplanrateview') ?>">
                <label for="roomtype"><b>Filter by Room Type:</b></label>
                <select name="roomtype" class="form-control chosen-select" id="roomtype" onchange="this.form.submit()"
                  style="width:220px;">
                  <option value="">All room types</option>
                  <?php while ($t = $allTypes->fetch_assoc()): ?>
                  <option value="<?= $t['id'] ?>" <?= $t['id'] == $chosen ? 'selected' : '' ?>>
                    <?= htmlspecialchars($t['roomtype']) ?>
                  </option>
                  <?php endwhile; ?>
                </select>
              </form>

              <?php
											$today = date('Y-m-d');

											/* which room types should we show? */
											$rtSQL = $chosen
												? "SELECT id, roomtype
       FROM roomtypes
      WHERE hotel = $_SESSION[hotel] AND id = $chosen"
												: "SELECT DISTINCT r.id, r.roomtype
       FROM roomtypes r
       JOIN room_rate_plans rp ON rp.roomtype = r.id
       JOIN seasonal_rate_plans_validity v ON v.rateplanid = rp.id
      WHERE r.hotel = $_SESSION[hotel]";

											$roomtypes = $conn->query($rtSQL);

											while ($rt = $roomtypes->fetch_assoc()):
												$rtId = $rt['id'];
												$rtName = $rt['roomtype'];
												?>
              <h4 style="margin-top:30px;font-weight:bold;">
                Room Type: <?= htmlspecialchars($rtName) ?>
              </h4>

              <?php
												/* fetch every seasonal validity row for every rate-plan of this room-type */
												$sql = "
 SELECT rp.room_rate_plan,
        v.validfrom,
        v.validto,
        v.fulldaytariff
   FROM room_rate_plans rp
   JOIN seasonal_rate_plans_validity v
        ON v.rateplanid = rp.id
  WHERE rp.roomtype = $rtId
    AND rp.deleted  = 0
  ORDER BY v.validfrom
";
												$res = $conn->query($sql);

												$thisYear = [];
												$future = [];
												$past = [];

												while ($row = $res->fetch_assoc()) {
													$from = $row['validfrom'];
													$to = $row['validto'];

													if ($today >= $from && $today <= $to)
														$thisYear[] = $row;   // Active
													elseif ($from > $today)
														$future[] = $row;   // Future
													else
														$past[] = $row;   // Past
												}

												$rows = array_merge($thisYear, $future, $past);

												if (!$rows) {
													echo "No seasonal rates defined.<br>";
													continue;
												}
												?>
              <table class="table table-th-block">
                <thead>
                  <tr>
                    <th>Sr.</th>
                    <th>Rate Plan</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Rate&nbsp;()</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <?php
														$sr = 1;
														foreach ($rows as $row):
															$isPast = ($row['validto'] < $today);
															$rowStyle = $isPast ? "style='background:#e0e0e0'" : '';
															$status = $isPast
																? 'Past'
																: (($today >= $row['validfrom']) ? 'Active' : 'Future');
															?>
                  <tr <?= $rowStyle ?>>
                    <td><?= $sr++ ?></td>
                    <td><?= htmlspecialchars($row['room_rate_plan']) ?></td>
                    <td><?= date('d-m-Y', strtotime($row['validfrom'])) ?></td>
                    <td><?= date('d-m-Y', strtotime($row['validto'])) ?></td>
                    <td><?= number_format($row['fulldaytariff'], 2) ?></td>
                    <td><?= $status ?></td>
                  </tr>
                  <?php endforeach; ?>
                </tbody>
              </table>
              <?php endwhile; /* next room-type */ ?>


            </div>

            <?php
							}
							// cm setup here:
							else if ($_GET['Pg'] == "cmsetup" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['roomtypes'])) {
									$roomtypes = $_POST['roomtypes'];
									$numofrooms = $_POST['numofrooms'];

									foreach ($roomtypes as $key => $roomtype) {
										$roomtypeid = insert("insert into roomtypes (hotel,roomtype) values ($_SESSION[hotel],'$roomtype')");

										for ($i = 1; $i <= $numofrooms[$key]; $i++) {
											insert("insert into roomnumbers (roomtype) values ($roomtypeid)");
										}
									} ?>
            <script type="text/javascript">
            window.location = "?Pg=roomdetails&msg=24";
            </script>
            <?php
								}
								pms_info_status(); ?>

            <div class="the-box">
              <h1 class="page-heading">CM Details</h1>
              <table class="table table-th-block table-hover" style="width:30vw">
                <thead>
                  <tr>
                    <th>Hotel Name</th>
                    <th>Set CM Hotel Name</th>
                    <th>Action </th>
                  </tr>
                </thead>
                <?php
												// Start PHP code
												$hotelname = execute("select u.company, u.cm_company_name, h.user from hotels h JOIN users u ON h.user = u.id where h.id = $_SESSION[hotel]");
												if ($hotelname['cm_company_name'] === NULL) {
													$alreadyexist = '';
												} else {
													$alreadyexist = $hotelname['cm_company_name'];
												}
												// End PHP code
												?>
                <tbody>
                  <tr>
                    <td><?= $hotelname['company'] ?></td>
                    <td><input type="text" id="cm_hotel_name" value="<?= $alreadyexist ?>" name="cm_hotel_name"
                        oninput="toggleSaveButton()" style="border: 1px solid #ddd" /></td>
                    <td><button id="cm-hotel-name-save" type="submit" class="btn btn-primary disabled"
                        onClick="save_CM_Hotel_Name(<?= $hotelname['user'] ?>)">Save</button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <?php if (col("msg") == 24) {
											$msg = "Room types added successfully";
											$clrclass = "success";
											alertbox($clrclass, $msg);
										} ?>
              <div class="btn-toolbar top-table" role="toolbar">
              </div>
              <div class="table-responsive">
                <?php $result = $conn->query("select id,roomtype,fulldaytariff,v360,adults,children,active,cmroomid,(case when exists(select * from roomnumbers where roomtype=r.id and roomnumber<>'') then 1 else 0 end)roomnumcnt,(select count(*) from roomnumbers where roomtype=r.id)totalrooms,(case when exists(select * from room_facilities where roomtype=r.id) then 1 else 0 end)roomfacilitycnt,(case when exists(select * from pictures where type='Room' and propertyid=r.id) then (select count(*) from pictures where type='Room' and propertyid=r.id) else 0 end)roompiccnt,(case when exists(select 1 from roomtype_hourly_facilities where roomtype=r.id) then 1 else 0 end)hourlyfacilities from roomtypes r where hotel=$_SESSION[hotel]");

											if ($result->num_rows > 0) { ?>
																																<table class="table table-th-block table-hover">
																																	<thead>
																																		<tr>
																																			<th>No.</th>
																																			<th>Room Type</th>
																																			<th>Set CM Room Code </th>
																																			<th style="visibility: ">Action </th>
																																			<th>CM Room Rate</th>
																																		</tr>
																																	</thead>
																																	<tbody>
															<?php
															$i = 0;
															while ($row = $result->fetch_assoc()) {
																$i++;
																?>

                    <tr>
                      <td><?= $i ?></td>
                      <td id="<?= $row['id'] ?>">
                        <?= $row['roomtype'] ?>
                      </td>
                      <td>
                        <input style="border: 1px solid #ddd" type="text" id="cm_room_code<?= $row['id'] ?>"
                          value="<?= $row['cmroomid'] ?>" name="cm_room_code<?= $row['id'] ?>"
                          oninput="toggleSaveButtonRoomType(<?= $row['id'] ?>)">
                      </td>
                      <td>
                        <button id="save_btn<?= $row['id'] ?>" type="submit" class="btn btn-primary disabled"
                          onClick="save_cm_roomcode_and_rateplancode(<?= $row['id'] ?>)">Save</button>
                      </td>

                      <td id='td1id<?= $i ?>'><a href="LBF_cmrateplan.php?id=<?= $row['id'] ?>"
                          class=" btn btn-primary fancybox2 fancybox.iframe"><span
                            class="label label-<?= $roomnumberl ?>"><i class="fa fa-<?= $roomnumberi ?>"></i> Rate Plan
                          </span></a>
                      </td>

                    </tr>
                    <?php } ?>
                  </tbody>
                </table>
                <script>
                let initialHotelName = "<?= $alreadyexist ?>";

                let initialValues = {};

                <?php
														$result->data_seek(0); // Reset pointer to the beginning of the result set
														while ($row = $result->fetch_assoc()) {
															$id = $row['id'];
															$cmroomid = $row['cmroomid'];
															echo "initialValues[$id] = { cm_room_code: '$cmroomid' };\n";
														}
														?>

                function toggleSaveButtonRoomType(id) {
                  let roomCodeElem = document.getElementById('cm_room_code' + id);
                  // let ratePlanCodeElem = document.getElementById('cm_rate_plan_code' + id);
                  let saveButton = document.getElementById('save_btn' + id);

                  if (
                    roomCodeElem.value !== initialValues[id].cm_room_code
                    // ratePlanCodeElem.value !== initialValues[id].cm_rate_plan_code
                  ) {
                    if (roomCodeElem.value.trim() === "") {
                      saveButton.classList.add('disabled');
                    } else {
                      saveButton.classList.remove('disabled');
                    }
                  } else {
                    saveButton.classList.add('disabled');
                  }
                }

                function toggleSaveButton() {
                  let inputElem = document.getElementById('cm_hotel_name');
                  let saveButton = document.getElementById('cm-hotel-name-save');
                  if (inputElem.value.trim() === "") {
                    saveButton.classList.add('disabled');
                  } else if (inputElem.value !== initialHotelName) {
                    saveButton.classList.remove('disabled');
                  } else {
                    saveButton.classList.add('disabled');
                  }
                }
                </script>
                <?php
											} ?>
              </div>
            </div>
            <?php
							} else if ($_GET['Pg'] == "frotelnormalrates" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['roomtype']) and col("act") != "roomtype") {
									$roomtype = $_POST['roomtype'];

									for ($i = 2; $i <= 10; $i++) {
										$row = execute("select count(*)cnt from hotelrates where roomtype=$roomtype and hours=$i");
										$preexisting = $row['cnt'];

										$monday = col('monday' . $i, 0);
										$monnight = col('monnight' . $i, 0);
										$tueday = col('tueday' . $i, 0);
										$tuenight = col('tuenight' . $i, 0);
										$wedday = col('wedday' . $i, 0);
										$wednight = col('wednight' . $i, 0);
										$thuday = col('thuday' . $i, 0);
										$thunight = col('thunight' . $i, 0);
										$friday = col('friday' . $i, 0);
										$frinight = col('frinight' . $i, 0);
										$satday = col('satday' . $i, 0);
										$satnight = col('satnight' . $i, 0);
										$sunday = col('sunday' . $i, 0);
										$sunnight = col('sunnight' . $i, 0);
										$wdrd = col('whrd' . $i, 0);
										$wdrdnl = col('whrdnl' . $i, 0);
										$werd = col('werd' . $i, 0);
										$werdnl = col('werdnl' . $i, 0);

										$average_rate = (($monday + $tueday + $wedday + $thuday + $friday + $satday + $sunday) * 14.5 + ($monnight + $tuenight + $wednight + $thunight + $frinight + $satnight + $sunnight) * 9.5) / 168;

										//echo $i." : ".$average_rate."<br>";
					
										////////////////////////// PANKAJ'S FORMULA /////////////////////////
					
										//$average_rate = 
										//(
										//	(1.9 * ($monday + $tueday + $wedday + $thuday + $friday)) 
										//	+ 
										//	(2.9 * ($monnight + $tuenight + $wednight + $thunight + $frinight)) 
										//	+ 
										//	(4.75 * ($satday + $sunday)) + (7.25 * ($satnight + $sunnight))
										//) / 168;
					
										////////////////////////// PANKAJ'S FORMULA /////////////////////////
					

										$average_rate2 = (9.5 * (($monday + $tueday + $wedday + $thuday + $friday) / 5)) + (14.5 * (($monnight + $tuenight + $wednight + $thunight + $frinight) / 5)) + (9.5 * (($satday + $sunday) / 2)) + (14.5 * (($satnight + $sunnight) / 2)) / (24 * 7);


										//echo "$i : ".$average_rate."<br><br>";
										//echo "B: ".$average_rate2."<br>";
					

										//echo "C: ".((9.5 * 100) + (14.5 * 125) + (9.5 * 125) + (14.5 * 150) / 168)."<br>";*/
					
										if (col('hour' . $i) == 1)
											$activehr = 1;
										else
											$activehr = 0;

										if ($preexisting == 0)
											$conn->query("insert into hotelrates (roomtype,hours,mon,tue,wed,thu,fri,sat,sun,monn,tuen,wedn,thun,frin,satn,sunn,wdrd, wdrdnl,werd,werdnl,active,average_rate) values ($_POST[roomtype],$i,$monday,$tueday,$wedday,$thuday,$friday,$satday,$sunday, $monnight,$tuenight,$wednight,$thunight,$frinight,$satnight,$sunnight,$wdrd,$wdrdnl,$werd,$werdnl,$activehr,$average_rate)");
										else
											$conn->query("update hotelrates set mon=$monday, tue=$tueday, wed=$wedday, thu=$thuday, fri=$friday, sat=$satday, sun=$sunday, monn=$monnight,tuen=$tuenight,wedn=$wednight,thun=$thunight,frin=$frinight,satn=$satnight,sunn=$sunnight,wdrd=$wdrd, wdrdnl=$wdrdnl,werd=$werd,werdnl=$werdnl,active=$activehr,average_rate=$average_rate where roomtype=$_POST[roomtype] and hours=$i");
									}

									$clrclass = "success";
									$msg = "Frotel rates saved successfully";
								}
								pms_info_status(); ?>
            <h1 class="page-heading">ROOMS <small>FROTEL RATES</small></h1>
            <div class="the-box">
              <h4 class="small-title">SET FROTEL RATES</h4>
              <?php alertbox($clrclass, $msg); ?>
              <form method="post" action="?Pg=frotelnormalrates">
                <div class="row">
                  <div class="col-xs-12">
                    <div class="col-xs-3">
                      <label>Room Type</label>
                      <select class="form-control" name="roomtype"
                        onChange="form.action='?Pg=frotelnormalrates&act=roomtype';form.submit()">
                        <option value="">--- Select Room Type ---</option>
                        <?php $result = $conn->query("select id,roomtype from roomtypes where hotel=$_SESSION[hotel]");
															while ($row = $result->fetch_assoc()) { ?>
                        <option value="<?= $row['id'] ?>" <?= selected($row['id'], col("roomtype", 0)) ?>>
                          <?= $row['roomtype'] ?></option>
                        <?php
															} ?>
                      </select>
                    </div>
                    <?php if (col("roomtype") != "") {
														$roomtype = col("roomtype");
														$row = execute("select fulldaytariff from roomtypes where id=$roomtype");
														$fdt = $row['fulldaytariff']; ?>
                    <div class="col-xs-3">
                      <div class="form-group">
                        <label>Full Day Tariff</label>
                        <input type="number" id="fdt" class="form-control" onChange="applyfdt()" onKeyup="applyfdt()"
                          value="<?= $fdt ?>">
                      </div>
                    </div>
                    <?php
													} else { ?>
                    <div style="width:75%; float:left; height:70px;"></div>
                    <?php
													} ?>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-3">
                    <b>Day Timing</b> 09:00 AM To 07:00 PM
                  </div>
                  <div class="col-xs-9">
                    <b>Night Timing</b> 07:00 PM To 09:00 AM
                  </div>
                </div>
                <br>
                <?php if (col("roomtype") != "") { ?>
                <div>
                  <?php $row = execute("select count(*)cnt from hotelrates where roomtype=" . col("roomtype") . " and hours<24");
													if ($row['cnt'] == 0) { ?>
                  <i class="fa fa-clock-o text-danger"></i> <span class="text-danger">Showing
                    suggested rates. (These rates are not saved yet)</span>
                  <?php
													} else { ?>
                  <i class="fa fa-check text-primary"></i> <span class="text-primary">Showing
                    previously saved rates</span>
                  <?php
													} ?>
                </div>
                <br>
                <?php if (content_access("roomtypes", $roomtype)) {
													$row = execute("select count(*)cnt from roomtypes r join hotelrates hr on hr.roomtype=r.id where hr.hours<>24 and r.hotel=$_SESSION[hotel] and hr.roomtype=$roomtype");

													if ($row['cnt'] == 0)
														$result = $conn->query("select 1 as active,h.hour,h.wdefiner as wdrd,5 as wdrdnl,(h.wdefiner+5)werd,5 as werdnl, coalesce(hr.mon,(h.wdefiner/100)*$fdt)mon, coalesce(hr.tue,(h.wdefiner/100)*$fdt)tue, coalesce(hr.wed,(h.wdefiner/100)*$fdt)wed, coalesce(hr.thu,(h.wdefiner/100)*$fdt)thu, coalesce(hr.fri,(h.wdefiner/100)*$fdt)fri, coalesce(hr.sat,((h.wdefiner+5)/100)*$fdt)sat, coalesce(hr.sun,((h.wdefiner+5)/100)*$fdt)sun,coalesce(hr.monn,((h.wdefiner+5)/100)*$fdt)monn, coalesce(hr.tuen,((h.wdefiner+5)/100)*$fdt)tuen,coalesce(hr.wedn,((h.wdefiner+5)/100)*$fdt)wedn, coalesce(hr.thun,((h.wdefiner+5)/100)*$fdt)thun,coalesce(hr.frin,((h.wdefiner+5)/100)*$fdt)frin, coalesce(hr.satn,((h.wdefiner+10)/100)*$fdt)satn,coalesce(hr.sunn,((h.wdefiner+10)/100)*$fdt)sunn from (select 2 as hour,$roomtype as roomtype,20 as wdefiner union all select 3,$roomtype,25 union all select 4,$roomtype,30 union all select 5,$roomtype,35 union all select 6,$roomtype,40 union all select 7,$roomtype,45 union all select 8,$roomtype,50 union all select 9,$roomtype,55 union all select 10,$roomtype,60)h left join hotelrates hr on (h.hour=hr.hours and h.roomtype=hr.roomtype) order by h.hour");
													else
														$result = $conn->query("select hr.hours as hour,hr.wdrd,hr.wdrdnl,hr.werd,hr.werdnl,hr.mon,hr.tue,hr.wed,hr.thu, hr.fri,hr.sat,hr.sun,hr.monn,hr.tuen,hr.wedn,hr.thun,hr.frin,hr.satn,hr.sunn,hr.active from hotelrates hr where hr.roomtype=$roomtype and hr.hours<>24 order by hr.hours"); ?>
                <div style="border-style:solid; border-color:#ACB5BE; border-width:1px 0px 0px 1px; overflow:hidden;">
                  <div style="height:60px;font-size:10px; font-weight:bold;">
                    <div class="head1">
                      <span class="txtblock"><u>No of Hours</u><br>Amenities/hr</span>
                    </div>
                    <div class="head1">
                      <span class="txtblock">Weekdays Hourly rate definer (%)</span>
                    </div>
                    <div class="head1">
                      <span class="txtblock">Night Loader (%)</span>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Mon</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Tue</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Wed</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Thu</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Fri</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head1">
                      <span class="txtblock">Weekends Hourly rate definer (%)</span>
                    </div>
                    <div class="head1">
                      <span class="txtblock">Night Loader (%)</span>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Sat</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                    <div class="head2">
                      <div class="head2b">
                        <span class="txtblock">Sun</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Day</span>
                      </div>
                      <div class="head2s">
                        <span class="txtblock">Night</span>
                      </div>
                    </div>
                  </div>
                  <div style="font-size:13px;">
                    <?php while ($row = $result->fetch_assoc()) { ?>
                    <div class="frotelraterow">
                      <div class="data1" style="background-color:;">
                        <input type="checkbox" class="normalfrotelhours" name="hour<?= $row['hour'] ?>"
                          <?= checked($row['active'], 1) ?> value="1">
                        <div class="normalfrotelhorstext"><?= $row['hour'] ?><a
                            href="LBF_frotelamenities.php?id=<?= $roomtype ?>&hours=<?= $row['hour'] ?>"
                            class="fancybox2 fancybox.iframe"><i class="fa fa-check amen"></i></a></div>
                      </div>
                      <div class="data1 definer">
                        <input type="text" id="whrd<?= $row['hour'] ?>" class="whrd" value="<?= $row['wdrd'] ?>"
                          name="whrd<?= $row['hour'] ?>"
                          onKeyup="validatenumbers('whrd<?= $row['hour'] ?>'); wdcalc(<?= $row['hour'] ?>,document.getElementById('fdt').value)">
                      </div>
                      <div class="data1">
                        <input type="text" class="whrd" id="whrdnl<?= $row['hour'] ?>" name="whrdnl<?= $row['hour'] ?>"
                          value="<?= $row['wdrdnl'] ?>"
                          onKeyup="validatenumbers('whrdnl<?= $row['hour'] ?>'); wdcalc(<?= $row['hour'] ?>,document.getElementById('fdt').value)">
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="monday<?= $row['hour'] ?>"
                          name="monday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('monday<?= $row['hour'] ?>')" value="<?= $row['mon'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="monnight<?= $row['hour'] ?>"
                          name="monnight<?= $row['hour'] ?>" onKeyup="validatehotelrates('monnight<?= $row['hour'] ?>')"
                          value="<?= $row['monn'] ?>" min="100" required>
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="tueday<?= $row['hour'] ?>"
                          name="tueday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('tueday<?= $row['hour'] ?>')" value="<?= $row['tue'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="tuenight<?= $row['hour'] ?>"
                          name="tuenight<?= $row['hour'] ?>" onKeyup="validatehotelrates('tuenight<?= $row['hour'] ?>')"
                          value="<?= $row['tuen'] ?>" min="100" required>
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="wedday<?= $row['hour'] ?>"
                          name="wedday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('wedday<?= $row['hour'] ?>')" value="<?= $row['wed'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="wednight<?= $row['hour'] ?>"
                          name="wednight<?= $row['hour'] ?>" onKeyup="validatehotelrates('wednight<?= $row['hour'] ?>')"
                          value="<?= $row['wedn'] ?>" min="100" required>
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="thuday<?= $row['hour'] ?>"
                          name="thuday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('thuday<?= $row['hour'] ?>')" value="<?= $row['thu'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="thunight<?= $row['hour'] ?>"
                          name="thunight<?= $row['hour'] ?>" onKeyup="validatehotelrates('thunight<?= $row['hour'] ?>')"
                          value="<?= $row['thun'] ?>" min="100" required>
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="friday<?= $row['hour'] ?>"
                          name="friday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('friday<?= $row['hour'] ?>')" value="<?= $row['fri'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="frinight<?= $row['hour'] ?>"
                          name="frinight<?= $row['hour'] ?>" onKeyup="validatehotelrates('frinight<?= $row['hour'] ?>')"
                          value="<?= $row['frin'] ?>" min="100" required>
                      </div>
                      <div class="data1">
                        <input type="text" class="whrd" id="wehrd<?= $row['hour'] ?>" name="werd<?= $row['hour'] ?>"
                          value="<?= $row['werd'] ?>"
                          onKeyup="validatenumbers('whrd<?= $row['hour'] ?>'); wecalc(<?= $row['hour'] ?>,document.getElementById('fdt').value)">
                      </div>
                      <div class="data1">
                        <input type="text" class="whrd" id="wehrdnl<?= $row['hour'] ?>" name="werdnl<?= $row['hour'] ?>"
                          value="<?= $row['werdnl'] ?>"
                          onKeyup="validatenumbers('whrd<?= $row['hour'] ?>'); wecalc(<?= $row['hour'] ?>,document.getElementById('fdt').value)">
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="satday<?= $row['hour'] ?>"
                          name="satday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('satday<?= $row['hour'] ?>')" value="<?= $row['sat'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="satnight<?= $row['hour'] ?>"
                          name="satnight<?= $row['hour'] ?>" onKeyup="validatehotelrates('satnight<?= $row['hour'] ?>')"
                          value="<?= $row['satn'] ?>" min="100" required>
                      </div>
                      <div class="data2">
                        <input type="number" class="ratefield" id="sunday<?= $row['hour'] ?>"
                          name="sunday<?= $row['hour'] ?>" style="border-width:0px 1px 0px 0px;"
                          onKeyup="validatehotelrates('sunday<?= $row['hour'] ?>')" value="<?= $row['sun'] ?>" min="100"
                          required>
                        <input type="number" class="ratefield" id="sunnight<?= $row['hour'] ?>"
                          name="sunnight<?= $row['hour'] ?>" onKeyup="validatehotelrates('sunnight<?= $row['hour'] ?>')"
                          value="<?= $row['sunn'] ?>" min="100" required>
                      </div>
                    </div>
                    <?php
															} ?>
                  </div>
                </div>
                <div style="margin-top:15px; height:30px; overflow:hidden;">
                  <input type="submit" class="btn btn-primary" value="Save">
                </div>
                <?php
												}
											} ?>
              </form>
            </div>
            <?php
							} else if ($_GET['Pg'] == "frotelseasonalrates" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['fromdate'])) {
									$title = $_POST['title'];
									$fromdate = dateindia($_POST['fromdate']);
									$todate = dateindia($_POST['todate']);

									$rateid = insert("insert into seasonalrates (hotel,title,fromdate,todate) values ($_SESSION[hotel],'$title','$fromdate','$todate')");

									foreach ($_POST['roomtypes'] as $key => $roomtype) {
										for ($i = 2; $i <= 10; $i++) {
											$day = $_POST['day' . $i][$key];
											$night = $_POST['night' . $i][$key];
											$active = col('activehr' . $i, '0');
											$conn->query("insert into seasonalfrotelratedetails (rateid,roomtype,hours,day,night,active) values ($rateid,$roomtype,$i,$day, $night,$active)");
										}
									}
									$msg = "Seasonal rates added successfully";
									$clrclass = "success";
								}

								if (col("deleteid") != "") {
									$id = col("deleteid");
									if (content_access("seasonalrates", $id)) {
										$conn->query("delete from seasonalrates where id=$id");
										$conn->query("delete from seasonalfrotelratedetails where rateid=$id");

										$msg = "Seasonal rates deleted successfully";
										$clrclass = "success";
									}
								}
								pms_info_status(); ?>
            <h1 class="page-heading">ROOMS <small>FROTEL RATES</small></h1>
            <div class="row">
              <div class="col-xs-12">
                <div class="the-box" style="padding-bottom:20px;">
                  <h4 class="small-title">ADD SEASONAL RATES FOR FROTEL ROOMS</h4>
                  <?php alertbox($clrclass, $msg); ?>
                  <form method="post" action="">
                    <div class="row">
                      <div class="col-xs-4">
                        <div class="form-group">
                          <label>Season / Title</label>
                          <input type="text" name="title" class="form-control" required>
                        </div>
                      </div>
                      <div class="col-xs-2">
                        <div class="form-group">
                          <label>From Date</label>
                          <input type="text" class="form-control" id="datepicker1" data-date-format="dd-mm-yyyy"
                            name="fromdate" readonly>
                        </div>
                      </div>
                      <div class="col-xs-2">
                        <div class="form-group">
                          <label>To Date</label>
                          <input type="text" class="form-control" id="datepicker2" data-date-format="dd-mm-yyyy"
                            name="todate" readonly>
                        </div>
                      </div>
                      <div style="width:33.33%; float:left; height:70px;"></div>
                    </div>
                    <div class="row">
                      <div class="col-xs-3">
                        <b>Day Timing</b> 09:00 AM To 07:00 PM
                      </div>
                      <div class="col-xs-9">
                        <b>Night Timing</b> 07:00 PM To 09:00 AM
                      </div>
                    </div>
                    <br>
                    <div
                      style="width:100%; float:left; background-color:#FFC000; border-style:solid; border-color:#ACB5BE; border-width:1px 0px 0px 1px; font-weight:bold; font-size:12px; margin:0px -3px;">
                      <div
                        style="width:19%; height:60px; float:left; border-style:solid; border-color:#ACB5BE; border-width:0px 1px 1px 0px; display:table; text-align:center;">
                        <span class="txtblock">Room Type</span>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr2" value="1"
                              checked>2 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr3" value="1"
                              checked>3 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr4" value="1"
                              checked>4 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr5" value="1"
                              checked>5 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr6" value="1"
                              checked>6 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr7" value="1"
                              checked>7 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr8" value="1"
                              checked>8 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr9" value="1"
                              checked>9 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                      <div class="hrstitlerow">
                        <div class="hrsnumber">
                          <span class="txtblock"><input type="checkbox" class="form-control" name="activehr10" value="1"
                              checked>10 hrs.</span>
                        </div>
                        <div class="datnightrow">
                          <div class="daytime">
                            <span class="txtblock">Day</span>
                          </div>
                          <div class="daytime">
                            <span class="txtblock">Night</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <?php $result = $conn->query("select a.*,coalesce(hr.mon,0)mon,coalesce(hr.monn,0)monn,coalesce(hr.sun,0)sun,coalesce(hr.sunn,0)sunn from (select hrs.hr,r.id,r.roomtype from (select 2 as hr union all select 3 union all select 4 union all select 5 union all select 6 union all select 7 union all select 8 union all select 9 union all select 10)hrs,roomtypes r where r.hotel=$_SESSION[hotel])a left join hotelrates hr on hr.roomtype=a.id and a.hr=hr.hours");

													while ($row = $result->fetch_assoc()) { ?>
                    <div class="datarow">
                      <div class="roomtypedata" style="text-align:left; padding:5px;">
                        <span class="txtblock"><?= $row['roomtype'] ?></span>
                        <input type="hidden" name="roomtypes[]" value="<?= $row['id'] ?>">
                      </div>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day2[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night2[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day3[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night3[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day4[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night4[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day5[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night5[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day6[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night6[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day7[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night7[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day8[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night8[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day9[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night9[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                      <?php $row = $result->fetch_assoc(); ?>
                      <div class="hrsdatarow">
                        <input type="number" min="100" class="dnrates" name="day10[]" value="<?= $row['mon'] ?>"
                          required>
                        <input type="number" min="100" class="dnrates" name="night10[]" value="<?= $row['monn'] ?>"
                          required>
                      </div>
                    </div>
                    <?php
													} ?>
                    <div class="row">
                      <div class="col-xs-12">
                        <br><input type="submit" class="btn btn-primary" value="Add">
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-12">
                <div class="the-box">
                  <h4 class="small-title">VIEW/EDIT/DELETE SEASONAL RATES FOR FROTEL ROOMS</h4>
                  <div class="table-responsive" style="overflow-x:scroll;">
                    <?php modal("Seasonal Rates", "seasonal rates"); ?>
                    <form name="filter_form" method="POST">
                      <input type="hidden" name="deleteid" id="deleteid">
                      <input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
                    </form>
                    <table class="table table-th-block table-hover">
                      <thead>
                        <tr>
                          <th>No.</th>
                          <th>Title</th>
                          <th>From Date</th>
                          <th>To Date</th>
                          <th>Edit</th>
                          <th>Delete</th>
                        </tr>
                      </thead>
                      <tbody>
                        <?php $pagesize = 10;

															if (isset($_GET['cnt'])) {
																$current_page = $_GET['cnt'];
															} else {
																$current_page = 1;
															}

															$base_query = "select distinct sr.id,sr.title,sr.fromdate,sr.todate from seasonalrates sr join seasonalfrotelratedetails srd on srd.rateid=sr.id where sr.hotel=$_SESSION[hotel] and srd.hours<24";

															$a = new pagination($base_query, $current_page, $pagesize);

															if ($current_page > $a->total_pages_)
																$current_page = $a->total_pages_;
															if ($current_page < 1)
																$current_page = 1;

															$qry = $base_query . " order by sr.fromdate desc limit " . $a->offset_ . ",$pagesize";

															$result = $conn->query($qry);
															if ($result->num_rows > 0) {
																$str = "";
																$i = (($current_page - 1) * $pagesize + 1);
																while ($row = $result->fetch_assoc()) {
																	$str .= "<tr>
																
																<td>$i</td>
																<td id='td3id$i'>" . $row['title'] . "</td>
																<td id='td1id$i'>" . popdate($row['fromdate']) . "</td>
																<td id='td2id$i'>" . popdate($row['todate']) . "</td>
																<td><a href='LBF_editseasonalfrotelrates.php?id=$row[id]&cntr=$i' class='fancybox4 fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																	$i++;
																}
																echo $str;
															} else {
																echo "<tr><td colspan='5'>No seasonal rates to display</td></tr>";
															} ?>
                      </tbody>
                    </table>
                  </div>
                  <?php mypagination($a->row_count_, $pagesize, '?Pg=hotelseasonalrates', ''); ?>
                </div>
              </div>
            </div>
            <?php
							} else if ($_GET['Pg'] == "froteltaxsetup" and $_SESSION['groupid'] == 0) {
								if (isset($_POST['chargingst'])) {
									$chargingst = $_POST['chargingst'];
									$stnumber = $_POST['stnumber'];
									$st = col('st', 0);
									$sbc = col('sbc', 0);
									$kkc = col('kkc', 0);
									$abetment = $_POST['abetment'];
									$threshold = col('threshold', 0);
									$ast = col('ast', 0);
									$asbc = col('asbc', 0);
									$akcc = col('akcc', 0);

									$row = execute("select count(*)cnt from taxes where hotel=0");
									if ($row['cnt'] == 0) {
										$taxid = insert("insert into taxes (hotel,chargingst,stnumber,stcopy,st,sbc,kkc,takingabetment,threshold,ast,asbc,akkc) values (0,$chargingst,'$stnumber','',$st,$sbc,$kkc,$abetment,$threshold,$ast,$asbc,$akcc)");
									} else {
										$conn->query("update taxes set chargingst=$chargingst,stnumber='$stnumber',st=$st,sbc=$sbc,kkc=$kkc,takingabetment=$abetment, threshold=$threshold,ast=$ast,asbc=$asbc,akkc=$akcc where hotel=0");
									}

									if ($_FILES['stcopy']['name'] != "") {
										$row = execute("select stcopy from taxes where hotel=0");
										if ($row['stcopy'] != "")
											deletefile("images/documents/stregistration/" . $row['stcopy']);
										$conn->query("update taxes set stcopy='" . saveimage("stcopy", "images/documents/stregistration/", 1200) . "' where hotel=0");
									}

									$clrclass = "success";
									$msg = "Tax setup updated";
								}
								$result = $conn->query("select * from taxes where hotel=0");
								if ($result->num_rows > 0) {
									$row = $result->fetch_assoc();
									if ($row['chargingst'] == 0) {
										$checked1 = "";
										$display1 = "none";
									} else {
										$checked1 = "checked";
										$display1 = "block";
									}

									if ($row['takingabetment'] == 0) {
										$checked2 = "";
										$display2 = "none";
									} else {
										$checked2 = "checked";
										$display2 = "block";
									}

									if ($row['stcopy'])
										$required = "required";

									$stnumber = $row['stnumber'];
									$stcopy = $row['stcopy'];
									$st = $row['st'];
									$sbc = $row['sbc'];
									$kkc = $row['kkc'];
									$threshold = $row['threshold'];
									$ast = $row['ast'];
									$asbc = $row['asbc'];
									$akkc = $row['akkc'];
								} else {
									$checked1 = "";
									$checked2 = "";
									$display1 = "none";
									$display2 = "none";
									$required = "";
									$stnumber = "";
									$stcopy = "";
									$st = "";
									$sbc = "";
									$kkc = "";
									$threshold = "";
									$ast = "";
									$asbc = "";
									$akkc = "";
								} ?>
            <h1 class="page-heading">HOTEL <small>Tax Setup</small></h1>
            <div class="row col-xs-6">
              <div class="the-box" style="padding-bottom:0px">
                <h4 class="small-title">FROTEL TAX SETUP</h4>
                <?php alertbox($clrclass, $msg); ?>
                <form method="post" action="" enctype="multipart/form-data">
                  <div class="row">
                    <div class="col-xs-12">
                      <label>Do you want to charge service tax?</label>
                      <div style="margin-left:-10px;">
                        <div class="radio-3">
                          <input type="radio" name="chargingst" value="0"
                            onChange="makerequired1(this.value,'<?= $stcopy ?>')" <?= checked($checked1, "") ?>>No
                        </div>
                        <div class="radio-3">
                          <input type="radio" name="chargingst" value="1"
                            onChange="makerequired1(this.value,'<?= $stcopy ?>')"
                            <?= checked($checked1, "checked") ?>>Yes
                        </div>
                      </div>
                    </div>
                    <div id="stblock" style="display:<?= $display1 ?>">
                      <div class="col-xs-5">
                        <label>Service Tax No.</label>
                        <div class="form-group">
                          <input type="text" class="form-control" id="stnumber" name="stnumber" value="<?= $stnumber ?>" <?php if ($stnumber != "")
																																									  echo "required"; ?>>
                        </div>
                      </div>
                      <div class="col-xs-7 inline-popups">
                        <label>Upload ST Certificate</label> <?php if ($stcopy != "") { ?><a href="#stregistration"
                          style="float:right;" data-effect="mfp-zoom-in"><i class="fa fa-eye"></i></a><?php } ?>
                        <div class="form-group">
                          <div class="input-group">
                            <input type="text" class="form-control" id="stcopy"
                              placeholder="ST Certificate scanned copy" <?php if ($stcopy == "" and $display1 == "block")
																																										echo "required"; ?>>
                            <span class="input-group-btn">
                              <span class="btn btn-default btn-file">
                                Browse...<input type="file" name="stcopy">
                              </span>
                            </span>
                          </div>
                        </div>
                      </div>
                      <div class="col-xs-12">
                        <div style="margin:0px -12px">
                          <div class="col-xs-9">
                            <label>Service tax applicable above this value</label>
                          </div>
                          <div class="col-xs-3">
                            <div class="form-group" style="margin-bottom: 10px;">
                              <input type="number" class="form-control" min="0" id="threshold" name="threshold"
                                value="<?= $threshold ?>" <?php if ($threshold != "")
																																											  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-xs-12">
                        <div style="margin:0px -12px">
                          <div class="col-xs-9">
                            <label>Service Tax %</label>
                          </div>
                          <div class="col-xs-3">
                            <input type="number" class="form-control" min="0" max="100" step="0.1" id="st" name="st"
                              value="<?= $st ?>" <?php if ($st != "")
																																										  echo "required"; ?>>
                          </div>
                        </div>
                      </div>
                      <div style="width:100%; float:left; height:10px;"></div>
                      <div class="col-xs-12">
                        <div style="margin:0px -12px">
                          <div class="col-xs-9">
                            <label>Swachha Bharat Cess %</label>
                          </div>
                          <div class="col-xs-3">
                            <input type="number" class="form-control" min="0" max="100" step="0.1" id="sbc" name="sbc"
                              value="<?= $sbc ?>" <?php if ($sbc != "")
																																										  echo "required"; ?>>
                          </div>
                        </div>
                      </div>
                      <div style="width:100%; float:left; height:10px;"></div>
                      <div class="col-xs-12">
                        <div style="margin:0px -12px">
                          <div class="col-xs-9">
                            <label>Krishi Kalyan Cess %</label>
                          </div>
                          <div class="col-xs-3">
                            <input type="number" class="form-control" min="0" max="100" step="0.1" id="kkc" name="kkc"
                              value="<?= $kkc ?>" <?php if ($kkc != "")
																																										  echo "required"; ?>>
                          </div>
                        </div>
                      </div>
                      <div style="width:100%; float:left; height:10px;"></div>
                      <div class="col-xs-12">
                        <label>Do you want to take service tax abetment?</label>
                        <div style="margin-left:-10px;">
                          <div class="radio-3">
                            <input type="radio" name="abetment" value="0" onChange="makerequired2(this.value)"
                              <?= checked($checked2, "") ?>>No
                          </div>
                          <div class="radio-3">
                            <input type="radio" name="abetment" value="1" onChange="makerequired2(this.value)"
                              <?= checked($checked2, "checked") ?>>Yes
                          </div>
                        </div>
                      </div>
                      <div id="abetmentblock" style="display:<?= $display2 ?>">
                        <div class="col-xs-12">
                          <h4>Abetment Tax Values</h4>
                        </div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Service Tax %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="ast" name="ast"
                                value="<?= $ast ?>" <?php if ($ast != "")
																																											  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Swachha Bharat Cess %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="asbc"
                                name="asbc" value="<?= $asbc ?>" <?php if ($asbc != "")
																				echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Krishi Kalyan Cess %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="akcc"
                                name="akcc" value="<?= $akkc ?>" <?php if ($akkc != "")
																				echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-12">
                      <div class="form-group">
                        <input type="submit" class="btn btn-primary" value="Save">
                      </div>
                    </div>
                  </div>
                </form>
                <div id="stregistration" class="white-popup mfp-with-anim mfp-hide">
                  <img src="images/documents/stregistration/<?= $stcopy ?>" width="800" border="0" alt="">
                </div>
              </div>
            </div>
            <?php
							} else if ($_GET['Pg'] == "hoteltaxsetup" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['chargingst'])) {
									$chargingst = $_POST['chargingst'];
									$stnumber = $_POST['stnumber'];
									$st = col('st', 0);
									$sbc = col('sbc', 0);
									$kkc = col('kkc', 0);
									$abetment = $_POST['abetment'];
									$threshold = col('threshold', 0);
									$ast = col('ast', 0);
									$asbc = col('asbc', 0);
									$akcc = col('akcc', 0);
									$takingsc = $_POST['takingsc'];
									$servicecharge = col('servicecharge', 0);
									$charginglt = $_POST['charginglt'];
									$ltnumber = $_POST['ltnumber'];
									$state = col('state', 0);

									$row = execute("select count(*)cnt from taxes where hotel=$_SESSION[hotel]");
									if ($row['cnt'] == 0) {
										$taxid = insert("insert into taxes (hotel,chargingst,stnumber,stcopy,st,sbc,kkc,takingabetment,threshold,ast,asbc,akkc,takingsc, sc,chargingluxury,ltnumber,state) values ($_SESSION[hotel],$chargingst,'$stnumber','',$st,$sbc,$kkc,$abetment,$threshold,$ast, $asbc,$akcc,$takingsc,$servicecharge,$charginglt,'$ltnumber',$state)");

										foreach ($_POST['rrf'] as $key => $rrf) {
											$rrt = $_POST['rrt'][$key];
											$pv = $_POST['pv'][$key];

											if ($rrf != "" and $rrt != "" and $pv != "")
												$conn->query("insert into luxurytaxes (tax,minrent,maxrent,value) values ($taxid,$rrf,$rrt,$pv)");
										}
									} else {
										$conn->query("update taxes set chargingst=$chargingst,stnumber='$stnumber',st=$st,sbc=$sbc,kkc=$kkc,takingabetment=$abetment, threshold=$threshold,ast=$ast,asbc=$asbc,akkc=$akcc,takingsc=$takingsc,sc=$servicecharge,chargingluxury=$charginglt, ltnumber='$ltnumber',state=$state where hotel=$_SESSION[hotel]");

										$taxid = execute("select id from taxes where hotel=$_SESSION[hotel]");
										$conn->query("delete from luxurytaxes where tax=$taxid[id]");

										foreach ($_POST['rrf'] as $key => $rrf) {
											$rrt = $_POST['rrt'][$key];
											$pv = $_POST['pv'][$key];

											if ($rrf != "" and $rrt != "" and $pv != "")
												$conn->query("insert into luxurytaxes (tax,minrent,maxrent,value) values ($taxid[id],$rrf,$rrt,$pv)");
										}
									}

									if ($_FILES['stcopy']['name'] != "") {
										$row = execute("select stcopy from taxes where hotel=$_SESSION[hotel]");
										if ($row['stcopy'] != "")
											deletefile("images/documents/stregistration/" . $row['stcopy']);
										$conn->query("update taxes set stcopy='" . saveimage("stcopy", "images/documents/stregistration/", 1200) . "' where hotel=$_SESSION[hotel]");
									}

									if ($_FILES['ltcopy']['name'] != "") {
										$row = execute("select ltcopy from taxes where hotel=$_SESSION[hotel]");
										if ($row['ltcopy'] != "")
											deletefile("images/documents/ltregistration/" . $row['ltcopy']);
										$conn->query("update taxes set ltcopy='" . saveimage("ltcopy", "images/documents/ltregistration/", 1200) . "' where hotel=$_SESSION[hotel]");
									}

									$clrclass = "success";
									$msg = "Tax setup updated";
								}
								$result = $conn->query("select * from taxes where hotel=$_SESSION[hotel]");
								if ($result->num_rows > 0) {
									$row = $result->fetch_assoc();
									if ($row['chargingst'] == 0) {
										$checked1 = "";
										$display1 = "none";
									} else {
										$checked1 = "checked";
										$display1 = "block";
									}

									if ($row['takingabetment'] == 0) {
										$checked2 = "";
										$display2 = "none";
									} else {
										$checked2 = "checked";
										$display2 = "block";
									}

									if ($row['takingsc'] == 0) {
										$checked3 = "";
										$display3 = "none";
									} else {
										$checked3 = "checked";
										$display3 = "block";
									}

									if ($row['chargingluxury'] == 0) {
										$checked4 = "";
										$display4 = "none";
									} else {
										$checked4 = "checked";
										$display4 = "block";
									}

									if ($row['stcopy'])
										$required = "required";

									$stnumber = $row['stnumber'];
									$stcopy = $row['stcopy'];
									$st = $row['st'];
									$sbc = $row['sbc'];
									$kkc = $row['kkc'];
									$servicechrg = $row['sc'];
									$threshold = $row['threshold'];
									$ast = $row['ast'];
									$asbc = $row['asbc'];
									$akkc = $row['akkc'];
									$ltnumber = $row['ltnumber'];
									$ltcopy = $row['ltcopy'];
									$state = $row['state'];
								} else {
									$checked1 = "";
									$checked2 = "";
									$checked3 = "";
									$checked4 = "";
									$display1 = "none";
									$display2 = "none";
									$display3 = "none";
									$display4 = "none";
									$required = "";
									$stnumber = "";
									$stcopy = "";
									$st = "";
									$sbc = "";
									$kkc = "";
									$servicechrg = "";
									$threshold = "";
									$ast = "";
									$asbc = "";
									$akkc = "";
									$ltnumber = "";
									$ltcopy = "";
									$state = "";
								}
								pms_info_status(); ?>
            <h1 class="page-heading">HOTEL <small>Tax Setup</small></h1>
            <form method="post" action="" enctype="multipart/form-data">
              <div class="row">
                <div class="col-xs-6" style="display:none">
                  <div class="the-box" style="padding-bottom:0px">
                    <h4 class="small-title">HOTEL SERVICE TAX SETUP</h4>
                    <?php alertbox($clrclass, $msg); ?>
                    <div class="row">
                      <div class="col-xs-12">
                        <label>Do you want to charge service tax?</label>
                        <div style="margin-left:-10px;">
                          <div class="radio-3">
                            <input type="radio" name="chargingst" value="0"
                              onChange="makerequired1(this.value,'<?= $stcopy ?>')" checked>No
                          </div>
                          <div class="radio-3">
                            <input type="radio" name="chargingst" value="1"
                              onChange="makerequired1(this.value,'<?= $stcopy ?>')">Yes
                          </div>
                        </div>
                      </div>
                      <div id="stblock" style="display:<?= $display1 ?>">
                        <div class="col-xs-5">
                          <label>Service Tax No.</label>
                          <div class="form-group">
                            <input type="text" class="form-control" id="stnumber" name="stnumber"
                              value="<?= $stnumber ?>" <?php if ($stnumber != "")
																																											  echo "required"; ?>>
                          </div>
                        </div>
                        <div class="col-xs-7 inline-popups">
                          <label>Upload ST Certificate</label> <?php if ($stcopy != "") { ?><a href="#stregistration"
                            style="float:right;" data-effect="mfp-zoom-in"><i class="fa fa-eye"></i></a><?php } ?>
                          <div class="form-group">
                            <div class="input-group">
                              <input type="text" class="form-control" id="stcopy"
                                placeholder="ST Certificate scanned copy" <?php if ($stcopy == "" and $display1 == "block")
																																												echo "required"; ?>>
                              <span class="input-group-btn">
                                <span class="btn btn-default btn-file">
                                  Browse...<input type="file" name="stcopy">
                                </span>
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Service tax applicable above this value</label>
                            </div>
                            <div class="col-xs-3">
                              <div class="form-group" style="margin-bottom: 10px;">
                                <input type="number" class="form-control" min="0" id="threshold" name="threshold"
                                  value="<?= $threshold ?>" <?php if ($threshold != "")
																																													  echo "required"; ?>>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Service Tax %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="st" name="st"
                                value="<?= $st ?>" <?php if ($st != "")
																																												  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Swachha Bharat Cess %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="sbc" name="sbc"
                                value="<?= $sbc ?>" <?php if ($sbc != "")
																																												  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Krishi Kalyan Cess %</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" max="100" step="0.1" id="kkc" name="kkc"
                                value="<?= $kkc ?>" <?php if ($kkc != "")
																																												  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <label>Do you want to add service charges?</label>
                          <div style="margin-left:-10px;">
                            <div class="radio-3">
                              <input type="radio" name="takingsc" value="0" onChange="makerequired3(this.value)"
                                <?= checked($checked3, "") ?>>No
                            </div>
                            <div class="radio-3">
                              <input type="radio" name="takingsc" value="1" onChange="makerequired3(this.value)"
                                <?= checked($checked3, "checked") ?>>Yes
                            </div>
                          </div>
                        </div>
                        <div id="scblock" style="display:<?= $display3 ?>" class="col-xs-12">
                          <div style="margin:0px -12px">
                            <div class="col-xs-9">
                              <label>Service Charge</label>
                            </div>
                            <div class="col-xs-3">
                              <input type="number" class="form-control" min="0" id="servicecharge" name="servicecharge"
                                value="<?= $servicechrg ?>" <?php if ($servicechrg != "")
																																												  echo "required"; ?>>
                            </div>
                          </div>
                        </div>
                        <div style="width:100%; float:left; height:10px;"></div>
                        <div class="col-xs-12">
                          <label>Do you want to take service tax abetment?</label>
                          <div style="margin-left:-10px;">
                            <div class="radio-3">
                              <input type="radio" name="abetment" value="0" onChange="makerequired2(this.value)"
                                <?= checked($checked2, "") ?>>No
                            </div>
                            <div class="radio-3">
                              <input type="radio" name="abetment" value="1" onChange="makerequired2(this.value)"
                                <?= checked($checked2, "checked") ?>>Yes
                            </div>
                          </div>
                        </div>
                        <div id="abetmentblock" style="display:<?= $display2 ?>">
                          <div class="col-xs-12">
                            <h4>Abetment Tax Values</h4>
                          </div>
                          <div class="col-xs-12">
                            <div style="margin:0px -12px">
                              <div class="col-xs-9">
                                <label>Service Tax %</label>
                              </div>
                              <div class="col-xs-3">
                                <input type="number" class="form-control" min="0" max="100" step="0.1" id="ast"
                                  name="ast" value="<?= $ast ?>" <?php if ($ast != "")
																																													  echo "required"; ?>>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%; float:left; height:10px;"></div>
                          <div class="col-xs-12">
                            <div style="margin:0px -12px">
                              <div class="col-xs-9">
                                <label>Swachha Bharat Cess %</label>
                              </div>
                              <div class="col-xs-3">
                                <input type="number" class="form-control" min="0" max="100" step="0.1" id="asbc"
                                  name="asbc" value="<?= $asbc ?>" <?php if ($asbc != "")
																																													  echo "required"; ?>>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%; float:left; height:10px;"></div>
                          <div class="col-xs-12">
                            <div style="margin:0px -12px">
                              <div class="col-xs-9">
                                <label>Krishi Kalyan Cess %</label>
                              </div>
                              <div class="col-xs-3">
                                <input type="number" class="form-control" min="0" max="100" step="0.1" id="akcc"
                                  name="akcc" value="<?= $akkc ?>" <?php if ($akkc != "")
																																													  echo "required"; ?>>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%; float:left; height:10px;"></div>
                        </div>
                      </div>
                    </div>
                    <div class="row">

                    </div>
                    <div id="stregistration" class="white-popup mfp-with-anim mfp-hide">
                      <img src="images/documents/stregistration/<?= $stcopy ?>" width="800" border="0" alt="">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="the-box" style="padding-bottom:0px">
                    <h4 class="small-title">GST SETUP</h4>
                    <div class="row">
                      <div class="col-xs-12">
                        <label>Do you want to charge GST?</label>
                        <div style="margin-left:-10px;">
                          <div class="radio-3">
                            <input type="radio" name="charginglt" value="0"
                              onChange="makerequired4(this.value,'<?= $ltcopy ?>')" <?= checked($checked4, "") ?>>No
                          </div>
                          <div class="radio-3">
                            <input type="radio" name="charginglt" value="1"
                              onChange="makerequired4(this.value,'<?= $ltcopy ?>')"
                              <?= checked($checked4, "checked") ?>>Yes
                          </div>
                        </div>
                      </div>
                      <div id="ltblock" style="display:<?= $display4 ?>">
                        <div class="col-xs-5">
                          <label>GST No.</label>
                          <div class="form-group">
                            <input type="text" class="form-control" id="ltnumber" name="ltnumber"
                              value="<?= $ltnumber ?>" <?php if ($ltnumber != "")
																																											  echo "required"; ?>>
                          </div>
                        </div>
                        <div class="col-xs-7 inline-popups">
                          <label>Upload GST Certificate</label>
                          <?php if ($ltcopy != "") { ?><a href="#ltregistration" style="float:right;"
                            data-effect="mfp-zoom-in"><i class="fa fa-eye"></i></a><?php } ?>
                          <div class="form-group">
                            <div class="input-group">
                              <input type="text" class="form-control" id="ltcopy"
                                placeholder="GST Certificate scanned copy" <?php if ($ltcopy == "" and $display4 == "block")
																																												echo "required"; ?>>
                              <span class="input-group-btn">
                                <span class="btn btn-default btn-file">
                                  Browse...<input type="file" name="ltcopy">
                                </span>
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xs-12">
                            <div style="height:50px; margin:0px 4px;">
                              <div class="col-xs-5">
                                <label>Selec your state</label>
                              </div>
                              <div class="col-xs-7">
                                <select class="form-control" id="state" name="state">
                                  <option value="">-- Select State --</option>
                                  <?php $result = $conn->query("select * from states order by id");
																				while ($row = $result->fetch_assoc()) { ?>
																																													<option value="<?= $row['id'] ?>"
																						<?= selected($row['id'], $state) ?>>
																						<?= $row['state'] ?></option>
																					<?php
																				} ?>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div id="slotblock">
                          <div id="slot1">
                            <div class="col-xs-4">
                              <div class="form-group">
                                <label>Room Rent From</label>
                                <input type="number" min="0" name="rrf[]" id="rrf1" class="form-control" value="1"
                                  readonly>
                              </div>
                            </div>
                            <div class="col-xs-4">
                              <div class="form-group">
                                <label>Room Rent Upto</label>
                                <input type="number" min="0" name="rrt[]" id="rtf1" class="form-control" value="999"
                                  readonly>
                              </div>
                            </div>
                            <div class="col-xs-4">
                              <div class="form-group">
                                <label>% Value</label>
                                <input type="number" min="0" name="pv[]" id="pv1" step="0.1" class="form-control"
                                  value="0" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrf[]" id="rrf2" class="form-control" value="1000"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrt[]" id="rtf2" class="form-control" value="2499"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="pv[]" id="pv2" step="0.1" class="form-control"
                                value="12" readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrf[]" id="rrf3" class="form-control" value="2500"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrt[]" id="rtf3" class="form-control" value="7499"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="pv[]" id="pv3" step="0.1" class="form-control"
                                value="18" readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrf[]" id="rrf4" class="form-control" value="7500"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="rrt[]" id="rtf4" class="form-control" value="5000000"
                                readonly>
                            </div>
                          </div>
                          <div class="col-xs-4">
                            <div class="form-group">
                              <input type="number" min="0" name="pv[]" id="pv4" step="0.1" class="form-control"
                                value="28" readonly>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-xs-12">
                        <div class="form-group">
                          <input type="submit" class="btn btn-primary" value="Save">
                        </div>
                      </div>
                    </div>
                    <div id="ltregistration" class="white-popup mfp-with-anim mfp-hide">
                      <img src="images/documents/ltregistration/<?= $ltcopy ?>" width="800" border="0" alt="">
                    </div>
                  </div>
                </div>
              </div>
            </form>
            <?php
							} else if ($_GET['Pg'] == "discounts" and $_SESSION['hotel'] > 0 and $page_access) {
								if (isset($_POST['title'])) {
									$validfrom = dateindia($_POST['validfrom']);
									$validto = dateindia($_POST['validto']);

									$did = insert("insert into discounts (hotel,title,type,validfrom,validto,value) values ($_SESSION[hotel],'$_POST[title]', 'Percent','$validfrom','$validto',$_POST[value])");

									foreach ($_POST['roomtypes'] as $roomtype) {
										$row = execute("select count(*)cnt from discounts d join discountedrooms dr on dr.discount=d.id and (('$validfrom' between d.validfrom and d.validto) or ('$validto' between d.validfrom and d.validto)) and dr.roomtype=$roomtype");
										if (!$row['cnt'])
											$conn->query("insert into discountedrooms (discount,roomtype) values ($did,$roomtype)");
									}

									$msg = "Discount created successfully.";
									$clrclass = "success";
								}
								pms_info_status(); ?>
            <h1 class="page-heading">HOTEL <small>Discounts</small></h1>
            <div class="the-box" style="padding-bottom:0px">
              <h4 class="small-title">CREATE DISCOUNTS</h4>
              <?php alertbox($clrclass, $msg);
										$msg = ""; ?>
              <form method="post" action="">
                <?php $result = $conn->query("select id,roomtype from roomtypes where hotel=$_SESSION[hotel]");
											if ($result->num_rows > 0) { ?>
                <div class="row">
                  <div class="col-xs-3">
                    <div class="form-group">
                      <label>Discount Title</label>
                      <input type="text" class="form-control" name="title" Placeholder="" title="E.g. 10% OFF">
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <div class="form-group">
                      <label>Valid From</label>
                      <input type="text" id="datepicker1" data-date-format="dd-mm-yyyy" class="form-control"
                        name="validfrom" title="" readonly>
                    </div>
                  </div>
                  <div class="col-xs-2">
                    <div class="form-group">
                      <label>Valid Upto</label>
                      <input type="text" id="datepicker2" data-date-format="dd-mm-yyyy" class="form-control"
                        name="validto" title="" readonly>
                    </div>
                  </div>
                  <!-- <div class="col-xs-3">
													<div class="form-group">
														<label>Discount Type</label>
														<div style="margin-left: -10px;">
															<div class="radio-6">
																<input type="radio" name="type" class="form-control" value="Percent" checked>Percent
															</div>
															<div class="radio-6">
																<input type="radio" name="type" class="form-control" value="Flat">Flat
															</div>
														</div>
													</div>
												</div> -->
                  <div class="col-xs-2">
                    <div class="form-group">
                      <label>Discount Value %</label>
                      <input type="number" class="form-control" min="0" max="100" step="1" name="value"
                        title="Discount value in percent">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <div style="width:100%; float:left"><label>Select room types to which discount
                        will be applied</label></div>
                    <?php while ($row = $result->fetch_assoc()) { ?>
                    <div class="radio-3" style="margin-left:-8px;">
                      <input type="checkbox" class="form-control" name="roomtypes[]" value="<?= $row['id'] ?>"
                        checked><?= $row['roomtype'] ?>
                    </div>
                    <?php
														} ?>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12">
                    <div class="form-group">
                      <input type="submit" class="btn btn-primary" value="Create">
                    </div>
                  </div>
                </div>
                <?php
											} else { ?>
                <div class="row">
                  <div class="col-xs-12">
                    <div class="form-group">
                      No room types are set. To create discounts, first you need to <a href="?Pg=setroomtypes">set the
                        room types</a>.
                    </div>
                  </div>
                </div>
                <?php
											} ?>
              </form>
            </div>
            <?php if (isset($_POST['deleteid'])) {
										if (content_access("discounts", $_POST['deleteid'])) {
											$conn->query("delete d,dr from discounts d left join discountedrooms dr on dr.discount=d.id where d.id=$_POST[deleteid]");
											$clrclass = "success";
											$msg = "Discount has been deleted";
										}
									} ?>
            <div class="the-box" style="padding-bottom:0px">
              <h4 class="small-title">VIEW/EDIT/DELETE DISCOUNTS</h4>
              <?php alertbox($clrclass, $msg) ?>
              <form method="post" name="filter_form" action="">
                <input type="hidden" name="deleteid" id="deleteid">
                <input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
              </form>
              <?php modal("Discount", "discount"); ?>
              <div class="table-responsive">
                <table class="table table-th-block table-hover">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th>Discount</th>
                      <th>Type</th>
                      <th>Valid From</th>
                      <th>Valid Upto</th>
                      <th>Discount Value</th>
                      <th>Room Types</th>
                      <th>Edit</th>
                      <th>Delete</th>
                    </tr>
                  </thead>
                  <tbody>
                    <?php $i = 0;
													$result = $conn->query("select d.id,d.title,d.validfrom,d.validto,d.type,d.value,group_concat(r.roomtype SEPARATOR ', ') roomtypes from discounts d left join discountedrooms dr on dr.discount=d.id left join roomtypes r on dr.roomtype=r.id where d.hotel=$_SESSION[hotel] group by d.id order by d.id");
													while ($row = $result->fetch_assoc()) {
														$i++; ?>
																																							<tr>
																																								<td><?= $i ?></td>
																																								<td id='td1id<?= $i ?>'><?= $row['title'] ?></td>
																																								<td><?= $row['type'] ?></td>
																																								<td id='td2id<?= $i ?>'><?= popdate($row['validfrom']) ?></td>
																																								<td id='td3id<?= $i ?>'><?= popdate($row['validto']) ?></td>
																																								<td id='td4id<?= $i ?>'>
																<?= $row['value'] ?>				<?= ($row['type'] == "Percent") ? "%" : "/-"; ?>
																																								</td>
																																								<td id='td5id<?= $i ?>'><?= $row['roomtypes'] ?></td>
																																								<td><a href="LBF_editdiscount.php?id=<?= $row['id'] ?>&cntr=<?= $i ?>"
																																										class="fancybox2 fancybox.iframe"><span
																																											class="label label-info">Edit</span></a></td>
																																								<td><a href='javascript:void(0)'
																																										onClick='modal_button_updater(<?= $row['id'] ?>)'><span
																																											class='label label-danger' data-toggle='modal'
																																											data-target='#DangerModalColor2'>Delete</span></a></td>
																																							</tr>
														<?php
													} ?>
                  </tbody>
                </table>
              </div>
            </div>
            <?php
							}
							// room inventory
							else if ($_GET['Pg'] == "roominventory" and $_SESSION['hotel'] > 0 and $page_access) {
								$first_day = date_create_from_format("d-m-Y", col("startdate", date("1-m-Y")));
								$current_day = clone $first_day;
								$now = date_create(date("Y-m-d H:i"));

								pms_info_status(); ?>
            <script>
            function updateLocalStorageAvailibility() {
              // Save selected month and year to localStorage
              let currentdate = new Date();
              localStorage.setItem('selectedMonth', `${currentdate.getMonth() + 1}`);
              localStorage.setItem('selectedYear', `${currentdate.getFullYear()}`);
            }
            </script>
            <h1 class="page-heading" style="padding: 5px 0;margin: 0px 0 -10px;">Availability- All Room
              Types <small>Check and update available rooms</small></h1>
            <div class="row margin ">
              <div class="col-md-12 padd-zero bg-color">
                <div class="row">
                  <div>
                    <?php
														// Fetch the registration date from the database
														$hotel_reg = execute("select reg_date from users where id in (select user from hotels where id=$_SESSION[hotel]);");
														$reg_year = date('Y', strtotime($hotel_reg['reg_date']));

														// Define the range of years to be displayed in the dropdown
														$current_year = date('Y');
														$future_end_year = $current_year + 5; // End 5 years into the future
														$years = range($reg_year, $future_end_year);

														// Set the default selected year
														$selected_year = $current_year;
														?>
                    <div class="cal-month"
                      style="display: flex; gap: 5px; padding: 0; margin-top: 15px; width: 40%; height: 31px; align-items: end;">
                      <div class="col-xs-2">
                        <div class="form-group" style="margin-bottom: 0px;">
                          <select id="yearSelector" style="width:70px" class="form-control" tabindex="2">
                            <?php foreach ($years as $year): ?>
                            <option value="<?php echo $year; ?>"
                              <?php echo $year == $selected_year ? 'selected' : ''; ?>>
                              <?php echo $year; ?>
                            </option>
                            <?php endforeach; ?>
                          </select>
                        </div>
                      </div>

                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="01">JAN</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="02">FEB</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="03">MAR</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="04">APR</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="05">MAY</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="06">JUN</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="07">JUL</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="08">AUG</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="09">SEP</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="10">OCT</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="11">NOV</a>
                      <a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);"
                        class="month-btn btn btn bleu txt-color" data-month="12">DEC</a>

                    </div>
                    <div id="messageBox-room-inventory" style="display: none;"></div>
                    <script>
                    function showMessageBox(content, type) {
                      const messageBox = document.getElementById('messageBox-room-inventory');

                      // Determine the alert class based on the type parameter
                      let alertClass;
                      switch (type) {
                        case 'success':
                          alertClass = 'alert-success';
                          break;
                        case 'error':
                          alertClass = 'alert-danger';
                          break;
                        case 'warning':
                          alertClass = 'alert-warning';
                          break;
                        default:
                          alertClass = 'alert-info';
                      }

                      // Populate the messageBox with the content and appropriate styling
                      messageBox.innerHTML = `
														<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:16px; right:20px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
															<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
															<p style="width:90%;">${content}</p>
														</div>`;

                      // Show the message box
                      messageBox.style.display = "block";

                      // Automatically hide the message box after 4 seconds
                      setTimeout(() => {
                        messageBox.style.display = "none";
                      }, 4000);
                    }
                    </script>



                    <div id="loader" style="display: none; margin-top: 145px">
                      <img src="fancybox/source/fancybox_loading.gif" alt="loading...">
                    </div>

                    <div
                      style="padding: 0px 35px 0px 14px;  overflow-y: auto; height: 100%; margin: 10px 0px; scrollbar-width: none; -ms-overflow-style: none; scroll-behavior: smooth;">



                      <table id="availability-table" class="table table-bordered br-none mg-top"
                        style="width:100%; border-collapse: separate; margin: 0px">
                        <thead style="position: sticky; top: 0; z-index: 10; background-color: #d0d0d0;">
                          <tr>
                            <th class="border-none"></th>
                          </tr>
                          <tr>
                            <td class="border-none"
                              style="margin: 0px; padding: 0px; text-align: center; color: #fb3c3c; font-size: 9px; text-align: center">
                              LIVE</td>
                          </tr>
                          <tr>
                            <td class="border-none"></td>
                          </tr>
                        </thead>
                        <tbody id="room-availability-body">
                        </tbody>
                      </table>

                      <style>
                      #loader {
                        text-align: center;
                        padding: 50px;
                      }

                      .spinner {
                        border: 16px solid #f3f3f3;
                        border-radius: 50%;
                        border-top: 16px solid #3498db;
                        width: 120px;
                        height: 120px;
                      }

                      .month-bg-color {
                        background-color: #fb3c3c;
                        color: white;
                      }
                      </style>

                      <script>
                      $(document).ready(function() {
                        // Function to get the start and end date of the month
                        function getMonthStartAndEnd(year, month) {
                          let startOfMonth = new Date(Date.UTC(year, month - 1, 1));
                          let endOfMonth = new Date(Date.UTC(year, month, 0));
                          return {
                            start: startOfMonth,
                            end: endOfMonth
                          };
                        }

                        // Function to update bookings based on year and month
                        function updateBookings(year, month) {
                          let refDate = getMonthStartAndEnd(year, month);
                          let apiUrl =
                            `${base_url}/bookingajax.php?month=${year}-${String(month).padStart(2, '0')}&hotelID=<?= $_SESSION['hotel'] ?>`;

                          $('#loader').show();
                          $('#availability-table').hide();

                          $.getJSON(apiUrl, function(data) {
                            const startDate = new Date(refDate.start.toISOString().split('T')[0]);
                            const endDate = new Date(refDate.end.toISOString().split('T')[0]);
                            const datelength = endDate.getDate();

                            // Populate table headers for dates and weekdays
                            $('#availability-table thead tr:nth-child(1)').empty();
                            $('#availability-table thead tr:nth-child(2)').empty();
                            $('#availability-table thead tr:nth-child(3)').empty();

                            $('#availability-table thead tr:nth-child(1)').append(
                              `<th class="tb-color-1" style="background-color: #fff"></th>`);
                            $('#availability-table thead tr:nth-child(2)').append(
                              `<td style="margin: 0px;padding: 0px;text-align: center; color: #fb3c3c; font-size: 12px; background-color: #fff"><span style="display: inline-block; width: 5px; height: 5px; background-color: red; border-radius: 50%; margin-bottom: 4% "></span> LIVE</td>`
                            );
                            $('#availability-table thead tr:nth-child(3)').append(
                              `<td class="tb-color-1" style="background-color: #fff" ></td>`);

                            let currentDate = new Date(startDate);
                            while (currentDate <= endDate) {
                              const day = currentDate.getDate();
                              const monthName = currentDate.toLocaleString('default', {
                                month: 'short'
                              });
                              const weekday = currentDate.toLocaleString('default', {
                                weekday: 'short'
                              });

                              $('#availability-table thead tr:nth-child(1)').append(
                                `<th class="tb-color-1">${monthName}</th>`);
                              $('#availability-table thead tr:nth-child(2)').append(
                                `<td class="tb-color-1">${day}</td>`);
                              $('#availability-table thead tr:nth-child(3)').append(
                                `<td class="tb-color-1">${weekday}</td>`);

                              currentDate.setDate(currentDate.getDate() + 1);
                            }

                            // Populate table body with room types and availability
                            $('#room-availability-body').empty();
                            $.each(data, function(roomType, roomData) {
                              const total_room = roomData["total_rooms"];
                              const roomtype_id = roomData["roomtype_id"];
                              const roomTypeRow = `<tr><td class="size tb-color" style="background-color: #1E6A71">Room</td>
																		<td colspan=${datelength} style="text-align:center; background-color:#1E6A71; color:white" >${roomType.toUpperCase()}</td>
																		</tr>`;
                              $('#room-availability-body').append(roomTypeRow);

                              let availabilityCells = `<td class="tb-color-2" style="color: white;"></td>`;

                              for (let date = new Date(startDate); date <= endDate; date.setDate(date
                                  .getDate() + 1)) {
                                const dateString = date.toISOString().split('T')[0];
                                const statusInfo = roomData["dates"][dateString] || {
                                  booked_rooms: 0,
                                  available_rooms: 0
                                };
                                const bookedRooms = statusInfo.booked_rooms;
                                const availableRooms = statusInfo.available_rooms;

                                let backgroundColor;
                                if (bookedRooms === 0) {
                                  backgroundColor = '#37bc9b'; // All rooms available
                                } else if (availableRooms > 0) {
                                  backgroundColor = '#f9c74f'; // Some rooms available
                                } else {
                                  backgroundColor = '#fb3c3c'; // Fully booked
                                }

                                const isToday = date.toISOString().split('T')[0] === new Date()
                                  .toISOString().split('T')[0];

                                // Check if the date is in the past
                                const isPastDate = new Date() > date && !isToday;

                                // Set the input field accordingly
                                availabilityCells += `<td style="padding:0px; ${isPastDate ? 'background-color: #e0e0e0;' : ''}">
																		<input type="number" data-roomtype_id="${roomtype_id}" data-bdate="${date.toISOString().split('T')[0]}" data-available-rooms="${availableRooms}" data-total-room="${total_room}" class="availibility-input ${isPastDate ? '' : 'available'}" value="${availableRooms}" style="border:none; width:100%; text-align:center; color: black; text-decoration:${isPastDate ? 'none' : 'underline'} " ${isPastDate ? 'disabled' : ''}/>
																		</td>`;
                              }

                              const fullRow = `<tr>${availabilityCells}</tr>`;
                              $('#room-availability-body').append(fullRow);
                            });

                            $('#availability-table').show();
                            $('#loader').hide();
                          }).fail(function(jqXHR, textStatus, errorThrown) {
                            console.log("API request failed: ", textStatus, errorThrown);
                            $('#loader').hide();
                          });
                        }

                        let previousValue;
                        $(document).on('focus', '.availibility-input', function() {
                          // Store the previous value when the input gains focus
                          previousValue = $(this).val();
                        });

                        // Use event delegation for input validation
                        $(document).on('blur', '.availibility-input', function() {
                          let inputValue = parseInt($(this).val(), 10);
                          let totalRooms = parseInt($(this).data('available-rooms'),
                            10); // Available rooms to block
                          let totalRooms_of_each_roomtype = parseInt($(this).data('total-room'),
                            10); // Total rooms of this type
                          let bdate = $(this).data('bdate');
                          let roomtype_id = $(this).data('roomtype_id');

                          // Prevent any action if input value is the same as previous
                          if (inputValue == previousValue) {
                            return;
                          }

                          // Validate if input exceeds total rooms of each room type
                          if (inputValue > totalRooms_of_each_roomtype) {
                            showMessageBox(
                              `Input exceeds the total number of rooms of this type (${totalRooms_of_each_roomtype}).`,
                              'error');
                            $(this).val(totalRooms_of_each_roomtype); // Reset to the total available room count
                            return;
                          }

                          // If input exceeds available rooms, reset it and show an error
                          // if (inputValue > totalRooms) {
                          // 	showMessageBox(`Input exceeds the available rooms (${totalRooms}).`, 'error');
                          // 	$(this).val(totalRooms);
                          // 	return;
                          // }

                          // Calculate the limit (rooms to block or unblock)
                          let limit = totalRooms_of_each_roomtype - inputValue;

                          // Ensure valid blocking/unblocking based on total rooms and available rooms
                          if (limit < 0) {
                            showMessageBox(`Invalid operation: Exceeds total available rooms.`, 'error');
                            $(this).val(totalRooms); // Reset the value
                            return;
                          }

                          // Proceed with blocking/unblocking the room numbers
                          $.ajax({
                            type: 'POST',
                            url: 'bookingajax.php',
                            data: {
                              bdate: bdate,
                              roomtypeid: roomtype_id,
                              limit: limit,
                              available: inputValue, // Send the new available rooms count
                              action: 'block_room_number',
                              user: <?= $_SESSION['id'] ?>,
                              hotel: <?= $_SESSION['hotel'] ?>
                            },
                            success: function(response) {
                              let res = JSON.parse(response);
                              if (res.status === 'success') {
                                showMessageBox(res.message, 'success');
                                location.reload()
                              } else if (res.status === 'fail') {
                                document.getElementById('messageBox').innerHTML = `<div class='alert alert-danger alert-block square fade in alert-dismissable'>
																	<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;</button>
																	<p>${res.message}</p>
																</div>`;
                              }
                            }
                          });
                        });

                        // Listen for year or month changes
                        $('#yearSelector').change(function() {
                          let selectedYear = $(this).val();
                          let selectedMonth = $('.month-btn.month-bg-color').data('month') ||
                            '01'; // Default to January

                          // Save selected year to localStorage
                          localStorage.setItem('selectedYear', selectedYear);

                          updateBookings(selectedYear, selectedMonth);
                        });


                        $('.month-btn').click(function() {
                          let selectedMonth = $(this).data('month');
                          let selectedYear = $('#yearSelector').val();

                          // Save selected month and year to localStorage
                          localStorage.setItem('selectedMonth', selectedMonth);
                          localStorage.setItem('selectedYear', selectedYear);

                          // Add active class to the clicked month button
                          $('.month-btn').removeClass('month-bg-color');
                          $(this).addClass('month-bg-color');

                          updateBookings(selectedYear, selectedMonth);
                        });


                        // Initial load with default values (current month and year)
                        let initialYear = localStorage.getItem('selectedYear') || $('#yearSelector').val();
                        let initialMonth = localStorage.getItem('selectedMonth') || (new Date().getMonth() +
                          1); // Get current month
                        initialMonth = String(initialMonth).padStart(2, '0'); // Format as 2 digits

                        $('#yearSelector').val(initialYear);

                        $(`.month-btn[data-month="${initialMonth}"]`).addClass('month-bg-color');

                        updateBookings(initialYear, initialMonth);

                      });
                      </script>





                    </div>
                  </div>
                  <?php
							} else if ($_GET['Pg'] == "assignroom" and $_SESSION['hotel'] > 0 and $page_access) {
										$first_day	= date_create_from_format("d-m-Y", col("startdate", date("1-m-Y")));
										$current_day = clone $first_day;
										$now		= date_create(date("Y-m-d H:i"));

										pms_info_status(); ?>
											<script>
												function updateLocalStorageAssign() {
													// Save selected month and year to localStorage
													let currentdate = new Date();
													localStorage.setItem('selectedMonthAssign', `${currentdate.getMonth()+1}`);
													localStorage.setItem('selectedYearAssign', `${currentdate.getFullYear()}`);
												}
											</script>
											<h1 class="page-heading" style="padding: 5px 0;margin: 0px 0 -10px;">Assign rooms- All Room Types <small>Check and assign available rooms</small></h1>
											<div class="row margin ">
												<div class="col-md-12 padd-zero bg-color">
													<div class="row">
														<div>
															<?php
															// Fetch the registration date from the database
															$hotel_reg = execute("select reg_date from users where id in (select user from hotels where id=$_SESSION[hotel]);");
															$reg_year = date('Y', strtotime($hotel_reg['reg_date']));

															// Define the range of years to be displayed in the dropdown
															$current_year = date('Y');
															$future_end_year = $current_year + 5; // End 5 years into the future
															$years = range($reg_year, $future_end_year);

															// Set the default selected year
															$selected_year = $current_year;
															?>
															<div class="cal-month" style="display: flex; gap: 5px; padding: 0; margin-top: 15px; width: 40%; height: 31px; align-items: end;">
																<div class="col-xs-2">
																	<div class="form-group" style="margin-bottom: 0px;">
																		<select id="yearSelector" style="width:70px" class="form-control" tabindex="2">
																			<?php foreach ($years as $year): ?>
																				<option value="<?php echo $year; ?>" <?php echo $year == $selected_year ? 'selected' : ''; ?>>
																					<?php echo $year; ?>
																				</option>
																			<?php endforeach; ?>
																		</select>
																	</div>
																</div>

																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="01">JAN</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="02">FEB</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="03">MAR</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="04">APR</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="05">MAY</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="06">JUN</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="07">JUL</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="08">AUG</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="09">SEP</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="10">OCT</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="11">NOV</a>
																<a style="display: flex; height: 30px; color: #fff" href="javascript:void(0);" class="month-btn btn btn bleu txt-color" data-month="12">DEC</a>

																<input type="text" id="search-bookingid" class="form-control" style="border: 1px; width: 160px; margin-left: 128px; height: 28px" placeholder="Search #BRN" fdprocessedid="ckfz4n">
																<a style="display: flex; height: 29px; color: #fff" class="btn btn bleu txt-color" id="search-button">Submit</a>
																<a href="LBF_bookroom.php?date=" class="fancybox fancybox.iframe booked" style="margin-top:50px; height:28px; position: absolute; right: 21px; border-radius: 2px"><button class="btn btn booked" style="color: #fff" fdprocessedid="d0insh">Check Room Availability</button></a>

															</div>
															<div id="messageBox-room-inventory" style="display: none;"></div>
															<script>
																function showMessageBoxAssignroom(content, type) {
																	const messageBox = document.getElementById('messageBox-room-inventory');

																	// Determine the alert class based on the type parameter
																	let alertClass;
																	switch (type) {
																		case 'success':
																			alertClass = 'alert-success';
																			break;
																		case 'error':
																			alertClass = 'alert-danger';
																			break;
																		case 'warning':
																			alertClass = 'alert-warning';
																			break;
																		default:
																			alertClass = 'alert-info';
																	}

																	// Populate the messageBox with the content and appropriate styling
																	messageBox.innerHTML = `
																<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:-20px; right:20px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
																	<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
																	<p style="width:90%;">${content}</p>
																</div>`;

																	// Show the message box
																	messageBox.style.display = "block";

																	// Automatically hide the message box after 4 seconds
																	setTimeout(() => {
																		messageBox.style.display = "none";
																	}, 4000);
																}
															</script>



															<div id="loader" style="display: none; margin-top: 145px">
																<img src="fancybox/source/fancybox_loading.gif" alt="loading...">
															</div>

															<div style="padding: 0px 35px 0px 14px;  overflow-y: auto; height: 100%; margin: 10px 0px; scrollbar-width: none; -ms-overflow-style: none; scroll-behavior: smooth;">



																<table id="availability-table" class="table table-bordered br-none mg-top" style="width:100%; border-collapse: separate; margin: 0px">
																	<thead style="position: sticky; top: 0; z-index: 10; background-color: #d0d0d0;">
																		<tr>
																			<th class="border-none"></th>
																		</tr>
																		<tr>
																			<td class="border-none" style="margin: 0px; padding: 0px; text-align: center; color: #fb3c3c; font-size: 9px; text-align: center">LIVE</td>
																		</tr>
																		<tr>
																			<td class="border-none"></td>
																		</tr>
																	</thead>
																	<tbody id="room-availability-body">
																	</tbody>
																</table>

																<style>
																	#loader {
																		text-align: center;
																		padding: 50px;
																	}

																	.spinner {
																		border: 16px solid #f3f3f3;
																		border-radius: 50%;
																		border-top: 16px solid #3498db;
																		width: 120px;
																		height: 120px;
																	}

																	.month-bg-color {
																		background-color: #fb3c3c;
																		color: white;
																	}

																	.glowing-border {
																		animation: blinker 1s linear infinite;
																	}

																	@keyframes blinker {
																		50% {
																			opacity: 0;
																		}
																	}
																</style>

																<script>
																	$(document).ready(function() {
																		// Function to get the start and end date of the month
																		function getMonthStartAndEnd(year, month) {
																			let startOfMonth = new Date(Date.UTC(year, month - 1, 1));
																			let endOfMonth = new Date(Date.UTC(year, month, 0));
																			return {
																				start: startOfMonth,
																				end: endOfMonth
																			};
																		}

																		// Function to update bookings based on year and month
																		function updateBookings(year, month) {
																			let refDate = getMonthStartAndEnd(year, month);
																			let apiUrl = `${base_url}/bookingajax.php?month=${year}-${String(month).padStart(2, '0')}&assign_hotel=<?= $_SESSION['hotel'] ?>`;

																			$('#loader').show();
																			$('#availability-table').hide();

																			$.getJSON(apiUrl, function(data) {
																				const startDate = new Date(refDate.start.toISOString().split('T')[0]);
																				const endDate = new Date(refDate.end.toISOString().split('T')[0]);
																				const datelength = endDate.getDate();

																				// Populate table headers for dates and weekdays
																				$('#availability-table thead tr:nth-child(1)').empty();
																				$('#availability-table thead tr:nth-child(2)').empty();
																				$('#availability-table thead tr:nth-child(3)').empty();

																				$('#availability-table thead tr:nth-child(1)').append(`<th class="tb-color-1" style="background-color: #fff"></th>`);
																				$('#availability-table thead tr:nth-child(2)').append(`<td style="margin: 0px;padding: 0px;text-align: center; color: #fb3c3c; font-size: 12px; background-color: #fff"><span style="display: inline-block; width: 5px; height: 5px; background-color: red; border-radius: 50%; margin-bottom: 4% "></span> LIVE</td>`);
																				$('#availability-table thead tr:nth-child(3)').append(`<td class="tb-color-1" style="background-color: #fff" ></td>`);

																				let currentDate = new Date(startDate);
																				while (currentDate <= endDate) {
																					const day = currentDate.getDate();
																					const monthName = currentDate.toLocaleString('default', {
																						month: 'short'
																					});
																					const weekday = currentDate.toLocaleString('default', {
																						weekday: 'short'
																					});

																					$('#availability-table thead tr:nth-child(1)').append(`<th class="tb-color-1">${monthName}</th>`);
																					$('#availability-table thead tr:nth-child(2)').append(`<td class="tb-color-1">${day}</td>`);
																					$('#availability-table thead tr:nth-child(3)').append(`<td class="tb-color-1">${weekday}</td>`);

																					currentDate.setDate(currentDate.getDate() + 1);
																				}

																				// Populate table body with room types and availability
																				$('#room-availability-body').empty();
																				$.each(data, function(roomType, roomData) {
																					const total_room = roomData["total_rooms"];
																					const roomtype_id = roomData["roomtype_id"];
																					// 1  HEADER  
																					const roomTypeRow = `
  <tr>
    <td class="size tb-color" style="background-color:#1E6A71">Room</td>
    <td colspan="${datelength}"
        style="text-align:center;background:#1E6A71;color:#fff">
        ${roomType.toUpperCase()}  TOTAL ROOMS (${total_room})
    </td>
  </tr>`;
																					$('#room-availability-body').append(roomTypeRow);

																					// 2  BUILD TWO PARALLEL DATA ROWS  
																					let availableRow = `
  <tr>
    <td class="tb-color-2" style="background:#31B0D5;color:#fff">AVAILABLE</td>`;
																					let bookedRow = `
  <tr>
    <td class="tb-color-2" style="background:#37BC9B;color:#fff">BOOKED</td>`;

																					//  loop once per calendar day
																					for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
																						const dateString = date.toISOString().split('T')[0];
																						const dayObj = roomData.dates[dateString] || {
																							assigned_count: 0,
																							booking_ids: []
																						};
																						const booked = dayObj.assigned_count || 0;
																						const available = total_room - booked;
																						const bookingIds = dayObj.booking_ids || [];

																						const isToday = dateString === new Date().toISOString().split('T')[0];
																						const isPastDate = new Date() > date && !isToday;
																						const pastStyle = isPastDate ? '#e0e0e0' : '';

																						/* AVAILABLE cells  plain number */
																						availableRow += `
       <td style="text-align:center;background:${pastStyle || '#31B0D5'};">
           ${available}
       </td>`;

																						/* BOOKED cells  keep the <a> so your BRN search and popup still work */
																						bookedRow += `
       <td style="padding:0;text-align:center;background:${pastStyle || '#37BC9B'};">
         <a data-bookingidsarray="${bookingIds}"
            class="fancybox fancybox.iframe"
            style="border:none;width:100%;display:block;color:#000;
                   ${isPastDate ? 'pointer-events:none;opacity:.5;' : ''}"
            ${isPastDate ? '' : `href="LBF_getallbrninfo.php?id=${roomtype_id}&date=${dateString}"`}>
            ${booked}
         </a>
       </td>`;
																					}

																					availableRow += '</tr>';
																					bookedRow += '</tr>';

																					// 3  APPEND BOTH ROWS  
																					$('#room-availability-body').append(availableRow);
																					$('#room-availability-body').append(bookedRow);


																					let availabilityCells = `<td class="tb-color-2" style="color: white;"></td>`;

																					for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
																						const dateString = date.toISOString().split('T')[0];
																						const total_assign = roomData["dates"][dateString] || {
																							assigned_count: 0
																						};
																						const booking_count = total_assign.assigned_count || 0;
																						const bookingids = total_assign.booking_ids || [];
																						const isToday = date.toISOString().split('T')[0] === new Date().toISOString().split('T')[0];


																						// Check if the date is in the past
																						const isPastDate = new Date() > date && !isToday;

																						// Set the input field accordingly
																						availabilityCells += `
																					<td style="padding:0px; text-align: center; 
																					 background-color: ${isPastDate ? '#e0e0e0' : '#37BC9B'};">
																						<a data-bookingidsarray="${bookingids}" class="fancybox fancybox.iframe" style="border:none; width:100%; text-align:center; color: black; text-decoration: none; 
																						${isPastDate ? 'pointer-events: none; cursor: default; opacity: 0.5;' : ''}" 
																						${isPastDate ? '' : `href="LBF_getallbrninfo.php?id=${roomtype_id}&date=${dateString}"`}>${booking_count}</a>
																					</td>`;

																					}

																					const fullRow = `<tr>${availabilityCells}</tr>`;
																				});

																				$('#availability-table').show();
																				$('#loader').hide();
																			}).fail(function(jqXHR, textStatus, errorThrown) {
																				console.log("API request failed: ", textStatus, errorThrown);
																				$('#loader').hide();
																			});
																		}

																		let previousValue;
																		$(document).on('focus', '.availibility-input', function() {
																			// Store the previous value when the input gains focus
																			previousValue = $(this).val();
																		});


																		// Listen for year or month changes
																		$('#yearSelector').change(function() {
																			let selectedYear = $(this).val();
																			let selectedMonth = $('.month-btn.month-bg-color').data('month') || '01'; // Default to January

																			// Save selected year to localStorage
																			localStorage.setItem('selectedYearAssign', selectedYear);

																			updateBookings(selectedYear, selectedMonth);
																		});


																		$('.month-btn').click(function() {
																			let selectedMonth = $(this).data('month');
																			let selectedYear = $('#yearSelector').val();

																			// Save selected month and year to localStorage
																			localStorage.setItem('selectedMonthAssign', selectedMonth);
																			localStorage.setItem('selectedYearAssign', selectedYear);

																			// Add active class to the clicked month button
																			$('.month-btn').removeClass('month-bg-color');
																			$(this).addClass('month-bg-color');

																			updateBookings(selectedYear, selectedMonth);
																		});

																		$('#search-button').click(function(event) {
																			// Prevent the default form submission behavior
																			event.preventDefault();

																			// Get the booking ID, remove 'FR' if present, and trim/uppercase it
																			const bookingIdToSearchWithFR = $('#search-bookingid').val().trim().toUpperCase();
																			const bookingIdToSearch = bookingIdToSearchWithFR.replace('FR', "");

																			if (bookingIdToSearch) {
																				// Remove previous highlights
																				$('#room-availability-body tr td').css('border', '');
																				$('.glowing-border').removeClass('glowing-border'); // Remove previous glowing effect

																				// Find the row(s) with the matching booking ID and highlight
																				const matchingCells = $(`#room-availability-body tr td a[data-bookingidsarray*="${bookingIdToSearch}"]`);

																				if (matchingCells.length > 0) {
																					// Add glowing-border class to the matching rows
																					matchingCells.closest('td').addClass('glowing-border');

																					// Scroll to the first matching row
																					$('html, body').animate({
																						scrollTop: matchingCells.first().offset().top
																					}, 500);

																					// Remove the glowing border after 5 seconds
																					setTimeout(() => {
																						matchingCells.closest('td').removeClass('glowing-border');
																					}, 5000);
																				} else {
																					// Show error if booking ID is not found
																					showMessageBoxAssignroom('Booking ID not found!', 'error');
																				}
																			} else {
																				// Show warning if no booking ID is entered
																				showMessageBoxAssignroom('Please enter a Booking ID to search.', 'warning');
																			}
																		});




																		// Initial load with default values (current month and year)
																		let initialYear = localStorage.getItem('selectedYearAssign') || $('#yearSelector').val();
																		let initialMonth = localStorage.getItem('selectedMonthAssign') || (new Date().getMonth() + 1); // Get current month
																		initialMonth = String(initialMonth).padStart(2, '0'); // Format as 2 digits

																		$('#yearSelector').val(initialYear);

																		$(`.month-btn[data-month="${initialMonth}"]`).addClass('month-bg-color');

																		updateBookings(initialYear, initialMonth);

																	});
																</script>





															</div>
														</div>
													<?php
							}else if ($_GET['Pg'] == "agentregistration" and $page_access) {
															?>
																<h1 class="page-heading">Add New Agent</h1>
																	<div id="popupMessage" style="
																		position: fixed;
																		top: 20px;
																		right: 20px;
																		background-color: #4caf50;
																		color: white;
																		padding: 12px 20px;
																		border-radius: 5px;
																		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
																		display: none;
																		z-index: 9999;
																		font-weight: bold;
																		font-size: 14px;
																	">
																		Popup message here
																	</div>
																<div class="the-box">
																	<h4 class="small-title" style="width:100%; margin-bottom:0px;">
																		Add New Agent
																	</h4>
																	<form method="post" enctype="multipart/form-data" class="tform collapsed" id="agentForm" style="margin-top: 21px;">
																		<div class="row">
																			<div class="col-xs-3" style="width: 15%;">
																				<div class="form-group">
																					<label>Agent/Company Name</label>
																					<input type="text" class="form-control" name="agent" autocomplete="off" required>
																				</div>
																			</div>
																			<div class="col-xs-2" style="width: 15%;">
																				<div class="form-group">
																					<label>Concern Person</label>
																					<input type="text" class="form-control" name="concernperson" autocomplete="off" required>
																				</div>
																			</div>
																			<div class="col-xs-1" style="width: 10%;">
																				<div class="form-group">
																					<label>Contact</label>
																					<input type="text" class="form-control" name="contact" autocomplete="off" required>
																				</div>
																			</div>
																			<div class="col-xs-1" style="width: 10%;">
																				<div class="form-group">
																					<label>Alternate Contact</label>
																					<input type="text" class="form-control" name="altcontact" autocomplete="off">
																				</div>
																			</div>
																			<div class="col-xs-2" style="width: 15%;">
																				<div class="form-group">
																					<label>Email</label>
																					<input type="text" class="form-control" name="email" autocomplete="off">
																				</div>
																			</div>
																			<div class="col-xs-4">
																				<div class="form-group">
																					<label>Address</label>
																					<input type="text" class="form-control" name="address" autocomplete="off">
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>State</label>
																					<select class="form-control" name="state" required>
																						<option value="">Select State</option>
																						<?php

																						// Fetch states
																						$abc = $conn->query("SELECT id, state FROM states ORDER BY state");
																						while ($row = $abc->fetch_assoc()) {
																							$id = (int) $row['id'];
																							$stateName = htmlspecialchars($row['state']);
																							echo "<option value=\"$id\" >$stateName</option>";
																						}
																						?>
																					</select>
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>GSTIN</label>
																					<input type="text" class="form-control" name="gstin" autocomplete="off">
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>PAN</label>
																					<input type="text" class="form-control" name="pan" autocomplete="off">
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>Upload GST Certificate</label>
																					<div class="input-group">
																						<input type="text" class="form-control" readonly>
																						<span class="input-group-btn">
																							<span class="btn btn-default btn-file">
																								Browse...<input type="file" name="gstcertificate">
																							</span>
																						</span>
																					</div>
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>Upload PAN Copy</label>
																					<div class="input-group">
																						<input type="text" class="form-control" readonly>
																						<span class="input-group-btn">
																							<span class="btn btn-default btn-file">
																								Browse...<input type="file" name="panimage">
																							</span>
																						</span>
																					</div>
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>Commission type</label>
																					<select class="form-control" name="commission_type" required>
																						<option value="">Select Commission type</option>
																						<option value="flat">Flat</option>
																						<option value="percentage">Percentage</option>

																					</select>
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>Commission</label>
																					<input type="text" class="form-control" name="commission" autocomplete="off" required>
																				</div>
																			</div>
																		</div>
																		<div class="row">
																			<div class="col-xs-2">
																				<button type="submit" name="submit_agent" class="btn btn-primary">Add Agent</button>
																			</div>
																		</div>
																	</form>
																</div>
																<script>
																
																	function showPopup(message, type = 'success') {
																		const popup = document.getElementById('popupMessage');
																		if (!popup) return;

																		// Set background color
																		popup.style.backgroundColor = type === 'success' ? '#4caf50' : '#f44336'; // green or red

																		popup.textContent = message;
																		popup.style.display = 'block';

																		// Hide after 4 seconds
																		setTimeout(() => {
																			popup.style.display = 'none';
																		}, 4000);
																	}
																</script>
																<?php

																if (isset($_POST['submit_agent'])) {
																	include 'conn.php';
																	session_start();

																	// Sanitize inputs
																	$agent      = trim($_POST["agent"]);
																	$conper     = trim($_POST["concernperson"]);
																	$contact    = trim($_POST["contact"]);
																	$altcontact = trim($_POST["altcontact"]);
																	$email      = trim($_POST["email"]);
																	$address    = trim($_POST["address"]);
																	$state      = $_POST["state"] == "" ? 0 : (int)$_POST["state"];
																	$gstin      = trim($_POST["gstin"]);
																	$pan        = trim($_POST["pan"]);
																	$commission_type = trim($_POST["commission_type"]);
																	$commission = trim($_POST["commission"]);

																	$banquetId = $_SESSION["hotel"]; // Or any session variable you're using 
																	// Check if agent already exists
																	$checkSql = "SELECT COUNT(*) as cnt FROM agents WHERE banquet = ? AND agent = ?";
																	$stmt = $conn->prepare($checkSql);
																	$stmt->bind_param("is", $banquetId, $agent);
																	$stmt->execute();
																	$result = $stmt->get_result()->fetch_assoc();
																	$stmt->close();
																	function uploadFile($inputName, $targetDir)
																	{
																		if (!isset($_FILES[$inputName]) || $_FILES[$inputName]['error'] !== UPLOAD_ERR_OK) {
																			return ''; // Return empty if no file or error
																		}

																		// Create target directory if not exists
																		if (!is_dir($targetDir)) {
																			mkdir($targetDir, 0755, true);
																		}

																		$originalName = basename($_FILES[$inputName]['name']);
																		$extension = pathinfo($originalName, PATHINFO_EXTENSION);
																		$uniqueName = time() . '_' . uniqid() . '.' . $extension;
																		$targetFile = $targetDir . $uniqueName;

																		if (move_uploaded_file($_FILES[$inputName]['tmp_name'], $targetFile)) {
																			return $targetFile; // Return path to save in DB
																		} else {
																			return ''; // Upload failed
																		}
																	}

																	if ($result['cnt'] == 0) {
																		// Handle GST and PAN uploads
																		$gstimg = uploadFile('gstcertificate', 'images/agent_gstcertificates/');
																		$panimg = uploadFile('panimage', 'images/agent_pancards/');

																		$ts = date("Y-m-d h:i A");

																		// Insert agent
																		$insertSql = "INSERT INTO agents (banquet, agent, concernperson, contact, altcontact, email, address, state, gstin, gstinimg, pan, panimg, ts, commission,commission_type) 
                   																   VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?)";
																		$stmt = $conn->prepare($insertSql);
																		$stmt->bind_param("issssssisssssss", $banquetId, $agent, $conper, $contact, $altcontact, $email, $address, $state, $gstin, $gstimg, $pan, $panimg, $ts, $commission, $commission_type);

																		if ($stmt->execute()) {
																			echo "<script>
																			    showPopup('New agent added successfully!', 'success');
																			</script>";
																		} else {
																			echo "<script>
																			    setTimeout(function() {
																			        showPopup('Failed to add agent: " . addslashes($stmt->error) . "', 'error');
																			    }, 100);
																			</script>";
																		}
																		$stmt->close();
																	} else {
																		echo "<script>
																	        showPopup('Agent already exists.', 'error');
																	</script>";
																	}
																}
															} else if ($_GET['Pg'] == "agentview" and $page_access) {
																?>
																<h1 class="page-heading">View all Agents</h1>
																	<div id="popupMessage" style="
																		position: fixed;
																		top: 20px;
																		right: 20px;
																		background-color: #4caf50;
																		color: white;
																		padding: 12px 20px;
																		border-radius: 5px;
																		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
																		display: none;
																		z-index: 9999;
																		font-weight: bold;
																		font-size: 14px;
																	">
																		Popup message here
																	</div>
																<div class="the-box">
																	<h4 class="small-title">View Agents</h4>																	
																	<div class="row">
																		<form method="post" name="filter_form" action="">
																			<div class="col-xs-3">
																				<div class="form-group">
																					<label>Agent / Concern Person</label>
																					<input type="text" class="form-control" name="f_agent" value=" ">
																				</div>
																			</div>
																			<div class="col-xs-3">
																				<div class="form-group">
																					<label>Contact / Alternate Contact / Email</label>
																					<input type="text" class="form-control" name="f_contact" value=" ">
																				</div>
																			</div>
																			<div class="col-xs-2">
																				<div class="form-group">
																					<label>State</label>
																					<select class="form-control" name="f_state">
																						<option value="">Select State</option>
																						<?php

																						// Fetch states
																						$abc = $conn->query("SELECT id, state FROM states ORDER BY state");
																						while ($row = $abc->fetch_assoc()) {
																							$id = (int) $row['id'];
																							$stateName = htmlspecialchars($row['state']);
																							echo "<option value=\"$id\" >$stateName</option>";
																						}
																						?>
																					</select>
																				</div>
																			</div>
																			<div class="col-xs-1">
																				<label style="width:100%">&nbsp;</label>
																				<button type="submit" class="btn btn-success">Apply</button>
																			</div>
																			<div class="col-xs-1">
																				<label style="width:100%">&nbsp;</label>
																				<a href="?Pg=vendors"><button type="button" class="btn btn-danger">Reset</button></a>
																			</div>
																			<div class="col-xs-2">
																				<input type="hidden" id="pgn" name="pgn" value="<?= $pgn ?>">
																				<input type="hidden" id="act" name="act">
																				<input type="hidden" id="value" name="value">
																			</div>
																		</form>
																	</div>
																	<div class="row">
																		<div class="col-xs-12">

																			<div class="table-responsive" style="overflow-x:scroll">

																				<?php

																				$filt = "AND status = 1";
																				if (col("f_agent") != "") {
																					$f_agent = strtolower($_REQUEST['f_agent']);
																					$filt .= " AND (LOWER(agent) LIKE '%$f_agent%' OR LOWER(concernperson) LIKE '%$f_agent%')";
																				}

																				if (col("f_contact") != "") {
																					$f_contact = strtolower($_REQUEST['f_contact']);
																					$filt .= " AND (contact LIKE '%$f_contact%' OR altcontact LIKE '%$f_contact%' OR LOWER(email) LIKE '%$f_contact%')";
																				}

																				if (col("f_state") != "") {
																					$filt .= " AND state = " . (int)col("f_state");
																				}

																				if (isset($_SESSION['hotel']) && $_SESSION['hotel'] > 0) {
																				    $filt .= " AND banquet = " . (int)$_SESSION['hotel'];
																				}

																				$pagesize = 20; // Set your page size here
																				$filt_query = "SELECT id, agent, contact, email, address, gstin FROM agents WHERE 1 $filt";

																				// Count total records
																				$count_query = "SELECT COUNT(*) AS total FROM agents WHERE 1 $filt";
																				$count_result = $conn->query($count_query);
																				$total_records = ($count_result && $count_row = $count_result->fetch_assoc()) ? $count_row['total'] : 0;

																				// Calculate pagination
																				$current_page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
																				$current_page = max($current_page, 1);
																				$offset = ($current_page - 1) * $pagesize;

																				$qry = $filt_query . " ORDER BY agent LIMIT $pagesize OFFSET $offset";
																				$result = $conn->query($qry);
																				?>

																				<table class="table table-th-block table-hover">
																					<thead>
																						<tr>
																							<th>#</th>
																							<th>Agent</th>
																							<th>Contact</th>
																							<th>Email</th>
																							<th>Address</th>
																							<th>GSTIN</th>
																							<th>Delete</th>
																						</tr>
																					</thead>
																					<tbody>
																						<?php
																						if ($result && $result->num_rows > 0) {
																							$i = $offset + 1;
																							while ($row = $result->fetch_assoc()) { ?>
																								<tr>
																									<td><?= $i++ ?></td>
																									<td><?= htmlspecialchars($row["agent"]) ?></td>
																									<td><?= htmlspecialchars($row["contact"]) ?></td>
																									<td><?= htmlspecialchars($row["email"]) ?></td>
																									<td><?= htmlspecialchars($row["address"]) ?></td>
																									<td><?= htmlspecialchars($row["gstin"]) ?></td>
																									<td>
																										<button class="btn btn-danger" onclick="deleteAgent(<?= $row['id'] ?>)">Delete</button>
																									</td>
																								</tr>
																						<?php
																							}
																						} else {
																							echo "<tr><td colspan='8' align='center'>No records found.</td></tr>";
																						}
																						?>
																					</tbody>
																				</table>

																				<!-- Pagination Links -->
																				<?php
																				$total_pages = ceil($total_records / $pagesize);
																				if ($total_pages > 1) {
																					echo '<ul class="pagination">';
																					for ($p = 1; $p <= $total_pages; $p++) {
																						$active = ($p == $current_page) ? 'class="active"' : '';
																						echo "<li $active><a href='?page=$p'>" . $p . "</a></li>";
																					}
																					echo '</ul>';
																				}

																				?>

																				</table>
																			</div>
																		</div>
																	</div>
																</div>

																<script>
																		function showPopup(message, type = 'success') {
																		const popup = document.getElementById('popupMessage');
																		if (!popup) return;

																		// Set background color
																		popup.style.backgroundColor = type === 'success' ? '#4caf50' : '#f44336'; // green or red

																		popup.textContent = message;
																		popup.style.display = 'block';

																		// Hide after 4 seconds
																		setTimeout(() => {
																			popup.style.display = 'none';
																		}, 4000);
																	}
																	function deleteAgent(id) {
																		if (!confirm("Are you sure you want to delete this agent?")) return;

																		fetch("bookingajax.php?action=delete_agent", {
																				method: "POST",
																				headers: {
																					"Content-Type": "application/x-www-form-urlencoded"
																				},
																				body: "id=" + encodeURIComponent(id)
																			})
																			.then(response => response.text())
																			.then(result => {
																				try {
																					const data = JSON.parse(result);
																					showPopup(data.message, data.type);
																					  setTimeout(() => {
																					                window.location.href = "admin.php?Pg=agentview";   //  your target page
																					            }, 1000);																				} catch (e) {
																					showPopup("Unexpected response from server.", "error");
																				}
																			})
																			.catch(() => {
																				showPopup("Failed to delete agent.", "error");
																			});
																	}																
																</script>

															<?php	}
															 else if ($_GET['Pg'] == "agentcommission" and $page_access) {
																?>
																<h1 class="page-heading">View all Agents</h1>
																	<div id="popupMessage" style="
																		position: fixed;
																		top: 20px;
																		right: 20px;
																		background-color: #4caf50;
																		color: white;
																		padding: 12px 20px;
																		border-radius: 5px;
																		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
																		display: none;
																		z-index: 9999;
																		font-weight: bold;
																		font-size: 14px;
																	">
																		Popup message here
																	</div>
																<div class="the-box">
																	<h4 class="small-title">View Agents</h4>		
																	<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																	<div class="row">
																		<form method="post" name="filter_form" action="">
																			<div>
    <!-- BRN -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>BRN</label>
            <input type="text" class="form-control" name="f_brn" value="<?= htmlspecialchars($_POST['f_brn'] ?? '') ?>">
        </div>
    </div>

    <!-- Date of Booking (FROM) -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>Booking From</label>
            <input type="date" class="form-control" name="f_book_from" value="<?= $_POST['f_book_from'] ?? '' ?>">
        </div>
    </div>

    <!-- Date of Booking (TO) -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>Booking To</label>
            <input type="date" class="form-control" name="f_book_to" value="<?= $_POST['f_book_to'] ?? '' ?>">
        </div>
    </div>

    <!-- Check-in Date -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>Check-in</label>
            <input type="date" class="form-control" name="f_checkin" value="<?= $_POST['f_checkin'] ?? '' ?>">
        </div>
    </div>

    <!-- Check-out Date -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>Check-out</label>
            <input type="date" class="form-control" name="f_checkout" value="<?= $_POST['f_checkout'] ?? '' ?>">
        </div>
    </div>

    <!-- Customer Name -->
    <div class="col-xs-2">
        <div class="form-group">
            <label>Customer Name</label>
            <input type="text" class="form-control" name="f_customer" value="<?= htmlspecialchars($_POST['f_customer'] ?? '') ?>">
        </div>
    </div>

	<div class="col-xs-2">
        <div class="form-group">
            <label>Agent Name</label>
            <input type="text" class="form-control" name="f_agent" value="<?= htmlspecialchars($_POST['f_agent'] ?? '') ?>">
        </div>
    </div>

    <!-- Buttons -->
    <div class="col-xs-2">
        <label>&nbsp;</label>
        <div>
            <button type="submit" class="btn btn-success">Apply</button>
            <a href="?Pg=agentcommission" class="btn btn-danger">Reset</a>
        </div>
    </div>
</div>

																		</form>
																	</div>
															 </div>
																	<div class="row">
																		<div class="col-xs-12">

																			<div class="table-responsive" style="overflow-x:scroll">
<?php
$filt = "";

// BRN filter
if (!empty($_POST['f_brn'])) {
    $filt .= " AND b.id = " . (int)$_POST['f_brn'];
}

// Booking date range
if (!empty($_POST['f_book_from'])) {
    $filt .= " AND DATE(b.reg_date) >= '" . $_POST['f_book_from'] . "'";
}
if (!empty($_POST['f_book_to'])) {
    $filt .= " AND DATE(b.reg_date) <= '" . $_POST['f_book_to'] . "'";
}

if (!empty($_POST['f_agent'])) {
 $search = strtolower(mysqli_real_escape_string($conn, $_POST['f_agent']));
    $filt .= " AND LOWER(a.agent) LIKE '%$search%'";
}

// Check-in date
if (!empty($_POST['f_checkin'])) {
    $filt .= " AND DATE(b.checkindatetime) = '" . $_POST['f_checkin'] . "'";
}

// Check-out date
if (!empty($_POST['f_checkout'])) {
    $filt .= " AND DATE(b.checkoutdatetime) = '" . $_POST['f_checkout'] . "'";
}

// Customer name
if (!empty($_POST['f_customer'])) {
    $search = strtolower(mysqli_real_escape_string($conn, $_POST['f_customer']));
    $filt .= " AND LOWER(u.fullname) LIKE '%$search%'";
}

// Optional: filter by banquet if needed

?>

																				<?php

																				$pagesize = 20; // Set your page size here
																				$base = "
																				    SELECT 
																				        b.id,
																						a.banquet,
																						b.agent_id,
																				        b.checkindatetime,
																				        b.checkoutdatetime,
																				        b.reg_date,
																				        u.fullname,
																				        a.agent,
																				        b.commission,
																				        b.commission_type,
																				        b.declaredtariff
																				    FROM bookings b
																				    JOIN users u ON u.id = b.guestid
																				    JOIN agents a ON a.id = b.agent_id
																				    WHERE 1 
																				";
if ($_SESSION['hotel'] > 0) {
    $filt .= " AND a.banquet = " . (int)$_SESSION['hotel'];
}

$filt_query = $base . $filt;
																				// Count total records
$count_query = "
    SELECT COUNT(*) AS total 
    FROM bookings b 
    JOIN users u ON u.id = b.guestid 
    JOIN agents a ON a.id = b.agent_id 
    WHERE 1 $filt
";
																				$count_result = $conn->query($count_query);
																				$total_records = ($count_result && $count_row = $count_result->fetch_assoc()) ? $count_row['total'] : 0;

																				// Calculate pagination
																				$current_page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
																				$current_page = max($current_page, 1);
																				$offset = ($current_page - 1) * $pagesize;

																				$qry = $filt_query . " ORDER BY agent LIMIT $pagesize OFFSET $offset";
																				$result = $conn->query($qry);
																				?>

																				<table class="table table-th-block table-hover">
    <thead>
        <tr>
            <th>#</th>
            <th>BRN</th>
            <th>Date&nbsp;of&nbsp;Booking</th>
            <th>Checkin</th>
            <th>Checkout</th>
            <th>Customer&nbsp;Name</th>
			<th>Agent Name</th>
            <th>Total&nbsp;Amount&nbsp;()</th>
            <th>Commission&nbsp;Type</th>
            <th>Commission&nbsp;Value</th>
            <th>Commission&nbsp;Amt&nbsp;()</th>
        </tr>
    </thead>
    <tbody>
        <?php
        if ($result && $result->num_rows) {
            $i = $offset + 1;
            while ($row = $result->fetch_assoc()) {
                // Nicelyformatted money
                $totalAmt        = number_format($row['declaredtariff'], 2);
                $commissionAmt   = number_format($row['commission'], 2);

                // Commission value with symbol
				if($row['commission_type'] == "flat"){
					$valueLabel = $row['commission'];
				}
               else{
				$valueLabel = $row['declaredtariff']*($row['commission']/100);
			   }

			    $value = ($row['commission_type'] === 'percentage')
                              ? $row['commission'] . '%'
                              : '' . number_format($row['commission'], 2);
        ?>
        <tr>
            <td><?= $i++ ?></td>
            <td><?= $row['id'] ?></td>
            <td><?= date('dMY', strtotime($row['reg_date'])) ?></td>
            <td>
    <?= !empty($row['checkindatetime']) ? date('d-M-Y', strtotime($row['checkindatetime'])) : '-' ?>
</td>
<td>
    <?= !empty($row['checkoutdatetime']) ? date('d-M-Y', strtotime($row['checkoutdatetime'])) : '-' ?>
</td>

            <td><?= htmlspecialchars($row['fullname']) ?></td>
            <td><?= htmlspecialchars($row['agent']) ?></td>
            <td><?= $totalAmt ?></td>
            <td><?= ucfirst($row['commission_type']) ?></td>
            <td><?= $value ?></td>
            <td><?= $valueLabel ?></td>
        </tr>
        <?php
            }
        } else {
            echo '<tr><td colspan="11" align="center">No records found.</td></tr>';
        }
        ?>
    </tbody>
</table>


																				<!-- Pagination Links -->
																				<?php
																				$total_pages = ceil($total_records / $pagesize);
																				if ($total_pages > 1) {
																					echo '<ul class="pagination">';
																					for ($p = 1; $p <= $total_pages; $p++) {
																						$active = ($p == $current_page) ? 'class="active"' : '';
																						echo "<li $active><a href='?page=$p'>" . $p . "</a></li>";
																					}
																					echo '</ul>';
																				}

																				?>

																				</table>
																			</div>
																		</div>
																	</div>
																</div>

															<?php	} else if ($_GET['Pg'] == "bookingmap" and $_SESSION['hotel'] > 0 and $page_access) {
								$first_day = date_create_from_format("d-m-Y", col("startdate", date("1-m-Y")));
								$current_day = clone $first_day;
								$now = date_create(date("Y-m-d H:i"));




								pms_info_status(); ?>
                        <script>
                        function updatelocalstrage() {
                          // Save selected month and year to localStorage
                          let currentdate = new Date();
                          localStorage.setItem('selectedMonthMap', `${currentdate.getMonth() + 1}`);
                          localStorage.setItem('selectedYearMap', `${currentdate.getFullYear()}`);
                        }
                        </script>
                        <div class="row margin ">
                          <!-- toast -->
                          <div id="toast-bookingmap" style="display: none"></div>
                          <script>
                          function showToastbookingmap(content, type) {
                            // Get the toast div element
                            const toast = document.getElementById('toast-bookingmap');

                            // Map the alert type to Bootstrap's alert classes (or define your own)
                            let alertClass;
                            switch (type) {
                              case 'success':
                                alertClass = 'alert-success';
                                break;
                              case 'error':
                                alertClass = 'alert-danger';
                                break;
                              case 'warning':
                                alertClass = 'alert-warning';
                                break;
                              default:
                                alertClass = 'alert-info'; // Default case for other types
                            }

                            // Set the inner HTML content for the toast, dynamically adding the message and the alert class
                            toast.innerHTML = `
													<div style="position:absolute; z-index:50; width:30%; padding: 5px 14px; height:30px; top:138px; right:36px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
														<button style="width: 50px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
														<p style="width:90%;">${content}</p>
													</div>
												`;

                            // Show the toast
                            toast.style.display = "block";

                            // Automatically hide the toast after 5 seconds
                            setTimeout(() => {
                              toast.style.display = "none";
                            }, 4000);
                          }
                          </script>



                          
                          <div class="col-md-12 padd-zero bg-color">
                            <div class="booking-map-container">
                          <h1 class="page-heading" style=" margin-bottom: 0px" >Booking Map</h1>
                             <input type="text" id="search-bookingid" class="form-control"
                                    style="margin-top: -33px; border: 1px; width: 160px; margin-left: 460px; height: 30px"
                                    placeholder="Search #BRN">
                                  <a  style="    margin-right: 186px; margin-top: -28px; display: flex; height: 32px; color: #fff; width: 160px;" class="btn btn bleu txt-color pull-right"
                                    id="search-button">Submit</a>


                                  <a id="create-booking" href="LBF_bookroom.php?date="
                                    class="fancybox fancybox.iframe booked"
                                    style="margin-top:50px; position: absolute; right: 21px; border-radius: 2px"><button
                                      class="btn btn booked" style="color: #fff; margin-top: -77px;">Check Room
                                      Availability</button></a>
                            </div>
                            
                            <div class=" info " style="display: flex; gap: 5px">
                              <div style="margin-top: 11px; width: 100%; margin-bottom: 15px;">
                                <div class="back booked"></div>
                                <div class="text" style="margin-left: 3px;padding: 0px 9px 0px 0px;">
                                  <p>Room Assigned</p>
                                </div>
                                <div class="back available"></div>
                                <div class="text" style="margin-left: 3px;padding: 0px 9px 0px 0px;">
                                  <p>Available</p>
                                </div>
                                <div class="back past_date"></div>
                                <div class="text" style="margin-left: 3px;padding: 0px 9px 0px 0px;">
                                  <p>Past date</p>
                                </div>
                                <div class="back partialbook"></div>
                                <div class="text" style="margin-left: 3px;padding: 0px 9px 0px 0px;">
                                  <p>Room Reserved</p>
                                </div>
                                <a class="btn available fancybox fancybox.iframe" href="bookmap.php"
                                  style="float: inline-end; margin-right: 20px;">Check
                                  In</a>
                              </div>

                            </div>

                            <div id="room-type-jump"
                              style="height: 19px; padding: 0px 35px 0px 0px; display: flex;gap: 5px; margin-top: 0px; flex-wrap: wrap;">

                            </div>


                            <div class="row">
                              <div style="margin-left: -22px;
    margin-right: -22px;">
                                <?php
																				// Fetch the registration date from the database
																				$hotel_reg = execute("select reg_date from users where id in (select user from hotels where id=$_SESSION[hotel]);");
																				$reg_year = date('Y', strtotime($hotel_reg['reg_date']));

																				// Define the range of years to be displayed in the dropdown
																				$current_year = date('Y');
																				$future_end_year = $current_year + 5; // End 5 years into the future
																				$years = range($reg_year, $future_end_year);

																				// Set the default selected year
																				$selected_year = $current_year;
																				?>
                                <div class="cal-month"
                                  style="display: flex; gap: 5px; padding: 0; margin-top: 10px; width: 40%; height: 31px; align-items: end;">
                                  <div class="col-xs-2">
                                    <div class="form-group" style="margin-bottom: 0px;">
                                      <select id="yearSelector" style="width:70px" class="form-control" tabindex="2">
                                        <?php foreach ($years as $year): ?>
                                        <option value="<?php echo $year; ?>"
                                          <?php echo $year == $selected_year ? 'selected' : ''; ?>>
                                          <?php echo $year; ?>
                                        </option>
                                        <?php endforeach; ?>
                                      </select>
                                    </div>
                                  </div>

                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="01">JAN</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="02">FEB</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="03">MAR</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="04">APR</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="05">MAY</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="06">JUN</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="07">JUL</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="08">AUG</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="09">SEP</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="10">OCT</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="11">NOV</a>
                                  <a style="display: flex; height: 29px; color: #fff" href="javascript:void(0);"
                                    class="month-btn btn btn bleu txt-color" data-month="12">DEC</a>


                                 

                                </div>



                                <div id="loader" style="display: none; margin-top: 145px">
                                  <img src="fancybox/source/fancybox_loading.gif" alt="loading...">
                                </div>

                                <div
                                  style="padding: 0px 35px 0px 14px;  overflow-y: auto; height: 100%; margin: 10px 0px; scrollbar-width: none; -ms-overflow-style: none; scroll-behavior: smooth;">



                                  <table id="availability-table" class="table table-bordered br-none mg-top"
                                    style="width: 100%; margin:0px; border-collapse: separate">
                                    <thead id="table-header"
                                      style="position: sticky; top: 0; z-index: 10; background-color: #d0d0d0;">
                                      <tr>
                                        <th class="border-none" style="padding: 8px;"></th>
                                      </tr>
                                      <tr>
                                        <td class="border-none"
                                          style="padding: 8px; margin: 0px; padding: 0px; text-align: center; color: #fb3c3c; font-size: 12px">
                                          LIVE</td>
                                      </tr>
                                      <tr>
                                        <td class="border-none" style="padding: 8px;"></td>
                                      </tr>
                                    </thead>
                                    <tbody id="room-availability-body">
                                      <!-- Add your table rows here -->
                                    </tbody>
                                  </table>


                                </div>
                                <style>
                                #loader {
                                  text-align: center;
                                  padding: 50px;
                                }

                                .spinner {
                                  border: 16px solid #f3f3f3;
                                  border-radius: 50%;
                                  border-top: 16px solid #3498db;
                                  width: 120px;
                                  height: 120px;
                                }



                                .glowing-border {
                                  animation: blinker 1s linear infinite;
                                }

                                @keyframes blinker {
                                  50% {
                                    opacity: 0;
                                  }
                                }

                                .month-bg-color {
                                  background-color: #fb3c3c;
                                }
                                </style>

                                <script>
                                let permissions = <?= decode_permissions($_SESSION['permission']) ?>;
                                let group_id = <?= $_SESSION['groupid'] ?>;
                                var isCreate = true

                                if (group_id >= 3 && group_id <= 4) {
                                  if (!permissions.booking.Create) {
                                    document.getElementById('create-booking').style.display = 'none';
                                    isCreate = false
                                  }
                                }
                                </script>
                                <script>
                                $(document).ready(function() {
                                  // Function to get the start and end date of the month
                                  function getMonthStartAndEnd(year, month) {
                                    // Start of the month
                                    let startOfMonth = new Date(Date.UTC(year, month - 1, 1));

                                    // End of the month
                                    let endOfMonth = new Date(Date.UTC(year, month, 0));

                                    return {
                                      start: startOfMonth,
                                      end: endOfMonth
                                    };
                                  }

                                  // Function to update bookings based on year and month
                                  function updateBookings(year, month) {
                                    let refDate = getMonthStartAndEnd(year, month);
                                    let apiUrl =
                                      `${base_url}/bookingajax.php?month=${year}-${String(month).padStart(2, '0')}&hotel=<?= $_SESSION['hotel'] ?>`;

                                    $('#loader').show();
                                    $('#availability-table').hide();

                                    $.getJSON(apiUrl, function(data) {
                                      const startDate = new Date(refDate.start.toISOString().split('T')[0]);
                                      const endDate = new Date(refDate.end.toISOString().split('T')[0]);

                                      const datelength = endDate.getDate();
                                      let currentDate = new Date(startDate);

                                      // Populate table headers for dates, days, and weekdays
                                      $('#availability-table thead tr:nth-child(1)').empty();
                                      $('#availability-table thead tr:nth-child(2)').empty();
                                      $('#availability-table thead tr:nth-child(3)').empty();
                                      $('#room-type-jump').empty();

                                      $('#availability-table thead tr:nth-child(1)').append(
                                        `<th style="background-color: #fff" class="tb-color-1"></th>`);
                                      $('#availability-table thead tr:nth-child(2)').append(
                                        `<td style="margin: 0px;padding: 0px;text-align: center; color: #fb3c3c; font-size: 12px; background-color: #fff"><span style="display: inline-block; width: 5px; height: 5px; background-color: red; border-radius: 50%; margin-bottom: 4% "></span> LIVE</td>`
                                      );
                                      $('#availability-table thead tr:nth-child(3)').append(
                                        `<td style="background-color: #fff"" class="tb-color-1"></td>`);

                                      while (currentDate <= endDate) {
                                        const day = currentDate.getDate();
                                        const monthName = currentDate.toLocaleString('default', {
                                          month: 'short'
                                        });
                                        const weekday = currentDate.toLocaleString('default', {
                                          weekday: 'short'
                                        });

                                        $('#availability-table thead tr:nth-child(1)').append(
                                          `<th class="tb-color-1">${monthName}</th>`);
                                        $('#availability-table thead tr:nth-child(2)').append(
                                          `<td class="tb-color-1">${day}</td>`);
                                        $('#availability-table thead tr:nth-child(3)').append(
                                          `<td class="tb-color-1">${weekday}</td>`);

                                        currentDate.setDate(currentDate.getDate() + 1);
                                      }

                                      // Populate table body with room types and availability
                                      $('#room-availability-body').empty();
                                      $.each(data, function(roomType, rooms) {
                                        const roomTypeId = roomType.replace(/\s+/g, '-').toLowerCase();
                                        const roomTypeRow = `<tr id="${roomTypeId}"><td class="size tb-color" style="background-color: #1E6A71">Room#</td>
																			<td colspan=${datelength} style="text-align:center; background-color:#1E6A71; color:white" >${roomType.toUpperCase()}</td>
																			</tr>`;

                                        const roomTypeJump = `<a id="scrollBotton" style="height: 20px; font-size: 10px;display: flex;text-align: center;align-self: center;align-items: center;color: #fff;" class="month-btn btn btn bleu txt-color" data-month="12" href="#${roomTypeId}">
																			${roomType.toUpperCase()}
																			</a>`;

                                        $('#room-type-jump').append(roomTypeJump)
                                        $('#room-availability-body').append(roomTypeRow);

                                        $.each(rooms, function(roomNumber, roomData) {
                                          let roomNumbersCells =
                                            `<td class="tb-color-2">${roomNumber}</td>`;
                                          let availabilityCells = '';

                                          for (let date = new Date(startDate); date <= endDate; date
                                            .setDate(date.getDate() + 1)) {
                                            const dateString = date.toISOString().split('T')[0];
                                            const roomtypeid = roomData.roomtypeid;
                                            const statusInfo = roomData.availability[dateString] || {
                                              status: 0
                                            };
                                            const status = statusInfo.status;
                                            const fullName = statusInfo.fullname || '';
                                            const checkin = statusInfo.checkin || '';
                                            const checkout = statusInfo.checkout || '';
                                            const unique_booking_number = statusInfo
                                              .unique_booking_number || '';
                                            const isRoomAssigned = Number(statusInfo.isRoomAssigned) ||
                                              '';
                                            const bookingid = statusInfo.bookingid || '';

                                            // Adjust the background color determination logic
                                            const isToday = date.toISOString().split('T')[0] ===
                                              new Date().toISOString().split('T')[0];
                                            const isPastDate = new Date() > date && !isToday;
                                            const backgroundColor = status === 1 ? '#fb3c3c' :
                                              isPastDate ? "#d0d0d0" : '#37bc9b';

                                            availabilityCells +=
                                              `<td data-bookingid="${(status === 1 && bookingid)}" class="tb-color-2" style="background-color: ${backgroundColor}; padding: 0;">`;


                                            function formatDate(dateString) {
                                              const date = new Date(dateString);
                                              const day = String(date.getDate()).padStart(2,
                                                '0'); // Get day and pad it to 2 digits
                                              const month = String(date.getMonth() + 1).padStart(2,
                                                '0'); // Get month and pad to 2 digits
                                              const year = date.getFullYear(); // Get year
                                              return `${day}-${month}-${year}`; // Return in dd-mm-yyyy format
                                            }

                                            // Use the formatDate function to format the checkin and checkout dates
                                            const formattedCheckin = formatDate(checkin);
                                            const formattedCheckout = formatDate(checkout);


                                            if (status === 1) {
                                              if (isRoomAssigned === 1) {
                                                availabilityCells += `
																						<a data-toggle="tooltip" data-placement="top" data-html="true"
																						title="Booked by: ${fullName}<br><span style='display:block; text-align:left;'>BookingId: FR${bookingid}<br>(Check-in: ${formattedCheckin},<br>Check-out: ${formattedCheckout})</span>" 
																						href="LBF_roomnumberbooking.php?id=${roomData.id}&date=${dateString}" 
																						class='fancybox fancybox.iframe' style="display: block; width: 100%; height: 100%; text-decoration: none;">
																						<span style="color:white; font-weight:400;">${unique_booking_number}</span>
																						</a>`
                                              } else {
                                                availabilityCells += `
																								<a class="fancybox fancybox.iframe" href="LBF_getallbrninfo.php?id=${roomtypeid}&date=${dateString}" data-toggle="tooltip" data-placement="top" title="Room is Already Reserved"  style="display: block; width: 100%; height: 100%; text-decoration: none; background-color:#428bca; ">
																									<span style="color:white; font-weight:400;">${unique_booking_number}</span>
																								</a>`;
                                              }

                                            } else {
                                              if (new Date() > date && !isToday) {
                                                availabilityCells += `
																								<a data-toggle="tooltip" data-placement="top" title="Past Dates Cannot Be Booked"  style="display: block; width: 100%; height: 100%; text-decoration: none;">
																									<span style="visibility: hidden;">Book</span>
																								</a>`;
                                              } else {
                                                availabilityCells += `
																								<a data-toggle="tooltip" data-placement="top" title="Room is Available" href="${isCreate ? `LBF_bookroom.php?date=${dateString}&roomname=${roomType}` : ''}" class='${isCreate ? "fancybox fancybox.iframe" : ''}' style="display: block; width: 100%; height: 100%; text-decoration: none;">
																									<span style="visibility: hidden;">Book</span>
																								</a>`;
                                              }
                                            }

                                            availabilityCells += `</td>`;
                                          }

                                          const fullRow =
                                            `<tr>${roomNumbersCells}${availabilityCells}</tr>`;
                                          $('#room-availability-body').append(fullRow);
                                        });

                                      });

                                      $('#availability-table').show();
                                      $('#loader').hide();
                                    }).fail(function(jqXHR, textStatus, errorThrown) {
                                      console.log("API request failed: ", textStatus, errorThrown);
                                      $('#loader').hide();
                                    });
                                  }

                                  // Listen for changes in the year dropdown
                                  $('#yearSelector').change(function() {
                                    let selectedYear = $(this).val();
                                    let selectedMonth = $('.month-btn.month-bg-color').data('month') ||
                                      '01'; // Default to January

                                    // Save selected year to localStorage
                                    localStorage.setItem('selectedYearMap', selectedYear);

                                    updateBookings(selectedYear, selectedMonth);
                                  });


                                  // Listen for clicks on month buttons
                                  $('.month-btn').click(function() {
                                    let selectedMonth = $(this).data('month');
                                    let selectedYear = $('#yearSelector').val();

                                    // Save selected month and year to localStorage
                                    localStorage.setItem('selectedMonthMap', selectedMonth);
                                    localStorage.setItem('selectedYearMap', selectedYear);

                                    // Add active class to the clicked month button
                                    $('.month-btn').removeClass('month-bg-color');
                                    $(this).addClass('month-bg-color');

                                    updateBookings(selectedYear, selectedMonth);
                                  });

                                  // Listen for clicks on the search button
                                  $('#search-button').click(function(event) {
                                    // Prevent the default form submission behavior
                                    event.preventDefault();

                                    const bookingIdToSearchWithFR = $('#search-bookingid').val().trim()
                                      .toUpperCase();
                                    const bookingIdToSearch = bookingIdToSearchWithFR.replace('FR', "")

                                    if (bookingIdToSearch) {
                                      // Remove previous highlights
                                      $('#room-availability-body tr td').css('border', '');

                                      // Find the row(s) with the matching bookingid and highlight
                                      const matchingRows = $(
                                        `#room-availability-body tr td[data-bookingid="${bookingIdToSearch}"]`
                                      );


                                      if (matchingRows.length > 0) {
                                        matchingRows.addClass('glowing-border');
                                        $('html, body').animate({
                                          scrollTop: matchingRows.offset().top
                                        }, 500); // Scroll to the row
                                        setTimeout(() => {
                                          matchingRows.removeClass('glowing-border');
                                        }, 5000);
                                      } else {
                                        showToastbookingmap('Booking ID not found!', 'error');
                                      }
                                    } else {
                                      showToastbookingmap('Please enter a Booking ID to search.', 'warning');

                                    }
                                  });

                                  // Initial load with default values (current month and year)
                                  let initialYear = localStorage.getItem('selectedYearMap') || $('#yearSelector')
                                    .val();
                                  let initialMonth = localStorage.getItem('selectedMonthMap') || (new Date()
                                    .getMonth() + 1); // Get current month
                                  initialMonth = String(initialMonth).padStart(2, '0'); // Format as 2 digits

                                  // Set the year dropdown to the saved year
                                  $('#yearSelector').val(initialYear);

                                  // Set the active month button to the saved month
                                  $(`.month-btn[data-month="${initialMonth}"]`).addClass('month-bg-color');

                                  // Update bookings for the selected month and year
                                  updateBookings(initialYear, initialMonth);

                                });
                                </script>



                              </div>
                            </div>
                            <?php
							} else if ($_GET['Pg'] == "promocodes" and $page_access) {
								if (isset($_POST['title'])) {
									$title = $_POST['title'];
									$validfrom = dateindia($_POST['validfrom']);
									$validto = dateindia($_POST['validto']);
									$type = $_POST['type'];
									$value = $_POST['value'];
									$target = $_POST['target'];
									$cities = col("cities", 0);
									$users = col("users", 0);
									$hotels = col("hotels", 0);
									$usability = $_POST['usability'];
									$generation = $_POST['generation'];
									$pcqty = col("pcqty", 0);
									$labelpref = $_POST['labelpref'];
									$label = $_POST['label'];
									$promocode = $_POST['promocode'];

									$pcid = insert("insert into promocodeids (title,type,target,validfrom,validto,value,usability,generation) values ('$title','$type', '$target','$validfrom','$validto',$value,'$usability','$generation')");

									if ($generation == "manual")
										$conn->query("insert into promocodes (promocodeid,promocode) values ($pcid,'$promocode')");
									else {
										$sql = "insert into promocodes (promocodeid,promocode) values ";
										for ($i = 1; $i <= $pcqty; $i++) {
											if ($labelpref == "Yes")
												$pc = $label . "-" . random_num(6);
											else
												$pc = random_num(6);

											if ($sql == "insert into promocodes (promocodeid,promocode) values ")
												$sql .= "($pcid,'$pc')";
											else
												$sql .= ",($pcid,'$pc')";
										}

										if ($sql != "insert into promocodes (promocodeid,promocode) values ") {
											$conn->query($sql);
										}
									}

									$result = $conn->query("select id from promocodes where promocodeid=$pcid");

									if ($target == "city") {
										foreach ($_POST['cities'] as $city) {
											while ($row = $result->fetch_assoc())
												$conn->query("insert into promocodetargets (promocodeid,targetid) values ($row[id],$city)");
											mysqli_data_seek($result, 0);
										}
									} else if ($target == "user") {
										foreach ($_POST['users'] as $user) {
											while ($row = $result->fetch_assoc())
												$conn->query("insert into promocodetargets (promocodeid,targetid) values ($row[id],$user)");
											mysqli_data_seek($result, 0);
										}
									} else if ($target == "hotel") {
										foreach ($_POST['hotels'] as $hotel) {
											while ($row = $result->fetch_assoc())
												$conn->query("insert into promocodetargets (promocodeid,targetid) values ($row[id],$hotel)");
											mysqli_data_seek($result, 0);
										}
									}

									$msg = "Promocode(s) generated successfully";
									$clrclass = "success";
								} ?>
                            <h1 class="page-heading">HOTEL <small>Promocodes</small></h1>
                            <div class="the-box" style="padding-bottom:0px">
                              <h4 class="small-title">CREATE PROMOCODES</h4>
                              <?php alertbox($clrclass, $msg);
																		$msg = ""; ?>
                              <form method="post" action="">
                                <div class="row">
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Title</label>
                                      <input type="text" class="form-control" name="title" Placeholder=""
                                        title="E.g. 10% OFF" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <label>Valid From</label>
                                      <input type="text" id="datepicker1" data-date-format="dd-mm-yyyy"
                                        class="form-control" name="validfrom" title="" readonly required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <label>Valid Upto</label>
                                      <input type="text" id="datepicker2" data-date-format="dd-mm-yyyy"
                                        class="form-control" name="validto" title="" readonly required>
                                    </div>
                                  </div>

                                  <div class="col-xs-5">
                                    <div style="width:100%; float:left">
                                      <label>Usability</label>
                                    </div>
                                    <div class="radio-4" style="margin-left:-8px;">
                                      <input type="radio" name="usability" class="form-control" value="single"
                                        title="This type of coupon can be used only once. After a single use, it wil get expired automatically. ()"
                                        checked>Single use
                                    </div>
                                    <div class="radio-6">
                                      <input type="radio" name="usability" class="form-control" value="multiple"
                                        title="This type of coupon can be used multiple times with a validity. Ex. FROTEL10">Multiple
                                      use
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <div class="form-group">
                                      <div class="radio-2" style="margin-left:-8px;">
                                        <input type="radio" class="form-control" name="target" value="general"
                                          onChange="showtargetlist(this.value)" checked>General
                                      </div>
                                      <div class="radio-3" style="margin-left:-8px;">
                                        <input type="radio" class="form-control" name="target" value="city"
                                          onChange="showtargetlist(this.value)">City
                                        Based
                                        <div id="cities" style="margin-top:10px;">
                                          <select name="cities[]" class="form-control chosen-select" multiple>
                                            <?php $result = $conn->query("select id,city from cities order by city");
																									while ($row = $result->fetch_assoc()) { ?>
																																																							<option
																																																								value="<?= $row['id'] ?>">
																											<?= $row['city'] ?></option>
																										<?php
																									} ?>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="radio-3" style="margin-left:-8px;">
                                        <input type="radio" class="form-control" name="target" value="user"
                                          onChange="showtargetlist(this.value)">User
                                        Based
                                        <div id="users" style="margin-top:10px;">
                                          <select name="users[]" class="form-control chosen-select" multiple>
                                            <?php $result = $conn->query("select id,fullname from users where groupid=5 order by fullname");
																									while ($row = $result->fetch_assoc()) { ?>
                                            <option value="<?= $row['id'] ?>">
                                              <?= $row['fullname'] ?>
                                            </option>
                                            <?php
																									} ?>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="radio-3" style="margin-left:-8px;">
                                        <input type="radio" class="form-control" name="target" value="hotel"
                                          onChange="showtargetlist(this.value)">Hotel
                                        Based
                                        <div id="hotels" style="margin-top:10px;">
                                          <select name="hotels[]" class="form-control chosen-select" multiple>
                                            <?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 order by u.company");
																									while ($row = $result->fetch_assoc()) { ?>
                                            <option value="<?= $row['id'] ?>">
                                              <?= $row['company'] ?>
                                            </option>
                                            <?php
																									} ?>
                                          </select>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Type</label>
                                      <div style="margin-left: -10px;">
                                        <div class="radio-6">
                                          <input type="radio" name="type" class="form-control" value="Percent"
                                            checked>Percent
                                        </div>
                                        <div class="radio-6">
                                          <input type="radio" name="type" class="form-control" value="Flat">Flat
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <div class="form-group">
                                      <label>Value</label>
                                      <input type="number" style="width: 139px" class="form-control" min="0"
                                        name="value" title="">
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <label style="margin-left:2px; margin-top:8px;">Do
                                      you want to generate code
                                      dynamically?</label>
                                  </div>
                                  <div class="col-xs-4">
                                    <div class="radio-4" style="margin-left:-8px;">
                                      <input type="radio" name="generation" class="form-control"
                                        onChange="codegeneration(this.value)" value="dynamic" checked>Yes
                                    </div>
                                    <div class="radio-6">
                                      <input type="radio" name="generation" class="form-control"
                                        onChange="codegeneration(this.value)" value="manual">No
                                    </div>
                                  </div>
                                </div>
                                <div class="row" id="dynamic">
                                  <div class="col-xs-12">
                                    <label>How many promocodes you want to
                                      generate?</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <input type="number" name="pcqty" min="0" class="form-control">
                                    </div>
                                  </div>
                                  <div class="col-xs-12">
                                    <label>Do you have start label
                                      preference?</label>
                                  </div>
                                  <div class="col-xs-12">
                                    <div class="radio-1" style="margin-left:-8px;">
                                      <input type="radio" name="labelpref" class="form-control" value="Yes"
                                        onChange="labelpreference(this.value)" checked>Yes
                                    </div>
                                    <div class="radio-1">
                                      <input type="radio" name="labelpref" class="form-control"
                                        onChange="labelpreference(this.value)" value="No">No
                                    </div>
                                  </div>
                                  <div class="col-xs-2" id="labelpref">
                                    <div class="form-group">
                                      <label>Label preference</label>
                                      <input type="text" name="label" class="form-control">
                                    </div>
                                  </div>
                                </div>
                                <div class="row" id="manual" style="display:none; margin-top:-15px;">
                                  <br>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <label>Enter Promocode</label>
                                      <input type="text" name="promocode" class="form-control">
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <div class="form-group">
                                      <input type="submit" class="btn btn-primary" value="Generate">
                                    </div>
                                  </div>
                                </div>
                              </form>
                            </div>
                            <?php if (isset($_POST['deleteid'])) {
																		$conn->query("delete pid,pc,pct from promocodeids pid left join promocodes pc on pid.id=pc.promocodeid left join promocodetargets pct on pid.id=pct.promocodeid where pid.id=$_POST[deleteid]");
																		$clrclass = "success";
																		$msg = "Promocodes are deleted";
																	} ?>
                            <div class="the-box" style="padding-bottom:0px">
                              <h4 class="small-title">VIEW/EDIT/DELETE PROMOCODES</h4>
                              <?php alertbox($clrclass, $msg) ?>
                              <form method="post" name="filter_form" action="">
                                <input type="hidden" name="deleteid" id="deleteid">
                                <input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
                              </form>
                              <?php modal("Promocodes", "promocodes"); ?>
                              <div class="table-responsive">
                                <table class="table table-th-block table-hover">
                                  <thead>
                                    <tr>
                                      <th>No.</th>
                                      <th>Title</th>
                                      <th>Type</th>
                                      <th>Value</th>
                                      <th>Valid From</th>
                                      <th>Valid Upto</th>
                                      <th>Code For</th>
                                      <th>Usability</th>
                                      <th>CSV</th>
                                      <th>View</th>
                                      <th>Delete</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <?php $i = 0;
																					$result = $conn->query("select * from promocodeids order by id desc");
																					if ($result->num_rows > 0) {
																						while ($row = $result->fetch_assoc()) {
																							$i++; ?>
																																																				<tr>
																																																					<td><?= $i ?></td>
																																																					<td id='td1id<?= $i ?>'><?= $row['title'] ?>
																																																					</td>
																																																					<td><?= $row['type'] ?></td>
																																																					<td id='td4id<?= $i ?>'>
																									<?= $row['value'] ?>					<?= ($row['type'] == "Percent") ? "%" : "/-"; ?>
																																																					</td>
																																																					<td id='td2id<?= $i ?>'>
																									<?= popdate($row['validfrom']) ?></td>
																																																					<td id='td3id<?= $i ?>'>
																									<?= popdate($row['validto']) ?></td>
																																																					<td id='td5id<?= $i ?>'>
																									<?= $row['target'] ?></td>
																																																					<td id='td5id<?= $i ?>'>
																									<?= $row['usability'] ?></td>
																																																					<td><a
																																																							href="csvexport.php?id=<?= $row['id'] ?>"><img
																																																								src="images/1475324306_application-vnd.ms-excel.png"
																																																								width="22" height="22"
																																																								border="0" alt=""></a></td>
																																																					<td><a href="LBF_viewpromocodes.php?id=<?= $row['id'] ?>&cntr=<?= $i ?>"
																																																							class="fancybox fancybox.iframe"><span
																																																								class="label label-purple">View</span></a>
																																																					</td>
																																																					<td><a href='javascript:void(0)'
																																																							onClick='modal_button_updater(<?= $row['id'] ?>)'><span
																																																								class='label label-danger'
																																																								data-toggle='modal'
																																																								data-target='#DangerModalColor2'>Delete</span></a>
																																																					</td>
																																																				</tr>
																							<?php
																						}
																					} else { ?>
                                    <tr>
                                      <td colspan="10">No promocodes to display
                                      </td>
                                    <tr>
                                      <?php
																					} ?>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                            <?php
							} else if ($_GET['Pg'] == "cities" and $page_access) { ?>

                            <?php if (col("city") != "") {
																		$latitude = $_POST['latitude'];
																		$longitude = $_POST['longitude'];
																		$state = $_POST['state'];
																		$city = $_POST['city'];

																		$row = execute("select count(*)cnt from cities where city='$city'");

																		if ($row['cnt'] == 0) {
																			$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																			if ($filename != "") {
																				$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																				$cityid = $conn->insert_id;

																				$msg = "City added successfully";
																				$clrclass = "success";
																			} else {
																				$msg = "City could not be saved";
																				$clrclass = "danger";
																			}
																		} else {
																			$msg = "City already exist";
																			$clrclass = "danger";
																		}
																	} ?>
                            <div class="row">
                              <div class="col-xs-12" style="margin-top:40px;">
                                <div class="the-box">
                                  <h1 class="page-heading" style="margin-left:10px;">CITIES</h1>
                                  <?php if ($msg != "") {
																					alertbox($clrclass, $msg);
																				} ?>
                                  <form method="POST" action="?Pg=<?= $_GET['Pg'] ?>" enctype="multipart/form-data">
                                    <div class="row">
                                      <div class="col-xs-4">
                                        <div class="form-group">
                                          <label>Country</label>
                                          <select name="country" class="form-control" onChange="getstates(this.value)"
                                            required>
                                            <option value="">Select Country
                                            </option>
                                            <?php $result = $conn->query("select id,country from countries where id=104 order by (case when id=104 or id=170 then 0 else 1 end),id");
																									while ($row = $result->fetch_assoc()) { ?>
                                            <option value="<?= $row['id'] ?>">
                                              <?= $row['country'] ?>
                                            </option>
                                            <?php
																									} ?>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="col-xs-4">
                                        <div class="form-group">
                                          <label>State</label>
                                          <select name="state" id="state" class="form-control" required>
                                            <option value="">Select State
                                            </option>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="col-xs-4">
                                        <div class="form-group">
                                          <label>City</label>
                                          <input type="text" class="form-control" name="city" placeholder="City name"
                                            title="Please enter city name" required>
                                        </div>
                                      </div>
                                      <div class="col-xs-6">
                                        <div class="form-group" style="margin-right: 142px;">
                                          <label>Place City Marker on
                                            Map</label>
                                          <input type="text" class="form-control" id="us3-address" value="Mumbai" />
                                        </div>
                                      </div>
                                      <div class="col-xs-3">
                                        <div class="form-group" style="margin-left: -142px;
    margin-right: 70px;">
                                          <label>Latitude</label>
                                          <input type="text" class="form-control" name="latitude"
                                            value="<?= $row['latitude'] ?>" id="us3-lat" readonly />
                                        </div>
                                      </div>
                                      <div class="col-xs-3">
                                        <div class="form-group" style="margin-left: -69px;">
                                          <label>Longitude</label>
                                          <input type="text" class="form-control" name="longitude"
                                            value="<?= $row['longitude'] ?>" id="us3-lon" readonly />
                                        </div>
                                      </div>
                                      <div class="col-xs-12">
                                        <div id="us3" style="width:100%; height:400px;">
                                        </div>
                                      </div>
                                      <div class="col-xs-4">
                                        <div class="form-group">
                                          <label>City Image file</label>
                                          <div class="input-group">
                                            <input type="text" class="form-control" readonly="">
                                            <span class="input-group-btn">
                                              <span class="btn btn-default btn-file">
                                                Browse...<input type="file" name="cityimage" required>
                                              </span>
                                            </span>
                                          </div>
                                        </div>
                                        <p class="help-block">Image Dimensions :
                                          1920 x 275 Pixels</p>
                                      </div>
                                      <div class="col-xs-2">
                                        <label style="visibility:hidden">Submit
                                          Button</label>
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                      </div>
                                    </div>
                                    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
                                    <script type="text/javascript"
                                      src='https://maps.google.com/maps/api/js?key=AIzaSyBLZ9ZLnTdY6vAdJ9ty5OSYDeqvyfDXGgQ&sensor=false&libraries=places'>
                                    </script>
                                    <script src="locationpicker/locationpicker.jquery.min.js"></script>
                                    <input type="hidden" class="form-control" id="us3-radius" />
                                    <script>
                                    $('#us3').locationpicker({
                                      location: {
                                        latitude: 21.992708150346054,
                                        longitude: 78.98268374999998
                                      },
                                      radius: 0,
                                      zoom: 6,
                                      inputBinding: {
                                        latitudeInput: $('#us3-lat'),
                                        longitudeInput: $('#us3-lon'),
                                        radiusInput: $('#us3-radius'),
                                        locationNameInput: $('#us3-address')
                                      },
                                      enableAutocomplete: true,
                                      onchanged: function(currentLocation, radius, isMarkerDropped) {
                                        // Uncomment line below to show alert on each Location Changed event
                                        //alert("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");
                                      }
                                    });
                                    </script>
                                  </form>
                                </div>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-sm-12">
                                <div class="the-box">
                                  <?php if (col("deleteid") != "") {
																					$id = nosql($_POST['deleteid']);
																					$row = execute("select count(*)cnt from locations where city=$id");

																					if ($row['cnt'] > 0)
																						alertbox("danger", "City could not be deleted");
																					else {
																						$conn->query("delete from cities where id=$id");
																						alertbox("success", "City has been deleted");
																					}
																				} ?>
                                  <h4 class="small-title">VIEW / EDIT / DELETE CITIES
                                  </h4>
                                  <div class="table-responsive" style="overflow-x:scroll;">
                                    <?php modal("City", "city") ?>
                                    <form name="filter_form" method="POST">
                                      <input type="hidden" name="deleteid" id="deleteid">
                                      <input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
                                    </form>
                                    <table class="table table-th-block table-hover">
                                      <thead>
                                        <tr>
                                          <th style="width:40px;">No.</th>
                                          <th>City</th>
                                          <th>State</th>
                                          <th>Country</th>
                                          <th>Co-ordinates</th>
                                          <th>Image / Update Image</th>
                                          <th>Edit</th>
                                          <th>Delete</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <?php $pagesize = 50;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																							$a = new pagination($base_query, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									if ($row['path'] != "")
																										$path = $row['path'];
																									else
																										$path = "booking-confirm-bannar.png";

																									if ($row['latitude'] == "" or $row['longitude'] == "")
																										$coordinates = "-";
																									else
																										$coordinates = $row['latitude'] . ", " . $row['longitude'];

																									$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='6'>No cities to display</td></tr>";
																							} ?>
                                      </tbody>
                                    </table>
                                  </div>
                                  <?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
                                </div>
                              </div>
                            </div>
                            <?php
							} else if ($_GET['Pg'] == "myhotels" and $page_access) {
								if (isset($_POST['address1'])) {
									$pwd = new Crypter('awssecret', '26457381');
									$chain = $_POST['chain'];
									$address1 = $_POST['address1'];
									$address2 = $_POST['address2'];
									$location = $_POST['location'];
									$landmark = $_POST['landmark'];
									$website = $_POST['website'];
									$regtype = $_POST['registrationtype'];

									$conn->query("update users set company='$chain',address1='$address1',address2='$address2',location='$location',landmark='$landmark', website='$website',registrationtype='$regtype' where id=$_SESSION[id]");

									/*$row = execute("select registrationcopy from users where id=$_SESSION[id]");

			if($_FILES['registrationcopy']['name']!="")
			{
				if($row['registrationcopy'] != "")
					deletefile("images/documents/stregistration/".$row['registrationcopy']);

				$conn->query("update users set registrationcopy='".saveimage("registrationcopy","images/documents/stregistration/",1200)."' where id=$_SESSION[id]");
			}*/

									if (isset($_POST['p_userids'])) {
										$p_hotels = $_POST['p_hotels'];
										$p_conpers = $_POST['p_conpers'];
										$p_usernames = $_POST['p_usernames'];
										$p_passwords = $_POST['p_passwords'];
										$p_contacts = $_POST['p_contacts'];

										foreach ($_POST['p_userids'] as $key => $p_userid) {
											$p_hotel = $p_hotels[$key];
											$p_conper = $p_conpers[$key];
											$p_email = $p_usernames[$key];
											$p_password = $p_passwords[$key];
											$p_contact = $p_contacts[$key];
											$p_bulkbooking = $_POST['p_bulkbooking' . $p_userid];

											$row = execute("select count(*)cnt from users where email='$p_email' and id<>$p_userid");

											if ($row['cnt'] == 0) {
												$conn->query("update users set company='$p_hotel',fullname='$p_conper',email='$p_email',contact='$p_contact', password='$p_password' where id=$p_userid");
											} else {
												$msg = "Email id '" . $p_email . "' is already in use.";
												$clrclass = "danger";
											}

											$conn->query("update hotels set allowbulkbooking=$p_bulkbooking where user=$p_userid");
										}
									}

									$row = execute("select count(*)cnt from hotels where admin=$_SESSION[id]");

									if ($row['cnt'] == 0 or 1) {
										$hotels = $_POST['hotel']; ///Array
										$conpers = $_POST['conper']; ///Array
										$emails = $_POST['email']; ///Array
										$passwords = $_POST['password']; ///Array
										$contacts = $_POST['contact']; ///Array
					
										foreach ($hotels as $key => $hotel) {
											$conper = $conpers[$key];
											$email = $emails[$key];
											$password = $passwords[$key];
											$contact = $contacts[$key];
											$bulkbooking = $_POST['bulkbooking' . ($key + 1)];

											if ($email != "") {
												$row = execute("select count(*)cnt from users where email='$email'");
												if ($row['cnt'] == 0) {
													if ($hotel != "" and $conper != "" and $email != "" and $password != "" and $contact != "") {
														$uid = insert("insert into users (groupid,company,fullname,email,password,contact,emailverified,mobileverified) values (2,'$hotel','$conper','$email','$password','$contact',1,1)");
														insert("insert into hotels (user,admin,allowbulkbooking) values ($uid,$_SESSION[id],$bulkbooking)");
													}
												} else {
													$msg = "Email id '" . $email . "' is already in use";
													$clrclass = "danger";
												}
											}
										}
									}
								}

								pms_info_status(); ?>
                            <div class="the-box">
                              <form method="post" name="myhotels" action="?Pg=myhotels">
                                <h4 class="small-title">HOTEL CHAIN BASIC INFO</h4>
                                <?php if ($msg == "" and isset($_POST['chain'])) {
																				$msg = "Hotel chain info updated";
																				$clrclass = "success";
																				alertbox($clrclass, $msg);
																			} else if ($msg != "") {
																				alertbox($clrclass, $msg);
																			}

																			if ($_SESSION['groupid'] == 1)
																				$uid = $_SESSION['id'];
																			else {
																				$admin = execute("select admin from hotels where id=$_SESSION[hotel]");
																				$uid = $admin['admin'];
																			}
																			$row = execute("select u.company,u.address1,u.address2,u.landmark,u.city as cityid,c.city,s.state,con.country,u.location,u.landmark,u.website,u.registrationcopy from users u left join cities c on c.id=u.city left join states s on s.id=c.state left join countries con on con.id=s.country where u.id=$uid");

																			$registrationcopy = $row['registrationcopy']; ?>
                                <div class="row">
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Hotel Chain Name</label>
                                      <input type="text" class="form-control" name="chain"
                                        value="<?= $row['company'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Address Line 1</label>
                                      <input type="text" class="form-control" name="address1"
                                        value="<?= $row['address1'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Address Line 2</label>
                                      <input type="text" class="form-control" name="address2"
                                        value="<?= $row['address2'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Locality</label>
                                      <input type="text" class="form-control" name="location"
                                        value="<?= $row['location'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Landmark</label>
                                      <input type="text" class="form-control" name="landmark"
                                        value="<?= $row['landmark'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Website</label>
                                      <input type="text" class="form-control" name="website"
                                        value="<?= $row['website'] ?>">
                                    </div>
                                  </div>
                                  <div class="col-xs-3">
                                    <div class="form-group">
                                      <label>Registration Type</label>
                                      <select name="registrationtype" class="form-control" required>
                                        <option>Hotel</option>
                                        <option>Resort</option>
                                        <option>Motel</option>
                                        <option>Bed n Breakfast</option>
                                        <option>Hostel</option>
                                        <option>Home Stay</option>
                                        <option>Service Apartment</option>
                                        <option>Bungalow</option>
                                        <option>Villa</option>
                                        <option>Lodge</option>
                                        <option>Guest House</option>
                                        <option>Other</option>
                                      </select>
                                    </div>
                                  </div>
                                  <!-- <div class="col-xs-3">
																		<div class="form-group inline-popups">
																			<label>Registration Certificate Copy</label>
																			<?php if ($registrationcopy != "") { ?>
																				<a href="#registration" style="float:right;" data-effect="mfp-zoom-in"><i class="fa fa-eye"></i></a>
																				<?php
																			} ?>
																			<div class="input-group">
																				<input type="text" class="form-control" readonly>
																				<span class="input-group-btn">
																					<span class="btn btn-default btn-file">
																						Browse...<input type="file" name="registrationcopy">
																					</span>
																				</span>
																			</div>
																		</div>
																	</div> -->
                                </div>
                                <hr>
                                <h4 class="small-title">HOTELS</h4>
                                <div class="row">
                                  <div class="col-xs-2">
                                    <label>Hotel Name</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <label>Concerned Person</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <label>Username</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <label>Password</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <label>Contact</label>
                                  </div>
                                  <div class="col-xs-2">
                                    <label title="Allow agents for bulk booking?">Allow
                                      Bulk Booking</label>
                                  </div>
                                </div>
                                <div class="row" id="newhotels">
                                  <?php $result = $conn->query("select u.id,u.company,u.fullname,u.email,u.contact,u.password,h.allowbulkbooking from users u join hotels h on u.id=h.user where h.admin=$_SESSION[id]");
																				if ($result->num_rows > 0) {
																					while ($row = $result->fetch_assoc()) { ?>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="hidden" name="p_userids[]" value="<?= $row['id'] ?>">
                                      <input type="text" class="form-control" name="p_hotels[]"
                                        value="<?= $row['company'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="p_conpers[]"
                                        value="<?= $row['fullname'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="p_usernames[]"
                                        onBlur="email_availability(this,<?= $row['id'] ?>)" value="<?= $row['email'] ?>"
                                        required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="password" class="form-control" name="p_passwords[]"
                                        value="<?= $row['password'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="p_contacts[]"
                                        value="<?= $row['contact'] ?>" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <div style="margin-left:-10px">
                                        <div class="radio-6">
                                          <input type="radio" class="form-control" name="p_bulkbooking<?= $row['id'] ?>"
                                            value="1" <?= checked(1, $row['allowbulkbooking']) ?>>Yes
                                        </div>
                                        <div class="radio-6">
                                          <input type="radio" class="form-control" name="p_bulkbooking<?= $row['id'] ?>"
                                            value="0" <?= checked(0, $row['allowbulkbooking']) ?>>No
                                        </div>
                                      </div>
                                      <div style="clear:both"></div>
                                    </div>
                                  </div>
                                  <?php
																					}
																				}
																				if ($result->num_rows > 0)
																					$lastid = "1";
																				else
																					$lastid = "2"; ?>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="hotel[]" value="">
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="conper[]" value="">
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="email[]"
                                        onBlur="email_availability(this.value,0)" value="">
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="password" class="form-control" name="password[]" value="">
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="contact[]" value="">
                                    </div>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <div style="margin-left:-10px">
                                        <div class="radio-6">
                                          <input type="radio" name="bulkbooking1" class="form-control" value="1"
                                            checked>Yes
                                        </div>
                                        <div class="radio-6">
                                          <input type="radio" name="bulkbooking1" class="form-control" value="0">No
                                        </div>
                                      </div>
                                      <div style="clear:both"></div>
                                    </div>
                                  </div>
                                  <?php if ($result->num_rows == 0) { ?>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="hotel[]" value="" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="conper[]" value="" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="email[]" value=""
                                        onBlur="email_availability(this,0)" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="password" class="form-control" name="password[]" value="" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2" style="padding-right:0px;">
                                    <div class="form-group">
                                      <input type="text" class="form-control" name="contact[]" value="" required>
                                    </div>
                                  </div>
                                  <div class="col-xs-2">
                                    <div class="form-group">
                                      <div style="margin-left:-10px">
                                        <div class="radio-6">
                                          <input type="radio" name="bulkbooking2" class="form-control" value="1"
                                            checked>Yes
                                        </div>
                                        <div class="radio-6">
                                          <input type="radio" name="bulkbooking2" class="form-control" value="0">No
                                        </div>
                                      </div>
                                      <div style="clear:both"></div>
                                    </div>
                                  </div>
                                  <?php
																				} ?>
                                </div>
                                <script type="text/javascript">
                                function email_availability(obj, id) {
                                  var ajaxRequest;

                                  try {
                                    ajaxRequest = new XMLHttpRequest();
                                  } catch (e) {
                                    try {
                                      ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
                                    } catch (e) {
                                      try {
                                        ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
                                      } catch (e) {
                                        alert("Your browser broke!");
                                        return false;
                                      }
                                    }
                                  }

                                  ajaxRequest.onreadystatechange = function() {
                                    if (ajaxRequest.readyState == 4) {
                                      var str = ajaxRequest.responseText;
                                      if (str != "1")
                                        obj.value = "Username is already used";
                                    }
                                  }
                                  ajaxRequest.open("GET", "ajaxproc.php?Pg=checkmailavailability&email=" + obj.value +
                                    "&id=" + id, true);
                                  ajaxRequest.send(null);
                                }
                                </script>
                                <div class="row" style="padding-left:10px;padding-bottom:10px;">
                                  <a href="javascript:void(0)" onClick="addhotel()">+Add more hotel(s)</a>
                                </div>
                                <div class="row" style="padding-bottom:10px;">
                                  <div class="col-xs-12">
                                    <b>Note:</b> What is bulk / group booking? We
                                    allow our Agent network to take bulk Hotel
                                    booking for big groups. If you allow bulk/group
                                    booking, we will list / show / reflect your
                                    property on our portal against such enquires
                                    from our Agents. If you select yes, you need to
                                    define maximum people allowed in each room type
                                    & rate per extra person allowed in bulk booking
                                    section while you are defining room types.
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <button type="submit" class="btn btn-primary">Save</button>
                                  </div>
                                </div>
                              </form>
                            </div>
                            <div id="registration" class="white-popup mfp-with-anim mfp-hide">
                              <img src="images/documents/stregistration/<?= $registrationcopy ?>" width="800" border="0"
                                alt="">
                            </div>
                            <input type="hidden" id="lastid" value="<?= $lastid ?>">
                            <?php
							} else if ($_GET['Pg'] == "changepassword") { ?>
                            <h1 class="page-heading">Change Password</h1>
                            <div class="col-md-6 the-box" style="padding-bottom:0px;">
                              <?php if (col('current_password') <> "") {
																			$result = $conn->query("select count(*)as cnt from users where password='" . col('current_password') . "' and fullname='" . $_SESSION['username'] . "'");
																			$row = $result->fetch_assoc();

																			if ($row['cnt'] == 1) {
																				if ($conn->query("update users set password = '" . col('new_password') . "' where fullname='" . $_SESSION['username'] . "'")) { ?>
                              <div class="alert alert-success alert-block square fade in alert-dismissable">
                                <button type="button" class="close" data-dismiss="alert"
                                  aria-hidden="true">&times;</button>
                                <p>Your password has been successfully changed</p>
                              </div>
                              <?php
																				}
																			} else { ?>
                              <div class="alert alert-danger alert-block square fade in alert-dismissable">
                                <button type="button" class="close" data-dismiss="alert"
                                  aria-hidden="true">&times;</button>
                                <p><strong>Error!</strong></p>
                                <p>Current password was incorect. Password has not been
                                  changed.</p>
                              </div>
                              <?php
																			}
																		} ?>
                              <form method="post" action="?Pg=changepassword" onSubmit="return changepwd()">
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="input50">ENTER CURRENT PASSWORD
                                    </div>
                                    <input type="password" class="form-control input50" id="cp" name="current_password"
                                      autocomplete="off">
                                  </div>
                                </div><br>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group">
                                      <div class="input50">ENTER NEW PASSWORD
                                      </div>
                                      <input type="password" class="form-control input50" id="np1" name="new_password"
                                        autocomplete="off">
                                    </div>
                                  </div>
                                </div><br>
                                <div class="row">
                                  <div class="col-md-12">
                                    <div class="form-group">
                                      <div class="input50">RE-ENTER NEW PASSWORD
                                      </div>
                                      <input type="password" class="form-control input50" id="np2" autocomplete="off">
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-sm-12">
                                    <div class="form-group">
                                      <button type="submit"
                                        class="btn btn-primary">&nbsp;&nbsp;Save&nbsp;&nbsp;</button>
                                    </div>
                                  </div>
                                </div>
                              </form>
                            </div>

                            <?php							
														} else if ($_GET['Pg'] == "view_bulkroom") {

															$perPage = 25;             // < change to taste
															$page    = isset($_GET['p']) && $_GET['p'] > 0 ? (int)$_GET['p'] : 1;
															$offset  = ($page - 1) * $perPage;
															?>
																<h1 class="page-heading">Blocked Room List</h1>

																<div class="the-box">
																	<h4 class="small-title">Blockedroom list</h4>
																	<?php

																	$filters = [];                 // SQL fragments well join with AND
																	$params  = [];                 // For rebuilding querystring links
																	$hotel_id = (int) $_SESSION['hotel'];   // always cast session values

																	//  Date filter (single date OR range)
																	if (!empty($_GET['f_date'])) {
																		$d = DateTime::createFromFormat('d-m-Y', $_GET['f_date']);
																		if ($d) {
																			$f_date = $conn->real_escape_string($d->format('Y-m-d'));
																			$filters[] = "br.bdate = '$f_date'";
																			$params['f_date'] = $_GET['f_date'];
																		}
																	}
																	if (!empty($_GET['f_from']) && !empty($_GET['f_to'])) {
																		$d1 = DateTime::createFromFormat('d-m-Y', $_GET['f_from']);
																		$d2 = DateTime::createFromFormat('d-m-Y', $_GET['f_to']);
																		if ($d1 && $d2) {
																			$from = $conn->real_escape_string($d1->format('Y-m-d'));
																			$to   = $conn->real_escape_string($d2->format('Y-m-d'));
																			$filters[] = "br.bdate BETWEEN '$from' AND '$to'";
																			$params['f_from'] = $_GET['f_from'];
																			$params['f_to']   = $_GET['f_to'];
																		}
																	}

																	//  Roomtype filter (by id or name fragment)
																	if (!empty($_GET['f_roomtype'])) {
																		$rt = $conn->real_escape_string(strtolower($_GET['f_roomtype']));
																		$filters[] = "(LOWER(rt.roomtype) LIKE '%$rt%')";
																		$params['f_roomtype'] = $_GET['f_roomtype'];
																	}

																	//  Only rows withspecial rate checkbox
																	if (isset($_GET['f_hasrate']) && $_GET['f_hasrate'] === '1') {
																		$filters[] = "sr.rate IS NOT NULL";
																		$params['f_hasrate'] = 1;
																	}

																	/* ---------- 2.  Pagination setup ---------------------------------------- */

																	$perPage = 25;
																	$page    = isset($_GET['p']) && $_GET['p'] > 0 ? (int)$_GET['p'] : 1;
																	$offset  = ($page - 1) * $perPage;

																	/* ---------- 3.  Build the base query ------------------------------------ */

																	$where  = "rt.hotel = $hotel_id";
																	if ($filters) $where .= ' AND ' . implode(' AND ', $filters);

																	$baseQuery = "
  FROM blocked_roomnumbers br
  JOIN roomnumbers  rn ON rn.id = br.roomnumber
  JOIN roomtypes    rt ON rt.id = rn.roomtype
  LEFT JOIN special_rates sr ON sr.roomtype = rt.id AND sr.rdate = br.bdate
  WHERE $where
";

																	/* ---------- 4.  Get paged records --------------------------------------- */

																	$sql = "
  SELECT 
      br.bdate,
      rt.roomtype,
      sr.rate,
      GROUP_CONCAT(rn.roomnumber ORDER BY rn.roomnumber SEPARATOR ', ') AS rooms,
      GROUP_CONCAT(br.id ORDER BY rn.roomnumber SEPARATOR ',')          AS block_ids,
      COUNT(*)                                                          AS num_rooms
  $baseQuery
  GROUP BY br.bdate, rt.roomtype
  ORDER BY br.bdate DESC, rt.roomtype
  LIMIT  $perPage
  OFFSET $offset
";

																	$res = $conn->query($sql);

																	/* ---------- 5.  Total rows for pagination ------------------------------- */

																	$countSql  = "SELECT COUNT(*) AS total FROM (SELECT 1 $baseQuery GROUP BY br.bdate, rt.roomtype) x";
																	$totalRows = (int)$conn->query($countSql)->fetch_assoc()['total'];
																	$totalPages = (int)ceil($totalRows / $perPage);

																	/* ---------- 6.  Little helper to rebuild links -------------------------- */

																	function linkWithParams(array $params, $page)
																	{
																		$params['p'] = $page;
																		return '?Pg=view_bulkroom&' . http_build_query($params);
																	}
																	?>
																	<form class="form-inline mb-2" method="get" action="">
																		<input type="hidden" name="Pg" value="view_bulkroom">
																		<input type="hidden" name="p" value="1"><!-- reset page on new search -->

																		<div class="form-group mr-2">
																			<label class="sr-only">Date</label>
																			<input type="text" name="f_date" class="form-control" placeholder="dd-mm-yyyy"
																				value="<?= htmlspecialchars($_GET['f_date'] ?? '') ?>">
																		</div>

																		<div class="form-group mr-2">
																			<label class="sr-only">Roomtype</label>
																			<input type="text" name="f_roomtype" class="form-control" placeholder="Room type"
																				value="<?= htmlspecialchars($_GET['f_roomtype'] ?? '') ?>">
																		</div>

																		<div class="form-group form-check mr-2">
																			<input type="checkbox" name="f_hasrate" value="1" class="form-check-input"
																				<?= isset($_GET['f_hasrate']) ? 'checked' : '' ?>>
																			<label class="form-check-label">only rows with rate</label>
																		</div>

																		<button class="btn btn-primary btn-sm">Filter</button>
																		<a href="?Pg=view_bulkroom" class="btn btn-secondary btn-sm ml-1">Reset</a>
																	</form>


																	<form id="bulkUnblockForm" method="post" action="bookingajax.php">
																		<input type="hidden" name="post_action" value="unblock_many">

																		<div class="table-responsive">
																			<table class="table table-bordered table-striped" id="blocked-table">
																				<thead>
																					<tr>
																						<th style="width:40px"><input type="checkbox" id="chkAll"></th>
																						<th>Date</th>
																						<th>Room&nbsp;Type</th>
																						<th>Rate</th>
																						<th>Blocked&nbsp;Rooms</th>
																						<th style="width:90px">Action</th>
																					</tr>
																				</thead>
																				<tbody>
																					<?php while ($r = $res->fetch_assoc()) { ?>
																						<tr id="row<?= md5($r['block_ids']) ?>">
																							<td class="text-center">
																								<input type="checkbox" name="block_ids[]" value="<?= $r['block_ids'] ?>" class="chkRow">
																							</td>

																							<td><?= date('d-m-Y', strtotime($r['bdate'])) ?></td>
																							<td><?= htmlspecialchars($r['roomtype']) ?></td>
																							<td><?= $r['rate'] ?? '<span class="text-muted">No rate</span>' ?></td>

																							<!-- modal trigger -->
																							<td>
																								<a href="#" class="show-rooms btn btn-xs btn-info"
																									data-rooms="<?= htmlspecialchars($r['rooms']) ?>"
																									data-date="<?= $r['bdate'] ?>"
																									data-rt="<?= htmlspecialchars($r['roomtype']) ?>">
																									show&nbsp;(<?= $r['num_rooms'] ?>)
																								</a>
																							</td>

																							<td class="text-center">
																								<button type="button"
																									class="btn btn-xs btn-danger single-unblock"
																									data-ids="<?= $r['block_ids'] ?>">
																									Unblock
																								</button>
																							</td>
																						</tr>
																					<?php } ?>
																				</tbody>
																			</table>
																		</div>
																		<!-- Modal -->
																		<div class="modal fade" id="roomsModal" tabindex="-1" role="dialog" aria-labelledby="roomsModalLabel" aria-hidden="true">
																			<div class="modal-dialog">
																				<div class="modal-content">
																					<div class="modal-header">
																						<h4 class="modal-title" id="roomsModalLabel">Blocked Rooms</h4>
																						<button type="button" class="close" data-dismiss="modal">&times;</button>
																					</div>
																					<div class="modal-body text-center" id="roomsModalBody"></div>
																				</div>
																			</div>
																		</div>

																		<script>
																			$(document).ready(function() {
																				$('.show-rooms').click(function(e) {
																					e.preventDefault();

																					const rooms = $(this).data('rooms');
																					const date = $(this).data('date');
																					const rt = $(this).data('rt');

																					$('#roomsModalLabel').text(`Blocked Rooms for ${rt} on ${date}`);
																					$('#roomsModalBody').html(`<strong>${rooms}</strong>`);

																					$('#roomsModal').modal('show');
																				});
																			});
																		</script>

																		<?php if ($totalPages > 1): ?>
																			<nav aria-label="Blockedroom pages">
																				<ul class="pagination">
																					<?php
																					// previous
																					$prev = $page - 1;
																					echo '<li class="page-item ' . ($prev < 1 ? 'disabled' : '') . '">
                <a class="page-link" href="' . ($prev < 1 ? '#' : linkWithParams($params, $prev)) . '">&laquo;</a>
              </li>';

																					// window 2
																					for ($i = max(1, $page - 2); $i <= min($totalPages, $page + 2); $i++) {
																						echo '<li class="page-item ' . ($i == $page ? 'active' : '') . '">
                    <a class="page-link" href="' . linkWithParams($params, $i) . '">' . $i . '</a>
                  </li>';
																					}

																					// next
																					$next = $page + 1;
																					echo '<li class="page-item ' . ($next > $totalPages ? 'disabled' : '') . '">
                <a class="page-link" href="' . ($next > $totalPages ? '#' : linkWithParams($params, $next)) . '">&raquo;</a>
              </li>';
																					?>
																				</ul>
																			</nav>
																		<?php endif; ?>


																		<button type="submit" class="btn btn-warning btn-sm">
																			Unblock&nbsp;Selected
																		</button>
																	</form>
																	<div class="modal fade" id="roomsModal" tabindex="-1">
																		<div class="modal-dialog">
																			<div class="modal-content">
																				<div class="modal-header">
																					<h4 class="modal-title">Blocked rooms</h4>
																					<button type="button" class="close" data-dismiss="modal">&times;</button>
																				</div>
																				<div class="modal-body text-center"></div>
																			</div>
																		</div>
																	</div>
																</div>
																<script>
																	$(document).ready(function() {
																		// Unblock selected rows
																		$('#bulkUnblockForm').submit(function(e) {
																			e.preventDefault();
																			if (!confirm("Are you sure you want to unblock selected rooms?")) return;

																			$.post('bookingajax.php', $(this).serialize(), function(response) {
																				let res = JSON.parse(response);
																				if (res.status === 'success') {
																					alert(res.deleted + ' blocked room(s) unblocked.');
																					location.reload();
																				} else {
																					alert(res.message || 'Unblock failed.');
																				}
																			});
																		});

																		// Single unblock button
																		$('.single-unblock').click(function() {
																			if (!confirm("Unblock these rooms?")) return;

																			let ids = $(this).data('ids');
																			let rowId = '#row' + md5(ids); // optional: fade out row

																			$.post('bookingajax.php', {
																				post_action: 'unblock_single',
																				block_ids: ids
																			}, function(response) {
																				let res = JSON.parse(response);
																				if (res.status === 'success') {
																					alert('Unblocked successfully.');
																					location.reload();
																				} else {
																					alert(res.message || 'Unblock failed.');
																				}
																			});
																		});

																		// optional helper for md5 simulation if needed
																		function md5(str) {
																			// you can skip this if row ID isn't tied to md5
																			return str;
																		}
																	});
																</script>


															<?php }
               else if ($_GET['Pg'] == "multiple_room_blocking") {
								if (!empty($_POST)) {
									//echo "<pre>".print_r($_POST,true)."</pre>";
					
									$update = $_POST['update'];
									$fdate = $_POST['fdate'];
									$tdate = $_POST['tdate'];
									$roomtypes = $_POST['roomtypes'];
									$roomnumbers = $_POST['roomnumbers'];

									$fd = date_create($fdate);
									$td = date_create($tdate);

									if (($update == "rooms" or $update == "roomnprices") and 1) {
										if (!empty($roomnumbers)) {
											while ($fd <= $td) {
												foreach ($roomnumbers as $key => $roomnumber) {
													$row = execute("select count(*)cnt from blocked_roomnumbers where roomnumber=$roomnumber and bdate='" . $fd->format("Y-m-d") . "'");

													if (!$row['cnt'])
														$conn->query("insert into blocked_roomnumbers (roomnumber,bdate) values ($roomnumber,'" . $fd->format("Y-m-d") . "')");
												}
												$fd->modify("+1 days");
											}

											$fd = date_create($fdate);
										}
									}

									if (($update == "prices" or $update == "roomnprices") and 1) {
										if (!empty($roomtypes)) {
											while ($fd <= $td) {
												foreach ($roomtypes as $key => $roomtype) {
													$row = execute("select count(*)cnt from special_rates where roomtype=$roomtype and rdate='" . $fd->format("Y-m-d") . "'");

													if (!$row['cnt'])
														$conn->query("insert into special_rates (rpid,roomtype,rdate,rate) values (0,$roomtype,'" . $fd->format("Y-m-d") . "'," . $_POST['fdt' . $roomtype] . ")");
													else
														$conn->query("update special_rates set rate=" . $_POST['fdt' . $roomtype] . " where roomtype=$roomtype and rdate='" . $fd->format("Y-m-d") . "'");
												}
												$fd->modify("+1 days");
											}
										}
									}

									alertbox("success", "Room details have been updated successfully.");
								} ?>

                            <form method="post" action="">
                              <div class="row form-group">
                                <div class="col-xs-2">
                                  <input type="radio" name="update" value="rooms" checked>Block rooms
                                </div>
                                <div class="col-xs-2">
                                  <input type="radio" name="update" value="prices">Update prices
                                </div>
                                <div class="col-xs-3">
                                  <input type="radio" name="update" value="roomnprices">Block rooms & update prices
                                </div>
                                <div class="col-xs-5">&nbsp;</div>
                              </div>
                              <div class="row">
                                <div class="col-xs-12">
                                  <label>Date Range</label>
                                  <div class="row form-group">
                                    <div class="col-xs-2">
                                      <label>Start Date</label>
                                      <input type="text" name="fdate" data-date-format="dd-mm-yyyy"
                                        class="form-control datepicker" autocomplete="off" required>
                                    </div>
                                    <div class="col-xs-2">
                                      <label>End Date</label>
                                      <input type="text" name="tdate" data-date-format="dd-mm-yyyy"
                                        class="form-control datepicker" autocomplete="off" required>
                                    </div>
                                    <div class="col-xs-8">&nbsp;</div>
                                  </div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="mason" data-columns>
                                  <?php $result = $conn->query("select id,roomtype,fulldaytariff from roomtypes where hotel=$_SESSION[hotel]");
																				while ($row = $result->fetch_assoc()) { ?>
                                  <div class="item">
                                    <div class="the-box no-border no-margin">
                                      <div class="row">
                                        <div class="col-xs-12">
                                          <div class="form-group">
                                            <input type="checkbox" id="rt<?= $row['id'] ?>"
                                              onChange="select_room_numbers(<?= $row['id'] ?>)" name="roomtypes[]"
                                              checked value="<?= $row['id'] ?>"><b><?= $row['roomtype'] ?></b>
                                          </div>
                                        </div>
                                        <div class="col-xs-6 form-group">
                                          Fullday tariff
                                        </div>
                                        <div class="col-xs-6 form-group">
                                          <input type="number" id="fdt<?= $row['id'] ?>" style="text-align:right"
                                            class="form-control" name="fdt<?= $row['id'] ?>"
                                            value="<?= $row['fulldaytariff'] ?>" required>
                                        </div>
                                        <div class="col-xs-12">
                                          Room No.s
                                        </div>
                                        <?php $i = 0;
																								$rs = $conn->query("select id,roomnumber from roomnumbers where roomtype=$row[id] and deleted=0");
																								while ($rs_row = $rs->fetch_assoc()) { ?>
                                        <div class="col-xs-12">
                                          <input type="checkbox" class="form-control" id="r<?= $row['id'] ?>_<?= $i ?>"
                                            name="roomnumbers[]" value="<?= $rs_row['id'] ?>"
                                            checked><?= $rs_row['roomnumber'] ?>
                                        </div>
                                        <?php $i++;
																								} ?>
                                      </div>
                                    </div>
                                  </div>
                                  <?php
																				} ?>
                                  <script type="text/javascript">
                                  function select_room_numbers(rt) {
                                    var i = 0;

                                    if (document.getElementById("rt" + rt).checked) {
                                      document.getElementById("fdt" + rt).disabled = false;
                                      while (document.getElementById("r" + rt + "_" + i)) {
                                        document.getElementById("r" + rt + "_" + i).disabled = false;
                                        document.getElementById("r" + rt + "_" + i).checked = true;
                                        i++;
                                      }
                                    } else {
                                      document.getElementById("fdt" + rt).disabled = true;
                                      while (document.getElementById("r" + rt + "_" + i)) {
                                        document.getElementById("r" + rt + "_" + i).disabled = true;
                                        document.getElementById("r" + rt + "_" + i).checked = false;
                                        i++;
                                      }
                                    }
                                  }
                                  </script>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-xs-12">
                                  <input type="submit" class="btn btn-primary" value="Update">
                                </div>
                              </div>
                            </form>
                            <?php
							}
							/////////////// SUSHANT's CODE STARTS HERE//////////////////////////
							else if ($_GET['Pg'] == "invoicesetup" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
                            <h1 class="page-heading">INVOICE SETUP</h1>
                            <div id="messageBox-setupinvoice"></div>
                            <script>
                            function showMessageBoxsetup(content, type) {
                              const messageBox = document.getElementById('messageBox-setupinvoice');

                              // Determine the alert class based on the type parameter
                              let alertClass;
                              switch (type) {
                                case 'success':
                                  alertClass = 'alert-success';
                                  break;
                                case 'error':
                                  alertClass = 'alert-danger';
                                  break;
                                case 'warning':
                                  alertClass = 'alert-warning';
                                  break;
                                default:
                                  alertClass = 'alert-info';
                              }

                              // Populate the messageBox with the content and appropriate styling
                              messageBox.innerHTML = `
																	<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:125px; right:34px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
																		<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
																		<p style="width:90%;">${content}</p>
																	</div>`;

                              // Show the message box
                              messageBox.style.display = "block";

                              // Automatically hide the message box after 4 seconds
                              setTimeout(() => {
                                messageBox.style.display = "none";
                              }, 4000);
                            }
                            </script>
                            <div class="row" style="margin-left:0px;margin-right:0px;>
																			<?php
																			$row = execute("select isgst,state,start_invoice_no,invoice_prefix,signature_label,bank_detail,account_no,branch_detail,ifsc,upi_id,gstin_no from invoice_setup where hotel='$_SESSION[hotel]'");

																			$checkValue = $row['signature_label'];
																			$isgst = $row['isgst'] ? 'checked' : '';
																			$gstindisplay = $row['isgst'] ? 'block' : 'none';

																			?>
																																																				<div class=" col-sm-12">
                              <div class="the-box" style="display: flex;  ">
                                <div class="form" style="width: 50%">
                                  <form action="" style="display: flex; flex-direction: column">
                                    <div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">Start Invoice
                                          No.</label>
                                        <input type="number" name="start_invoice_no" class="form-control"
                                          id="validationCustom05" required value="<?= $row['start_invoice_no'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">Invoice
                                          Prefix</label>
                                        <input type="text" name="invoice_prefix" class="form-control"
                                          id="validationCustom05" required value="<?= $row['invoice_prefix'] ?>">
                                      </div>
                                    </div>
                                    <div class="col-md-1"
                                      style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px; margin-top: 10px">
                                      <label for="validationCustom05" class="form-label">Signatory
                                        Label</label>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios1" value="proprietor" checked>
                                        <label class="form-check-label" for="exampleRadios1">
                                          Proprietor
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios2" value="partners">
                                        <label class="form-check-label" for="exampleRadios2">
                                          Partners
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios3" value="proprietorDirectors">
                                        <label class="form-check-label" for="exampleRadios3">
                                          ProprietorDirectors
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios4" value="director">
                                        <label class="form-check-label" for="exampleRadios4">
                                          Director
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios5" value="directors">
                                        <label class="form-check-label" for="exampleRadios5">
                                          Directors
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios6" value="trustee">
                                        <label class="form-check-label" for="exampleRadios6">
                                          Trustee
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios7" value="trustees">
                                        <label class="form-check-label" for="exampleRadios7">
                                          Trustees
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios8" value="authorisedSignatory">
                                        <label class="form-check-label" for="exampleRadios8">
                                          Authorised Signatory
                                        </label>
                                      </div>
                                      <div class="form-check">
                                        <input class="form-check-input" type="radio" name="exampleRadios"
                                          id="exampleRadios9" value="authorisedSignatories">
                                        <label class="form-check-label" for="exampleRadios9">
                                          Authorised Signatories
                                        </label>
                                      </div>
                                    </div>


                                    <div style="margin-top: 10px">

                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">Bank
                                          Deatils</label>
                                        <input type="text" name="bank_details" class="form-control"
                                          id="validationCustom05" required value="<?= $row['bank_detail'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">A/C
                                          No.</label>
                                        <input type="text" name="account_no" class="form-control"
                                          id="validationCustom05" required value="<?= $row['account_no'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">Branch
                                          Details</label>
                                        <input type="text" name="branch_details" class="form-control"
                                          id="validationCustom05" required value="<?= $row['branch_detail'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">IFSC</label>
                                        <input type="text" name="ifsc" class="form-control" id="validationCustom05"
                                          required value="<?= $row['ifsc'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">UPI
                                          ID</label>
                                        <input type="text" name="upi_id" class="form-control" id="validationCustom05"
                                          required value="<?= $row['upi_id'] ?>">
                                      </div>
                                      <div class="col-md-1"
                                        style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
                                        <label for="validationCustom05" class="form-label">State</label>
                                        <select name="state" id="state" class="form-control">
                                          <option value="">State</option>
                                          <?php
																										$states = $conn->query("select state,id from states where country=104");

																										while ($row1 = $states->fetch_assoc()) {
																											if ($row['state'] == $row1['id']) {
																												$selected = 'selected';
																											} else {
																												$selected = '';
																											}
																											?>
                                          <option value="<?= $row1['id'] ?>" <?= $selected ?>>
                                            <?= $row1['state'] ?>
                                          </option>
                                          <?php } ?>
                                        </select>
                                      </div>

																																																									<<<<<<< HEAD <div id="gstinInputDiv"
																																																										class="col-md-1"
																																																										style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px; display:<?= $gstindisplay ?>;">
																																																										<label for="validationCustom05"
																																																											class="form-label">GSTIN
																																																											No.</label>
																																																										<input type="text" name="gstin_no"
																																																											class="form-control"
																																																											id="validationCustom05" required
																																																											value="<?= $row['gstin_no'] ?>">
																																																								</div>
																																																						</div>
																																																						<div>
																																																							<label style="margin: 7px; ">
																																																								<input <?= $isgst ?>id="areYouCheckbox"
																																																									style="height: 14px; margin: 2px; "
																																																									type="checkbox" id="areYouCheckbox"
																																																									onchange="toggleGSTInput()">
																																																								Enable GST for tax invoice
																																																							</label>
																																																						</div>
																																																						=======
																																																						<div id="gstinInputDiv" class="col-md-1"
																																																							style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px; display:<?= $gstindisplay ?>;">
																																																							<label for="validationCustom05"
																																																								class="form-label">GSTIN No.</label>
																																																							<input type="text" name="gstin_no"
																																																								class="form-control" id="validationCustom05"
																																																								required value="<?= $row['gstin_no'] ?>">
																																																						</div>
																																																					</div>
																																																					<div>
																																																						<label style="margin: 7px; ">
																																																							<input <?= $isgst ?> id="areYouCheckbox"
																																																								style="height: 14px; margin: 2px; "
																																																								type="checkbox" id="areYouCheckbox"
																																																								onchange="toggleGSTInput()">
																																																							Enable GST for tax invoice
																																																						</label>
																																																					</div>
																																																					>>>>>>> d5c2e5fc7986b2c50177deab97ae912f365bbde2

																																																					<div class="submit-button" style="margin: 8px">
																																																						<a class="btn available"
																																																							onclick="updateInvoiceSetup('<?= $_SESSION['hotel'] ?>')">Submit</a>
																																																					</div>
																																																					</form>

																																																				</div>
																																																				<div class="invoiceimg" style="text-align: center">
																																																					<label for="">Invoice Sample</label>
																																																					<img src="invoice_preview.png" alt="">
																																																				</div>

																																																				<script>
																																																					function toggleGSTInput() {
																																																						const checkbox = document.getElementById('areYouCheckbox');
																																																						const gstinInputDiv = document.getElementById('gstinInputDiv');

																																																						if (checkbox.checked) {
																																																							gstinInputDiv.style.display = 'block'; // Show the input field
																																																						} else {
																																																							gstinInputDiv.style.display = 'none'; // Hide the input field
																																																						}
																																																					}

																																																					function updateInvoiceSetup(hotel) {
																																																						console.log("mdlkskncksnmkcxksl kdncisc k ")
																																																						let start_invoice_no = document.querySelector('input[name="start_invoice_no"]').value;
																																																						let invoice_prefix = document.querySelector('input[name="invoice_prefix"]').value;
																																																						let bank_details = document.querySelector('input[name="bank_details"]').value;
																																																						let account_no = document.querySelector('input[name="account_no"]').value;
																																																						let branch_details = document.querySelector('input[name="branch_details"]').value;
																																																						let ifsc = document.querySelector('input[name="ifsc"]').value;
																																																						let upi_id = document.querySelector('input[name="upi_id"]').value;
																																																						let gstin_no = document.querySelector('input[name="gstin_no"]').value;
																																																						let isgst = 1;
																																																						const signatory_label = document.querySelector('input[name="exampleRadios"]:checked').value;
																																																						const stateDropdown = document.getElementById('state').value;


																																																						const checkbox = document.getElementById('areYouCheckbox');
																																																						if (!checkbox.checked) {
																																																							gstin_no = ''
																																																							isgst = 0
																																																						}


																																																						// Check if any field is empty
																																																						if (!start_invoice_no) {
																																																							showMessageBoxsetup("Start Invoice Number is required", "warning");
																																																							return false;
																																																						}

																																																						if (!invoice_prefix) {
																																																							showMessageBoxsetup("Invoice Prefix is required", "warning");
																																																							return false;
																																																						}

																																																						if (!bank_details) {
																																																							showMessageBoxsetup("Bank Details are required", "warning");
																																																							return false;
																																																						}

																																																						if (!account_no) {
																																																							showMessageBoxsetup("Account Number is required", "warning");
																																																							return false;
																																																						}

																																																						// Validate Account Number length
																																																						if (account_no.length < 9) {
																																																							showMessageBoxsetup("Account Number must be at least 9 digits long", "warning");
																																																							return false;
																																																						}

																																																						if (!branch_details) {
																																																							showMessageBoxsetup("Branch Details are required", "warning");
																																																							return false;
																																																						}

																																																						if (!ifsc) {
																																																							showMessageBoxsetup("IFSC Code is required", "warning");
																																																							return false;
																																																						}


																																																						if (!upi_id) {
																																																							showMessageBoxsetup("UPI ID is required", "warning");
																																																							return false;
																																																						}

																																																						if (isgst && !gstin_no) {
																																																							showMessageBoxsetup("GSTIN Number is required", "warning");
																																																							return false;
																																																						}



																																																						// Validate that a signatory label is selected
																																																						if (!signatory_label) {
																																																							showMessageBoxsetup("Please select a signatory label", "warning");
																																																							return false;
																																																						}

																																																						console.log('sjjsj');


																																																						$.ajax({
																																																							type: 'POST',
																																																							url: 'bookingajax.php',
																																																							data: {
																																																								action: "setup_invoice",
																																																								start_invoice_no: start_invoice_no,
																																																								invoice_prefix: invoice_prefix,
																																																								bank_details: bank_details,
																																																								account_no: account_no,
																																																								branch_details: branch_details,
																																																								ifsc: ifsc,
																																																								upi_id: upi_id,
																																																								gstin_no: gstin_no,
																																																								isgst: isgst,
																																																								signatory_label: signatory_label,
																																																								state: stateDropdown,
																																																								hotel: hotel,
																																																								user: <?= $_SESSION['id'] ?>
																																																							},
																																																							success: function (response) {
																																																								res = JSON.parse(response)
																																																								location.reload()
																																																							},
																																																							error: function (err) {
																																																								console.log('err', err);
																																																							}
																																																						});

																																																					}
																																																				</script>

																																																				<script>
																																																					document.addEventListener('DOMContentLoaded', function () {
																																																						// PHP variable output
																																																						const checkValue = "<?= $checkValue ?>"; // Ensure PHP variable is properly output in JavaScript

																																																						// Function to select the appropriate radio button
																																																						function selectRadioBasedOnValue(value) {
																																																							const radios = document.querySelectorAll('input[name="exampleRadios"]');
																																																							let found = false;

																																																							radios.forEach(radio => {
																																																								if (radio.value === value) {
																																																									radio.checked = true;
																																																									found = true;
																																																								}
																																																							});

																																																							// If no matching value is found, select the first radio button
																																																							if (!found) {
																																																								radios[0].checked = true;
																																																							}
																																																						}

																																																						// Call the function with the value from the database
																																																						selectRadioBasedOnValue(checkValue);
																																																					});
																																																				</script>


																																																			</div>
																																																		</div>
																																																	</div>

															<?php
							                                                                      }  else if ($_GET['Pg'] == "registerhotel" and $page_access) {
															if ($_SESSION['hotel'] > 0)
																pms_info_status(); ?>
																<h1 class="page-heading">Register Hotel</h1>
																<div id="messageBox-registerhotel"></div>
																<script>
																	function showMessageBoxregisterhotel(content, type) {
																		const messageBox = document.getElementById('messageBox-registerhotel');

																		// Determine the alert class based on the type parameter
																		let alertClass;
																		switch (type) {
																			case 'success':
																				alertClass = 'alert-success';
																				break;
																			case 'error':
																				alertClass = 'alert-danger';
																				break;
																			case 'warning':
																				alertClass = 'alert-warning';
																				break;
																			default:
																				alertClass = 'alert-info';
																		}

																		// Populate the messageBox with the content and appropriate styling
																		messageBox.innerHTML = `
														<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:125px; right:34px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
															<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
															<p style="width:90%;">${content}</p>
														</div>`;

																		// Show the message box
																		messageBox.style.display = "block";

																		// Automatically hide the message box after 4 seconds
																		setTimeout(() => {
																			messageBox.style.display = "none";
																		}, 4000);
																	}
																</script>
																<div class="row">
																	<?php
																	$row = execute("select start_invoice_no,invoice_prefix,signature_label,bank_detail,account_no,branch_detail,ifsc,upi_id,gstin_no from invoice_setup where hotel='$_SESSION[hotel]'");

																	$checkValue = $row['signature_label'];
																	$states = $conn->query("select state,id from states where country=104");

																	?>

																	<div class="col-sm-12">
																		<div class="the-box" style="display: flex; ">
																			<form style="display: flex; flex-direction: column; width: 720px;  gap: 25px;" id="registerhotelid">
																				<div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="username" class="form-label">Full name</label>
																						<input type="text" name="username" class="form-control" id="username" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="email" class="form-label">Email Address</label>
																						<input type="email" name="email" class="form-control" id="email" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="phone_number" class="form-label">Phone Number</label>
																						<input type="number" name="phone_number" class="form-control" id="phone_number" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="hotelname" class="form-label">Hotel Name</label>
																						<input type="text" name="hotelname" class="form-control" id="hotelname" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="hoteltype" class="form-label">Hotel Type</label>
																						<select name="hoteltype" id="hoteltype" class="form-control" required>
																							<option selected value="hotel">Single Hotel</option>
																							<option value="chain">Multi Chain Hotel</option>
																						</select>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="address" class="form-label">Address</label>
																						<input type="text" name="address" class="form-control" id="address" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="state" class="form-label">State</label>
																						<select name="state" id="state" class="form-control" required onchange="fetchCities()">
																							<option value="">State</option>
																							<?php
																							while ($row = $states->fetch_assoc()) {
																								if ($row['id'] == '15') {
																									$selected = 'selected';
																								} else {
																									$selected = '';
																								}
																							?>
																								<option value="<?= $row['id'] ?>" <?= $selected ?>><?= $row['state'] ?></option>
																							<?php } ?>
																						</select>
																					</div>

																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="city" class="form-label">City</label>
																						<select name="city" id="city" class="form-control" required>
																							<option value="">Select City</option>
																						</select>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="password" class="form-label">Password</label>
																						<input type="password" name="password" class="form-control" id="password" required>
																					</div>
																					<div class="col-md-1" style="flex: 1; min-width: 250px; margin-right: 0px; padding-right: 0px; padding-left: 7px">
																						<label for="retype_password" class="form-label">Confirm Password</label>
																						<input type="password" name="retype_password" class="form-control" id="retype_password" required>
																					</div>
																				</div>

																				<div class="submit-button" style="margin: 8px; width: 492px;">
																					<a class="btn available" onclick="Registerhotel()" style="float: right;">Submit</a>
																				</div>
																			</form>
																		</div>
																	</div>
																</div>
																<script>
																	async function fetchCities() {
																		const stateId = document.getElementById('state').value;

																		if (stateId) {
																			try {
																				const response = await fetch('bookingajax.php?stateid=' + stateId);
																				const cities = await response.json();

																				const cityDropdown = document.getElementById('city');
																				cityDropdown.innerHTML = '<option value="">Select City</option>';

																				cities.data.forEach(function(city) {
																					const option = document.createElement('option');
																					option.value = city.id;
																					option.text = city.city;
																					cityDropdown.add(option);
																				});
																			} catch (error) {
																				console.error('Error fetching cities:', error);
																			}
																		}
																	}
																	window.onload = function() {
																		const stateDropdown = document.getElementById('state');
																		if (stateDropdown.value) {
																			fetchCities(); // Populate cities if a state is pre-selected
																		}
																	};
																</script>
																<script>
																	function Registerhotel() {
																		const form = document.getElementById('registerhotelid');
																		const username = form.querySelector('input[name="username"]').value;
																		const email = form.querySelector('input[name="email"]').value;
																		const phoneNumber = form.querySelector('input[name="phone_number"]').value;
																		const hotelname = form.querySelector('input[name="hotelname"]').value;
																		const address = form.querySelector('input[name="address"]').value;
																		const password = form.querySelector('input[name="password"]').value;
																		const retypePassword = form.querySelector('input[name="retype_password"]').value;

																		// Collect selected state value
																		const state = form.querySelector('select[name="state"]').value;

																		const city = form.querySelector('select[name="city"]').value;

																		const hoteltype = form.querySelector('select[name="hoteltype"]').value;

																		// Log all values

																		$.ajax({
																			type: 'POST',
																			url: 'bookingajax.php',
																			data: {
																				usernamep: username,
																				mobilep: phoneNumber,
																				agencyp: hoteltype,
																				passwordp: password,
																				emailp: email,
																				hotelp: hotelname,
																				addressp: address,
																				cityp: city,
																				action: 'register_hotel'
																			},
																			success: function(response) {
																				let res = JSON.parse(response);
																				console.log(res);
																				// location.reload()
																				if (res.status == "fail") {
																					showMessageBoxregisterhotel(res.message, "error")
																				} else {
																					showMessageBoxregisterhotel(res.message, "success");
																					// location.reload();
																				}
																				// showMessageBoxadditionalservice("Service Deleted", "success")
																				// Handle response
																				// You can display a success or failure message here based on the result
																			}
																		});
																	}
																</script>

															<?php
																} else if ($_GET['Pg'] == "admin_gst_report" and $page_access) { ?>
															<h1 class="page-heading">GST & Invoices</h1>
															<!-- <h1 class="page-heading">GST Report</h1> -->
															<div class="the-box">
																<h4 class="small-title">View Report</h4>
																<div class="table-responsive">
																	<form name="filter_form" method="POST" action="?Pg=<?= $_GET['Pg'] ?>">
																		<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																			<div class="btn-group" style="width:70px">
																				<label>Invoice</label>
																				<input type="text" class="form-control" name="f_invoice" placeholder="Invoice" value="<?= col("f_invoice") ?>">
																			</div>
																			<div class="btn-group" style="width:180px">
																				<label>Company name</label>
																				<input type="text" class="form-control" name="f_payer" placeholder="Payer Name / Email / Contact" value="<?= col("f_payer") ?>">
																			</div>
																			<div class="btn-group" style="width:140px">
																				<label>Gateway</label>
																				<select class="form-control" name="f_gateway">
																					<option value="">Payment Gateway</option>
																					<option value="paytm" <?= selected("paytm", col("f_gateway")) ?>>Paytm</option>
																					<option value="payu" <?= selected("payu", col("f_gateway")) ?>>PayU</option>
																					<option value="ccavenue" <?= selected("ccavenue", col("f_gateway")) ?>>CCAvenue</option>
																					<option value="upi" <?= selected("upi", col("f_gateway")) ?>>UPI</option>
																					<option value="offline" <?= selected("offline", col("f_gateway")) ?>>Offline</option>
																				</select>
																			</div>
																			<div class="btn-group" style="width:90px">
																				<label>Invoice Date</label>
																				<input type="text" placeholder="Date From" class="form-control datepicker" name="f_dop_from" value="<?= col("f_dop_from") ?>" readonly>
																			</div>
																			<div class="btn-group" style="width:90px">
																				<label>Invoice Date</label>
																				<input type="text" placeholder="Date To" class="form-control datepicker" name="f_dop_to" value="<?= col("f_dop_to") ?>" readonly>
																			</div>
																			<div class="btn-group" style="width:82px">
																				<label>Rate From</label>
																				<input type="number" class="form-control" name="f_amount_from" value="<?= col("f_amount_from") ?>">
																			</div>
																			<div class="btn-group" style="width:82px">
																				<label>Rate To</label>
																				<input type="number" class="form-control" name="f_amount_to" value="<?= col("f_amount_to") ?>">
																			</div>
																			<div class="btn-group pull-left">
																				<br><input type="submit" class="btn btn-success" value="Apply">
																			</div>
																			<div class="btn-group pull-left">
																				<br><a href="?Pg=<?= $_GET['Pg'] ?>"><input type="button" class="btn btn-danger" value="Reset"></a>
																			</div>
																		</div>
																		<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px"></div>
																		<input type="hidden" id="pgn" name="pgn" value="<?= $pgn ?>">
																		<input type="hidden" id="act" name="act">
																		<input type="hidden" id="value" name="value">
																	</form>
																	<div class="table-responsive" style="overflow-x:scroll;">
																		<table class="table table-th-block table-hover">
																			<thead>
																				<tr>
																					<th>Sr#</th>
																					<th>Invoice number</th>
																					<th>Particulars</th>
																					<th>Gateway</th>
																					<th>Company</th>
																					<th>GSTIN</th>
																					<th>Invoice Date</th>
																					<th>Price</th>
																					<th>Discount</th>
																					<th>SGST</th>
																					<th>CGST</th>
																					<th>IGST</th>
																					<th>Tot.Tax</th>
																					<th>Tot. Amt.</th>
																					<th>View</th>
																				</tr>
																			</thead>
																			<tbody>
																				<?php $filt = "";

																				if (col("f_invoice") != "")
																					$filt .= " and invoice=" . $_REQUEST['f_invoice'];
																				if (col("f_payer") != "")
																					$filt .= " and (company like '%" . $_REQUEST['f_payer'] . "%')";
																				if (col("f_gateway") != "")
																					$filt .= " and payment_gateway='" . $_REQUEST['f_gateway'] . "'";
																				if (col("f_dop_from") != "")
																					$filt .= " and invdate>='" . date_create_from_format("d-m-Y", $_REQUEST['f_dop_from'])->format("Y-m-d") . "'";
																				if (col("f_dop_to") != "")
																					$filt .= " and invdate<='" . date_create_from_format("d-m-Y", $_REQUEST['f_dop_to'])->format("Y-m-d") . "'";
																				if (col("f_amount_from") != "")
																					$filt .= " and rate>=" . $_REQUEST['f_amount_from'];
																				if (col("f_amount_to") != "")
																					$filt .= " and rate<=" . $_REQUEST['f_amount_to'];

																				//$base_query="select sp.id,'BanquetEasy' as domain,p.plan,u.property,u.email,u.contact,sp.dop,sp.paid,u.gstin,(case when sp.payment_gateway='payu' then 'PayU' when sp.payment_gateway='paytm' then 'Paytm' when sp.payment_gateway='ccavenue' then 'CCAvenue' when sp.payment_gateway='upi' then 'UPI' else '-' end)payment_gateway,sp.rate,sp.tax,sp.discount, s.state,(case when sp.invoice=0 then '-' else sp.invoice::text end)invoice,sp.expiry_date from subscription_payments sp join users u on u.id=sp.userx join plans p on p.id=sp.plan left join states s on u.state=s.id where sp.paid=1 and sp.rate>0";

																				//nikhil's code
																				$base_query = "select id,invoice,plan,payment_gateway,company,gstin,invdate,rate,discount,sgst,cgst,igst from subscription_payments where invoice <> 0 ";

																				$filt_query = $base_query . $filt;

																				$perPage = 10;                                      // rows per page
																				$page    = isset($_GET['p']) && $_GET['p'] > 0
																					? (int)$_GET['p']
																					: 1;

																				$offset  = ($page - 1) * $perPage;

																				$qry = $filt_query . " order by id desc";

																				$result = $conn->query($qry);
																				if ($result && $result->num_rows > 0) {
																					$str = "";
																					$i = (($current_page - 1) * $pagesize + 1);
																					$sr = 1;

																					//initialising variable to zero for calculating summary
																					$sumrate = $sumsgst = $sumcgst = $sumigst = $sumtotalgst = $sumgrandtotal = 0;

																					while ($row = $result->fetch_assoc()) {
																						//dop -> invdate

																				?>
																						<tr>
																							<td id='td1id<?= $i ?>'><?= $sr ?></td>
																							<td id='td2id<?= $i ?>'>PMS-SUB-<?= $row['invoice'] ?></td>
																							<td id='td3id<?= $i ?>'>Subscription</td>
																							<td id='td4id<?= $i ?>'><?= $row['payment_gateway'] ?></td>
																							<td id='td5id<?= $i ?>'><?= $row['company'] ?></td>
																							<td id='td6id<?= $i ?>'><?= $row['gstin'] ?></td>
																							<td id='td7id<?= $i ?>'><?= date_create($row['invdate'])->format("d-M-Y") ?></td>
																							<td id='td8id<?= $i ?>'><?= $row['rate'] ?></td>
																							<td id='td9id<?= $i ?>'><?= $row['discount'] ?></td>
																							<td id='td10id<?= $i ?>'><?= $row['sgst'] ?></td>
																							<td id='td11id<?= $i ?>'><?= $row['cgst'] ?></td>
																							<td id='td12id<?= $i ?>'><?= $row['igst'] ?></td>
																							<?php
																							$total_gst = $row['sgst'] + $row['cgst'] + $row['igst'];
																							?>
																							<td id='td13id<?= $i ?>'><?= $total_gst ?></td>
																							<?php
																							$grandtotal = $row['rate'] - $row['discount'] + $total_gst;
																							?>
																							<td id='td14id<?= $i ?>'><?= indianamount($grandtotal) ?></td>
																							<td id='td15id<?= $i ?>'><a href="lightboxes/print_invoice.php?id=<?= $row['id'] ?>" target="_blank"><span class="label btn-dropbox">View</span></a></td>
																						</tr>
																					<?php

																						$i++;
																						$sr++;

																						$sumrate = $sumrate + $row['rate'];
																						$sumdiscount = $sumdiscount + $row['discount'];
																						$sumsgst = $sumsgst + $row['sgst'];
																						$sumcgst = $sumcgst + $row['cgst'];
																						$sumigst = $sumigst + $row['igst'];
																						$sumtotalgst = $sumtotalgst + $total_gst;
																						$sumgrandtotal = $sumgrandtotal + $grandtotal;
																					}
																					?>
																					<tr style="font-weight: bold;">
																						<td colspan="7" aligh="right"> Total </td>
																						<td id='td8id<?= $i ?>'><?= $sumrate ?></td>
																						<td id='td9id<?= $i ?>'><?= $sumdiscount ?></td>
																						<td id='td10id<?= $i ?>'><?= $sumsgst ?></td>
																						<td id='td11id<?= $i ?>'><?= $sumcgst ?></td>
																						<td id='td12id<?= $i ?>'><?= $sumigst ?></td>
																						<td id='td13id<?= $i ?>'><?= $sumtotalgst ?></td>
																						<td id='td14id<?= $i ?>'><?= $sumgrandtotal ?></td>
																						<td id='td15id<?= $i ?>'>END</td>
																					</tr>

																				<?php } else
																					echo "<tr><td colspan='16'>No payment records to display</td></tr>"; ?>
																			</tbody>
																		</table>
																	</div>
																</div>
																<?php if ($totalPages > 1): ?>
																	<nav aria-label="pendingsubs pages">
																		<ul class="pagination">
																			<?php
																			/* previous */
																			$prev = $page - 1;
																			echo '<li class="page-item ' . ($prev < 1 ? 'disabled' : '') . '">
                <a class="page-link" href="?Pg=pendingsubscription&p=' . $prev . '">&laquo;</a>
              </li>';

																			/* centred window 2 */
																			$win = 2;
																			$start = max(1, $page - $win);
																			$end   = min($totalPages, $page + $win);
																			for ($i = $start; $i <= $end; $i++) {
																				echo '<li class="page-item ' . ($i == $page ? 'active' : '') . '">
                    <a class="page-link" href="?Pg=pendingsubscription&p=' . $i . '">' . $i . '</a>
                  </li>';
																			}

																			/* next */
																			$next = $page + 1;
																			echo '<li class="page-item ' . ($next > $totalPages ? 'disabled' : '') . '">
                <a class="page-link" href="?Pg=pendingsubscription&p=' . $next . '">&raquo;</a>
              </li>';
																			?>
																		</ul>
																	</nav>
																<?php endif; ?>
															</div>

														<?php
							} else if ($_GET['Pg'] == "invoices" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>

																																																	<div id="messageBox-alert"></div>
																																																	<div class="row" style="margin-left: -11px; margin-right: -12px">
																																																		<div class="col-sm-12">
																																																			<div class="the-box">
																																																				<div class="invoice-heading">
																																																					<h1 class="page-heading">INVOICES</h1>
																																																					<div class="btn-group pull-right" style="margin-top: -50px;  margin-right: 65px;">
																																																																<input type="submit" class="btn btn-success" value="Apply">
																																																															</div>
																																																															<div class="btn-group pull-right" style="margin-top: -50px;">
																																																																<a href="?Pg=invoices"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																															</div>
																																																					
																																																				</div>
																																																				<form name="filter_form" method="POST">
																																																					<div class="btn-toolbar top-table" role="toolbar"
																																																						style="margin-bottom:12px;">
																																																						<div class="btn-group">
																																																							<input type="text" class="form-control" name="bookingid"
																																																								value="<?= col("bookingid") ?>" placeholder="BR#"
																																																								style="height:34px; width: 44px;">
																																																						</div>
																																																						<div class="btn-group">
																																																							<select class="form-control" name="source"
																																																								style="height:34px;     width: 105px;">
																																																								<option value="">Source</option>
																																																								<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																								<option value="PMS" <?= selected(col("source"), "Agent") ?>>PMS</option>
																																																							</select>
																																																						</div>
																																																						<!-- <?php if ($_SESSION['groupid'] == 0) { ?>
															<div class="btn-group">
																<select class="form-control chosen-select" name="hotel" style="width:220px">
																	<option value="">Hotel</option>
																	<?php
																	$result = $conn->query("SELECT h.id, u.company FROM hotels h JOIN users u ON u.id = h.user WHERE u.approved = 1 AND u.active = 1 AND u.groupid = 2");
																	while ($row = $result->fetch_assoc()) { ?>
																		<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																	<?php } ?>
																</select>
															</div>
														<?php } else if ($_SESSION['groupid'] == 1) { ?>
															<div class="btn-group">
																<select class="form-control chosen-select" name="hotel" style="width:220px">
																	<option value="">Hotel</option>
																	<?php
																	$result = $conn->query("SELECT h.id, u.company FROM hotels h JOIN users u ON u.id = h.user WHERE u.approved = 1 AND u.active = 1 AND u.groupid = 2 AND h.id IN (SELECT id FROM hotels WHERE admin = $_SESSION[id])");
																	while ($row = $result->fetch_assoc()) { ?>
																		<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																	<?php } ?>
																</select>
															</div>
														<?php } ?> -->
																																																						<div class="btn-group">
																																																							<input type="text" class="form-control datepicker"
																																																								data-date-format="dd-mm-yyyy" name="fromdate"
																																																								value="<?= col("fromdate") ?>"
																																																								placeholder="Booking Date From"
																																																								style="height:34px; width: 130px;">
																																																						</div>
																																																						<div class="btn-group">
																																																							<input type="text" class="form-control datepicker"
																																																								data-date-format="dd-mm-yyyy" name="todate"
																																																								value="<?= col("todate") ?>"
																																																								placeholder="Booking Date To"
																																																								style="height:34px; width: 130px;">
																																																						</div>

																																																					<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																								<?php
																								$max_length = 25; // Set your desired length limit
																								$roomtype_limited = (strlen($row['roomtype']) > $max_length)
																									? substr($row['roomtype'], 0, $max_length) . '...'
																									: $row['roomtype'];
																								?>
																																																											<div class="btn-group">
																																																												<select class="form-control chosen-select" name="roomtype" style="width:175px">
																																																													<option value="">Room Type</option>
																										<?php
																										$result = $conn->query("SELECT roomtype FROM roomtypes WHERE hotel = $_SESSION[hotel]");
																										while ($row = $result->fetch_assoc()) {
																											$roomtype_limited = (strlen($row['roomtype']) > $max_length)
																												? substr($row['roomtype'], 0, $max_length) . '...'
																												: $row['roomtype']; ?>
																																																															<option value="<?= $row['roomtype'] ?>" <?= selected(col("roomtype"), $row['roomtype']) ?>>
																												<?= $roomtype_limited ?>
																																																															</option>
																									<?php } ?>
																																																												</select>
																																																											</div>
																																																											<!-- <div class="btn-group">
															<select class="form-control" name="status" style="height:34px">
																<option value="">Booking Status</option>
																<option value="Scheduled" <?= selected(col("status"), "Scheduled") ?>>Scheduled</option>
																<option value="Checkedin" <?= selected(col("status"), "Checkedin") ?>>Checked in</option>
																<option value="Checkedout" <?= selected(col("status"), "Checkedout") ?>>Checked out</option>
																<option value="Cancelled" <?= selected(col("status"), "Cancelled") ?>>Cancelled</option>
																<option value="Refunded" <?= selected(col("status"), "Refunded") ?>>Refunded</option>
															</select>
														</div> -->
																																																											<div class="btn-group">
																																																												<input type="text" class="" name="guestname" value="<?= col("guestname") ?>" placeholder="Enter Guest Name" style="height:34px; width: 165px;">
																																																											</div>
																																																											<div class="btn-group">
																																																												<input type="text" class="" name="guestcontact" value="<?= col("guestcontact") ?>" placeholder="Enter Guest Number" style="height:34px; width: 148px;">
																																																											</div>
																				
																																																										</div>
																																																										</div>
																			
																																																										<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																									</form>
																						<?php
																						// Number of results per page
																						$pagesize = 10;

																						// Determine the current page number
																						$current_page = isset($_GET['cnt']) ? (int) $_GET['cnt'] : 1;
																						$offset = ($current_page - 1) * $pagesize;

																						$hotel_prefix = execute("SELECT invoice_prefix from invoice_setup where hotel=$_SESSION[hotel]");

																						// Base query
																						$base_query = "SELECT 
																b.id, 
																b.reg_date,
																b.checkindatetime,
																b.checkoutdatetime,
																r.roomtype,
																b.source,
																rn.id AS roomnumberid, 
																u_gst.fullname,  -- Directly join users table for guest information
																u_gst.contact,   -- Directly join users table for guest information
																b.declaredtariff,
																COUNT(rd.roomnumber) AS cnt -- Count directly in the main query
															FROM bookings b
															JOIN room_distribution rd ON rd.bookingid = b.id 
															JOIN roomnumbers rn ON rn.id = rd.roomnumber 
															JOIN roomtypes r ON r.id = rn.roomtype 
															JOIN hotels h ON h.id = r.hotel 
															JOIN users u ON u.id = h.user 
															JOIN users u_gst ON u_gst.id = b.guestid -- Direct join for guest info
															JOIN cities c ON c.id = u.city";

																						// Filter conditions
																						$filt = "";
																						if (col("bookingid") != "") {
																							$bookingid = str_replace("FR", "", col("bookingid"));
																							$filt .= " AND b.id = " . $bookingid;
																						}
																						if (col("global_search") != "") {
																							$bookingid = str_replace("FR", "", col("global_search"));
																							$filt .= " AND id = " . $bookingid;
																						}
																						// if ($_SESSION['groupid'] == 2) {
																						// 	$filt .= " AND hotelid = $_SESSION[hotel]";
																						// } elseif ($_SESSION['groupid'] == 1) {
																						// 	$filt .= " AND hotelid IN (SELECT id FROM hotels WHERE admin = $_SESSION[id])";
																						// } elseif (col("hotel") != "") {
																						// 	$filt .= " AND hotelid = " . col("hotel");
																						// }
																						if (col("fromdate") != "") {
																							$filt .= " AND b.checkindatetime >= '" . dateindia(col("fromdate")) . " 12:00:00'";
																						}
																						if (col("todate") != "") {
																							$filt .= " AND b.checkoutdatetime <= '" . dateindia(col("todate")) . " 11:00:00'";
																						}
																						if (col("roomtype") != "") {
																							$filt .= " AND r.roomtype = '" . col("roomtype") . "'";
																						}
																						// if (col("source") != "") {
																						// 	$filt .= " AND source = '" . col("source") . "'";
																						// }
																			
																						if (col("guestname") != "") {
																							$filt .= " AND (SELECT u.fullname FROM users u WHERE u.id = b.guestid) = '" . col("guestname") . "'";
																						}
																						if (col("guestcontact") != "") {
																							$filt .= " AND (SELECT u.contact FROM users u WHERE u.id = b.guestid) = '" . col("guestcontact") . "'";
																						}

																						// Final query with pagination
																						$qry = $base_query . $filt . " GROUP BY b.id ORDER BY b.id DESC LIMIT $offset, $pagesize";
																						// Execute query
																						$result = $conn->query($qry);
																						?>
																																																									<div class="table-responsive" style="overflow-x:scroll;">
																																																										<table class="table table-th-block table-hover">
																																																											<thead>
																																																												<tr style='font-size: 13px'>
																																																													<th style="width:40px">Invoice No</th>
																																																													<th>BR#</th>
																																																													<th>Date of Booking</th>
																																																													<th>Checkin Date</th>
																																																													<th>Checkout Date</th>
																																																													<th>Roomtype</th>
																																																													<th>No of rooms</th>
																																																													<th>Booked By(Source)</th>
																																																													<th>Client Name</th>
																																																													<th>Contact</th>
																																																													<th>Total Amount</th>
																																																													<th>Summary</th>
																																																													<th>Create Invoice</th>
																																																													<th>Send Invoice</th>
																																																													<th>Pdf</th>
																																																												</tr>
																																																											</thead>
																																																											<tbody>


																									<?php
																									if ($result->num_rows > 0) {
																										$str = "";
																										$i = $offset + 1;
																										while ($row = $result->fetch_assoc()) {
																											$invoice_num = execute("select invoice_number,count(*)cnt from invoices where bookingid = $row[id]");
																											$invoicestr = "-";
																											$isinvoiceCreated = 0;
																											if ($invoice_num['cnt'] > 0) {
																												$isinvoiceCreated = 1;
																												$invoicestr = '' . $hotel_prefix['invoice_prefix'] . '' . $invoice_num['invoice_number'] . '';
																											}
																											$brn = "FR" . $row['id'];
																											$date = new DateTime($row['checkindatetime']);
																											$str .= "<tr style='font-size: 13px'>
																		<td id='td1id$i'>$invoicestr</td>
																		<td id='td13id$i'>$brn</td>
																		<td id='td5id$i'>" . date_create($row['reg_date'])->format("d-M-Y H:i") . "</td>
																		<td id='td2id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																		<td id='td4id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																		<td id='td3id$i'>$row[roomtype]</td>
																		<td id='td3id$i'>$row[cnt]</td>
																		<td id='td3id$i'>$row[source]</td>
																		<td id='td3id$i'>$row[fullname]</td>
																		<td id='td5id$i'>$row[contact]</td>
																		<td id='td6id$i'>$row[declaredtariff]</td>

																		<td id='td3id$i' >
																			<button style='height: 25px; padding: 2px 10px;'  href='LBF_roomnumberbooking.php?id=$row[roomnumberid]&date=" . $date->format("Y-m-d") . "' class=' btn btn available  fancybox fancybox.iframe'>Summary</button>
																		</td>

																		<td id='td9id$i' >
																			<button style='width: 104px; height: 25px; padding: 2px 10px;'  href='./taxinvoice/LBF_confirminvoice.php?id=$row[roomnumberid]&date=" . $date->format("Y-m-d") . "' class=' btn btn available  fancybox4 fancybox.iframe'>" . ($isinvoiceCreated ? 'Edit Invoice' : 'Create Invoice') . "</button>
																		</td>

																		<td id='td7id$i'>
																			<button style='height: 25px; padding: 2px 10px;'  href='./taxinvoice/LBF_confirminvoice.php?id=$row[roomnumberid]&date=" . $date->format("Y-m-d") . "' class=' btn btn available  fancybox4 fancybox.iframe'>Send Invoice</button>
																		</td>
																		


																		<td style='font-size: 20px'  id='td9id$i'><a href='LBF_finalinvoice.php?id=$row[roomnumberid]&date=" . $date->format("Y-m-d") . "'' target=_blank><i class='fa fa-print' style='color: #37BC9B; cursor: pointer; " . ($isinvoiceCreated ? '' : 'display:none;') . "'></i></a></td>
																	</tr>";
																											$i++;
																										}
																										echo $str;
																									} else {
																										echo "<tr><td colspan='15'>No bookings to display</td></tr>";
																									}
																									?>
																																																											</tbody>
																																																										</table>
																																																									</div>

																																																									<!-- Pagination Controls -->
																																																									<div class="pagination-container">
																							<?php
																							// Retrieve filter parameters
																							$filter_params = [
																								'bookingid' => col("bookingid"),
																								'source' => col("source"),
																								'fromdate' => col("fromdate"),
																								'todate' => col("todate"),
																								'roomtype' => col("roomtype"),
																								'guestname' => col("guestname"),
																								'guestcontact' => col("guestcontact"),
																							];

																							// Get the total number of results
																							$total_results = $conn->query("SELECT COUNT(*) AS total FROM bookings b 
																				JOIN room_distribution rd ON rd.bookingid = b.id 
																				JOIN roomnumbers rn ON rn.id = rd.roomnumber 
																				JOIN roomtypes r ON r.id = rn.roomtype 
																				JOIN hotels h ON h.id = r.hotel 
																				JOIN users u ON u.id = h.user 
																				JOIN cities c ON c.id = u.city" . $filt)->fetch_assoc()['total'];
																							$total_pages = ceil($total_results / $pagesize);
																							?>
																																																										<ul class="pagination">
																								<?php
																								// Define page range to display (e.g., 5 pages before and after current page)
																								$page_range = 5;
																								$start_page = max(1, $current_page - $page_range);
																								$end_page = min($total_pages, $current_page + $page_range);

																								// Previous page link
																								if ($current_page > 1) {
																									$prev_page = $current_page - 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=invoices&cnt=' . $prev_page . '&' . http_build_query($filter_params) . '">&laquo;</a></li>';
																								}

																								// Page number links
																								for ($page = $start_page; $page <= $end_page; $page++) {
																									echo '<li class="page-item ' . ($page == $current_page ? 'active' : '') . '">
																<a class="page-link" href="?Pg=invoices&cnt=' . $page . '&' . http_build_query($filter_params) . '">' . $page . '</a>
															</li>';
																								}

																								// Next page link
																								if ($current_page < $total_pages) {
																									$next_page = $current_page + 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=invoices&cnt=' . $next_page . '&' . http_build_query($filter_params) . '">&raquo;</a></li>';
																								}
																								?>
																																																										</ul>
																																																									</div>

																																																								</div>
																																																							</div>
																																																						</div>

																	<?php
							} else if ($_GET['Pg'] == "hotelstaff" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
															
																																																							<div id="messageBox-alert"></div>
																																																							<div class="row" style =" margin-left: -13px; margin-right: -12px;">
																																																								<div class="col-sm-12">
																																																									<div class="the-box">
																																																										<div id="add-hotel-staff" style="margin: 5px 0px; ">
																																																											<a href="LBF_addnewstaff.php" class="fancybox fancybox.iframe" style="border-radius: 2px; "><button class="btn btn addnewstaff" fdprocessedid="d0insh">Add new staff</button></a>
																																																										</div>
																						<?php
																						// Number of results per page
																						$pagesize = 10;

																						// Determine the current page number
																						$current_page = isset($_GET['cnt']) ? (int) $_GET['cnt'] : 1;
																						$offset = ($current_page - 1) * $pagesize;

																						// Base query
																						$base_query = "SELECT hs.id,u.groupid,u.fullname,u.email,u.contact FROM hotel_staff hs JOIN users u ON u.id=hs.user_id WHERE hs.deleted=0 AND hs.hotel_id=$_SESSION[hotel]";

																						// Final query with pagination
																						$qry = $base_query . " GROUP BY hs.id ORDER BY hs.id DESC LIMIT $offset, $pagesize";
																						// Execute query
																						$result = $conn->query($qry);

																						?>
																																																										<div class="table-responsive" style="overflow-x:scroll;">
																																																											<table class="table table-th-block table-hover">
																																																												<thead>
																																																													<tr style='font-size: 13px'>
																																																														<th>Sr</th>
																																																														<th>Type</th>
																																																														<th>Full name</th>
																																																														<th>Email</th>
																																																														<th>Contact</th>
																																																														<th style="text-align: center; ">Edit</th>
																																																														<th style="text-align: center; ">Delete</th>
																																																													</tr>
																																																												</thead>
																																																												<tbody id="hotel-staff-table">
																									<?php
																									if ($result->num_rows > 0) {
																										$str = "";
																										$i = $offset + 1;
																										$itr = 0;
																										while ($row = $result->fetch_assoc()) {
																											$itr++;
																											if ($row['groupid'] == 2) {
																												$role = 'Admin';
																											} elseif ($row['groupid'] == 3) {
																												$role = 'SubAdmin';
																											} elseif ($row['groupid'] == 4) {
																												$role = 'Receptionist';
																											}
																											// Build the table row
																											$str .= "<tr style='font-size: 13px'>
																							<td>$i</td>
																							<td>$role</td>
																							<td>$row[fullname]</td>
																							<td>$row[email]</td>
																							<td>$row[contact]</td>
																							<td id='edit-hotel-staff-$itr' style='text-align: center; '><a href='LBF_addnewstaff.php?id=$row[id]' class='fancybox fancybox.iframe'><i class='fa fa-edit' style='color: #3BAFDA; cursor: pointer'></i></a></td>
																							<td id='delete-hotel-staff-$itr' style='text-align: center; '><a onClick='handleDelete($row[id])'><i class='fa fa-trash-o' style='color: #fb3c3c; cursor: pointer'></i></a></td>
																						</tr>";
																											$i++;
																										}
																										echo $str;
																									} else {
																										echo "<tr><td colspan='15'>No Staff to display</td></tr>";
																									}

																									?>
																																																												</tbody>
																																																											</table>
																																																										</div>

																																																										<script>
																																																											function handleDelete(id) {
																																																												$.ajax({
																																																													type: 'POST',
																																																													url: 'bookingajax.php',
																																																													data: {
																																																														action: "delete_hotel_staff",
																																																														id: id,
																																																														user: <?= $_SESSION['id'] ?>,
																																																														hotel: <?= $_SESSION['hotel'] ?>,
																																																													},
																																																													success: function(response) {
																																																														let res = JSON.parse(response);
																																																														if (res.status === 'success') {
																																																															location.reload();
																																																														}
																																																													}
																																																												});
																																																											}
																																																										</script>

																																																										<!-- Pagination Controls -->
																																																										<div class="pagination-container">
																							<?php
																							// Retrieve filter parameters
																							$filter_params = [
																								'bookingid' => col("bookingid"),
																								'source' => col("source"),
																								'fromdate' => col("fromdate"),
																								'todate' => col("todate"),
																								'roomtype' => col("roomtype"),
																								'guestname' => col("guestname"),
																								'guestcontact' => col("guestcontact"),
																							];

																							// Get the total number of results
																							$total_results = $conn->query("SELECT COUNT(*)total FROM hotel_staff hs JOIN users u ON u.id=hs.user_id WHERE hs.deleted=0 AND hs.hotel_id=$_SESSION[hotel];")->fetch_assoc()['total'];
																							$total_pages = ceil($total_results / $pagesize);
																							?>
																																																											<ul class="pagination">
																								<?php
																								// Define page range to display (e.g., 5 pages before and after current page)
																								$page_range = 5;
																								$start_page = max(1, $current_page - $page_range);
																								$end_page = min($total_pages, $current_page + $page_range);

																								// Previous page link
																								if ($current_page > 1) {
																									$prev_page = $current_page - 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=hotelstaff&cnt=' . $prev_page . '&' . http_build_query($filter_params) . '">&laquo;</a></li>';
																								}

																								// Page number links
																								for ($page = $start_page; $page <= $end_page; $page++) {
																									echo '<li class="page-item ' . ($page == $current_page ? 'active' : '') . '">
																			<a class="page-link" href="?Pg=hotelstaff&cnt=' . $page . '&' . http_build_query($filter_params) . '">' . $page . '</a>
																		</li>';
																								}

																								// Next page link
																								if ($current_page < $total_pages) {
																									$next_page = $current_page + 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=hotelstaff&cnt=' . $next_page . '&' . http_build_query($filter_params) . '">&raquo;</a></li>';
																								}
																								?>
																																																											</ul>
																																																										</div>

																																																										<!-- <script>
																			let permissions = <?= decode_permissions($_SESSION['permission']) ?>;
																			
																			let group_id = <?= $_SESSION['groupid'] ?>;
																			let intialRowCount = document.getElementById('hotel-staff-table').rows.length;

																			if (group_id >= 3 && group_id <= 4) {
																				if (!permissions.hotel_staff_details.Create) {
																					document.getElementById('add-hotel-staff').style.display = 'none';
																				}

																				for (let i = 1; i <= intialRowCount; i++) {
																					if (!permissions.hotel_staff_details.Edit) {
																						const editElement = document.getElementById(`edit-hotel-staff-${i}`);
																						editElement.addEventListener('click', function (event) {
																							event.preventDefault(); // Prevent default navigation
																							event.stopPropagation();
																							showMessageBoxPermission("You don't have permission to edit staff details.")
																						});
																					}
																					if (!permissions.hotel_staff_details.Delete) {
																						const deleteElement = document.getElementById(`delete-hotel-staff-${i}`);
																						const deleteAnchor = deleteElement.querySelector('a');

																						// Override the existing onclick handler
																						deleteAnchor.onclick = function (event) {
																							event.preventDefault(); // Prevent the default action
																							event.stopPropagation(); // Stop propagation
																							showMessageBoxPermission("You don't have permission to delete staff details.");
																						};
																					}
																				}
																			}
																		</script> -->

																																																									</div>
																																																								</div>
																																																							</div>

																	<?php
							} else if ($_GET['Pg'] == "hotel_task_log" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
															

																																																								<div class="filter-container">
																																																									<form method="GET" action="">
																																																										<input type="hidden" name="Pg" value="hotel_task_log">
																																																										<div class="row" style="margin-right:-21px; margin-left: -12px">
																																																											<!-- Username Filter -->
																																																											<div class="col-lg-3">
																																																												<label for="username">Username:</label>
																																																												<input type="text" id="username" name="username" class="form-control" value="<?php echo isset($_GET['username']) ? htmlspecialchars($_GET['username']) : ''; ?>">
																																																											</div>
																																																											<!-- Timestamp Filter -->
																																																											<div class="col-lg-3">
																																																												<label for="from_time">From:</label>
																																																												<input type="datetime-local" id="from_time" name="from_time" class="form-control" value="<?php echo isset($_GET['from_time']) ? htmlspecialchars($_GET['from_time']) : ''; ?>">
																																																											</div>
																																																											<div class="col-lg-3">
																																																												<label for="to_time">To:</label>
																																																												<input type="datetime-local" id="to_time" name="to_time" class="form-control" value="<?php echo isset($_GET['to_time']) ? htmlspecialchars($_GET['to_time']) : ''; ?>">
																																																											</div>
																																																											<div class="col-lg-3">
																																																												<label for="module">Module:</label>
																																																												<select id="module" name="module" class="form-control" style="width:210px;">
																																																													<option value="">Select Module</option>
																																																													<option value="BOOKINGS" <?php echo isset($_GET['module']) && $_GET['module'] == 'BOOKINGS' ? 'selected' : ''; ?>>BOOKINGS</option>
																																																													<option value="HOTEL STAFF" <?php echo isset($_GET['module']) && $_GET['module'] == 'HOTEL STAFF' ? 'selected' : ''; ?>>HOTEL STAFF</option>
																																																													<option value="HOTEL SERVICE" <?php echo isset($_GET['module']) && $_GET['module'] == 'HOTEL SERVICE' ? 'selected' : ''; ?>>HOTEL SERVICE</option>
																																																													<!-- Add other modules as necessary -->
																																																												</select>
																																																											</div>
																																																										</div>
																																																										<div class="row mt-3" style="margin-block: 15px; margin-left: 0px;  margin-right: 0px;">
																																																											<div class="col-sm-12" style="padding: 0px;">
																																																												<button type="submit" class="btn btn-primary" style="background-color: #e4514b; border-radius: 1px; border-color: #e4514b;">Filter</button>
																																																												<a href="?Pg=hotel_task_log" class="btn btn-secondary" style="color: #e4514b;">Reset</a>
																																																											</div>
																																																										</div>
																																																									</form>
																																																								</div>


																																																								<div class="row" style="margin-right:-21px; margin-left: -12px">
																																																									<div class="col-sm-12">
																																																										<div class="the-box" style="margin-right: 15px;">
																						<?php
																						// Number of results per page
																						$pagesize = 10;

																						// Determine the current page number
																						$current_page = isset($_GET['cnt']) ? (int) $_GET['cnt'] : 1;
																						$offset = ($current_page - 1) * $pagesize;

																						$username_filter = isset($_GET['username']) && !empty($_GET['username']) ? "AND u.fullname LIKE '%" . $conn->real_escape_string($_GET['username']) . "%'" : "";

																						$module_filter = isset($_GET['module']) && !empty($_GET['module']) ? "AND hlog.module = '" . $conn->real_escape_string($_GET['module']) . "'" : "";

																						$timestamp_filter = "";

																						if (!empty($_GET['from_time'])) {
																							$from_time = $conn->real_escape_string($_GET['from_time']);
																							$timestamp_filter .= " AND hlog.created_at >= '$from_time'";
																						}
																						if (!empty($_GET['to_time'])) {
																							$to_time = $conn->real_escape_string($_GET['to_time']);
																							$timestamp_filter .= " AND hlog.created_at <= '$to_time'";
																						}

																						// Base query
																						$base_query = "SELECT hlog.id,hlog.message,hlog.module,u.fullname,u.email,hlog.created_at,u.groupid FROM hotel_task_log hlog JOIN users u ON u.id=hlog.user_id WHERE hlog.hotel_id=$_SESSION[hotel] AND hlog.deleted=0  $username_filter 
																		$timestamp_filter $module_filter";

																						// Final query with pagination
																						$qry = $base_query . " GROUP BY hlog.id ORDER BY hlog.id DESC LIMIT $offset, $pagesize";
																						// Execute query
																						$result = $conn->query($qry);

																						?>
																																																											<div class="table-responsive" style="overflow-x:scroll;">
																																																												<table class="table table-th-block table-hover">
																																																													<thead>
																																																														<tr style='font-size: 13px'>
																																																															<th>Sr</th>
																																																															<th>Type</th>
																																																															<th>User name</th>
																																																															<th>Email</th>
																																																															<th>Time</th>
																																																															<th>Module</th>
																																																															<th>Message</th>
																																																														</tr>
																																																													</thead>
																																																													<tbody id="hotel-staff-table">
																									<?php
																									if ($result->num_rows > 0) {
																										$str = "";
																										$i = $offset + 1;
																										$itr = 0;
																										while ($row = $result->fetch_assoc()) {
																											$itr++;
																											if ($row['groupid'] == 2) {
																												$role = 'Admin';
																											} elseif ($row['groupid'] == 3) {
																												$role = 'SubAdmin';
																											} elseif ($row['groupid'] == 4) {
																												$role = 'Receptionist';
																											} elseif ($row['groupid'] == 0) {
																												$role = 'SuperAdmin';
																											}
																											$created_at = new DateTime($row['created_at']);
																											// Build the table row
																											$str .= "<tr style='font-size: 13px'>
																							<td>$i</td>
																							<td>$role</td>
																							<td>$row[fullname]</td>
																							<td>$row[email]</td>
																							<td>" . $created_at->format('Y-m-d H:i') . "</td>
																							<td>$row[module]</td>
																							<td>$row[message]</td>
																						
																						</tr>";
																											$i++;
																										}
																										echo $str;
																									} else {
																										echo "<tr><td colspan='15'>No Staff to display</td></tr>";
																									}

																									?>
																																																													</tbody>
																																																												</table>
																																																											</div>

																																																											<script>
																																																												function handleDelete(id) {
																																																													$.ajax({
																																																														type: 'POST',
																																																														url: 'bookingajax.php',
																																																														data: {
																																																															action: "delete_hotel_staff",
																																																															id: id
																																																														},
																																																														success: function(response) {
																																																															let res = JSON.parse(response);
																																																															if (res.status === 'success') {
																																																																location.reload();
																																																															}
																																																														}
																																																													});
																																																												}
																																																											</script>

																																																											<!-- Pagination Controls -->
																																																											<div class="pagination-container">
																							<?php
																							// Get the total number of results with applied filters
																							$total_results = $conn->query("SELECT COUNT(*) AS total 
																	FROM hotel_task_log hlog 
																	JOIN users u ON u.id = hlog.user_id
																	WHERE hlog.deleted = 0 
																	AND hlog.hotel_id = $_SESSION[hotel]
																	$username_filter 
																	$timestamp_filter
																	$module_filter;")->fetch_assoc()['total'];

																							// Calculate the total number of pages
																							$total_pages = ceil($total_results / $pagesize);
																							?>

																																																												<ul class="pagination">
																								<?php
																								// Page range to display (e.g., 5 pages before and after current page)
																								$page_range = 5;
																								$start_page = max(1, $current_page - $page_range);
																								$end_page = min($total_pages, $current_page + $page_range);

																								// Remove current page parameters from $_GET to prevent duplication
																								$query_params = $_GET;
																								unset($query_params['cnt']);
																								unset($query_params['Pg']);

																								// Previous page link
																								if ($current_page > 1) {
																									$prev_page = $current_page - 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=hotel_task_log&cnt=' . $prev_page . '&' . http_build_query($query_params) . '">&laquo;</a></li>';
																								}

																								// Page number links
																								for ($page = $start_page; $page <= $end_page; $page++) {
																									echo '<li class="page-item ' . ($page == $current_page ? 'active' : '') . '">
																					<a class="page-link" href="?Pg=hotel_task_log&cnt=' . $page . '&' . http_build_query($query_params) . '">' . $page . '</a>
																					</li>';
																								}

																								// Next page link
																								if ($current_page < $total_pages) {
																									$next_page = $current_page + 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=hotel_task_log&cnt=' . $next_page . '&' . http_build_query($query_params) . '">&raquo;</a></li>';
																								}
																								?>
																																																												</ul>

																																																											</div>

																																																										</div>
																																																									</div>
																																																								</div>

																	<?php
							} else if ($_GET['Pg'] == "gstreport" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																									

																																																									<div class="row" style="margin-left: -11px; margin-right: -12px;">
																																																										<div class="col-sm-12">
																																																											<div class="the-box">
																																																												<div class="invoice-heading">
																																																					<h1 class="page-heading">GST REPORT</h1>
																																																					<div class="btn-group pull-right" style="margin-top: -50px;  margin-right: 65px;">
																																																																<input type="submit" class="btn btn-success" value="Apply">
																																																															</div>
																																																															<div class="btn-group pull-right" style="margin-top: -50px;">
																																																																<a href="?Pg=invoices"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																															</div>
																																																					
																																																				</div>
																																																												<form name="filter_form" method="POST">
																																																													<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px; ">
																																																														<div class="btn-group">
																																																															<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#" style="height:34px;     width: 44px;">
																																																														</div>
																																																														<div class="btn-group">
																																																															<select class="form-control" name="source" style="height:34px; width: 105px;">
																																																																<option value="">Source</option>
																																																																<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																																<option value="PMS" <?= selected(col("source"), "Agent") ?>>PMS</option>
																																																															</select>
																																																														</div>
																																																														<!-- <?php if ($_SESSION['groupid'] == 0) { ?>
																		<div class="btn-group">
																			<select class="form-control chosen-select" name="hotel" style="width:220px">
																				<option value="">Hotel</option>
																				<?php
																				$result = $conn->query("SELECT h.id, u.company FROM hotels h JOIN users u ON u.id = h.user WHERE u.approved = 1 AND u.active = 1 AND u.groupid = 2");
																				while ($row = $result->fetch_assoc()) { ?>
																					<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																				<?php } ?>
																			</select>
																		</div>
																	<?php } else if ($_SESSION['groupid'] == 1) { ?>
																		<div class="btn-group">
																			<select class="form-control chosen-select" name="hotel" style="width:220px">
																				<option value="">Hotel</option>
																				<?php
																				$result = $conn->query("SELECT h.id, u.company FROM hotels h JOIN users u ON u.id = h.user WHERE u.approved = 1 AND u.active = 1 AND u.groupid = 2 AND h.id IN (SELECT id FROM hotels WHERE admin = $_SESSION[id])");
																				while ($row = $result->fetch_assoc()) { ?>
																					<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																				<?php } ?>
																			</select>
																		</div>
																	<?php } ?> -->
																																																														<div class="btn-group">
																																																															<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="fromdate" value="<?= col("fromdate") ?>" placeholder="Booking Date From" style="height:34px; width: 130px;">
																																																														</div>
																																																														<div class="btn-group">
																																																															<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="todate" value="<?= col("todate") ?>" placeholder="Booking Date To" style="height:34px; width: 130px;">
																																																														</div>
																																																														<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																								<?php
																								$max_length = 25; // Set your desired length limit
																								$roomtype_limited = (strlen($row['roomtype']) > $max_length)
																									? substr($row['roomtype'], 0, $max_length) . '...'
																									: $row['roomtype'];
																								?>
																																																														<div class="btn-group">
																																																															<select class="form-control chosen-select" name="roomtype" style="width: 175px;">
																																																																<option value="">Room Type</option>
																										<?php
																										$result = $conn->query("SELECT roomtype FROM roomtypes WHERE hotel = $_SESSION[hotel]");
																										while ($row = $result->fetch_assoc()) {
																											$roomtype_limited = (strlen($row['roomtype']) > $max_length)
																												? substr($row['roomtype'], 0, $max_length) . '...'
																												: $row['roomtype']; ?>
																																																																		<option value="<?= $row['roomtype'] ?>" <?= selected(col("roomtype"), $row['roomtype']) ?>>
																												<?= $roomtype_limited ?>
																																																																		</option>
																									<?php } ?>
																																																															</select>
																																																														</div>

																																																														<!-- <div class="btn-group">
																		<select class="form-control" name="status" style="height:34px">
																			<option value="">Booking Status</option>
																			<option value="Scheduled" <?= selected(col("status"), "Scheduled") ?>>Scheduled</option>
																			<option value="Checkedin" <?= selected(col("status"), "Checkedin") ?>>Checked in</option>
																			<option value="Checkedout" <?= selected(col("status"), "Checkedout") ?>>Checked out</option>
																			<option value="Cancelled" <?= selected(col("status"), "Cancelled") ?>>Cancelled</option>
																			<option value="Refunded" <?= selected(col("status"), "Refunded") ?>>Refunded</option>
																		</select>
																	</div> -->
																																																														<div class="btn-group">
																																																															<input type="text" class="" name="guestname" value="<?= col("guestname") ?>" placeholder="Enter Guest Name" style="height:34px; width: 165px;">
																																																														</div>
																																																														<div class="btn-group">
																																																															<input type="text" class="" name="guestcontact" value="<?= col("guestcontact") ?>" placeholder="Enter Guest Number" style="height:34px; width: 148px;">
																																																														</div>
																																																													</div>
																																																													</div>
																																																													
																																																													<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																												</form>
																						<?php
																						// Number of results per page
																						$pagesize = 10;

																						// Determine the current page number
																						$current_page = isset($_GET['cnt']) ? (int) $_GET['cnt'] : 1;
																						$offset = ($current_page - 1) * $pagesize;

																						$hotel_prefix = execute("SELECT invoice_prefix from invoice_setup where hotel=$_SESSION[hotel]");

																						// Base query
																						$base_query = "SELECT iv.bookingid, iv.invoice_number, iv.reg_date, r.roomtype ,iv.invoice_data,rn.id AS roomnumberid
																			FROM invoices iv 
																			JOIN room_distribution rd ON rd.bookingid = iv.bookingid 
																			JOIN roomnumbers rn ON rn.id = rd.roomnumber 
																			JOIN roomtypes r ON r.id = rn.roomtype 
																			WHERE iv.invoice_number IS NOT NULL";

																						// Filter conditions
																						$filt = "";
																						if (col("bookingid") != "") {
																							$bookingid = str_replace("FR", "", col("bookingid"));
																							$filt .= " AND b.id = " . $bookingid;
																						}
																						if (col("global_search") != "") {
																							$bookingid = str_replace("FR", "", col("global_search"));
																							$filt .= " AND id = " . $bookingid;
																						}
																						// if ($_SESSION['groupid'] == 2) {
																						// 	$filt .= " AND hotelid = $_SESSION[hotel]";
																						// } elseif ($_SESSION['groupid'] == 1) {
																						// 	$filt .= " AND hotelid IN (SELECT id FROM hotels WHERE admin = $_SESSION[id])";
																						// } elseif (col("hotel") != "") {
																						// 	$filt .= " AND hotelid = " . col("hotel");
																						// }
																						if (col("fromdate") != "") {
																							$filt .= " AND b.checkindatetime >= '" . dateindia(col("fromdate")) . " 12:00:00'";
																						}
																						if (col("todate") != "") {
																							$filt .= " AND b.checkoutdatetime <= '" . dateindia(col("todate")) . " 11:00:00'";
																						}
																						if (col("roomtype") != "") {
																							$filt .= " AND r.roomtype = '" . col("roomtype") . "'";
																						}
																						// if (col("source") != "") {
																						// 	$filt .= " AND source = '" . col("source") . "'";
																						// }
																			
																						if (col("guestname") != "") {
																							$filt .= " AND (SELECT u.fullname FROM users u WHERE u.id = b.guestid) = '" . col("guestname") . "'";
																						}
																						if (col("guestcontact") != "") {
																							$filt .= " AND (SELECT u.contact FROM users u WHERE u.id = b.guestid) = '" . col("guestcontact") . "'";
																						}

																						// Final query with pagination
																						$qry = $base_query . $filt . " GROUP BY iv.id ORDER BY iv.id DESC LIMIT $offset, $pagesize";
																						// Execute query
																						$result = $conn->query($qry);
																						?>
																																																												<div class="table-responsive" style="overflow-x:scroll;">
																																																													<table class="table table-th-block table-hover">
																																																														<thead>
																																																															<tr style='font-size: 13px'>
																																																																<th style="width:40px">BRN#</th>
																																																																<th>Invoice</th>
																																																																<th>Customer</th>
																																																																<th>Invoice Date</th>
																																																																<th>Room Type</th>
																																																																<th>Sub Total</th>
																																																																<th>Discount</th>
																																																																<th>SGST</th>
																																																																<th>CGST</th>
																																																																<th>IGST</th>
																																																																<th>Tot.Tax </th>
																																																																<th>Tot. Amt.</th>
																																																																<th>Invoice</th>
																																																															</tr>
																																																														</thead>
																																																														<tbody>
																									<?php
																									if ($result->num_rows > 0) {
																										$str = "";
																										$i = $offset + 1;
																										while ($row = $result->fetch_assoc()) {
																											// Decode invoice_data
																											$decoded_data = html_entity_decode($row['invoice_data']);
																											$decoded_data = trim($decoded_data, '"');
																											$decoded_data = stripslashes($decoded_data);

																											// Parse JSON data
																											$data = json_decode($decoded_data, true); // Convert JSON to array
																						
																											// Extract summary data
																											$discount = $data['summatyData']['totalDiscount'] ?? 0;
																											$subtotal = $data['summatyData']['subtotal'] + $discount ?? 0;
																											$total_gst = $data['summatyData']['totalGST'] ?? 0;
																											$sgst = $total_gst / 2;  // Assuming VAT is equivalent to CGST here
																											$cgst = $total_gst / 2;  // Assuming VAT is equivalent to CGST here
																											$igst = 0; // IGST is 0 in the given data
																											$totalTax = $sgst + $cgst + $igst; // Sum of all taxes
																											$totalAmount = ($subtotal + $totalTax) - $discount ?? 0;

																											// Get user information
																											$userinfo = execute("SELECT u.fullname,b.checkindatetime FROM users u JOIN bookings b ON b.guestid=u.id WHERE b.id=$row[bookingid]");

																											// Invoice details
																											$invoicestr = "" . $hotel_prefix['invoice_prefix'] . "" . $row['invoice_number'] . "";
																											$reg_date = new DateTime($row['reg_date']);
																											$date = new DateTime($userinfo['checkindatetime']);
																											$brn = "FR" . $row['bookingid'];

																											// Build the table row
																											$str .= "<tr style='font-size: 13px'>
																							<td>$brn</td>
																							<td>$invoicestr</td>
																							<td>$userinfo[fullname]</td>
																							<td>" . $reg_date->format('d-M-Y') . "</td>
																							<td>$row[roomtype]</td>
																							<td>$subtotal</td>
																							<td>$discount</td>
																							<td>$sgst</td>
																							<td>$cgst</td>
																							<td>$igst</td>
																							<td>$totalTax</td>
																							<td>$totalAmount</td>
																							<td>
																								<a style='height: 25px; padding: 2px 10px;' href='LBF_finalinvoice.php?id=$row[roomnumberid]&date=" . $date->format("Y-m-d") . "' class='btn btn available fancybox fancybox.iframe'>View</a>
																							</td>
																						</tr>";
																											$i++;
																										}
																										echo $str;
																									} else {
																										echo "<tr><td colspan='15'>No bookings to display</td></tr>";
																									}

																									?>
																																																														</tbody>
																																																													</table>
																																																												</div>

																																																												<!-- Pagination Controls -->
																																																												<div class="pagination-container">
																							<?php
																							// Retrieve filter parameters
																							$filter_params = [
																								'bookingid' => col("bookingid"),
																								'source' => col("source"),
																								'fromdate' => col("fromdate"),
																								'todate' => col("todate"),
																								'roomtype' => col("roomtype"),
																								'guestname' => col("guestname"),
																								'guestcontact' => col("guestcontact"),
																							];

																							// Get the total number of results
																							$total_results = $conn->query("SELECT COUNT(*) AS total
																			FROM invoices iv 
																			JOIN room_distribution rd ON rd.bookingid = iv.bookingid 
																			JOIN roomnumbers rn ON rn.id = rd.roomnumber 
																			JOIN roomtypes r ON r.id = rn.roomtype 
																			WHERE iv.invoice_number IS NOT NULL" . $filt)->fetch_assoc()['total'];
																							$total_pages = ceil($total_results / $pagesize);
																							?>
																																																													<ul class="pagination">
																								<?php
																								// Define page range to display (e.g., 5 pages before and after current page)
																								$page_range = 5;
																								$start_page = max(1, $current_page - $page_range);
																								$end_page = min($total_pages, $current_page + $page_range);

																								// Previous page link
																								if ($current_page > 1) {
																									$prev_page = $current_page - 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=invoices&cnt=' . $prev_page . '&' . http_build_query($filter_params) . '">&laquo;</a></li>';
																								}

																								// Page number links
																								for ($page = $start_page; $page <= $end_page; $page++) {
																									echo '<li class="page-item ' . ($page == $current_page ? 'active' : '') . '">
																			<a class="page-link" href="?Pg=invoices&cnt=' . $page . '&' . http_build_query($filter_params) . '">' . $page . '</a>
																		</li>';
																								}

																								// Next page link
																								if ($current_page < $total_pages) {
																									$next_page = $current_page + 1;
																									echo '<li class="page-item"><a class="page-link" href="?Pg=invoices&cnt=' . $next_page . '&' . http_build_query($filter_params) . '">&raquo;</a></li>';
																								}
																								?>
																																																													</ul>
																																																												</div>

																																																											</div>
																																																										</div>
																																																									</div>

																	<?php
							} else if ($_GET['Pg'] == "bookings" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
															
																																																										<div class="row" style="margin-left: -13px; margin-right: -12px">
																																																											<div class="col-lg-12">
																																																												<div class="the-box">
																																																													<div class="booking-heading">
																																																														<h1 class="page-heading">BOOKINGS</h1>
																																																															<div class="btn-group pull-right" style="margin-top: -50px;  margin-right: 65px;">
																																																																<input type="submit" class="btn btn-success" value="Apply">
																																																															</div>
																																																															<div class="btn-group pull-right" style="margin-top: -50px;">
																																																																<a href="?Pg=bookings"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																															</div>
																																																													</div>
																		
																																																													<form name="filter_form" method="POST">
																																																														<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																															<div class="btn-group">
																																																																<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#" style="height:34px; width:42px;">
																																																															</div>
																																																															<div class="btn-group">
																																																																<select class="form-control" name="source" style="height:34px; width: 118px;">
																																																																	<option value="">Source</option>
																																																																	<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																																	<option value="Agent" <?= selected(col("source"), "Agent") ?>>Agent</option>
																																																																	<option value="Corporate" <?= selected(col("source"), "Corporate") ?>>Corporate</option>
																																																																</select>
																																																															</div>
																							<?php if ($_SESSION['groupid'] == 0) { ?>
																																																																	<div class="btn-group">
																																																																		<select class="form-control chosen-select" name="hotel" style="width:205px">
																																																																			<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																					<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																		</select>
																																																																	</div>
																								<?php
																							} else if ($_SESSION['groupid'] == 1) { ?>
																																																																		<div class="btn-group">
																																																																			<select class="form-control chosen-select" name="hotel" style="width:175px">
																																																																				<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2 and h.id in (select id from hotels where admin=$_SESSION[id])");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																			</select>
																																																																		</div>
																								<?php
																							} ?>
																																																															<div class="btn-group">
																																																																<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="fromdate" value="<?= col("fromdate") ?>" placeholder="Booking Date From" style="height:34px; width:130px;">
																																																															</div>
																																																															<div class="btn-group">
																																																																<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="todate" value="<?= col("todate") ?>" placeholder="Booking Date To" style="height:34px; width:130px;">
																																																															</div>
																																																															<div class="btn-group">
																																																																<select class="form-control chosen-select" name="fullname" style="width:155px">
																																																																	<option value="">Guest Name</option>
																									<?php $result = $conn->query("select id,fullname from users where groupid=5 order by fullname");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																			<option value="<?= $row['fullname'] ?>" <?= selected(col("fullname"), $row['fullname']) ?>><?= $row['fullname'] ?></option>
																										<?php
																									} ?>
																																																																</select>
																																																															</div>
																																																															<div class="btn-group">
																																																																<select class="form-control" name="status" style="height:34px">
																																																																	<option value="">Booking Status</option>
																																																																	<option value="Scheduled" <?= selected(col("status"), "Scheduled") ?>>Scheduled</option>
																																																																	<option value="Checkedin" <?= selected(col("status"), "Checkedin") ?>>Checked in</option>
																																																																	<option value="Checkedout" <?= selected(col("status"), "Checkedout") ?>>Checked out</option>
																																																																	<option value="Cancelled" <?= selected(col("status"), "Cancelled") ?>>Cancelled</option>
																																																																	<option value="Refunded" <?= selected(col("status"), "Refunded") ?>>Refunded</option>
																																																																</select>
																																																															</div>
																																																															<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																				
																																																														</div>
																																																														<!-- <div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																				
																				
																				
																			</div> -->
																			
																																																													</form>
																																																													<div class="table-responsive" style="overflow-x:scroll;">
																																																														<table class="table table-th-block table-hover">
																																																															<thead>
																																																																<tr style='font-size: 11px'>
																																																																	<th style="width:40px">SR No.</th>
																																																																	<th>BR#</th>
																																																																	<th>Date of Booking</th>
																																																																	<th>Booking Status</th> <!-- Scheduled / Travelled / Cancelled / Refunded -->
																																																																	<th>Hotel</th>
																																																																	<th>City</th>
																																																																	<th>Source Of Booking </th><!-- (Direct/Agent/Corp) -->
																																																																	<th>Guest Name</th>
																																																																	<th>Check In Date </th>
																																																																	<th>Check Out Date</th>
																																																																	<th>No of Rooms</th>
																																																																	<th>Check In Time</th>
																																																																	<th>Check Out Time</th>
																																																																	<th>Hotel Room Type booked</th>
																																																																	<th>Total invoiced to customer/Paid by customer</th>
																																																																	<th>IP Address</th>
																																																																</tr>
																																																															</thead>
																																																															<tbody style='font-size: 11px'>
																								<?php $pagesize = 10;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select b.id,b.reg_date,b.status,u.company as hotel,c.city as city,b.source,u_gst.fullname,b.checkindatetime,b.checkoutdatetime,b.hours,r.roomtype,b.declaredtariff,b.ip,COUNT(rd.roomnumber) AS cnt from bookings b join room_distribution rd on rd.bookingid=b.id join roomnumbers rn on rn.id=rd.roomnumber join roomtypes r on r.id=rn.roomtype join hotels h on r.hotel=h.id join users u on u.id=h.user join cities c on c.id=u.city join users u_gst on u_gst.id=b.guestid";

																								$filt = "";
																								if (col("bookingid") != "") {
																									$bookingid = str_replace("FR", "", col("bookingid"));
																									$filt .= " and b.id=" . $bookingid;
																								}

																								if (col("global_search") != "") {
																									$bookingid = str_replace("FR", "", col("global_search"));
																									$filt .= " and b.id=" . $bookingid;
																								}

																								if ($_SESSION['groupid'] == 2)
																									$filt .= " h.id=$_SESSION[hotel]";
																								else if ($_SESSION['groupid'] == 1)
																									$filt .= " and hotelid in (select id from hotels where admin=$_SESSION[id])";
																								else if (col("hotel") != "")
																									$filt .= " and h.hotelid=" . col("hotel");

																								if (col("fromdate") != "")
																									$filt .= " and cast(b.reg_date as date)>='" . dateindia(col("fromdate")) . "'";
																								if (col("todate") != "")
																									$filt .= " and cast(b.reg_date as date)<='" . dateindia(col("todate")) . "'";
																								if (col("fullname") != "")
																									$filt .= " and u_gst.fullname='" . col("fullname") . "'";

																								if (col("source") != "")
																									$filt .= " and b.source='" . col("source") . "'";

																								if (col("hotel") != "")
																									$filt .= " and h.hotelid=" . col("hotel");

																								if (col("status") != "")
																									$filt .= " and b.status='" . col("status") . "'";

																								// $a = new pagination($base_query . $filt, $current_page, $pagesize);
																					
																								// $current_page = $a->current_page_;
																					
																								if ($_SESSION['groupid'] == 2) {
																									$a = new pagination1($base_query . ' where' . $filt, $current_page, $pagesize);

																									// Use the getter method to access the current page
																									$current_page = $a->getCurrentPage();

																									$qry = $base_query . ' where' . $filt . " group by id order by id desc limit " . $a->offset_ . ",$pagesize";
																								} else {
																									$a = new pagination1($base_query . $filt, $current_page, $pagesize);

																									// Use the getter method to access the current page
																									$current_page = $a->getCurrentPage();

																									$qry = $base_query . $filt . " group by id order by id desc limit " . $a->offset_ . ",$pagesize";
																								}
																								// echo $qry;
																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$brn = "FR" . $row['id'];
																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td13id$i'>$brn</td>
																<td id='td5id$i'>" . date_create($row['reg_date'])->format("d-M-Y H:i") . "</td>
																<td id='td2id$i'>$row[status]</td>
																<td id='td4id$i'>$row[hotel]</td>
																<td id='td3id$i'>$row[city]</td>
																<td id='td3id$i'>$row[source]</td>
																<td id='td3id$i'>$row[fullname]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td6id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td3id$i'>$row[cnt]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("h:i A") . "</td>
																<td id='td6id$i'>" . date_create($row['checkoutdatetime'])->format("h:i A") . "</td>
																<td id='td9id$i'>$row[roomtype]</td>
																<td id='td7id$i'>" . round($row['declaredtariff'], 2) . "</td>
																<td id='td9id$i'>$row[ip]</td>
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='12'>No bookings to display</td></tr>";
																								} ?>
																																																															</tbody>
																																																														</table>
																																																													</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																												</div>
																																																											</div>
																																																										</div>
																	<?php
							} else if ($_GET['Pg'] == "abandonedbookings" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																											<h1 class="page-heading">ABANDONED BOOKINGS</h1>
																																																											<div class="row">
																																																												<div class="col-sm-12">
																																																													<div class="the-box">
																																																														<h4 class="small-title">ABANDONED BOOKINGS</h4>
																																																														<form name="filter_form" method="POST">
																																																															<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																<div class="btn-group">
																																																																	<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#" style="height:34px">
																																																																</div>
																																																																<div class="btn-group">
																																																																	<select class="form-control" name="source" style="height:34px">
																																																																		<option value="">Source</option>
																																																																		<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																																		<option value="Agent" <?= selected(col("source"), "Agent") ?>>Agent</option>
																																																																		<option value="Corporate" <?= selected(col("source"), "Corporate") ?>>Corporate</option>
																																																																	</select>
																																																																</div>
																							<?php if ($_SESSION['groupid'] == 0) { ?>
																																																																		<div class="btn-group">
																																																																			<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																				<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																			</select>
																																																																		</div>
																								<?php
																							} else if ($_SESSION['groupid'] == 1) { ?>
																																																																			<div class="btn-group">
																																																																				<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																					<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2 and h.id in (select id from hotels where admin=$_SESSION[id])");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																							<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																				</select>
																																																																			</div>
																								<?php
																							} ?>
																																																																<div class="btn-group">
																																																																	<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="fromdate" value="<?= col("fromdate") ?>" placeholder="Booking Date From" style="height:34px">
																																																																</div>
																																																																<div class="btn-group">
																																																																	<input type="text" class="form-control datepicker" data-date-format="dd-mm-yyyy" name="todate" value="<?= col("todate") ?>" placeholder="Booking Date To" style="height:34px">
																																																																</div>
																																																																<div class="btn-group pull-right">
																																																																	<input type="submit" class="btn btn-success" value="Apply">
																																																																</div>
																																																															</div>
																																																															<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																<div class="btn-group">
																																																																	<select class="form-control chosen-select" name="fullname" style="width:220px">
																																																																		<option value="">Guest Name</option>
																									<?php $result = $conn->query("select id,fullname from users where groupid=5 order by fullname");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																				<option value="<?= $row['fullname'] ?>" <?= selected(col("fullname"), $row['fullname']) ?>><?= $row['fullname'] ?></option>
																										<?php
																									} ?>
																																																																	</select>
																																																																</div>
																																																																<div class="btn-group pull-right">
																																																																	<a href="?Pg=abandonedbookings"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																</div>
																																																															</div>
																																																															<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																														</form>
																																																														<div class="table-responsive" style="overflow-x:scroll;">
																																																															<table class="table table-th-block table-hover">
																																																																<thead>
																																																																	<tr style='font-size: 11px'>
																																																																		<th style="width:40px">SR No.</th>
																																																																		<th>BR#</th>
																																																																		<th>Date of Booking</th>
																																																																		<th>Hotel</th>
																																																																		<th>City</th>
																																																																		<th>Source Of Booking </th><!-- (Direct/Agent/Corp) -->
																																																																		<th>Guests/Agent/Corporate</th>
																																																																		<th>Hotel/Frotel</th>
																																																																		<th>Check In Date </th>
																																																																		<th>Check Out Date</th>
																																																																		<th>No of Hours</th>
																																																																		<th>Check In Time</th>
																																																																		<th>Check Out Time</th>
																																																																		<th>Hotel Room Type booked</th>
																																																																		<th>Total invoiced to customer/Paid by customer</th>
																																																																		<th>IP Address</th>
																																																																	</tr>
																																																																</thead>
																																																																<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select * from (select b.id,b.status,b.source,vr.hotelid,vr.hotel,b.checkindatetime, b.checkoutdatetime,b.reg_date,DATEDIFF(cast(b.checkoutdatetime as date),cast(b.checkindatetime as date))nights, (case when b.hours>0 and b.hours<24 then 'Frotel' else 'Hotel' end)hf,b.usercheckedin,b.usercheckedout,b.hours, u.fullname,vr.city,vr.roomtype,(b.declaredtariff-b.pcdiscount+b.hotelst+ b.hsbc+b.hkcc+b.frotelst+b.fsbc+b.fkcc+ b.lt+b.sc+b.stonsc)total,b.ip,b.paid from (select * from bookings where paid=1 limit 450,100) b left join view_roomtypes vr on vr.id=b.roomtype left join users u on u.id=b.guestid)x where status='Scheduled' and paid=0";

																								$filt = "";
																								if (col("bookingid") != "") {
																									$bookingid = str_replace("FR", "", col("bookingid"));
																									$filt .= " and id=" . $bookingid;
																								}

																								if (col("global_search") != "") {
																									$bookingid = str_replace("FR", "", col("global_search"));
																									$filt .= " and id=" . $bookingid;
																								}

																								if ($_SESSION['groupid'] == 2)
																									$filt .= " and hotelid=$_SESSION[hotel]";
																								else if ($_SESSION['groupid'] == 1)
																									$filt .= " and hotelid in (select id from hotels where admin=$_SESSION[id])";
																								else if (col("hotel") != "")
																									$filt .= " and hotelid=" . col("hotel");

																								if (col("fromdate") != "")
																									$filt .= " and cast(reg_date as date)>='" . dateindia(col("fromdate")) . "'";
																								if (col("todate") != "")
																									$filt .= " and cast(reg_date as date)<='" . dateindia(col("todate")) . "'";
																								if (col("fullname") != "")
																									$filt .= " and fullname='" . col("fullname") . "'";

																								if (col("source") != "")
																									$filt .= " and source='" . col("source") . "'";

																								if (col("hotel") != "")
																									$filt .= " and hotelid=" . col("hotel");
																								//echo $base_query.$filt;
																								$a = new pagination($base_query . $filt, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . $filt . " order by id desc limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['hours'] > 0 and $row['hours'] < 24)
																											$brn = "FR" . $row['id'];
																										else
																											$brn = "HR" . $row['id'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td13id$i'>$brn</td>
																<td id='td5id$i'>" . date_create($row['reg_date'])->format("d-M-Y H:i") . "</td>
																<td id='td4id$i'>$row[hotel]</td>
																<td id='td3id$i'>$row[city]</td>
																<td id='td3id$i'>$row[source]</td>
																<td id='td3id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[hf]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td6id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td3id$i'>$row[hours]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("h:i A") . "</td>
																<td id='td6id$i'>" . date_create($row['checkoutdatetime'])->format("h:i A") . "</td>
																<td id='td9id$i'>$row[roomtype]</td>
																<td id='td7id$i'>" . round($row['total'], 2) . "</td>
																<td id='td9id$i'><a href='https://aruljohn.com/ip/$row[ip]' target='_blank'>$row[ip]</a></td>
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='12'>No bookings to display</td></tr>";
																								} ?>
																																																																</tbody>
																																																															</table>
																																																														</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																													</div>
																																																												</div>
																																																											</div>
																	<?php
							} else if ($_GET['Pg'] == "weeklysales" and $page_access) { ?>
																																																												<h1 class="page-heading">Weekly Sales</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																												<div class="row">
																																																													<div class="col-sm-12">
																																																														<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																															<h4 class="small-title">VIEW WEEKLY SALES</h4>
																																																															<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																<form name="filter_form" method="POST">
																																																																	<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																		<div class="btn-group">
																																																																			<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																		</div>
																																																																		<div class="btn-group">
																																																																			<select class="form-control chosen-select" name="city">
																																																																				<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																						<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																			</select>
																																																																		</div>

																																																																		<div class="btn-group pull-right">
																																																																			<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																		</div>
																																																																		<div class="btn-group pull-right">
																																																																			<input type="submit" class="btn btn-success" value="Apply">
																																																																		</div>
																																																																	</div>
																																																																	<input type="hidden" name="deleteid" id="deleteid">
																																																																	<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																</form>
																																																																<table class="table table-th-block table-hover">
																																																																	<thead>
																																																																		<tr style="font-size: 11px;">
																																																																			<th>Year 2016-17(Apr 2016 to Mar 2017)</th>
																																																																			<th>Week Number</th>
																																																																			<th>Week Number</th>
																																																																			<th>Week Number</th>
																																																																			<th>Week Number</th>
																																																																			<th>WTD (Week To Date) in case middle of week.</th>
																																																																			<th>Total invoiced to customer / Paid by customer</th>
																																																																		</tr>
																																																																	</thead>
																																																																	<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																	</tbody>
																																																																</table>
																																																															</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																														</div>
																																																													</div>
																																																												</div>
																	<?php
							} else if ($_GET['Pg'] == "monthlysales" and $page_access) { ?>
																																																													<h1 class="page-heading">Monthly Sales</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																													<div class="row">
																																																														<div class="col-sm-12">
																																																															<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																<h4 class="small-title">VIEW MONTHLY SALES</h4>
																																																																<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																	<form name="filter_form" method="POST">
																																																																		<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																			<div class="btn-group">
																																																																				<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																			</div>
																																																																			<div class="btn-group">
																																																																				<select class="form-control chosen-select" name="city">
																																																																					<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																							<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																				</select>
																																																																			</div>

																																																																			<div class="btn-group pull-right">
																																																																				<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																			</div>
																																																																			<div class="btn-group pull-right">
																																																																				<input type="submit" class="btn btn-success" value="Apply">
																																																																			</div>
																																																																		</div>
																																																																		<input type="hidden" name="deleteid" id="deleteid">
																																																																		<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																	</form>
																																																																	<table class="table table-th-block table-hover">
																																																																		<thead>
																																																																			<tr style="font-size: 11px;">
																																																																				<th>Year 2016-17(Apr 2016 to Mar 2017)</th>
																																																																				<th>Apr</th>
																																																																				<th>May</th>
																																																																				<th>June</th>
																																																																				<th>July</th>
																																																																				<th>Aug</th>
																																																																				<th>Sep</th>
																																																																				<th>Oct</th>
																																																																				<th>Nov</th>
																																																																				<th>Dec</th>
																																																																				<th>Jan</th>
																																																																				<th>Feb</th>
																																																																				<th>Mar</th>
																																																																				<th>MTD(Month To Date)in case of middle of the month.</th>
																																																																				<th>Totalinvoicedtocustomer/Paid by customer</th>
																																																																			</tr>
																																																																		</thead>
																																																																		<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																		</tbody>
																																																																	</table>
																																																																</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																															</div>
																																																														</div>
																																																													</div>
																	<?php
							} else if ($_GET['Pg'] == "quarterlysales" and $page_access) { ?>
																																																														<h1 class="page-heading">Quarterly Sales</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																														<div class="row">
																																																															<div class="col-sm-12">
																																																																<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																	<h4 class="small-title">VIEW QUARTERLY SALES</h4>
																																																																	<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																		<form name="filter_form" method="POST">
																																																																			<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																				<div class="btn-group">
																																																																					<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																				</div>
																																																																				<div class="btn-group">
																																																																					<select class="form-control chosen-select" name="city">
																																																																						<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																								<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																					</select>
																																																																				</div>

																					<div class="btn-group pull-right">
																						<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																					</div>
																					<div class="btn-group pull-right">
																						<input type="submit" class="btn btn-success" value="Apply">
																					</div>
																				</div>
																				<input type="hidden" name="deleteid" id="deleteid">
																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																			</form>
																			<table class="table table-th-block table-hover">
																				<thead>
																					<tr style="font-size: 11px;"> 
		
																						<th>Year 2016-17(Apr 2016 to Mar 2017)</th>
																						<th>Q1(Apr to June)</th>
																						<th>Q2(July to Sep)</th>
																						<th>Q3(Oct to Dec)</th>
																						<th>Q4(Jan to Mar)</th>
																						<th>QTD (Quarter To Date) in case of middle of the quarter.</th>
																						<th>Total invoiced to customer / Paid by customer</th>
																					</tr>
																				</thead>
																				<tbody>
																					<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																			</tbody>
																																																																		</table>
																																																																	</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																</div>
																																																															</div>
																																																														</div>
																	<?php
							} else if ($_GET['Pg'] == "yearlysales" and $page_access) { ?>
																																																															<h1 class="page-heading">Yearly Sales</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																															<div class="row">
																																																																<div class="col-sm-12">
																																																																	<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																		<h4 class="small-title">VIEW Yearly SALES</h4>
																																																																		<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																			<form name="filter_form" method="POST">
																																																																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																					<div class="btn-group">
																																																																						<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																					</div>
																																																																					<div class="btn-group">
																																																																						<select class="form-control chosen-select" name="city">
																																																																							<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																									<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																						</select>
																																																																					</div>

																																																																					<div class="btn-group pull-right">
																																																																						<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																					</div>
																																																																					<div class="btn-group pull-right">
																																																																						<input type="submit" class="btn btn-success" value="Apply">
																																																																					</div>
																																																																				</div>
																																																																				<input type="hidden" name="deleteid" id="deleteid">
																																																																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																			</form>
																																																																			<table class="table table-th-block table-hover">
																																																																				<thead>
																																																																					<tr style="font-size: 11px;">
																																																																						<th>2016-17(Apr 2016 to Mar 2017)</th>
																																																																						<th>2017-18(Apr 2017 to Mar 2018)</th>
																																																																						<th>2018-19(Apr 2018 to Mar 2019)</th>
																																																																						<th>YTD (Year To Date) in case of middle of the year.</th>
																																																																						<th>Total invoiced to customer / Paid by customer</th>
																																																																					</tr>
																																																																				</thead>
																																																																				<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																				</tbody>
																																																																			</table>
																																																																		</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																	</div>
																																																																</div>
																																																															</div>
																	<?php
							} else if ($_GET['Pg'] == "totalnumberofuniqueusers" and $page_access) { ?>
																																																																<h1 class="page-heading">Total Number of Unique Users</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																<div class="row">
																																																																	<div class="col-sm-12">
																																																																		<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																			<h4 class="small-title">VIEW Total Number of Unique Users</h4>
																					<?php modal("City", "city") ?>
																																																																			<form name="filter_form" method="POST">
																																																																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																					<div class="btn-group">
																																																																						<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																					</div>
																																																																					<div class="btn-group">
																																																																						<select class="form-control chosen-select" name="city">
																																																																							<option value="">City</option>
																									<?php $result = $conn->query("select id,city from cities order by city");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																									<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																										<?php
																									} ?>
																																																																						</select>
																																																																					</div>
																																																																					<div class="btn-group pull-right">
																																																																						<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																					</div>
																																																																					<div class="btn-group pull-right">
																																																																						<input type="submit" class="btn btn-success" value="Apply">
																																																																					</div>
																																																																				</div>
																																																																				<input type="hidden" name="deleteid" id="deleteid">
																																																																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																			</form>
																																																																			<div class="table-responsive" style="overflow-x:scroll;">
																																																																				<table class="table table-th-block table-hover">
																																																																					<thead>
																																																																						<tr>
																																																																							<th style="width:40px;">Sr.</th>
																																																																							<th>Name</th>
																																																																							<th>Email</th>
																																																																							<th>Mobile</th>
																																																																							<th>Address</th>
																																																																							<th>City</th>
																																																																							<th>State</th>
																																																																							<th>Registration Date</th>
																																																																							<th>Block</th>
																																																																						</tr>
																																																																					</thead>
																																																																					<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select u.id,u.fullname,u.email,u.contact,u.address1,u.travelercity,s.state,u.reg_date,u.active from users u join states s on s.id=u.travelerstate where groupid=5";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by u.fullname limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[email]</td>
																<td id='td4id$i'>$row[contact]</td>
																<td id='td5id$i'>$row[address1]</td>
																<td id='td6id$i'>$row[travelercity]</td>
																<td id='td7id$i'>$row[state]</td>
																<td id='td8id$i'>$row[reg_date]</td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																					</tbody>
																																																																				</table>
																																																																			</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																		</div>
																																																																	</div>
																																																																</div>
																	<?php
							} else if ($_GET['Pg'] == "totalmoneysavedforusers" and $page_access) { ?>
																																																																	<h1 class="page-heading">Total Money Saved For Users</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																	<div class="row">
																																																																		<div class="col-sm-12">
																																																																			<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																				<h4 class="small-title">VIEW TOTAL MONEY SAVED FOR USERS</h4>
																																																																				<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																					<form name="filter_form" method="POST">
																																																																						<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																							<div class="btn-group">
																																																																								<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																							</div>
																																																																							<div class="btn-group">
																																																																								<select class="form-control chosen-select" name="city">
																																																																									<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																											<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																								</select>
																																																																							</div>

																																																																							<div class="btn-group pull-right">
																																																																								<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																							</div>
																																																																							<div class="btn-group pull-right">
																																																																								<input type="submit" class="btn btn-success" value="Apply">
																																																																							</div>
																																																																						</div>
																																																																						<input type="hidden" name="deleteid" id="deleteid">
																																																																						<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																					</form>
																																																																					<table class="table table-th-block table-hover">
																																																																						<thead>
																																																																							<tr>
																																																																								<th>Hotel's Price for per night</th>
																																																																								<th>Frotel booked Price</th>
																																																																								<th>Difference</th>
																																																																							</tr>
																																																																						</thead>
																																																																						<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																						</tbody>
																																																																					</table>
																																																																				</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																			</div>
																																																																		</div>
																																																																	</div>
																	<?php
							} else if ($_GET['Pg'] == "hotels" and $page_access) { ?>
																																																																		<h1 class="page-heading">Hotels</h1>
																																																																		<div class="row">
																																																																			<div class="col-sm-12">
																																																																				<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$hotelid = col("deleteid");
																						$row = execute("select count(*)cnt from bookings b join roomtypes r on r.id=b.roomtype where r.hotel=$hotelid and b.paid=1");
																						if ($row['cnt'] == 0 and $_SESSION['hotel'] != $hotelid) {
																							$conn->query("delete t,lt from taxes t left join luxurytaxes lt on lt.tax=t.id where t.hotel=$hotelid");
																							$conn->query("delete from reviews where hotel=$hotelid");
																							$conn->query("delete from hotel_proximities where hotel=$hotelid");
																							$conn->query("delete d,dr from discounts d join discountedrooms dr on d.id=dr.discount where d.hotel=$hotelid");
																							$conn->query("delete sr,srd,sfrd from seasonalrates sr left join seasonalratedetails srd on srd.rateid=sr.id left join seasonalfrotelratedetails sfrd on sfrd.rateid where sr.hotel=$hotelid");
																							$conn->query("delete hr from hotelrates hr join roomtypes r on r.id=hr.roomtype where r.hotel=$hotelid");
																							$conn->query("delete from hotel_facilities where hotel=$hotelid");
																							$conn->query("delete pci,pct,pc from promocodeids pci join promocodes pc on pc.promocodeid=pci.id join promocodetargets pct on pc.id=pct.promocodeid where pct.targetid=$hotelid and pci.target='hotel'");
																							$conn->query("delete rf from room_facilities rf join roomtypes r on r.id=rf.roomtype where r.hotel=$hotelid");
																							$conn->query("delete rn from roomnumbers rn join roomtypes r on r.id=rn.roomtype where r.hotel=$hotelid");
																							$conn->query("delete p from pictures p join roomtypes r on (r.id=p.propertyid and p.type='Room') where r.hotel=$hotelid");
																							$conn->query("delete from pictures where propertyid=$hotelid and type='Hotel'");
																							$conn->query("delete from roomtypes where hotel=$hotelid");
																							$conn->query("delete h,u from hotels h join users u on u.id=h.user where h.id=$hotelid");

																							alertbox("success", "Hotel has been deleted");
																						} else if ($_SESSION['hotel'] == $hotelid)
																							alertbox("danger", "Hotel selected in navigation bar can not be deleted. First deselect it, in order to delete.");
																						else
																							alertbox("danger", "Hotel could not be deleted");
																					}

																					if (col("verifyid") != "") {
																						$conn->query("update hotels set frotelverified=1 where id=" . col("verifyid"));
																						alertbox("success", "Hotel marked as 'Frotel Verified'");
																					}

																					if (col("blockid") != "") {
																						$row = execute("select u.active from users u join hotels h on h.user=u.id where h.id=" . col("blockid"));
																						if ($row['active']) {
																							$conn->query("update users u join hotels h on h.user=u.id set u.active=0 where h.id=" . col("blockid"));
																							alertbox("success", "Hotel blocked successfully");
																						} else {
																							$conn->query("update users u join hotels h on h.user=u.id set u.active=1 where h.id=" . col("blockid"));
																							alertbox("success", "Hotel unblocked successfully");
																						}
																					} ?>
																																																																					<h4 class="small-title">VIEW HOTELS</h4>
																																																																					<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("Hotel", "hotel");
																						verifymodal("Hotel", "hotel");
																						blockmodal("Hotel", "hotel");
																						unblockmodal("Hotel", "hotel") ?>
																																																																						<form name="filter_form" method="POST">
																																																																							<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																								<div class="btn-group">
																																																																									<input type="text" class="form-control" name="fhotel" placeholder="Hotel name" value="<?= col("fhotel") ?>">
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<select class="form-control chosen-select" name="fcity">
																																																																										<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																												<option value="<?= $row['id'] ?>" <?= selected(col("fcity"), $row['id']) ?>><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																									</select>
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<select class="form-control" name="status">
																																																																										<option value="">Status</option>
																																																																										<option value="1" <?= selected(col("status"), "1") ?>>E-Mob Verified</option>
																																																																										<option value="0" <?= selected(col("status"), "0") ?>>E-Mob Pending</option>
																																																																									</select>
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<select class="form-control" name="mkw">
																																																																										<option value="">Meta Keywords</option>
																																																																										<option value="1" <?= selected(col("mkw"), "1") ?>>Entered</option>
																																																																										<option value="0" <?= selected(col("mkw"), "0") ?>>Not Entered</option>
																																																																									</select>
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<select class="form-control" name="mkd">
																																																																										<option value="">Meta Description</option>
																																																																										<option value="1" <?= selected(col("mkd"), "1") ?>>Entered</option>
																																																																										<option value="0" <?= selected(col("mkd"), "0") ?>>Not Entered</option>
																																																																									</select>
																																																																								</div>
																																																																								<div class="btn-group pull-right">
																																																																									<input type="submit" class="btn btn-success" value="Apply">
																																																																								</div>
																																																																							</div>
																																																																							<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																								<div class="btn-group">
																																																																									<input type="text" class="form-control" name="email" placeholder="Email" value="<?= col("email") ?>">
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<input type="text" class="form-control" name="contact" placeholder="Contact Number" value="<?= col("contact") ?>">
																																																																								</div>
																																																																								<div class="btn-group">
																																																																									<select class="form-control" name="fverified">
																																																																										<option value="">Frotel Verified</option>
																																																																										<option value="1" <?= selected(col("fverified"), "1") ?>>Verified</option>
																																																																										<option value="0" <?= selected(col("fverified"), "0") ?>>Not Verified</option>
																																																																									</select>
																																																																								</div>
																																																																								<div class="btn-group pull-right">
																																																																									<a href="?Pg=hotels"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																								</div>
																																																																							</div>
																																																																							<input type="hidden" name="deleteid" id="deleteid">
																																																																							<input type="hidden" name="deleteid2" id="deleteid2">
																																																																							<input type="hidden" name="verifyid" id="verifyid">
																																																																							<input type="hidden" name="blockid" id="blockid">
																																																																							<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																							<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																						</form>
																																																																						<table class="table table-th-block table-hover">
																																																																							<thead>
																																																																								<tr>
																																																																									<th style="width: 40px;">ID</th>
																																																																									<th>City</th>
																																																																									<th>Hotel</th>
																																																																									<th>Concerned Person</th>
																																																																									<th>Contact</th>
																																																																									<th>Email</th>
																																																																									<th>Meta Keywords</th>
																																																																									<th>Meta Description</th>
																																																																									<th>Status</th>
																																																																									<th>Physical Verification</th>
																																																																									<th>Email Key</th>
																																																																									<th>OTP</th>
																																																																									<th>Block</th>
																																																																									<th>View</th>
																																																																									<th>Delete</th>
																																																																								</tr>
																																																																							</thead>
																																																																							<tbody>
																								<?php $pagesize = 8;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select x.* from (select h.id,c.id as cityid,c.city,u.company,u.fullname,u.contact,u.email, h.frotelverified,(case when u.emailverified=1 and u.mobileverified=1 then 1 else 0 end)status,h.meta_keywords, h.meta_description,u.active,u.emailkey,u.otp from hotels h left join users u on u.id=h.user left join locations l on l.id=h.location left join cities c on c.id=l.city where u.groupid=2)x where 1";

																								$filt = "";

																								if (col("fhotel") != "")
																									$filt .= " and x.company like '%" . col("fhotel") . "%'";
																								if (col("fcity") != "")
																									$filt .= " and x.cityid=" . col("fcity");
																								if (col("status") != "")
																									$filt .= " and x.status=" . col("status");

																								if (col("mkw") != "") {
																									if (col("mkw"))
																										$filt .= " and x.meta_keywords<>''";
																									else
																										$filt .= " and x.meta_keywords=''";
																								}
																								if (col("mkd") != "") {
																									if (col("mkd"))
																										$filt .= " and x.meta_description<>''";
																									else
																										$filt .= " and x.meta_description=''";
																								}
																								if (col("fverified") != "") {
																									if (col("fverified"))
																										$filt .= " and x.frotelverified=1";
																									else
																										$filt .= " and x.frotelverified=0";
																								}
																								if (col("email") != "")
																									$filt .= " and x.email='" . col("email") . "'";
																								if (col("contact") != "")
																									$filt .= " and x.contact='" . col("contact") . "'";

																								$a = new pagination($base_query . $filt, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . $filt . " order by x.city,x.company limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$str .= "<tr>
																<td id='td1id$i'>$row[id]</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[company]</td>
																<td id='td4id$i'>$row[fullname]</td>
																<td id='td5id$i'>$row[contact]</td>
																<td id='td6id$i'>$row[email]</td>";

																										if ($row['meta_keywords'] == "")
																											$str .= "<td id='td7id$i' align=center><i class='fa fa-times text-danger'></i></td>";
																										else
																											$str .= "<td id='td7id$i' align=center><i class='fa fa-check text-success'></i></td>";

																										if ($row['meta_description'] == "")
																											$str .= "<td id='td8id$i' align=center><i class='fa fa-times text-danger'></i></td>";
																										else
																											$str .= "<td id='td8id$i' align=center><i class='fa fa-check text-success'></i></td>";

																										if ($row['status'])
																											$str .= "<td id='td7id$i' align=center><span class='label label-success' title='Email and mobile  of this partner are verified'>E-Mob Verified</span></td>";
																										else
																											$str .= "<td id='td7id$i' align=center><span class='label label-danger' title='Email or mobile verification is pending of this partner'>E-Mob Pending</span></td>";

																										if ($row['frotelverified'])
																											$str .= "<td><span class='label label-success' title='This hotel is physically verified'>Verified</span></td>";
																										else
																											$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'  title='This hotel is yet to be verified'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";

																										$str .= "
																<td>$row[emailkey]</td>
																<td>$row[otp]</td>";

																										if ($row['active'])
																											$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])' title='This hotel is currently unblocked'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block?</span></a></td>";
																										else
																											$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater5($row[id])' title='This hotel is currently blocked'><span class='label label-success' data-toggle='modal' data-target='#SuccessModalColor5'>Unblock?</span></a></td>";

																										$str .= "<td><a href='?Pg=basicinfo&current_city=$row[cityid]&current_hotel=$row[id]' target='_blank'><span class='label label-purple'>View</span></a></td>
																
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])' title='Delete this hotel'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='11'>No hotels to display</td></tr>";
																								} ?>
																																																																							</tbody>
																																																																						</table>
																																																																					</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																				</div>
																																																																			</div>
																																																																		</div>
																	<?php
							} else if ($_GET['Pg'] == "hotelchains" and $page_access) { ?>
																																																																			<h1 class="page-heading">Hotel Chains</h1>
																																																																			<div class="row">
																																																																				<div class="col-sm-12">
																																																																					<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$admin = col("deleteid");
																						$row = execute("select count(*)cnt from hotels where admin=$admin");
																						if ($row['cnt'] == 0) {
																							$conn->query("delete from users where id=$admin and groupid=1");
																							alertbox("success", "Hotel chain has been deleted");
																						} else
																							alertbox("danger", "Hotel chain having hotels defined in it, can not be deleted.</p><p>Delete the Hotels first.");
																					}

																					if (col("blockid") != "") {
																						$row = execute("select active from users where id=" . col("blockid"));
																						if ($row['active']) {
																							$conn->query("update users u left join hotels h on h.admin=u.id left join u2 on u2.id=h.user set u.active=0,u2.active=0 where u.id=" . col("blockid"));
																							alertbox("success", "Hotel chain has been blocked");
																						} else {
																							$conn->query("update users set active=1 where id=" . col("blockid"));
																							alertbox("success", "Hotel chain has been unblocked");
																						}
																					} ?>
																																																																						<h4 class="small-title">VIEW HOTEL CHAINS</h4>
																																																																						<div class="table-responsive" style="overflow-x:scroll">
																						<?php modal("Hotel Chain", "hotel chain");
																						blockmodal("Hotel Chain", "hotel chain");
																						unblockmodal("Hotel Chain", "hotel chain") ?>
																																																																							<form name="filter_form" method="POST">
																																																																								<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px">
																																																																									<div class="btn-group">
																																																																										<input type="text" class="form-control" name="fhotel" placeholder="Hotel name" value="<?= col("fhotel") ?>">
																																																																									</div>
																																																																									<div class="btn-group">
																																																																										<select class="form-control chosen-select" name="fcity">
																																																																											<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																													<option value="<?= $row['id'] ?>" <?= selected(col("fcity"), $row['id']) ?>><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																										</select>
																																																																									</div>
																																																																									<div class="btn-group">
																																																																										<select class="form-control" name="status">
																																																																											<option value="">Status</option>
																																																																											<option value="1" <?= selected(col("status"), "1") ?>>E-Mob Verified</option>
																																																																											<option value="0" <?= selected(col("status"), "0") ?>>E-Mob Pending</option>
																																																																										</select>
																																																																									</div>
																																																																									<div class="btn-group">
																																																																										<input type="text" class="form-control" name="email" placeholder="Email" value="<?= col("email") ?>">
																																																																									</div>
																																																																									<div class="btn-group">
																																																																										<input type="text" class="form-control" name="contact" placeholder="Contact Number" value="<?= col("contact") ?>">
																																																																									</div>
																																																																									<div class="btn-group pull-right">
																																																																										<input type="submit" class="btn btn-success" value="Apply">
																																																																									</div>
																																																																								</div>
																																																																								<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px">
																																																																									<div class="btn-group pull-right">
																																																																										<a href="?Pg=hotelchains"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																									</div>
																																																																								</div>
																																																																								<input type="hidden" name="deleteid" id="deleteid">
																																																																								<input type="hidden" name="deleteid2" id="deleteid2">
																																																																								<input type="hidden" name="verifyid" id="verifyid">
																																																																								<input type="hidden" name="blockid" id="blockid">
																																																																								<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																								<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																							</form>
																																																																							<table class="table table-th-block table-hover">
																																																																								<thead>
																																																																									<tr>
																																																																										<th style="width: 40px;">ID</th>
																																																																										<th>City</th>
																																																																										<th>Company Name</th>
																																																																										<th>Concerned Person</th>
																																																																										<th>Contact</th>
																																																																										<th>Email</th>
																																																																										<th>Status</th>
																																																																										<th>Email Key</th>
																																																																										<th>OTP</th>
																																																																										<th>Hotels</th>
																																																																										<th>Block</th>
																																																																										<th>Delete</th>
																																																																									</tr>
																																																																								</thead>
																																																																								<tbody>
																								<?php $pagesize = 20;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select x.* from (select u.id,c.id as cityid,c.city,u.company,u.fullname,u.contact,u.email,(case when u.emailverified=1 and u.mobileverified=1 then 1 else 0 end)status,u.active,u.emailkey,u.otp,(select count(*) from hotels where admin=u.id)hotels from users u left join cities c on c.id=u.city where u.groupid=1)x where 1";

																								$filt = "";

																								if (col("fhotel") != "")
																									$filt .= " and x.company like '%" . col("fhotel") . "%'";
																								if (col("fcity") != "")
																									$filt .= " and x.cityid=" . col("fcity");
																								if (col("status") != "")
																									$filt .= " and x.status=" . col("status");

																								if (col("email") != "")
																									$filt .= " and x.email='" . col("email") . "'";
																								if (col("contact") != "")
																									$filt .= " and x.contact='" . col("contact") . "'";

																								$a = new pagination($base_query . $filt, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . $filt . " order by x.city,x.company limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$str .= "<tr>
																<td id='td1id$i'>$row[id]</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[company]</td>
																<td id='td4id$i'>$row[fullname]</td>
																<td id='td5id$i'>$row[contact]</td>
																<td id='td6id$i'>$row[email]</td>";

																										if ($row['status'])
																											$str .= "<td id='td7id$i' align=center><span class='label label-success' title='Email and mobile  of this partner are verified'>E-Mob Verified</span></td>";
																										else
																											$str .= "<td id='td7id$i' align=center><span class='label label-danger' title='Email or mobile verification is pending of this partner'>E-Mob Pending</span></td>";

																										$str .= "
																<td>$row[emailkey]</td>
																<td>$row[otp]</td>
																<td><a href='LBF_viewchainhotels.php?id=$row[id]' class='fancybox4 fancybox.iframe'><span class='label label-purple'>($row[hotels]) Hotels</span></a></td>";

																										if ($row['active'])
																											$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])' title='This hotel is currently unblocked'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";
																										else
																											$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater5($row[id])' title='This hotel is currently blocked'><span class='label label-success' data-toggle='modal' data-target='#SuccessModalColor5'>Unblock?</span></a></td>";

																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])' title='Delete this hotel'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='11'>No hotel chains to display</td></tr>";
																								} ?>
																																																																								</tbody>
																																																																							</table>
																																																																						</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																					</div>
																																																																				</div>
																																																																			</div>
																	<?php
							} else if ($_GET['Pg'] == "totalhotelchainpartners" and $page_access) { ?>
																																																																				<h1 class="page-heading">Total Hotel Chain Partners</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																				<div class="row">
																																																																					<div class="col-sm-12">
																																																																						<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																							<h4 class="small-title">VIEW TOTAL HOTEL CHAIN PARTNERS </h4>
																																																																							<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																								<form name="filter_form" method="POST">
																																																																									<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																										<div class="btn-group">
																																																																											<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																										</div>
																																																																										<div class="btn-group">
																																																																											<select class="form-control chosen-select" name="city">
																																																																												<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																														<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																											</select>
																																																																										</div>

																																																																										<div class="btn-group pull-right">
																																																																											<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																										</div>
																																																																										<div class="btn-group pull-right">
																																																																											<input type="submit" class="btn btn-success" value="Apply">
																																																																										</div>
																																																																									</div>
																																																																									<input type="hidden" name="deleteid" id="deleteid">
																																																																									<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																								</form>
																																																																								<table class="table table-th-block table-hover">
																																																																									<thead>
																																																																										<tr>
																																																																											<th style="width: 40PX;">Sr #</th>
																																																																											<th>Hotel Chain Name</th>
																																																																											<th>Number Of Hotels in the Chain Listed with Frotels</th>
																																																																											<th>City</th>
																																																																										</tr>
																																																																									</thead>
																																																																									<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																									</tbody>
																																																																								</table>
																																																																							</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																						</div>
																																																																					</div>
																																																																				</div>
																	<?php
							} else if ($_GET['Pg'] == "totalnumberofagents" and $page_access) { ?>
																																																																					<h1 class="page-heading">Total Number Of Agents</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																					<div class="row">
																																																																						<div class="col-sm-12">
																																																																							<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																								<h4 class="small-title">VIEW TOTAL NUMBER OF AGENTS</h4>
																																																																								<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																									<form name="filter_form" method="POST">
																																																																										<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																											<div class="btn-group">
																																																																												<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																											</div>
																																																																											<div class="btn-group">
																																																																												<select class="form-control chosen-select" name="city">
																																																																													<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																															<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																												</select>
																																																																											</div>

																																																																											<div class="btn-group pull-right">
																																																																												<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																											</div>
																																																																											<div class="btn-group pull-right">
																																																																												<input type="submit" class="btn btn-success" value="Apply">
																																																																											</div>
																																																																										</div>
																																																																										<input type="hidden" name="deleteid" id="deleteid">
																																																																										<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																									</form>
																																																																									<table class="table table-th-block table-hover">
																																																																										<thead>
																																																																											<tr>
																																																																												<th style="width: 40PX;">Sr #</th>
																																																																												<th>Agent Name</th>
																																																																												<th>City Name</th>
																																																																											</tr>
																																																																										</thead>
																																																																										<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																										</tbody>
																																																																									</table>
																																																																								</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																							</div>
																																																																						</div>
																																																																					</div>
																	<?php
							} else if ($_GET['Pg'] == "totalnumberofcorporates" and $page_access) { ?>
																																																																						<h1 class="page-heading">Total Number Of Corporates</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																						<div class="row">
																																																																							<div class="col-sm-12">
																																																																								<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																									<h4 class="small-title">VIEW TOTAL NUMBER OF CORPORATES</h4>
																																																																									<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																										<form name="filter_form" method="POST">
																																																																											<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																												<div class="btn-group">
																																																																													<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																												</div>
																																																																												<div class="btn-group">
																																																																													<select class="form-control chosen-select" name="city">
																																																																														<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																													</select>
																																																																												</div>

																																																																												<div class="btn-group pull-right">
																																																																													<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																												</div>
																																																																												<div class="btn-group pull-right">
																																																																													<input type="submit" class="btn btn-success" value="Apply">
																																																																												</div>
																																																																											</div>
																																																																											<input type="hidden" name="deleteid" id="deleteid">
																																																																											<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																										</form>
																																																																										<table class="table table-th-block table-hover">
																																																																											<thead>
																																																																												<tr>
																																																																													<th style="width: 40PX;">Sr #</th>
																																																																													<th>Corporate Name</th>
																																																																													<th>City Name</th>
																																																																												</tr>
																																																																											</thead>
																																																																											<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																											</tbody>
																																																																										</table>
																																																																									</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																								</div>
																																																																							</div>
																																																																						</div>
																	<?php
							} else if ($_GET['Pg'] == "hotelsondiscounttoday" and $page_access) { ?>
																																																																							<h1 class="page-heading">Hotels On Discount Today</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																							<div class="row">
																																																																								<div class="col-sm-12">
																																																																									<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																										<h4 class="small-title">HOTELS ON DISCOUNT TODAY</h4>
																																																																										<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																											<form name="filter_form" method="POST">
																																																																												<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																													<div class="btn-group">
																																																																														<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																													</div>
																																																																													<div class="btn-group">
																																																																														<select class="form-control chosen-select" name="city">
																																																																															<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																	<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																														</select>
																																																																													</div>

																																																																													<div class="btn-group pull-right">
																																																																														<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																													</div>
																																																																													<div class="btn-group pull-right">
																																																																														<input type="submit" class="btn btn-success" value="Apply">
																																																																													</div>
																																																																												</div>
																																																																												<input type="hidden" name="deleteid" id="deleteid">
																																																																												<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																											</form>
																																																																											<table class="table table-th-block table-hover">
																																																																												<thead>
																																																																													<tr>
																																																																														<th style="width: 40PX;">Sr #</th>
																																																																														<th>Date</th>
																																																																														<th>Name of the Hotel </th>
																																																																														<th>City</th>
																																																																														<th>% Discount offering</th>
																																																																													</tr>
																																																																												</thead>
																																																																												<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																												</tbody>
																																																																											</table>
																																																																										</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																									</div>
																																																																								</div>
																																																																							</div>
																	<?php
							} else if ($_GET['Pg'] == "frotelscouponreport" and $page_access) { ?>
																																																																								<h1 class="page-heading">Frotels Coupon Report</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																								<div class="row">
																																																																									<div class="col-sm-12">
																																																																										<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																											<h4 class="small-title">FROTELS COUPON REPORT</h4>
																																																																											<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																												<form name="filter_form" method="POST">
																																																																													<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																														<div class="btn-group">
																																																																															<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																														</div>
																																																																														<div class="btn-group">
																																																																															<select class="form-control chosen-select" name="city">
																																																																																<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																		<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																															</select>
																																																																														</div>

																																																																														<div class="btn-group pull-right">
																																																																															<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																														</div>
																																																																														<div class="btn-group pull-right">
																																																																															<input type="submit" class="btn btn-success" value="Apply">
																																																																														</div>
																																																																													</div>
																																																																													<input type="hidden" name="deleteid" id="deleteid">
																																																																													<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																												</form>
																																																																												<table class="table table-th-block table-hover">
																																																																													<thead>
																																																																														<tr>
																																																																															<th style="width: 40PX;">Sr #</th>
																																																																															<th>Date</th>
																																																																															<th>Name of the Hotel </th>
																																																																															<th>City</th>
																																																																															<th>% Discount offering</th>
																																																																														</tr>
																																																																													</thead>
																																																																													<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																													</tbody>
																																																																												</table>
																																																																											</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																										</div>
																																																																									</div>
																																																																								</div>
																	<?php
							} else if ($_GET['Pg'] == "partnertieupspending" and $page_access) { ?>
																																																																									<h1 class="page-heading">Partner Tie Ups Pending</h1>
																		<?php if (col("city") != "") {
																			$latitude = $_POST['latitude'];
																			$longitude = $_POST['longitude'];
																			$state = $_POST['state'];
																			$city = $_POST['city'];

																			$row = execute("select count(*)cnt from cities where city='$city'");

																			if ($row['cnt'] == 0) {
																				$filename = saveimage("cityimage", "../images/cityimages/", 1920);

																				if ($filename != "") {
																					$conn->query("insert into cities (state,city,latitude,longitude,path) values ($state,'$city','$latitude','$longitude','$filename')");
																					$cityid = $conn->insert_id;

																					$msg = "City added successfully";
																					$clrclass = "success";
																				} else {
																					$msg = "City could not be saved";
																					$clrclass = "danger";
																				}
																			} else {
																				$msg = "City already exist";
																				$clrclass = "danger";
																			}
																		} ?>
																																																																									<div class="row the-box">
																																																																										<div class="col-xs-12">
																																																																											<h4>HOTEL PARTNER PROCESS PENDING</h4>
																																																																											<div class="col-xs-3 center">
																																																																												<div class="block">
																																																																													<div>
																																																																														<p class="link">100%</p>
																																																																													</div>
																																																																													<div class="border"></div>
																																																																													<div class="color">
																																																																														<p class="line">20</p>
																																																																													</div>
																																																																												</div>
																																																																											</div>
																																																																											<div class="col-xs-3 center">
																																																																												<div class="block">
																																																																													<div>
																																																																														<p class="link">75%</p>
																																																																													</div>
																																																																													<div class="border"></div>
																																																																													<div class="color-1">
																																																																														<p class="line">40</p>
																																																																													</div>
																																																																												</div>
																																																																											</div>
																																																																											<div class="col-xs-3 center">
																																																																												<div class="block">
																																																																													<div>
																																																																														<p class="link">50%</p>
																																																																													</div>
																																																																													<div class="border"></div>
																																																																													<div class="color-2">
																																																																														<p class="line">60</p>
																																																																													</div>
																																																																												</div>
																																																																											</div>
																																																																											<div class="col-xs-3 center">
																																																																												<div class="block">
																																																																													<div>
																																																																														<p class="link">25%</p>
																																																																													</div>
																																																																													<div class="border"></div>
																																																																													<div class="color-3">
																																																																														<p class="line">80</p>
																																																																													</div>
																																																																												</div>
																																																																											</div>
																																																																										</div>

																																																																									</div>
																																																																									<div class="row">
																																																																										<div class="col-sm-12">
																																																																											<div class="the-box">
																					<?php if (col("deleteid") != "") {
																						$id = nosql($_POST['deleteid']);
																						$row = execute("select count(*)cnt from locations where city=$id");

																						if ($row['cnt'] > 0)
																							alertbox("danger", "City could not be deleted");
																						else {
																							$conn->query("delete from cities where id=$id");
																							alertbox("success", "City has been deleted");
																						}
																					} ?>
																																																																												<h4 class="small-title">PARTNER TIP UPS PENDING</h4>
																																																																												<div class="table-responsive" style="overflow-x:scroll;">
																						<?php modal("City", "city") ?>
																																																																													<form name="filter_form" method="POST">
																																																																														<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																															<div class="btn-group">
																																																																																<input type="text" class="form-control" name="workshop" placeholder="Workshop Title" value="<?= col("workshop") ?>">
																																																																															</div>
																																																																															<div class="btn-group">
																																																																																<select class="form-control chosen-select" name="city">
																																																																																	<option value="">City</option>
																										<?php $result = $conn->query("select id,city from cities order by city");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																			<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																											<?php
																										} ?>
																																																																																</select>
																																																																															</div>

																																																																															<div class="btn-group pull-right">
																																																																																<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																															</div>
																																																																															<div class="btn-group pull-right">
																																																																																<input type="submit" class="btn btn-success" value="Apply">
																																																																															</div>
																																																																														</div>
																																																																														<input type="hidden" name="deleteid" id="deleteid">
																																																																														<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																													</form>
																																																																													<table class="table table-th-block table-hover">
																																																																														<thead>
																																																																															<tr>
																																																																																<th style="width: 40px;">Sr.</th>
																																																																																<th>Hotel Name</th>
																																																																																<th>Email Verified</th>
																																																																																<th>Hotel Basic Info</th>
																																																																																<th>Hotel Contact Information</th>
																																																																																<th>Hotel Useful Information</th>
																																																																																<th>Hotel Facilities</th>
																																																																																<th>Hotel Images</th>
																																																																																<th>Hotels Policy</th>
																																																																																<th>Bank Details</th>
																																																																																<th>Payment Terms</th>
																																																																																<th>Room Types</th>
																																																																																<th>Approved by Frotels</th>
																																																																															</tr>
																																																																														</thead>
																																																																														<tbody>
																								<?php $pagesize = 50;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select c.id,c.city,s.state,con.country,c.latitude,c.longitude,c.path from cities c left join states s on c.state=s.id left join countries con on con.id=s.country";

																								$a = new pagination($base_query, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . " order by con.id,s.state,c.city limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										if ($row['path'] != "")
																											$path = $row['path'];
																										else
																											$path = "booking-confirm-bannar.png";

																										if ($row['latitude'] == "" or $row['longitude'] == "")
																											$coordinates = "-";
																										else
																											$coordinates = $row['latitude'] . ", " . $row['longitude'];

																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>$row[city]</td>
																<td id='td3id$i'>$row[state]</td>
																<td id='td4id$i'>$row[country]</td>
																<td id='td5id$i'>$coordinates</td>
																<td id='td6id$i'><a href='LBF_cityimage.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><img src='../images/cityimages/$path' width='140' border='0' alt=''></a></td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Edit</span></a></td>
																<td><a href='javascript:void(0)' onClick='modal_button_updater($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor2'>Delete</span></a></td>
																
																</tr>";
																										$i++;
																									}
																									//echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No cities to display</td></tr>";
																								} ?>
																																																																														</tbody>
																																																																													</table>
																																																																												</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																											</div>
																																																																										</div>
																																																																									</div>
																	<?php
							} else if ($_GET['Pg'] == "checkinlist" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																																										<h1 class="page-heading">Check In List</h1>
																																																																										<div class="row">
																																																																											<div class="col-sm-12">
																																																																												<div class="the-box">
																																																																													<h4 class="small-title">CHECK IN LIST</h4>
																																																																													<form name="filter_form" method="POST">
																																																																														<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																															<div class="btn-group">
																																																																																<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#">
																																																																															</div>
																																																																															<div class="btn-group">
																																																																																<select class="form-control chosen-select" name="fullname" style="width:220px">
																																																																																	<option value="">Guest Name</option>
																									<?php $result = $conn->query("select id,fullname from users where groupid=5 order by fullname");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																			<option value="<?= $row['fullname'] ?>" <?= selected(col("fullname"), $row['fullname']) ?>><?= $row['fullname'] ?></option>
																										<?php
																									} ?>
																																																																																</select>
																																																																															</div>
																																																																															<div class="btn-group">
																																																																																<select class="form-control" name="source">
																																																																																	<option value="">Source</option>
																																																																																	<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																																																	<option value="Agent" <?= selected(col("source"), "Agent") ?>>Agent</option>
																																																																																	<option value="Corporate" <?= selected(col("source"), "Corporate") ?>>Corporate</option>
																																																																																</select>
																																																																															</div>

																							<?php if ($_SESSION['groupid'] == 0) { ?>
																																																																																	<div class="btn-group">
																																																																																		<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																			<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																																					<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																																		</select>
																																																																																	</div>
																								<?php
																							} else if ($_SESSION['groupid'] == 1) { ?>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																				<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2 and h.id in (select id from hotels where admin=$_SESSION[id])");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																																			</select>
																																																																																		</div>
																								<?php
																							} ?>
																																																																															<div class="btn-group pull-right">
																																																																																<a href="?Pg=checkinlist"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																															</div>
																																																																															<div class="btn-group pull-right">
																																																																																<input type="submit" class="btn btn-success" value="Apply">
																																																																															</div>
																																																																														</div>
																																																																														<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																													</form>
																																																																													<div class="table-responsive" style="overflow-x:scroll;">
																																																																														<table class="table table-th-block table-hover">
																																																																															<thead>
																																																																																<tr>
																																																																																	<th style="width:40px">Sr.</th>
																																																																																	<th>BR#</th>
																																																																																	<th>Guest Name</th>
																																																																																	<th>Source Of Booking (Direct/Agent/Corp)</th>
																																																																																	<th>Hotel Name</th>
																																																																																	<th>Check In Date</th>
																																																																																	<th>Check Out Date</th>
																																																																																	<th>Number of Nights booked</th>
																																																																																	<th>Date of Booking</th>
																																																																																	<th>Hotel / Frotel Booking</th>
																																																																																	<th>Check in Time</th>
																																																																																	<th>Check Out Time</th>
																																																																																	<th>Number of Hours</th>
																																																																																</tr>
																																																																															</thead>
																																																																															<tbody>
																								<?php $pagesize = 30;

																								if (col('cnt') != "") {
																									$current_page = $_POST['cnt'];
																								} else {
																									$current_page = 1;
																								}

																								$base_query = "select b.id,b.source,vr.hotel,b.checkindatetime,b.checkoutdatetime,DATEDIFF(cast(b.checkoutdatetime as date),cast(b.checkindatetime as date))nights,b.reg_date,(case when b.hours>0 and b.hours<24 then 'Fotel' else 'Hotel' end)hf,b.usercheckedin,b.usercheckedout,b.hours,u.fullname from bookings b left join view_roomtypes vr on vr.id=b.roomtype left join users u on u.id=b.guestid where b.paid=1";

																								$filt = "";
																								if (col("bookingid") != "") {
																									$bookingid = str_replace("FR", "", col("bookingid"));
																									$filt .= " and b.id=" . $bookingid;
																								}

																								if ($_SESSION['groupid'] == 2)
																									$filt .= " and vr.hotelid=$_SESSION[hotel]";
																								else if ($_SESSION['groupid'] == 1)
																									$filt .= " and vr.hotelid in (select id from hotels where admin=$_SESSION[id])";
																								else if (col("hotel") != "")
																									$filt .= " and vr.hotelid=" . col("hotel");

																								if (col("fullname") != "")
																									$filt .= " and u.fullname='" . col("fullname") . "'";

																								if (col("source") != "")
																									$filt .= " and b.source='" . col("source") . "'";

																								if (col("hotel") != "")
																									$filt .= " and vr.hotelid=" . col("hotel");

																								$a = new pagination($base_query . $filt, $current_page, $pagesize);

																								$current_page = $a->current_page_;

																								$qry = $base_query . $filt . " order by b.id desc limit " . $a->offset_ . ",$pagesize";

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td13id$i'>FR$row[id]</td>
																<td id='td2id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[source]</td>
																<td id='td4id$i'>$row[hotel]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td6id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td7id$i'>$row[nights]</td>
																<td id='td8id$i'>" . $row['reg_date'] . "</td>
																<td id='td9id$i'>$row[hf]</td>
																<td id='td10id$i'>" . $row['usercheckedin'] . "</td>
																<td id='td11id$i'>" . $row['checkoutdatetime'] . "</td>
																<td id='td12id$i'>$row[hours]</td>
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='12'>No checkins to display</td></tr>";
																								} ?>
																																																																															</tbody>
																																																																														</table>
																																																																													</div>
																					<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																												</div>
																																																																											</div>
																																																																										</div>
																	<?php
							} else if ($_GET['Pg'] == "hoteldashboard" and $_SESSION['groupid'] == 0) {
								if ($_SESSION['hotel'] > 0) {
									pms_info_status();
								} ?>
<style>
	body{
		font-size:14px!important;
	}
</style><?php
								$row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel]  and DATE(b.reg_date) = CURDATE() and b.usercheckedin <> '0000-00-00 00:00:00';");
								$Total_payable_to_Hotel_Patners = round($row['cnt'], 2); ?>
																																																																								<h1 class="page-heading">Hotel Dashboard</h1>
																																																																								<div class="hotels-card" style="margin-left: -10px;">
																																																																									<div class="col-lg-3 center">
																																																																										<div class="panel panel-danger panel-square panel-no-border text-center">
																																																																											<div class="panel-heading ">
																																																																												
																																																																												<h3 class="panel-title ">Total Checkin today</h3>
																																																																											</div>
																																																																											<!-- <div class="border"></div> -->
																																																																											<div class="panel-body h-152">
																																																																												<p class="line-1"><a href='#'
																																																																														class="bolded tiles-number text-danger"><?= $Total_payable_to_Hotel_Patners ?></a>
																																																																												</p>
																																																																											</div>
																																																																										</div>
																																																																									</div>
																<?php $row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='Direct' and DATE(b.reg_date) = CURDATE();");
																$Total_Hotel_Pending_Approval = $row['cnt']; ?>
                        <div class="col-lg-3 center">
                          <div class="panel panel-warning panel-square panel-no-border text-center">
                            <div class="panel-heading ">
                              <p class="panel-title">Total offline bookings for today</p>
                            </div>
                            <!-- <div class="border"></div> -->
                            <div class="panel-body h-152">
                              <p class="line-1"><a href='#'
                                  class="bolded tiles-number text-warning"><?= $Total_Hotel_Pending_Approval ?></a>
                              </p>
                            </div>
                          </div>
                        </div>
                        <?php $row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='OTA' and DATE(b.reg_date) = CURDATE();");
																$Total_Agent_Corporate_Pending_Approval = $row['cnt']; ?>
                        <div class="col-lg-3 center">
                          <div class="panel panel-success panel-square panel-no-border text-center">
                            <div class="panel-heading">
                              <p class="panel-title">Total OTA bookings for today</p>
                            </div>
                            <!-- <div class="border"></div> -->
                            <div class="panel-body h-152">
                              <p class="line-1"><a href='#'
                                  class="bolded tiles-number text-success"><?= $Total_Agent_Corporate_Pending_Approval ?></a>
                              </p>
                            </div>
                          </div>
                        </div>
                        <?php
																	$total_room = execute("select count(*)totalrooms from roomtypes r left join roomnumbers rn on rn.roomtype=r.id where r.hotel=$_SESSION[hotel];");

																					$ota_booking = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='OTA' and YEAR(b.reg_date) = YEAR(CURDATE())
																	AND MONTH(b.reg_date) = MONTH(CURDATE());");


																					$pms_booking = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='Direct' and YEAR(b.reg_date) = YEAR(CURDATE())
																	AND MONTH(b.reg_date) = MONTH(CURDATE());");

																					$total_booking = $ota_booking['cnt'] + $pms_booking['cnt'];

																					$occupancy_rate = ($total_booking / $total_room['totalrooms']) * 100;

																					?>
																																																																													<div class="col-lg-3 center">
																																																																														<div class="panel panel-info panel-square panel-no-border text-center">
																																																																															<div  class="panel-heading">
																																																																																<p class="panel-title">Total Month occupancy %</p>
																																																																															</div>
																																																																															<!-- <div class="border"></div> -->
																																																																															<div class="panel-body h-152">
																																																																																<p class="line-1"><a href='#' class="bolded tiles-number text-info"><?= number_format($occupancy_rate, 2); ?>%</a></p>
																																																																															</div>
																																																																														</div>
																																																																													</div>
																																																																												</div>
																																																																											</div>

																																																																											<div class="row" style="padding: 15px 25px; position: relative;left: 0px;">
																																																																												<div class="col-lg-3" style="padding: 0px 12px;">
																				<?php $row = execute("SELECT COUNT(*) AS cnt
																					FROM bookings
																					WHERE MONTH(reg_date) = MONTH(CURDATE())
																					AND YEAR(reg_date) = YEAR(CURDATE())
																					AND usercheckedin <> '0000-00-00 00:00:00';
																					");
																				$row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.usercheckedin <> '0000-00-00 00:00:00' and YEAR(b.reg_date) = YEAR(CURDATE())
																			AND MONTH(b.reg_date) = MONTH(CURDATE());");
																$todayscheckins = $row['cnt'];
																?>
																																																																									<!-- BEGIN TODAY VISITOR TILES -->
																																																																									<div
																																																																										class="panel panel-danger panel-square panel-no-border text-center">
																																																																										<div class="panel-heading ">
																																																																											<h3 class="panel-title">TOTAL HOTEL CHECKINS FOR THESE MONTH
																																																																											</h3>
																																																																										</div>
																																																																										<div class="panel-body" style="height: 200px; ">
																																																																											<h1 class="bolded tiles-number text-danger">
																			<?= $todayscheckins ?>
																																																																											</h1>
																																																																										</div><!-- /.panel-body -->
																																																																									</div><!-- /.panel panel-success panel-block-color -->
																																																																									<!-- END TODAY VISITOR TILES -->

																																																																												</div><!-- /.col-sm-6 -->
																																																																												<div class="col-lg-3" style="padding: 0px 12px;">
																				<?php $row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='Direct' and YEAR(b.reg_date) = YEAR(CURDATE())
  																	AND MONTH(b.reg_date) = MONTH(CURDATE());");

																$todayscheckins = $row['cnt']; ?>
																																																																									<!-- BEGIN TODAY VISITOR TILES -->
																																																																									<div
																																																																										class="panel panel-warning panel-square panel-no-border text-center">
																																																																										<div class="panel-heading">
																																																																											<h3 class="panel-title">TOTAL OFFLINE BOOKINGS THESE MONTH
																																																																											</h3>
																																																																										</div>
																																																																										<div class="panel-body" style="height: 200px; ">
																																																																											<h1 class="bolded tiles-number text-warning">
																			<?= $todayscheckins ?>
																																																																											</h1>
																																																																										</div><!-- /.panel-body -->
																																																																									</div><!-- /.panel panel-success panel-block-color -->
																																																																									<!-- END TODAY VISITOR TILES -->
																																																																								</div><!-- /.col-sm-6 -->
																																																																								<div class="col-lg-3" style="padding: 0px 12px;">
																<?php $row = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='OTA' and YEAR(b.reg_date) = YEAR(CURDATE())
  																	AND MONTH(b.reg_date) = MONTH(CURDATE());");

																$todayscheckins = $row['cnt']; ?>
																																																																									<!-- BEGIN TODAY VISITOR TILES -->
																																																																									<div
																																																																										class="panel panel-success panel-square panel-no-border text-center">
																																																																										<div class="panel-heading">
																																																																											<h3 class="panel-title">TOTAL OTA BOOKINGS THESE MONTH</h3>
																																																																										</div>
																																																																										<div class="panel-body" style="height: 200px; ">
																																																																											<h1 class="bolded tiles-number text-success">
																			<?= $todayscheckins ?>
																																																																											</h1>
																																																																										</div><!-- /.panel-body -->
																																																																									</div><!-- /.panel panel-success panel-block-color -->
																																																																									<!-- END TODAY VISITOR TILES -->
																																																																								</div>


																																																																												<div class="col-lg-3" style="padding: 0px 12px;">
																																																																													<div class="card" >
																																																																														<div class="card-body">
																																																																															<h5 class="card-title">Total Month Booking Stats</h5>
																																																																															<canvas id="myPieChart" width="400" height="400"></canvas>
																																																																														</div>
																																																																													</div>
																																																																												</div>
																																																																											</div>

																																																																										</div><!-- /.row -->


																																																																										<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
																																																																										<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

																	<?php $pms_booking = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='Direct' and YEAR(b.reg_date) = YEAR(CURDATE()) AND MONTH(b.reg_date) = MONTH(CURDATE());");
																	?>

																	<?php $ota_booking = execute("select count(*)cnt from roomnumbers rn join roomtypes r on r.id=rn.roomtype join room_distribution rd on rn.id=rd.roomnumber join bookings b on b.id=rd.bookingid where r.hotel=$_SESSION[hotel] and b.source='OTA' and YEAR(b.reg_date) = YEAR(CURDATE()) AND MONTH(b.reg_date) = MONTH(CURDATE());");
																	?>

																																																																										<div class="row" style="margin: 15px;">

																																																																											<div class="card">
																																																																												<div class="card-body" style="height: 500px;">
																																																																													<h5 class="card-title">Monthly Booking Stats</h5>
																																																																													<canvas id="myBarChart" width="400" height="400"></canvas>
																																																																												</div>
																																																																											</div>

																																																																										</div>


																																																																										<script>
																																																																											let ota_book = <?= $ota_booking['cnt'] ?>;
																																																																											let pms_book = <?= $pms_booking['cnt'] ?>;

																																																																											const ctx = document.getElementById('myPieChart').getContext('2d');
																																																																											const myPieChart = new Chart(ctx, {
																																																																												type: 'pie',
																																																																												data: {
																																																																													labels: ['OTA Booking', 'PMS Booking'],
																																																																													datasets: [{
																																																																														label: 'Bookings',
																																																																														data: [ota_book, pms_book],
																																																																														backgroundColor: [
																																																																															'rgb(255, 99, 132)',
																																																																															'rgb(54, 162, 235)',
																																																																														],
																																																																														hoverOffset: 4
																																																																													}]
																																																																												}
																																																																											});
																																																																										</script>

																			<?php
																			// Get the current month and year
																			$currentMonth = (int) date('n');
																			$currentYear = (int) date('Y');

																			// Initialize an array for storing counts (for months April to the current month)
																			$monthly_counts = [];

																			// Adjust logic if the current month is earlier than April
																			if ($currentMonth >= 4) {
																				// Query for each month from April to the current month of the current year
																				for ($month = 4; $month <= $currentMonth; $month++) {
																					$sql = "
																		SELECT COUNT(*) AS cnt
																		FROM roomnumbers rn
																		JOIN roomtypes r ON r.id = rn.roomtype
																		JOIN room_distribution rd ON rn.id = rd.roomnumber
																		JOIN bookings b ON b.id = rd.bookingid
																		WHERE r.hotel = 917
																		AND b.source = 'Direct'
																		AND YEAR(b.reg_date) = $currentYear
																		AND MONTH(b.reg_date) = $month
																	";
																					$result = $conn->query($sql);
																					$row = $result->fetch_assoc();
																					$monthly_counts[] = (int) $row['cnt']; // Add count to the array
																				}
																			} else {
																				// If the current month is earlier than April, fetch data for April of the previous year to the current month
																				$lastYear = $currentYear - 1;

																				// Query for each month from April of last year to the current month of the last year
																				for ($month = 4; $month <= 12; $month++) {
																					$sql = "
																		SELECT COUNT(*) AS cnt
																		FROM roomnumbers rn
																		JOIN roomtypes r ON r.id = rn.roomtype
																		JOIN room_distribution rd ON rn.id = rd.roomnumber
																		JOIN bookings b ON b.id = rd.bookingid
																		WHERE r.hotel = 917
																		AND b.source = 'Direct'
																		AND YEAR(b.reg_date) = $lastYear
																		AND MONTH(b.reg_date) = $month
																	";
																					$result = $conn->query($sql);
																					$row = $result->fetch_assoc();
																					$monthly_counts[] = (int) $row['cnt']; // Add count to the array
																				}

																				// Now fetch data for the current months of the current year (January, February, March)
																				for ($month = 1; $month < $currentMonth + 1; $month++) {
																					$sql = "
																		SELECT COUNT(*) AS cnt
																		FROM roomnumbers rn
																		JOIN roomtypes r ON r.id = rn.roomtype
																		JOIN room_distribution rd ON rn.id = rd.roomnumber
																		JOIN bookings b ON b.id = rd.bookingid
																		WHERE r.hotel = 917
																		AND b.source = 'Direct'
																		AND YEAR(b.reg_date) = $currentYear
																		AND MONTH(b.reg_date) = $month
																	";
																					$result = $conn->query($sql);
																					$row = $result->fetch_assoc();
																					$monthly_counts[] = (int) $row['cnt']; // Add count to the array
																				}
																			}

																			// Convert PHP array to JSON for use in JavaScript
																			$monthly_counts_json = json_encode($monthly_counts);

																			?>


																																																																										<script>
																																																																										const ctxx = document.getElementById('myBarChart').getContext('2d');
																																																																										const myBarChart = new Chart(ctxx, {
																																																																											type: 'bar', // Change to 'line' for a line chart
																																																																											data: {
																																																																												labels: [ 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December','January', 'February', 'March'], // Full year labels
																																																																												datasets: [{
																																																																													label: 'Bookings',
																																																																													data: <?php echo $monthly_counts_json; ?>, // Insert the PHP array here
																																																																													backgroundColor: [
																																																																														'rgba(75, 192, 192, 0.2)',
																																																																														'rgba(54, 162, 235, 0.2)',
																																																																														'rgba(255, 206, 86, 0.2)',
																																																																														'rgba(75, 192, 192, 0.2)',
																																																																														'rgba(153, 102, 255, 0.2)',
																																																																														'rgba(255, 159, 64, 0.2)',
																																																																														'rgba(255, 99, 132, 0.2)',
																																																																														'rgba(54, 162, 235, 0.2)',
																																																																														'rgba(255, 206, 86, 0.2)',
																																																																														'rgba(75, 192, 192, 0.2)',
																																																																														'rgba(153, 102, 255, 0.2)',
																																																																														'rgba(255, 159, 64, 0.2)'
																																																																													],
																																																																													borderColor: [
																																																																														'rgba(75, 192, 192, 1)',
																																																																														'rgba(54, 162, 235, 1)',
																																																																														'rgba(255, 206, 86, 1)',
																																																																														'rgba(75, 192, 192, 1)',
																																																																														'rgba(153, 102, 255, 1)',
																																																																														'rgba(255, 159, 64, 1)',
																																																																														'rgba(255, 99, 132, 1)',
																																																																														'rgba(54, 162, 235, 1)',
																																																																														'rgba(255, 206, 86, 1)',
																																																																														'rgba(75, 192, 192, 1)',
																																																																														'rgba(153, 102, 255, 1)',
																																																																														'rgba(255, 159, 64, 1)'
																																																																													],
																																																																													borderWidth: 1
																																																																												}]
																																																																											},
																																																																											options: {
																																																																												scales: {
																																																																													y: {
																																																																														beginAtZero: true
																																																																													}
																																																																												}
																																																																											}
																																																																										});
																																																																										</script>




																<?php
							} else if ($_GET['Pg'] == "froteldash" and $_SESSION['groupid'] == 0) {
								if ($_SESSION['hotel'] > 0) {
									pms_info_status();
								}

								$row = execute("select sum(hoteltariff+hotelst+hsbc+hkcc+lt+sc+stonsc)payabletohotel from bookings where paid_to_hotel=0 and paid=1");
								$Total_payable_to_Hotel_Patners = round($row['payabletohotel'], 2); ?>
                  <h1 class="page-heading">Frotel Dashboard</h1>

																																																																							<div class="col-lg-12">

																																																																								<div class="col-lg-3 center	" style="margin-left: -23px  ;margin-right: 24px;">
																																																																									<div class="panel panel-danger panel-square panel-no-border text-center">
																																																																										<div class="panel-heading ">
																																																																											<h3 class="panel-title ">Total to be Paid to the Hotel Patners</h3>
																																																																										</div>
																																																																										<!-- <div class="border"></div> -->
																																																																										<div class="panel-body h-151">
																																																																											<h1 class="line-1"><a href='#'
																																																																													class="bolded tiles-number text-danger"><?= $Total_payable_to_Hotel_Patners ?></a>
							                                                                                                                                                                                                                                                                                   </h1>
																																																																										</div>
																																																																									</div>
																																																																								</div>
														<?php $row = execute("select count(*)cnt from users where groupid=2 and approved=0");
														$Total_Hotel_Pending_Approval = $row['cnt']; ?>
                    <div class="col-lg-3 center" style="padding-right: 10px; margin-left: -19px;">
                      <div class="panel panel-warning panel-square panel-no-border text-center">
                        <div class="panel-heading ">
                          <h3 class="panel-title">Total Hotel Pending Approval </p>
                        </div>
                        <!-- <div class="border"></div> -->
                        <div class="panel-body h-151">
                          <p class="line-1"><a href='#'
                              class="bolded tiles-number text-warning"><?= $Total_Hotel_Pending_Approval ?></a></p>
                        </div>
                      </div>
                    </div>
                    <?php $row = execute("select count(*)cnt from users where (groupid=3 or groupid=4) and approved=0");
														$Total_Agent_Corporate_Pending_Approval = $row['cnt']; ?>
																																																																								<div class="col-lg-3 center" style="padding-right: 8px; margin-left:9px">
																																																																									<div class="panel panel-success panel-square panel-no-border text-center">
																																																																										<div  class="panel-heading ">
																																																																											<h3 class="panel-title" style="font-size:11px">Total Agent Corporate
																																																																												Pending Approval</h3>
																																																																										</div>
																																																																										<!-- <div class="border"></div> -->
																																																																										<div class="panel-body h-151">
																																																																											<p class="line-1"><a href='#'
																																																																													class="bolded tiles-number text-success"><?= $Total_Agent_Corporate_Pending_Approval ?></a>
																																																																											</p>
																																																																										</div>
																																																																									</div>
																																																																								</div>
														<?php $row = execute("select count(*)cnt from bookings where status='Cancelled'");
														$Cancellation_Requests = $row['cnt']; ?>
																																																																								<div class="col-lg-3 center" style="padding-right: 0px; margin-left:9px;" 
	padding-left: 14px; margin-left: 15px;">
																																																																									<div class="panel panel-info panel-square panel-no-border text-center">
																																																																										<div class="panel-heading ">
																																																																											<p class="panel-title">Cancellation Request</p>
																																																																										</div>
																																																																										<!-- <div class="border"></div> -->
																																																																										<div class="panel-body h-151">
																																																																											<p class="line-1"><a href='#'
																																																																													class="bolded tiles-number text-info"><?= $Cancellation_Requests ?></a></p>
																																																																										</div>
																																																																									</div>
																																																																								</div>
																																																																							</div>
																																																																						</div>
																																																																						<div class="container-fluid" style="padding-right:30px; padding-left:30px">
																																																																						<div class="dashboard-2" style="  margin-left: 0 !important;
  margin-right: 0 !important;">
																																																																							<div class="col-lg-12">
																																																																								<div class="col-lg-3" style="margin-left: -23px  ;margin-right: 24px;">
															<?php $row = execute("select (select count(*) from bookings where status='Scheduled' and cast(checkindatetime as date)=curdate() and paid=1 and (hours=0 or hours=24))todayscheckins, (select count(distinct guestid) from bookings where cast(reg_date as date)=curdate() and (hours=0 or hours=24))visitors");
															$todayscheckins = $row['todayscheckins'];
															$visitors = $row['visitors'];
															if ($visitors > 0)
																$reach = round((float) ($todayscheckins) / (float) $visitors, 2);
															else
																$reach = 0; ?>
                      <!-- BEGIN TODAY VISITOR TILES -->
                      <div class="panel panel-danger panel-square panel-no-border text-center">
                        <div class="panel-heading ">
                          <h3 class="panel-title">TOTAL HOTEL CHECKINS FOR TODAY</h3>
                        </div>
                        <div class="panel-body">
                          <h1 class="bolded tiles-number text-danger">
                            <?= $todayscheckins ?>
                          </h1>
                          <p class="text-muted"><small>UNIQUE VISITORS
                              <strong><?= $visitors ?></strong></small></p>
                          <p class="text-muted"><small>TOTAL REACH
                              <strong><?= $reach ?>%</strong></small></p>
                        </div><!-- /.panel-body -->
                      </div><!-- /.panel panel-success panel-block-color -->
                      <!-- END TODAY VISITOR TILES -->

																																																																								</div><!-- /.col-sm-6 -->
																																																																								<div class="col-lg-3" style="padding-right: 10px; margin-left: -19px;">
															<?php $row = execute("select (select count(*) from bookings where status='Scheduled' and cast(checkindatetime as date)=curdate() and paid=1 and (hours>0 and hours<24))todayscheckins, (select reg_date from bookings where paid=1 and (hours>0 and hours<24) and cast(reg_date as date)=curdate() order by id desc limit 1)lastsale, (select avg(declaredtariff-pcdiscount+hotelst+hsbc+hkcc+frotelst+fsbc+fkcc+lt+sc+stonsc) from bookings where cast(reg_date as date)=curdate() and paid=1 and (hours>0 and hours<24))avgsale");
															$todayscheckins = $row['todayscheckins'];
															if (!is_null($row['lastsale'])) {
																$lastsale = date_create($row['lastsale']);
																$time1 = strtotime(date("Y-m-d H:i"));
																$time2 = strtotime($row["lastsale"]);
																$diffrence = "<strong>" . round(($time1 - $time2) / 60) . " MINUTES AGO</strong>";
																$average = round($row['avgsale'], 2);
															} else {
																$lastsale = "-";
																$diffrence = "-";
																$average = 0;
															} ?>
                      <!-- BEGIN TODAY VISITOR TILES -->

                      <div class="panel panel-warning panel-square panel-no-border text-center">

																																																																										<div class="panel-heading">
																																																																											<h3 class="panel-title">TOTAL FROTEL CHECKINS FOR TODAY</h3>
																																																																										</div>
																																																																										<div class="panel-body">
																																																																											<h1 class="bolded tiles-number text-warning">
																		<?= $todayscheckins ?>
																																																																											</h1>
																																																																											<p class="text-muted"><small>LAST SALE <?= $diffrence ?></small>
																																																																											</p>
																																																																											<p class="text-muted"><small>SALE AVERAGE
																																																																													<strong><?= round($row['avgsale'], 2) ?></strong></small>
																																																																											</p>
																																																																										</div><!-- /.panel-body -->
																																																																									</div><!-- /.panel panel-success panel-block-color -->
																																																																									<!-- END TODAY VISITOR TILES -->
																																																																								</div><!-- /.col-sm-6 -->
																																																																								<div class="col-lg-3" style="padding-right: 8px; margin-left:9px">
	
															<?php $row = execute("select (select count(*) from bookings where status='Scheduled' and cast(checkindatetime as date)=curdate() and paid=1 and (hours=0 or hours=24))todayscheckins, (select reg_date from bookings where paid=1 and (hours=0 or hours=24) and cast(reg_date as date)=curdate() order by id desc limit 1)lastsale,(select avg(declaredtariff-pcdiscount+hotelst+hsbc+hkcc+ frotelst+fsbc+fkcc+lt+sc+stonsc) from bookings where cast(reg_date as date)=curdate() and paid=1 and (hours=0 or hours=24))avgsale");
															$todayscheckins = $row['todayscheckins'];
															if (!is_null($row['lastsale'])) {
																$lastsale = date_create($row['lastsale']);
																$time1 = strtotime(date("Y-m-d H:i"));
																$time2 = strtotime($row["lastsale"]);
																$diffrence = "<strong>" . round(($time1 - $time2) / 60) . " MINUTES AGO</strong>";
																$average = round($row['avgsale'], 2);
															} else {
																$lastsale = "-";
																$diffrence = "-";
																$average = 0;
															} ?>
                      <!-- BEGIN TODAY VISITOR TILES -->
                      <div class="panel panel-success panel-square panel-no-border text-center">
                        <div class="panel-heading">
                          <h3 class="panel-title">TOTAL HOTELS REGISTERED SO FAR</h3>
                        </div>
                        <div class="panel-body">
                          <h1 class="bolded tiles-number text-success">
                            <?= $todayscheckins ?>
                          </h1>
                          <p class="text-muted"><small>LAST SALE <?= $diffrence ?></small>
                          </p>
                          <p class="text-muted"><small>SALE AVERAGE
                              <strong><?= $average ?></strong></small></p>
                        </div><!-- /.panel-body -->
                      </div><!-- /.panel panel-success panel-block-color -->
                      <!-- END TODAY VISITOR TILES -->
                    </div><!-- /.col-sm-6 -->

																																																																								<div class="col-lg-3" style="padding-right: 0px; margin-left:9px">
															<?php $row = execute("select count(*)cnt from users where groupid=1");
															$multi_chain = $row['cnt']; ?>
																																																																									<!-- BEGIN TODAY VISITOR TILES -->
																																																																									<div class="panel panel-info panel-square panel-no-border text-center">
																																																																										<div class="panel-heading">
																																																																											<h3 class="panel-title">TOTAL MULTICHAIN REGISTERED SO FAR</h3>
																																																																										</div>
																																																																										<div class="panel-body">
																																																																											<h1 class="bolded tiles-number text-info" style="padding-bottom:4px !important"><?= $multi_chain ?>
																																																																											</h1>
																																																																											<p class="text-muted">
																																																																												<!-- <small>LAST SALE <strong>2 HOURS AGO</strong></small> -->&nbsp;
																																																																											</p>
																																																																											<p class="text-muted">
																																																																												<!-- <small>SALE AVERAGE <strong>221</strong></small> -->&nbsp;
																																																																											</p>
																																																																										</div><!-- /.panel-body -->
																																																																									</div><!-- /.panel panel-success panel-block-color -->
																																																																									<!-- END TODAY VISITOR TILES -->
																																																																								</div><!-- /.col-sm-6 -->

																																																																							</div><!-- /.row -->
																																																																						</div>
														</div>

														

																																																																						<div class="row-dash" style="padding-right:10px;">
																																																																							<div class="row-dashboard">
																																																																							<div class="col-lg-3" style="padding-right: 29px; padding-left: 0px;">
														<?php $row = execute("select count(*)cnt from users where groupid=3");
														$multi_chain = $row['cnt']; ?>
                      <!-- BEGIN TODAY VISITOR TILES -->
                      <div class="panel panel-danger panel-square panel-no-border text-center">
                        <div class="panel-heading">
                          <h3 class="panel-title">TOTAL AGENTS REGISTERED SO FAR</h3>
                        </div>
                        <div class="panel-body">
                          <h1 class="bolded tiles-number text-danger"><?= $row['cnt'] ?></h1>
                          <p class="text-muted">
                            <!-- <small>UNIQUE VISITOR <strong>957</strong></small> -->&nbsp;
                          </p>
                          <p class="text-muted">
                            <!-- <small>TOTAL REACH <strong>25%</strong></small> -->&nbsp;
                          </p>
                        </div><!-- /.panel-body -->
                      </div><!-- /.panel panel-success panel-block-color -->
                      <!-- END TODAY VISITOR TILES -->

																																																																							</div><!-- /.col-sm-6 -->
																																																																							<div class="col-lg-3" style="margin-left:-13px;">
														<?php $row = execute("select count(*)cnt from users where groupid=4");
														$multi_chain = $row['cnt']; ?>
																																																																								<!-- BEGIN TODAY VISITOR TILES -->
																																																																								<div class="panel panel-warning panel-square panel-no-border text-center">
																																																																									<div class="panel-heading">
																																																																										<h3 class="panel-title">TOTAL CORPORATES REGISTERED SO FAR</h3>
																																																																									</div>
																																																																									<div class="panel-body">
																																																																										<h1 class="bolded tiles-number text-warning"><?= $row['cnt'] ?></h1>
																																																																										<p class="text-muted">
																																																																											<!-- <small>UNIQUE VISITOR <strong>957</strong></small> -->&nbsp;
																																																																										</p>
																																																																										<p class="text-muted">
																																																																											<!-- <small>TOTAL REACH <strong>25%</strong></small> -->&nbsp;
																																																																										</p>
																																																																									</div><!-- /.panel-body -->
																																																																								</div><!-- /.panel panel-success panel-block-color -->
																																																																								<!-- END TODAY VISITOR TILES -->

																																																																												</div><!-- /.col-sm-6 -->

																																																																							<div class="col-lg-3" style="margin-right: -10px; margin-left: 4px;">
														<?php $row = execute("select count(*)cnt from users where groupid=5");
														$multi_chain = $row['cnt']; ?>
																																																																								<!-- BEGIN TODAY VISITOR TILES -->
																																																																								<div class="panel panel-success panel-square panel-no-border text-center">
																																																																									<div class="panel-heading">
																																																																										<h3 class="panel-title">TOTAL TRAVLLERS REGISTERED SO FAR</h3>
																																																																									</div>
																																																																									<div class="panel-body">
																																																																										<h1 class="bolded tiles-number text-success"><?= $row['cnt'] ?></h1>
																																																																										<p class="text-muted">
																																																																											<!-- <small>UNIQUE VISITOR <strong>957</strong></small> -->&nbsp;
																																																																										</p>
																																																																										<p class="text-muted">
																																																																											<!-- <small>TOTAL REACH <strong>25%</strong></small> -->&nbsp;
																																																																										</p>
																																																																									</div><!-- /.panel-body -->
																																																																								</div><!-- /.panel panel-success panel-block-color -->
																																																																								<!-- END TODAY VISITOR TILES -->

																																																																							</div>
																																																																							<div class="col-lg-3" style="padding-right: 0px; margin-left: 15px;">
														<?php $row = execute("select sum(declaredtariff-pcdiscount+hotelst+hsbc+hkcc+lt+sc+stonsc+frotelst+fsbc+fkcc)total from bookings where paid=1");
														$total_received = $row['total']; ?>
                      <!-- BEGIN TODAY VISITOR TILES -->
                      <div class="panel panel-info panel-square panel-no-border text-center">
                        <div class="panel-heading">
                          <h3 class="panel-title">TOTAL AMOUNT RECEIVED SO FAR</h3>
                        </div>
                        <div class="panel-body">
                          <h1 class="bolded tiles-number text-info">
                            <?= round($total_received, 2) ?>
                          </h1>
                          <p class="text-muted">
                            <!-- <small>LAST SALE <strong>2 HOURS AGO</strong></small> -->&nbsp;
                          </p>
                          <p class="text-muted">
                            <!-- <small>SALE AVERAGE <strong>221</strong></small> --><br>
                          </p>
                        </div><!-- /.panel-body -->
                      </div><!-- /.panel panel-success panel-block-color -->
                      <!-- END TODAY VISITOR TILES -->

																																																																												</div><!-- /.col-sm-6 -->												<!-- /.row -->

																<?php
							} else if ($_GET['Pg'] == "partnerverification" and $page_access) { ?>
														
																																																																												<div class="row">
																																																																													<div class="col-sm-12" style="margin-top: 30px;">
																
																																																																														<div class="the-box">
																																																																															<h1 class="page-heading">Partner Verification</h1>
																				<?php if (col("verifyid") != "") {
																					$id = $_POST['verifyid'];
																					$conn->query("update users u join hotels h on h.user=u.id set u.approved=1 where h.id=$id");
																					$conn->query("update pictures set approved=1,approvaldate=now() where propertyid=$id and type='Hotel'");
																					$conn->query("update pictures p join roomtypes r on (r.id=p.propertyid and p.type='Room') set p.approved=1,p.approvaldate=now() where r.hotel=$id");
																					alertbox("success", "Partner has been verified");
																				}

																				if (col("blockid") != "") {
																					$id = $_POST['blockid'];
																					$conn->query("update users u join hotels h on h.user=u.id set u.active=0 where h.id=$id");
																					alertbox("success", "Partner has been blocked");
																				} ?>
																	
																																																																															<div class="table-responsive" style="overflow-x:scroll;">
																					<?php verifymodal("Hotel", "hotel");
																					blockmodal("Hotel", "hotel"); ?>
																																																																																<form name="filter_form" method="POST">
																																																																																	<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom: 0;">
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control chosen-select" name="city" onChange="form.submit()" style="width:140px;">
																																																																																				<option value="">City</option>
																									<?php $result = $conn->query("select id,city from cities order by city");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																										<?php
																									} ?>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control chosen-select" name="hotel" style="width:140px;">
																																																																																				<option value="">Hotel</option>
																									<?php if (col("city") != "")
																										$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.city=" . col("city") . " order by u.company");
																									else
																										$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user order by u.company");

																									while ($row = $result->fetch_assoc()) { ?>
																																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																										<?php
																									} ?>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control chosen-select" name="chain" style="width:140px;">
																																																																																				<option value="">Chain</option>
																									<?php $result = $conn->query("select u.id,u.company from users u where exists (select * from hotels where admin=u.id) order by u.company");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																						<option value="<?= $row['id'] ?>" <?= selected(col("chain"), $row['id']) ?>><?= $row['company'] ?></option>
																										<?php
																									} ?>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control" name="venture" style="height:30px">
																																																																																				<option value="">Venture</option>
																																																																																				<option value="single" <?= selected(col("venture"), "single") ?>>Single</option>
																																																																																				<option value="chain" <?= selected(col("venture"), "chain") ?>>Chain</option>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control" name="type" style="height:30px">
																																																																																				<option value="">Type</option>
																																																																																				<option value="Hotel" <?= selected(col("type"), "Hotel") ?>>Hotel</option>
																																																																																				<option value="Resort" <?= selected(col("type"), "Resort") ?>>Resort</option>
																																																																																				<option value="Motel" <?= selected(col("type"), "Motel") ?>>Motel</option>
																																																																																				<option value="Bed n Breakfast" <?= selected(col("type"), "Bed n Breakfast") ?>>Bed n Breakfast</option>
																																																																																				<option value="Hostel" <?= selected(col("type"), "Hostel") ?>>Hostel</option>
																																																																																				<option value="Home Stay" <?= selected(col("type"), "Home Stay") ?>>Home Stay</option>
																																																																																				<option value="Service Apartment" <?= selected(col("type"), "Service Apartment") ?>>Service Apartment</option>
																																																																																				<option value="Bungalow" <?= selected(col("type"), "Bungalow") ?>>Bungalow</option>
																																																																																				<option value="Villa" <?= selected(col("type"), "Villa") ?>>Villa</option>
																																																																																				<option value="Lodge" <?= selected(col("type"), "Lodge") ?>>Lodge</option>
																																																																																				<option value="Guest House" <?= selected(col("type"), "Guest House") ?>>Guest House</option>
																																																																																				<option value="Other" <?= selected(col("type"), "Other") ?>>Other</option>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group">
																																																																																			<select class="form-control" name="star" style="height:30px">
																																																																																				<option value="">Star</option>
																																																																																				<option value="0" <?= selected(col("star"), "0") ?>>No star</option>
																																																																																				<option value="1" <?= selected(col("star"), "1") ?>>1</option>
																																																																																				<option value="2" <?= selected(col("star"), "2") ?>>2</option>
																																																																																				<option value="3" <?= selected(col("star"), "3") ?>>3</option>
																																																																																				<option value="4" <?= selected(col("star"), "4") ?>>4</option>
																																																																																				<option value="5" <?= selected(col("star"), "5") ?>>5</option>
																																																																																			</select>
																																																																																		</div>
																																																																																		<div class="btn-group pull-right">
																																																																																			<input type="submit" class="btn btn-success" value="Apply">
																																																																																		</div>
																																																																																		<div class="btn-group pull-right">
																																																																																			<a href="?Pg=partnerverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																		</div>
																																																																																	</div>
																			
																																																																																	<input type="hidden" name="deleteid" id="deleteid">
																																																																																	<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																	<input type="hidden" name="verifyid" id="verifyid">
																																																																																	<input type="hidden" name="blockid" id="blockid">
																																																																																	<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																	<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																</form>
																																																																																<table class="table table-th-block table-hover">
																																																																																	<thead>
																																																																																		<tr style="font-size:11px;">
																																																																																			<th style="width: 40px;">ID</th>
																																																																																			<th>City</th>
																																																																																			<th>Hotel Name</th>
																																																																																			<th>Venture</th>
																																																																																			<th>Chain Name</th>
																																																																																			<th>Type</th>
																																																																																			<th>Star</th>
																																																																																			<th>Concern Person</th>
																																																																																			<th>Contact no</th>
																																																																																			<th>Email</th>
																																																																																			<th>Registration Date</th>
																																																																																			<th>Email Verified</th>
																																																																																			<th>Phone Verified</th>
																																																																																			<th>Verify</th>
																																																																																			<th>Block</th>
																																																																																			<th>View Details</th>
																																																																																		</tr>
																																																																																	</thead>
																																																																																	<tbody>
																							<?php $pagesize = 20;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select h.id,coalesce(cast(h.id as char),'*')hotelid,c.city,u.company,(case when h.admin>0 then 'Chain' else 'Single' end)venture,coalesce(ua.company,'-')chainname,h.propertytype,h.stars,u.fullname,u.contact, u.email,u.emailverified,u.mobileverified,c.id as cityid,u.reg_date from users u left join hotels h on u.id=h.user left join cities c on u.city=c.id left join users ua on ua.id=h.admin where u.approved=0 and u.active=1 and (u.groupid=2)";

																							//echo $base_query;
																							$filt = "";
																							if (col("city") != "")
																								$filt .= " and c.id=" . col("city");

																							if (col("hotel") != "")
																								$filt .= " and h.id=" . col("hotel");

																							if (col("venture") != "") {
																								if (col("venture") == "chain")
																									$filt .= " and h.admin>0";
																								else
																									$filt .= " and h.admin=0";
																							}

																							if (col("type") != "")
																								$filt .= " and h.propertytype='" . col("type") . "'";

																							if (col("star") != "")
																								$filt .= " and h.stars=" . col("star");

																							if (col("chain") != "")
																								$filt .= "";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by h.id limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td>$row[hotelid]</td>
																<td>$row[city]</td>
																<td>$row[company]</td>
																<td>$row[venture]</td>
																<td>$row[chainname]</td>
																<td>$row[propertytype]</td>
																<td>$row[stars]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																									if ($row['emailverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																									if ($row['mobileverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																									if ($row['venture'] == "Single")
																										$str .= "<td><a href='?Pg=basicinfo&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";
																									else
																										$str .= "<td><a href='?Pg=myhotels&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";

																									$str .= "</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='14'>No partners to verify</td></tr>";
																							} ?>
																																																																																	</tbody>
																																																																																</table>
																																																																															</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																														</div>
																																																																													</div>
																																																																												</div>
																<?php
															} else if ($_GET['Pg'] == "activeSubscription" and $page_access) { ?>
															<h1 class="page-heading">Active Subscription</h1>
															<div class="row">
																<div class="col-sm-12">
																	<div class="the-box">
																		<?php if (col("verifyid") != "") {
																			$id = $_POST['verifyid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.approved=1 where h.id=$id");
																			$conn->query("update pictures set approved=1,approvaldate=now() where propertyid=$id and type='Hotel'");
																			$conn->query("update pictures p join roomtypes r on (r.id=p.propertyid and p.type='Room') set p.approved=1,p.approvaldate=now() where r.hotel=$id");
																			alertbox("success", "Partner has been verified");
																		}

																		if (col("blockid") != "") {
																			$id = $_POST['blockid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.active=0 where h.id=$id");
																			alertbox("success", "Partner has been blocked");
																		} ?>
																		<h4 class="small-title">Active Subscription</h4>

																		<div class="table-responsive" style="overflow-x:scroll;">
																			<?php verifymodal("Hotel", "hotel");
																			blockmodal("Hotel", "hotel"); ?>
																			<form name="filter_form" method="POST">
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="city" onChange="form.submit()">
																							<option value="">City</option>
																							<?php $result = $conn->query("select id,city from cities order by city");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="hotel" style="width:210px;">
																							<option value="">Hotel</option>
																							<?php if (col("city") != "")
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.city=" . col("city") . " order by u.company");
																							else
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user order by u.company");

																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="chain" style="width:210px;">
																							<option value="">Chain</option>
																							<?php $result = $conn->query("select u.id,u.company from users u where exists (select * from hotels where admin=u.id) order by u.company");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("chain"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="venture" style="height:34px">
																							<option value="">Venture</option>
																							<option value="single" <?= selected(col("venture"), "single") ?>>Single</option>
																							<option value="chain" <?= selected(col("venture"), "chain") ?>>Chain</option>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="type" style="height:34px">
																							<option value="">Type</option>
																							<option value="Hotel" <?= selected(col("type"), "Hotel") ?>>Hotel</option>
																							<option value="Resort" <?= selected(col("type"), "Resort") ?>>Resort</option>
																							<option value="Motel" <?= selected(col("type"), "Motel") ?>>Motel</option>
																							<option value="Bed n Breakfast" <?= selected(col("type"), "Bed n Breakfast") ?>>Bed n Breakfast</option>
																							<option value="Hostel" <?= selected(col("type"), "Hostel") ?>>Hostel</option>
																							<option value="Home Stay" <?= selected(col("type"), "Home Stay") ?>>Home Stay</option>
																							<option value="Service Apartment" <?= selected(col("type"), "Service Apartment") ?>>Service Apartment</option>
																							<option value="Bungalow" <?= selected(col("type"), "Bungalow") ?>>Bungalow</option>
																							<option value="Villa" <?= selected(col("type"), "Villa") ?>>Villa</option>
																							<option value="Lodge" <?= selected(col("type"), "Lodge") ?>>Lodge</option>
																							<option value="Guest House" <?= selected(col("type"), "Guest House") ?>>Guest House</option>
																							<option value="Other" <?= selected(col("type"), "Other") ?>>Other</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<input type="submit" class="btn btn-success" value="Apply">
																					</div>
																				</div>
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control" name="star" style="height:34px">
																							<option value="">Star</option>
																							<option value="0" <?= selected(col("star"), "0") ?>>No star</option>
																							<option value="1" <?= selected(col("star"), "1") ?>>1</option>
																							<option value="2" <?= selected(col("star"), "2") ?>>2</option>
																							<option value="3" <?= selected(col("star"), "3") ?>>3</option>
																							<option value="4" <?= selected(col("star"), "4") ?>>4</option>
																							<option value="5" <?= selected(col("star"), "5") ?>>5</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<a href="?Pg=partnerverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																					</div>
																				</div>
																				<input type="hidden" name="deleteid" id="deleteid">
																				<input type="hidden" name="deleteid2" id="deleteid2">
																				<input type="hidden" name="verifyid" id="verifyid">
																				<input type="hidden" name="blockid" id="blockid">
																				<input type="hidden" name="approvenshowid" id="approvenshowid">
																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																			</form>

																			<table class="table table-th-block table-hover">
																				<thead>
																					<tr style="font-size:11px;">
																						<th style="width: 40px;">ID</th>
																						<th>City</th>
																						<th>Hotel Name</th>
																						<th>Venture</th>
																						<th>Chain Name</th>
																						<th>Type</th>
																						<th>Star</th>
																						<th>Concern Person</th>
																						<th>Contact no</th>
																						<th>Email</th>
																						<th>Registration Date</th>
																						<th>Email Verified</th>
																						<th>Phone Verified</th>
																						<th>Start Date</th>
																						<th>End Date</th>
																						<th>Validity</th>
																						<?php if ($_SESSION['groupid'] == 0) { ?>
																							<th>Create Invoice</th>
																							<th>View Invoice</th>
																							<th>Change Password</th><?php } ?>
																						<th>Demo</th>
																						<th>Verify</th>
																						<th>Block</th>
																						<th>View Details</th>
																					</tr>
																				</thead>
																				<tbody>
																					<?php $pagesize = 20;

																					if (col('cnt') != "") {
																						$current_page = is_numeric(col('cnt')) && col('cnt') > 0 ? (int)col('cnt') : 1;
																					} else {
																						$current_page = 1;
																					}
																					$subscriptionJoin = "
																				    JOIN (
																				        SELECT ps1.start_date, ps1.end_date, ps1.hotel_id
																				        FROM pms_subscriptions ps1
																				        JOIN (
																				            SELECT hotel_id, MAX(id) AS max_id
																				            FROM pms_subscriptions
																				            GROUP BY hotel_id
																				        ) latest ON latest.hotel_id = ps1.hotel_id AND latest.max_id = ps1.id
																				        WHERE CURDATE() BETWEEN ps1.start_date AND ps1.end_date
																				    ) ps ON ps.hotel_id = h.id
																				";

																					$base_query = "select h.id,u.id as payment_id,u.approved,coalesce(cast(h.id as char),'*')hotelid,c.city,u.company,(case when h.admin>0 then 'Chain' else 'Single' end)venture,coalesce(ua.company,'-')chainname,h.propertytype,h.stars,u.fullname,u.contact, u.email,u.emailverified,u.mobileverified,c.id as cityid, ps.start_date AS subscription_start,ps.end_date AS subscription_end,u.reg_date from users u join hotels h on u.id=h.user left join subscription_payments sp on u.payment_id=sp.id left join cities c on u.city=c.id left join users ua on ua.id=h.admin $subscriptionJoin where u.active=1 and (u.groupid=2)";

																					$filt = "";
																					if (col("city") != "")
																						$filt .= " and c.id=" . col("city");

																					if (col("hotel") != "")
																						$filt .= " and h.id=" . col("hotel");

																					if (col("venture") != "") {
																						if (col("venture") == "chain")
																							$filt .= " and h.admin>0";
																						else
																							$filt .= " and h.admin=0";
																					}

																					if (col("type") != "")
																						$filt .= " and h.propertytype='" . col("type") . "'";

																					if (col("star") != "")
																						$filt .= " and h.stars=" . col("star");

																					if (col("chain") != "")
																						$filt .= "";

																					$a = new pagination($base_query . $filt, $current_page, $pagesize);

																					// $current_page = $a->current_page_;
																					$offset = ($current_page - 1) * $pagesize;
																					$qry = $base_query . $filt . " order by h.id limit $offset ,$pagesize";

																					$result = $conn->query($qry);
																					if ($result->num_rows > 0) {
																						$str = "";
																						$i = (($current_page - 1) * $pagesize + 1);
																						while ($row = $result->fetch_assoc()) {

																							$invoices = execute("select count(*)cnt from subscription_payments where userx=$row[payment_id] and invoice>0")["cnt"];

																							$str .= "<tr>
																<td>$row[hotelid]</td>
																<td>$row[city]</td>
																<td>$row[company]</td>
																<td>$row[venture]</td>
																<td>$row[chainname]</td>
																<td>$row[propertytype]</td>
																<td>$row[stars]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																							if ($row['emailverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							if ($row['mobileverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							$str .= "<td align=center>" . date('d-M-Y', strtotime($row['subscription_start'])) . "</td>";
																							$str .= "<td align=center>" . date('d-M-Y', strtotime($row['subscription_end'])) . "</td>";
																							$start = strtotime($row['subscription_start']);
																							$end = strtotime($row['subscription_end']);
																							$diff_days = ($end - $start) / (60 * 60 * 24);
																							$str .= "<td align=center>{$diff_days} days</td>";
																							if ($_SESSION['groupid'] == 0) {
																								$str .= "<td>
																									<a href='lightboxes/create_invoice.php?id=$row[payment_id]' class='fancybox2 fancybox.iframe'>
																										<span class='label label-primary'>Create</span>
																									</a>
																								</td>";

																								$str .= '<td>';

																								if (!empty($invoices)) {
																									$invCount = (int) $invoices;          // cast for safety
																									$userId   = (int) $row['payment_id'];     // cast for safety

																									$str .= "<a href='lightboxes/view_invoices.php?id={$userId}'
               class='fancybox2 fancybox.iframe'>
                <span class='label label-info'>{$invCount}</span>
            </a>";
																								} else {
																									$str .= "<span class='label label-default'>0</span>";
																								}

																								$str .= '</td>';

																								$str .= "
																							    <td align='center'>
																							        <a href='javascript:void(0)' class='btn btn-xs btn-primary' onclick='openPasswordModal($row[id], \"$row[fullname]\")'>
																							            Change
																							        </a>
																							    </td>";
																							}
																							$str .= "
																						    <td>
																						        <a href='javascript:void(0)'
																						           onclick='openDemoModal($row[hotelid])'>
																						             <span class='label label-info'>Demo</span>
																						        </a>
																						    </td>
																						";
																							if ($row['approved'] == 1) {
																								$str .= "<td><span class='label label-success'>Verified</span></td>";
																							} else {
																								$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";
																							}
																							$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																							if ($row['venture'] == "Single")
																								$str .= "<td><a href='?Pg=basicinfo&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";
																							else
																								$str .= "<td><a href='?Pg=myhotels&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";

																							$str .= "</tr>";
																							$i++;
																						}
																						echo $str;
																					} else {
																						echo "<tr><td colspan='14'>No partners to verify</td></tr>";
																					} ?>
																				</tbody>
																			</table>
																		</div>
																		<!-- Demo Modal -->
																		<div class="modal fade" id="demoModal" tabindex="-1" aria-hidden="true">
																			<div class="modal-dialog">
																				<form class="modal-content" id="demoForm">
																					<div class="modal-header">
																						<h5 class="modal-title">Create demo subscription</h5>
																						<button type="button" class="close" data-dismiss="modal">&times;</button>
																					</div>

																					<div class="modal-body">
																						<input type="hidden" name="hotel_id" id="demo_hotel_id">
																						<div class="form-group">
																							<label>Startdate</label>
																							<input type="date" name="start_date" class="form-control" required>
																						</div>
																						<div class="form-group">
																							<label>Enddate</label>
																							<input type="date" name="end_date" class="form-control" required>
																						</div>
																					</div>

																					<div class="modal-footer">
																						<button type="submit" class="btn btn-primary">Save demo</button>
																						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
																					</div>
																				</form>
																			</div>
																		</div>
																		<div id="passwordModal" class="modal fade" tabindex="-1" role="dialog">
																			<div class="modal-dialog" role="document">
																				<form id="passwordForm" method="POST">
																					<div class="modal-content">
																						<div class="modal-header">
																							<h5 class="modal-title">Change Password for <span id="modalHotelName"></span></h5>
																							<button type="button" class="close" data-dismiss="modal">&times;</button>
																						</div>
																						<div class="modal-body">
																							<div id="messageBox-registerhotel"></div>
																							<input type="hidden" name="user_id" id="modalUserId">
																							<input type="hidden" name="post_action" value="change_password">
																							<div class="form-group">
																								<label>New Password</label>
																								<input type="password" name="new_password" class="form-control" required>
																							</div>
																							<div class="form-group">
																								<label>Confirm Password</label>
																								<input type="password" name="confirm_password" class="form-control" required>
																							</div>
																						</div>
																						<div class="modal-footer">
																							<button type="submit" class="btn btn-success">Save</button>
																							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
																						</div>
																					</div>
																				</form>
																			</div>
																		</div>
																		<script>
																			$(document).ready(function() {
																				$('#passwordForm').on('submit', function(e) {
																					e.preventDefault(); // prevent form from submitting normally
																					const password = $('input[name="new_password"]').val().trim();
																					const confirmPassword = $('input[name="confirm_password"]').val().trim();

																					// Validate
																					if (password !== confirmPassword) {
																						showMessageBoxregisterhotel('Passwords do not match.', 'failure');
																						return; // Stop form submission
																					}
																					$.ajax({
																						type: 'POST',
																						url: 'bookingajax.php',
																						data: $(this).serialize(),
																						success: function(response) {
																							$('#passwordModal').modal('hide');

																							// Show response in alertbox (assuming you have alertbox(type, message))
																							if (response.includes('successfully')) {
																								showMessageBoxregisterhotel(response, 'success');
																							} else {
																								showMessageBoxregisterhotel(response, 'failure');
																							}
																						},
																						error: function() {
																							showMessageBoxregisterhotel('Something went wrong. Please try again.', 'failure');
																						}
																					});
																				});
																			});

																			function showMessageBoxregisterhotel(content, type) {
																				const messageBox = document.getElementById('messageBox-registerhotel');

																				// Determine the alert class based on the type parameter
																				let alertClass;
																				switch (type) {
																					case 'success':
																						alertClass = 'alert-success';
																						break;
																					case 'error':
																						alertClass = 'alert-danger';
																						break;
																					case 'warning':
																						alertClass = 'alert-warning';
																						break;
																					default:
																						alertClass = 'alert-info';
																				}

																				// Populate the messageBox with the content and appropriate styling
																				messageBox.innerHTML = `
														<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:125px; right:34px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
															<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
															<p style="width:90%;">${content}</p>
														</div>`;

																				// Show the message box
																				messageBox.style.display = "block";

																				// Automatically hide the message box after 4 seconds
																				setTimeout(() => {
																					messageBox.style.display = "none";
																				}, 4000);
																			}
																		</script>

																		<script>
																			function openPasswordModal(userId, hotelName) {
																				document.getElementById('modalUserId').value = userId;
																				document.getElementById('modalHotelName').innerText = hotelName;
																				$('#passwordModal').modal('show');
																			}
																		</script>


																		<script>
																			function openDemoModal(hotelId) {
																				document.getElementById('demo_hotel_id').value = hotelId;
																				$('#demoModal').modal('show');
																			}

																			$('#demoForm').on('submit', function(e) {
																				e.preventDefault();
																				$.post('save_demo_subscription.php', $(this).serialize(), function(resp) {
																					if (resp === 'OK') {
																						$('#demoModal').modal('hide');
																						location.reload(); // refresh list
																					} else {
																						alert(resp); // show error text
																					}
																				});
																			});
																		</script>

																		<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																	</div>
																</div>
															</div>
														<?php
															} else if ($_GET['Pg'] == "expiredSubscription" and $page_access) { ?>
															<h1 class="page-heading">Expired Subscription</h1>
															<div class="row">
																<div class="col-sm-12">
																	<div class="the-box">
																		<?php if (col("verifyid") != "") {
																			$id = $_POST['verifyid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.approved=1 where h.id=$id");
																			$conn->query("update pictures set approved=1,approvaldate=now() where propertyid=$id and type='Hotel'");
																			$conn->query("update pictures p join roomtypes r on (r.id=p.propertyid and p.type='Room') set p.approved=1,p.approvaldate=now() where r.hotel=$id");
																			alertbox("success", "Partner has been verified");
																		}

																		if (col("blockid") != "") {
																			$id = $_POST['blockid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.active=0 where h.id=$id");
																			alertbox("success", "Partner has been blocked");
																		} ?>
																		<h4 class="small-title">Expired Subscription</h4>
																		<div class="table-responsive" style="overflow-x:scroll;">
																			<?php verifymodal("Hotel", "hotel");
																			blockmodal("Hotel", "hotel"); ?>
																			<form name="filter_form" method="POST">
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="city" onChange="form.submit()">
																							<option value="">City</option>
																							<?php $result = $conn->query("select id,city from cities order by city");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="hotel" style="width:210px;">
																							<option value="">Hotel</option>
																							<?php if (col("city") != "")
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.city=" . col("city") . " order by u.company");
																							else
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user order by u.company");

																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="chain" style="width:210px;">
																							<option value="">Chain</option>
																							<?php $result = $conn->query("select u.id,u.company from users u where exists (select * from hotels where admin=u.id) order by u.company");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("chain"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="venture" style="height:34px">
																							<option value="">Venture</option>
																							<option value="single" <?= selected(col("venture"), "single") ?>>Single</option>
																							<option value="chain" <?= selected(col("venture"), "chain") ?>>Chain</option>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="type" style="height:34px">
																							<option value="">Type</option>
																							<option value="Hotel" <?= selected(col("type"), "Hotel") ?>>Hotel</option>
																							<option value="Resort" <?= selected(col("type"), "Resort") ?>>Resort</option>
																							<option value="Motel" <?= selected(col("type"), "Motel") ?>>Motel</option>
																							<option value="Bed n Breakfast" <?= selected(col("type"), "Bed n Breakfast") ?>>Bed n Breakfast</option>
																							<option value="Hostel" <?= selected(col("type"), "Hostel") ?>>Hostel</option>
																							<option value="Home Stay" <?= selected(col("type"), "Home Stay") ?>>Home Stay</option>
																							<option value="Service Apartment" <?= selected(col("type"), "Service Apartment") ?>>Service Apartment</option>
																							<option value="Bungalow" <?= selected(col("type"), "Bungalow") ?>>Bungalow</option>
																							<option value="Villa" <?= selected(col("type"), "Villa") ?>>Villa</option>
																							<option value="Lodge" <?= selected(col("type"), "Lodge") ?>>Lodge</option>
																							<option value="Guest House" <?= selected(col("type"), "Guest House") ?>>Guest House</option>
																							<option value="Other" <?= selected(col("type"), "Other") ?>>Other</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<input type="submit" class="btn btn-success" value="Apply">
																					</div>
																				</div>
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control" name="star" style="height:34px">
																							<option value="">Star</option>
																							<option value="0" <?= selected(col("star"), "0") ?>>No star</option>
																							<option value="1" <?= selected(col("star"), "1") ?>>1</option>
																							<option value="2" <?= selected(col("star"), "2") ?>>2</option>
																							<option value="3" <?= selected(col("star"), "3") ?>>3</option>
																							<option value="4" <?= selected(col("star"), "4") ?>>4</option>
																							<option value="5" <?= selected(col("star"), "5") ?>>5</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<a href="?Pg=partnerverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																					</div>
																				</div>
																				<input type="hidden" name="deleteid" id="deleteid">
																				<input type="hidden" name="deleteid2" id="deleteid2">
																				<input type="hidden" name="verifyid" id="verifyid">
																				<input type="hidden" name="blockid" id="blockid">
																				<input type="hidden" name="approvenshowid" id="approvenshowid">
																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																			</form>
																			<table class="table table-th-block table-hover">
																				<thead>
																					<tr style="font-size:11px;">
																						<th style="width: 40px;">ID</th>
																						<th>City</th>
																						<th>Hotel Name</th>
																						<th>Venture</th>
																						<th>Chain Name</th>
																						<th>Type</th>
																						<th>Star</th>
																						<th>Concern Person</th>
																						<th>Contact no</th>
																						<th>Email</th>
																						<th>Registration Date</th>
																						<th>Email Verified</th>
																						<th>Phone Verified</th>
																						<th>Start Date</th>
																						<th>End Date</th>
																						<th>Validity</th>
																						<?php if ($_SESSION['groupid'] == 0) { ?>
																							<th>Change Password</th><?php } ?>
																						<th>Demo</th>
																						<th>Verify</th>
																						<th>Block</th>
																						<th>View Details</th>
																					</tr>
																				</thead>
																				<tbody>
																					<?php $pagesize = 20;

																					if (col('cnt') != "") {
																						$current_page = is_numeric(col('cnt')) && col('cnt') > 0 ? (int)col('cnt') : 1;
																					} else {
																						$current_page = 1;
																					}
																					$subscriptionJoin = "
    JOIN (
        SELECT ps1.start_date, ps1.end_date, ps1.hotel_id
        FROM pms_subscriptions ps1
        JOIN (
            SELECT hotel_id, MAX(id) AS max_id
            FROM pms_subscriptions
            GROUP BY hotel_id
        ) latest ON latest.hotel_id = ps1.hotel_id AND latest.max_id = ps1.id
        WHERE ps1.end_date < CURDATE()
    ) ps ON ps.hotel_id = h.id
";



																					$base_query = "select h.id,coalesce(cast(h.id as char),'*')hotelid,u.approved,c.city,u.company,(case when h.admin>0 then 'Chain' else 'Single' end)venture,coalesce(ua.company,'-')chainname,h.propertytype,h.stars,u.fullname,u.contact, u.email,u.emailverified,ps.start_date AS subscription_start,ps.end_date AS subscription_end,u.mobileverified,c.id as cityid,u.reg_date from users u join hotels h on u.id=h.user left join cities c on u.city=c.id left join users ua on ua.id=h.admin $subscriptionJoin where u.active=1 and (u.groupid=2)";

																					// echo $base_query;
																					$filt = "";
																					if (col("city") != "")
																						$filt .= " and c.id=" . col("city");

																					if (col("hotel") != "")
																						$filt .= " and h.id=" . col("hotel");

																					if (col("venture") != "") {
																						if (col("venture") == "chain")
																							$filt .= " and h.admin>0";
																						else
																							$filt .= " and h.admin=0";
																					}

																					if (col("type") != "")
																						$filt .= " and h.propertytype='" . col("type") . "'";

																					if (col("star") != "")
																						$filt .= " and h.stars=" . col("star");

																					if (col("chain") != "")
																						$filt .= "";

																					$a = new pagination($base_query . $filt, $current_page, $pagesize);

																					// $current_page = $a->current_page_;
																					$offset = ($current_page - 1) * $pagesize;
																					$qry = $base_query . $filt . " order by h.id limit $offset ,$pagesize";

																					$result = $conn->query($qry);
																					if ($result->num_rows > 0) {
																						$str = "";
																						$i = (($current_page - 1) * $pagesize + 1);
																						while ($row = $result->fetch_assoc()) {
																							$str .= "<tr>
																<td>$row[hotelid]</td>
																<td>$row[city]</td>
																<td>$row[company]</td>
																<td>$row[venture]</td>
																<td>$row[chainname]</td>
																<td>$row[propertytype]</td>
																<td>$row[stars]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																							if ($row['emailverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							if ($row['mobileverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							$str .= "<td align=center>" . date('d-M-Y', strtotime($row['subscription_start'])) . "</td>";
																							$str .= "<td align=center>" . date('d-M-Y', strtotime($row['subscription_end'])) . "</td>";

																							$start = new DateTime($row['subscription_start']);
																							$end = new DateTime($row['subscription_end']);
																							$today = new DateTime();
																							$expired_days = $end->diff($today)->days;
																							$str .= "<td align=center style='color:red;'>Expired before {$expired_days} days</td>";
																							if ($_SESSION['groupid'] == 0) {
																								$str .= "
																							    <td align='center'>
																							        <a href='javascript:void(0)' class='btn btn-xs btn-primary' onclick='openPasswordModal($row[id], \"$row[fullname]\")'>
																							            Change
																							        </a>
																							    </td>";
																							}
																							$str .= "
																						    <td>
																						        <a href='javascript:void(0)'
																						           onclick='openDemoModal($row[hotelid])'>
																						             <span class='label label-info'>Demo</span>
																						        </a>
																						    </td>
																						";
																							if ($row['approved'] == 1) {
																								$str .= "<td><span class='label label-success'>Verified</span></td>";
																							} else {
																								$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";
																							}
																							$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																							if ($row['venture'] == "Single")
																								$str .= "<td><a href='?Pg=basicinfo&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";
																							else
																								$str .= "<td><a href='?Pg=myhotels&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";

																							$str .= "</tr>";
																							$i++;
																						}
																						echo $str;
																					} else {
																						echo "<tr><td colspan='14'>No partners to verify</td></tr>";
																					} ?>
																				</tbody>
																			</table>
																		</div>
																		<!-- Demo Modal -->
																		<div class="modal fade" id="demoModal" tabindex="-1" aria-hidden="true">
																			<div class="modal-dialog">
																				<form class="modal-content" id="demoForm">
																					<div class="modal-header">
																						<h5 class="modal-title">Create demo subscription</h5>
																						<button type="button" class="close" data-dismiss="modal">&times;</button>
																					</div>

																					<div class="modal-body">
																						<input type="hidden" name="hotel_id" id="demo_hotel_id">
																						<div class="form-group">
																							<label>Startdate</label>
																							<input type="date" name="start_date" class="form-control" required>
																						</div>
																						<div class="form-group">
																							<label>Enddate</label>
																							<input type="date" name="end_date" class="form-control" required>
																						</div>
																					</div>

																					<div class="modal-footer">
																						<button type="submit" class="btn btn-primary">Save demo</button>
																						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
																					</div>
																				</form>
																			</div>
																		</div>
																		<div id="passwordModal" class="modal fade" tabindex="-1" role="dialog">
																			<div class="modal-dialog" role="document">
																				<form id="passwordForm" method="POST">
																					<div class="modal-content">
																						<div class="modal-header">
																							<h5 class="modal-title">Change Password for <span id="modalHotelName"></span></h5>
																							<button type="button" class="close" data-dismiss="modal">&times;</button>
																						</div>
																						<div class="modal-body">
																							<div id="messageBox-registerhotel"></div>
																							<input type="hidden" name="user_id" id="modalUserId">
																							<input type="hidden" name="post_action" value="change_password">
																							<div class="form-group">
																								<label>New Password</label>
																								<input type="password" name="new_password" class="form-control" required>
																							</div>
																							<div class="form-group">
																								<label>Confirm Password</label>
																								<input type="password" name="confirm_password" class="form-control" required>
																							</div>
																						</div>
																						<div class="modal-footer">
																							<button type="submit" class="btn btn-success">Save</button>
																							<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
																						</div>
																					</div>
																				</form>
																			</div>
																		</div>
																		<script>
																			$(document).ready(function() {
																				$('#passwordForm').on('submit', function(e) {
																					e.preventDefault(); // prevent form from submitting normally
																					const password = $('input[name="new_password"]').val().trim();
																					const confirmPassword = $('input[name="confirm_password"]').val().trim();

																					// Validate
																					if (password !== confirmPassword) {
																						showMessageBoxregisterhotel('Passwords do not match.', 'failure');
																						return; // Stop form submission
																					}
																					$.ajax({
																						type: 'POST',
																						url: 'bookingajax.php',
																						data: $(this).serialize(),
																						success: function(response) {
																							$('#passwordModal').modal('hide');

																							// Show response in alertbox (assuming you have alertbox(type, message))
																							if (response.includes('successfully')) {
																								showMessageBoxregisterhotel(response, 'success');
																							} else {
																								showMessageBoxregisterhotel(response, 'failure');
																							}
																						},
																						error: function() {
																							showMessageBoxregisterhotel('Something went wrong. Please try again.', 'failure');
																						}
																					});
																				});
																			});

																			function showMessageBoxregisterhotel(content, type) {
																				const messageBox = document.getElementById('messageBox-registerhotel');

																				// Determine the alert class based on the type parameter
																				let alertClass;
																				switch (type) {
																					case 'success':
																						alertClass = 'alert-success';
																						break;
																					case 'error':
																						alertClass = 'alert-danger';
																						break;
																					case 'warning':
																						alertClass = 'alert-warning';
																						break;
																					default:
																						alertClass = 'alert-info';
																				}

																				// Populate the messageBox with the content and appropriate styling
																				messageBox.innerHTML = `
														<div style="position:absolute; z-index:50; width:35%; padding: 5px 14px; height:30px; top:125px; right:34px; border-radius: 2px;" class="alert ${alertClass} alert-block square fade in alert-dismissable">
															<button style="width: 45px;" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
															<p style="width:90%;">${content}</p>
														</div>`;

																				// Show the message box
																				messageBox.style.display = "block";

																				// Automatically hide the message box after 4 seconds
																				setTimeout(() => {
																					messageBox.style.display = "none";
																				}, 4000);
																			}
																		</script>

																		<script>
																			function openPasswordModal(userId, hotelName) {
																				document.getElementById('modalUserId').value = userId;
																				document.getElementById('modalHotelName').innerText = hotelName;
																				$('#passwordModal').modal('show');
																			}
																		</script>


																		<script>
																			function openDemoModal(hotelId) {
																				document.getElementById('demo_hotel_id').value = hotelId;
																				$('#demoModal').modal('show');
																			}

																			$('#demoForm').on('submit', function(e) {
																				e.preventDefault();
																				$.post('save_demo_subscription.php', $(this).serialize(), function(resp) {
																					if (resp === 'OK') {
																						$('#demoModal').modal('hide');
																						location.reload(); // refresh list
																					} else {
																						alert(resp); // show error text
																					}
																				});
																			});
																		</script>

																		<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																	</div>
																</div>
															</div>
														<?php
															} else if ($_GET['Pg'] == "pendingsubscription" and $page_access) { ?>
															<h1 class="page-heading">Pending Subscription</h1>
															<div class="row">
																<div class="col-sm-12">
																	<div class="the-box">
																		<?php if (col("verifyid") != "") {
																			$id = $_POST['verifyid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.approved=1 where h.id=$id");
																			$conn->query("update pictures set approved=1,approvaldate=now() where propertyid=$id and type='Hotel'");
																			$conn->query("update pictures p join roomtypes r on (r.id=p.propertyid and p.type='Room') set p.approved=1,p.approvaldate=now() where r.hotel=$id");
																			alertbox("success", "Partner has been verified");
																		}

																		if (col("blockid") != "") {
																			$id = $_POST['blockid'];
																			$conn->query("update users u join hotels h on h.user=u.id set u.active=0 where h.id=$id");
																			alertbox("success", "Partner has been blocked");
																		} ?>
																		<h4 class="small-title">Pending Subscription</h4>
																		<div class="table-responsive" style="overflow-x:scroll;">
																			<?php verifymodal("Hotel", "hotel");
																			blockmodal("Hotel", "hotel"); ?>
																			<form name="filter_form" method="POST">
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="city" onChange="form.submit()">
																							<option value="">City</option>
																							<?php $result = $conn->query("select id,city from cities order by city");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="hotel" style="width:210px;">
																							<option value="">Hotel</option>
																							<?php if (col("city") != "")
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.city=" . col("city") . " order by u.company");
																							else
																								$result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user order by u.company");

																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control chosen-select" name="chain" style="width:210px;">
																							<option value="">Chain</option>
																							<?php $result = $conn->query("select u.id,u.company from users u where exists (select * from hotels where admin=u.id) order by u.company");
																							while ($row = $result->fetch_assoc()) { ?>
																								<option value="<?= $row['id'] ?>" <?= selected(col("chain"), $row['id']) ?>><?= $row['company'] ?></option>
																							<?php
																							} ?>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="venture" style="height:34px">
																							<option value="">Venture</option>
																							<option value="single" <?= selected(col("venture"), "single") ?>>Single</option>
																							<option value="chain" <?= selected(col("venture"), "chain") ?>>Chain</option>
																						</select>
																					</div>
																					<div class="btn-group">
																						<select class="form-control" name="type" style="height:34px">
																							<option value="">Type</option>
																							<option value="Hotel" <?= selected(col("type"), "Hotel") ?>>Hotel</option>
																							<option value="Resort" <?= selected(col("type"), "Resort") ?>>Resort</option>
																							<option value="Motel" <?= selected(col("type"), "Motel") ?>>Motel</option>
																							<option value="Bed n Breakfast" <?= selected(col("type"), "Bed n Breakfast") ?>>Bed n Breakfast</option>
																							<option value="Hostel" <?= selected(col("type"), "Hostel") ?>>Hostel</option>
																							<option value="Home Stay" <?= selected(col("type"), "Home Stay") ?>>Home Stay</option>
																							<option value="Service Apartment" <?= selected(col("type"), "Service Apartment") ?>>Service Apartment</option>
																							<option value="Bungalow" <?= selected(col("type"), "Bungalow") ?>>Bungalow</option>
																							<option value="Villa" <?= selected(col("type"), "Villa") ?>>Villa</option>
																							<option value="Lodge" <?= selected(col("type"), "Lodge") ?>>Lodge</option>
																							<option value="Guest House" <?= selected(col("type"), "Guest House") ?>>Guest House</option>
																							<option value="Other" <?= selected(col("type"), "Other") ?>>Other</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<input type="submit" class="btn btn-success" value="Apply">
																					</div>
																				</div>
																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																					<div class="btn-group">
																						<select class="form-control" name="star" style="height:34px">
																							<option value="">Star</option>
																							<option value="0" <?= selected(col("star"), "0") ?>>No star</option>
																							<option value="1" <?= selected(col("star"), "1") ?>>1</option>
																							<option value="2" <?= selected(col("star"), "2") ?>>2</option>
																							<option value="3" <?= selected(col("star"), "3") ?>>3</option>
																							<option value="4" <?= selected(col("star"), "4") ?>>4</option>
																							<option value="5" <?= selected(col("star"), "5") ?>>5</option>
																						</select>
																					</div>
																					<div class="btn-group pull-right">
																						<a href="?Pg=partnerverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																					</div>
																				</div>
																				<input type="hidden" name="deleteid" id="deleteid">
																				<input type="hidden" name="deleteid2" id="deleteid2">
																				<input type="hidden" name="verifyid" id="verifyid">
																				<input type="hidden" name="blockid" id="blockid">
																				<input type="hidden" name="approvenshowid" id="approvenshowid">
																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																			</form>
																			<table class="table table-th-block table-hover">
																				<thead>
																					<tr style="font-size:11px;">
																						<th style="width: 40px;">ID</th>
																						<th>City</th>
																						<th>Hotel Name</th>
																						<th>Venture</th>
																						<th>Chain Name</th>
																						<th>Type</th>
																						<th>Star</th>
																						<th>Concern Person</th>
																						<th>Contact no</th>
																						<th>Email</th>
																						<th>Registration Date</th>
																						<th>Email Verified</th>
																						<th>Phone Verified</th>
																						<th>Demo</th>
																						<th>Verify</th>
																						<th>Block</th>
																						<th>View Details</th>
																					</tr>
																				</thead>
																				<tbody>
																					<?php $perPage = 10;                                      // rows per page
																					$page    = isset($_GET['p']) && $_GET['p'] > 0
																						? (int)$_GET['p']
																						: 1;

																					$offset  = ($page - 1) * $perPage;

																					$base_query = "select h.id,u.approved,coalesce(cast(h.id as char),'*')hotelid,c.city,u.company,(case when h.admin>0 then 'Chain' else 'Single' end)venture,coalesce(ua.company,'-')chainname,h.propertytype,h.stars,u.fullname,u.contact, u.email,u.emailverified,u.mobileverified,c.id as cityid,u.reg_date from users u join hotels h on u.id=h.user left join cities c on u.city=c.id left join users ua on ua.id=h.admin where u.active=1 and (u.groupid=2)  AND NOT EXISTS (
          SELECT 1
          FROM pms_subscriptions ps
          WHERE ps.hotel_id = h.id
            AND CURDATE() BETWEEN ps.start_date AND ps.end_date
      )";

																					//echo $base_query;
																					$filt = "";
																					if (col("city") != "")
																						$filt .= " and c.id=" . col("city");

																					if (col("hotel") != "")
																						$filt .= " and h.id=" . col("hotel");

																					if (col("venture") != "") {
																						if (col("venture") == "chain")
																							$filt .= " and h.admin>0";
																						else
																							$filt .= " and h.admin=0";
																					}

																					if (col("type") != "")
																						$filt .= " and h.propertytype='" . col("type") . "'";

																					if (col("star") != "")
																						$filt .= " and h.stars=" . col("star");

																					if (col("chain") != "")
																						$filt .= "";
																					$paginated_sql = "SELECT * FROM ({$base_query} {$filt}) AS temp";
																					$a = new pagination($paginated_sql, $current_page, $pagesize);
																					// $current_page = $a->current_page_;
																					$qry = $base_query . $filt . " order by h.id limit $perPage OFFSET $offset";
																					$result = $conn->query($qry);

																					$countSql   = "SELECT COUNT(*) AS total FROM ({$base_query} {$filt}) x";
																					$totalRows  = (int) $conn->query($countSql)->fetch_assoc()['total'];
																					$totalPages = (int) ceil($totalRows / $perPage);
																					if ($result->num_rows > 0) {
																						$str = "";
																						$i = $offset + 1;
																						while ($row = $result->fetch_assoc()) {
																							$str .= "<tr>
																<td>$row[hotelid]</td>
																<td>$row[city]</td>
																<td>$row[company]</td>
																<td>$row[venture]</td>
																<td>$row[chainname]</td>
																<td>$row[propertytype]</td>
																<td>$row[stars]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																							if ($row['emailverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							if ($row['mobileverified'])
																								$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																							else
																								$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																							$str .= "
																						    <td>
																						        <a href='javascript:void(0)'
																						           onclick='openDemoModal($row[hotelid])'>
																						             <span class='label label-info'>Demo</span>
																						        </a>
																						    </td>
																						";
																							if ($row['approved'] == 1) {
																								$str .= "<td><span class='label label-success'>Verified</span></td>";
																							} else {
																								$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";
																							}
																							$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																							if ($row['venture'] == "Single")
																								$str .= "<td><a href='?Pg=basicinfo&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";
																							else
																								$str .= "<td><a href='?Pg=myhotels&current_city=$row[cityid]&current_hotel=$row[id]' target=_blank><span class='label label-purple'>View Details</span></a></td>";

																							$str .= "</tr>";
																							$i++;
																						}
																						echo $str;
																					} else {
																						echo "<tr><td colspan='14'>No partners to verify</td></tr>";
																					} ?>
																				</tbody>
																			</table>
																			<?php if ($totalPages > 1): ?>
																				<nav aria-label="pendingsubs pages">
																					<ul class="pagination">
																						<?php
																						/* previous */
																						$prev = $page - 1;
																						echo '<li class="page-item ' . ($prev < 1 ? 'disabled' : '') . '">
                <a class="page-link" href="?Pg=pendingsubscription&p=' . $prev . '">&laquo;</a>
              </li>';

																						/* centred window 2 */
																						$win = 2;
																						$start = max(1, $page - $win);
																						$end   = min($totalPages, $page + $win);
																						for ($i = $start; $i <= $end; $i++) {
																							echo '<li class="page-item ' . ($i == $page ? 'active' : '') . '">
                    <a class="page-link" href="?Pg=pendingsubscription&p=' . $i . '">' . $i . '</a>
                  </li>';
																						}

																						/* next */
																						$next = $page + 1;
																						echo '<li class="page-item ' . ($next > $totalPages ? 'disabled' : '') . '">
                <a class="page-link" href="?Pg=pendingsubscription&p=' . $next . '">&raquo;</a>
              </li>';
																						?>
																					</ul>
																				</nav>
																			<?php endif; ?>

																		</div>
																		<!-- Demo Modal -->
																		<div class="modal fade" id="demoModal" tabindex="-1" aria-hidden="true">
																			<div class="modal-dialog">
																				<form class="modal-content" id="demoForm">
																					<div class="modal-header">
																						<h5 class="modal-title">Create demo subscription</h5>
																						<button type="button" class="close" data-dismiss="modal">&times;</button>
																					</div>

																					<div class="modal-body">
																						<input type="hidden" name="hotel_id" id="demo_hotel_id">
																						<div class="form-group">
																							<label>Startdate</label>
																							<input type="date" name="start_date" class="form-control" required>
																						</div>
																						<div class="form-group">
																							<label>Enddate</label>
																							<input type="date" name="end_date" class="form-control" required>
																						</div>
																					</div>

																					<div class="modal-footer">
																						<button type="submit" class="btn btn-primary">Save demo</button>
																						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
																					</div>
																				</form>
																			</div>
																		</div>

																		<script>
																			function openDemoModal(hotelId) {
																				document.getElementById('demo_hotel_id').value = hotelId;
																				$('#demoModal').modal('show');
																			}

																			$('#demoForm').on('submit', function(e) {
																				e.preventDefault();
																				$.post('save_demo_subscription.php', $(this).serialize(), function(resp) {
																					if (resp === 'OK') {
																						$('#demoModal').modal('hide');
																						location.reload(); // refresh list
																					} else {
																						alert(resp); // show error text
																					}
																				});
																			});
																		</script>

																	</div>
																</div>
															</div><?php
																} else if ($_GET['Pg'] == "chainverification" and $page_access) { ?>
																																																																													<h1 class="page-heading">Hotel Chain Verification</h1>
																																																																													<div class="row">
																																																																														<div class="col-sm-12">
																																																																															<div class="the-box">
																				<?php if (col("verifyid") != "") {
																					$id = $_POST['verifyid'];
																					$conn->query("update users set approved=1 where id=$id");
																					alertbox("success", "Hotel chain has been verified");
																				}

																				if (col("blockid") != "") {
																					$id = $_POST['blockid'];
																					$conn->query("update users set active=0 where id=$id");
																					alertbox("success", "Hotel chain has been blocked");
																				} ?>
																																																																																<h4 class="small-title">HOTEL CHAIN VERIFICATION</h4>
																				<?php verifymodal("Hotel", "hotel");
																				blockmodal("Hotel", "hotel"); ?>
																																																																																<form name="filter_form" method="POST">
																																																																																	<!-- <div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
													<div class="btn-group">
														<select class="form-control chosen-select" name="city" onChange="form.submit()">
															<option value="">City</option>
															<?php $result = $conn->query("select id,city from cities order by city");
															while ($row = $result->fetch_assoc()) { ?>
																<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																<?php
															} ?>
														</select>
													</div>
													<div class="btn-group">
														<select class="form-control chosen-select" name="chain" style="width:210px;">
															<option value="">Chain</option>
															<?php $result = $conn->query("select u.id,u.company from users u where exists (select * from hotels where admin=u.id) order by u.company");
															while ($row = $result->fetch_assoc()) { ?>
																<option value="<?= $row['id'] ?>" <?= selected(col("chain"), $row['id']) ?>><?= $row['company'] ?></option>
																<?php
															} ?>
														</select>
													</div>
													<div class="btn-group pull-right">
														<input type="submit" class="btn btn-success" value="Apply">
													</div>
													<div class="btn-group pull-right">
														<a href="?Pg=partnerverification"><input type="button" class="btn btn-danger" value="Reset"></a>
													</div>
												</div> -->
																																																																																	<input type="hidden" name="deleteid" id="deleteid">
																																																																																	<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																	<input type="hidden" name="verifyid" id="verifyid">
																																																																																	<input type="hidden" name="blockid" id="blockid">
																																																																																	<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																	<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																</form>
																																																																																<div class="table-responsive" style="overflow-x:scroll;">
																																																																																	<table class="table table-th-block table-hover">
																																																																																		<thead>
																																																																																			<tr style="font-size:11px;">
																																																																																				<th>Chain Name</th>
																																																																																				<th>City</th>
																																																																																				<th>Concern Person</th>
																																																																																				<th>Contact no</th>
																																																																																				<th>Email</th>
																																																																																				<th>Registration Date</th>
																																																																																				<th>Email Verification</th>
																																																																																				<th>Phone Verification</th>
																																																																																				<th>Verify</th>
																																																																																				<th>Block</th>
																																																																																			</tr>
																																																																																		</thead>
																																																																																		<tbody>
																							<?php $pagesize = 20;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select u.id,c.city,u.company,u.fullname,u.contact,u.email,u.emailverified,u.mobileverified,c.id as cityid,u.reg_date,u.emailkey,u.otp from users u left join hotels h on u.id=h.user left join cities c on u.city=c.id where u.approved=0 and u.active=1 and u.groupid=1";

																							//echo $base_query;
																							$filt = "";
																							if (col("city") != "")
																								$filt .= " and c.id=" . col("city");

																							if (col("hotel") != "")
																								$filt .= " and h.id=" . col("hotel");

																							if (col("chain") != "")
																								$filt .= "";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by u.id limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td>$row[company]</td>
																<td>$row[city]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																									if ($row['emailverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td>$row[emailkey]</td>";

																									if ($row['mobileverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td>$row[otp]</td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																									$str .= "</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='14'>No hotel chains to verify</td></tr>";
																							} ?>
																																																																																		</tbody>
																																																																																	</table>
																																																																																</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																															</div>
																																																																														</div>
																																																																													</div>
																<?php
							} else if ($_GET['Pg'] == "agentverification" and $page_access) { ?>
																																																																														<h1 class="page-heading">Agent Verification</h1>
																																																																														<div class="row">
																																																																															<div class="col-sm-12">
																																																																																<div class="the-box">
																				<?php if (col("verifyid") != "") {
																					$id = $_POST['verifyid'];
																					$conn->query("update users set approved=1 where id=$id");
																					alertbox("success", "Agent has been verified");
																				}

																				if (col("blockid") != "") {
																					$id = $_POST['blockid'];
																					$conn->query("update users set active=0 where id=$id");
																					alertbox("success", "Agent has been blocked");
																				} ?>
																																																																																	<h4 class="small-title">AGENT VERIFICATION</h4>
																																																																																	<div class="table-responsive" style="overflow-x:scroll;">
																					<?php verifymodal("Agent", "agent");
																					blockmodal("Agent", "agent"); ?>
																																																																																		<form name="filter_form" method="POST">
																																																																																			<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="city" style="width:160px;">
																																																																																						<option value="">City</option>
																									<?php $result = $conn->query("select distinct travelercity from users where groupid=3 order by travelercity");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['travelercity'] ?>" <?= selected(col("city"), $row['travelercity']) ?>><?= $row['travelercity'] ?></option>
																										<?php
																									} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="contact" style="width:160px;">
																																																																																						<option value="">Contact No.</option>
																									<?php $result = $conn->query("select contact from users where groupid=3");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['contact'] ?>" <?= selected(col("contact"), $row['contact']) ?>><?= $row['contact'] ?></option>
																										<?php
																									} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="email" style="width:200px;">
																																																																																						<option value="">Email</option>
																									<?php $result = $conn->query("select email from users where groupid=3");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['email'] ?>" <?= selected(col("email"), $row['email']) ?>><?= $row['email'] ?></option>
																										<?php
																									} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="pan" style="width:160px;">
																																																																																						<option value="">Pan Card</option>
																									<?php $result = $conn->query("select pan from users where groupid=3");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['pan'] ?>" <?= selected(col("pan"), $row['pan']) ?>><?= $row['pan'] ?></option>
																										<?php
																									} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group pull-right">
																																																																																					<a href="?Pg=agentverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																				</div>
																																																																																				<div class="btn-group pull-right">
																																																																																					<input type="submit" class="btn btn-success" value="Apply">
																																																																																				</div>
																																																																																			</div>
																																																																																			<input type="hidden" name="deleteid" id="deleteid">
																																																																																			<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																			<input type="hidden" name="verifyid" id="verifyid">
																																																																																			<input type="hidden" name="blockid" id="blockid">
																																																																																			<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																			<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																		</form>
																																																																																		<table class="table table-th-block table-hover">
																																																																																			<thead>

																																																																																				<tr style="font-size:11px;">
																																																																																					<th style="width: 40px;">Agent ID</th>
																																																																																					<th>Agent Venture Name</th>
																																																																																					<th>Concern Person</th>
																																																																																					<th>Contact No.</th>
																																																																																					<th>Email</th>
																																																																																					<th>Resident City</th>
																																																																																					<th>PAN Card</th>
																																																																																					<th>Registration Date</th>
																																																																																					<th>Email Verified</th>
																																																																																					<th>Phone Verified</th>
																																																																																					<th>Verify</th>
																																																																																					<th>Block</th>
																																																																																					<th>View Details</th>
																																																																																				</tr>
																																																																																			</thead>
																																																																																			<tbody>
																							<?php $pagesize = 20;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select id,fullname,company,contact,email,travelercity,emailverified,mobileverified,active,reg_date, pan,emailkey,otp from users where groupid=3 and approved=0 and active=1";

																							//echo $base_query;
																							$filt = "";
																							if (col("city") != "")
																								$filt .= " and travelercity='" . col("city") . "'";

																							if (col("contact") != "")
																								$filt .= " and contact='" . col("contact") . "'";

																							if (col("email") != "")
																								$filt .= " and email='" . col("email") . "'";

																							if (col("pan") != "")
																								$filt .= " and pan='" . col("pan") . "'";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by id desc limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td>$row[id]</td>
																<td>$row[company]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>$row[travelercity]</td>
																<td>$row[pan]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																									if ($row['emailverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center>$row[emailkey]</td>";

																									if ($row['mobileverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center>$row[otp]</td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																									$str .= "<td><a href='LBF_viewagent.php?id=$row[id]' class='fancybox2 fancybox.iframe'><span class='label label-purple'>View Details</span></a></td>";

																									$str .= "</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='11'>No agents to verify</td></tr>";
																							} ?>
																																																																																			</tbody>
																																																																																		</table>
																																																																																	</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																</div>
																																																																															</div>
																																																																														</div>
																<?php
							} else if ($_GET['Pg'] == "corporateverification" and $page_access) { ?>
																																																																															<h1 class="page-heading">Corporate Verification</h1>
																																																																															<div class="row">
																																																																																<div class="col-sm-12">
																																																																																	<div class="the-box">
																				<?php if (col("verifyid") != "") {
																					$id = $_POST['verifyid'];
																					$conn->query("update users set approved=1 where id=$id");
																					alertbox("success", "Venture has been verified");
																				}

																				if (col("blockid") != "") {
																					$id = $_POST['blockid'];
																					$conn->query("update users set active=0 where id=$id");
																					alertbox("success", "Venture has been blocked");
																				} ?>
																																																																																		<h4 class="small-title">CORPORATE VERIFICATION</h4>
																																																																																		<form name="filter_form" method="POST">
																																																																																			<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="city" style="width:160px;">
																																																																																						<option value="">City</option>
																								<?php $result = $conn->query("select distinct travelercity from users where groupid=4 order by travelercity");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['travelercity'] ?>"><?= $row['travelercity'] ?></option>
																									<?php
																								} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="company" style="width:180px;">
																																																																																						<option value="">Company Name</option>
																								<?php $result = $conn->query("select company from users where groupid=4 order by company");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['company'] ?>"><?= $row['company'] ?></option>
																									<?php
																								} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group">
																																																																																					<select class="form-control chosen-select" name="pan" style="width:160px;">
																																																																																						<option value="">Pan Card</option>
																								<?php $result = $conn->query("select pan from users where groupid=4 order by pan");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																								<option value="<?= $row['pan'] ?>"><?= $row['pan'] ?></option>
																									<?php
																								} ?>
																																																																																					</select>
																																																																																				</div>
																																																																																				<div class="btn-group pull-right">
																																																																																					<a href="?Pg=corporateverification"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																				</div>
																																																																																				<div class="btn-group pull-right">
																																																																																					<input type="submit" class="btn btn-success" value="Apply">
																																																																																				</div>
																																																																																			</div>
																																																																																			<input type="hidden" name="deleteid" id="deleteid">
																																																																																			<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																			<input type="hidden" name="verifyid" id="verifyid">
																																																																																			<input type="hidden" name="blockid" id="blockid">
																																																																																			<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																			<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																		</form>
																																																																																		<div class="table-responsive" style="overflow-x:scroll;">
																					<?php verifymodal("Venture", "venture");
																					blockmodal("Venture", "venture"); ?>
																																																																																			<table class="table table-th-block table-hover">
																																																																																				<thead>
																																																																																					<tr style="font-size:11px;">
																																																																																						<th style="width: 40px">Corporate ID</th>
																																																																																						<th>Company Name</th>
																																																																																						<th>Concern Person</th>
																																																																																						<th>Contact No.</th>
																																																																																						<th>Email</th>
																																																																																						<th>City</th>
																																																																																						<th>PAN Card</th>
																																																																																						<th>Registration Date</th>
																																																																																						<th>Email Verified</th>
																																																																																						<th>Phone Verified</th>
																																																																																						<th>Verify</th>
																																																																																						<th>Block</th>
																																																																																						<th>View Details</th>
																																																																																					</tr>
																																																																																				</thead>
																																																																																				<tbody>
																							<?php $pagesize = 20;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select id,fullname,company,contact,email,travelercity,pan,emailverified,mobileverified,active, reg_date from users where groupid=4 and approved=0 and active=1";

																							//echo $base_query;
																							$filt = "";
																							if (col("city") != "")
																								$filt .= " and travelercity='" . col("city") . "'";

																							if (col("company") != "")
																								$filt .= " and company='" . col("company") . "'";

																							//if(col("email")!="")
																							//$filt .= " and email='".col("email")."'";
																				
																							if (col("pan") != "")
																								$filt .= " and pan='" . col("pan") . "'";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by id desc limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td>$row[id]</td>
																<td>$row[company]</td>
																<td>$row[fullname]</td>
																<td>$row[contact]</td>
																<td>$row[email]</td>
																<td>$row[travelercity]</td>
																<td>$row[pan]</td>
																<td>" . popdate($row['reg_date']) . "</td>";

																									if ($row['emailverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																									if ($row['mobileverified'])
																										$str .= "<td align=center><i class='fa fa-check text-success'></i></td>";
																									else
																										$str .= "<td align=center><i class='fa fa-times text-danger'></i></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater3($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2'>Verify</span></a></td>";

																									$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";

																									$str .= "<td><a href='LBF_viewcorporate.php?id=$row[id]' class='fancybox2 fancybox.iframe'><span class='label label-purple'>View Details</span></a></td>";

																									$str .= "</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='11'>No ventures to verify</td></tr>";
																							} ?>
																																																																																				</tbody>
																																																																																			</table>
																																																																																		</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																	</div>
																																																																																</div>
																																																																															</div>
																<?php
							} else if ($_GET['Pg'] == "hotelimageverification" and $page_access) {
								$pagesize = 50;

								if (col('cnt') != "") {
									$current_page = $_POST['cnt'];
								} else {
									$current_page = 1;
								}

								$filt = "";
								if (col("city") != "")
									$filt .= " and cityid=" . col("city");
								if (col("hotel") != "")
									$filt .= " and id=" . col("hotel");

								$base_query = "select * from waitingpics where 1";

								//echo $base_query;
								$a = new pagination($base_query, $current_page, $pagesize);

								$current_page = $a->current_page_;

								$qry = $base_query . $filt . " limit " . $a->offset_ . ",$pagesize";

								//echo $qry;
								?>
																																																																																<h1 class="page-heading">Hotel Image Verification</h1>
																																																																																<div class="row">
																																																																																	<div class="col-sm-12">
																																																																																		<div class="the-box">
																																																																																			<h4 class="small-title">HOTEL IMAGE VERIFICATION</h4>
																																																																																			<form name="filter_form" method="POST">
																																																																																				<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																					<div class="btn-group">
																																																																																						<select class="form-control chosen-select" name="city" style="width:160px">
																																																																																							<option value="">City</option>
																								<?php $result = $conn->query("select distinct c.id,c.city from waitingpics wp join cities c on wp.cityid=c.id order by c.city");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																									<option value="<?= $row['id'] ?>" <?= selected(col("city"), $row['id']) ?>><?= $row['city'] ?></option>
																									<?php
																								} ?>
																																																																																						</select>
																																																																																					</div>
																																																																																					<div class="btn-group">
																																																																																						<select class="form-control chosen-select" name="hotel" style="width:180px">
																																																																																							<option value="">Hotel Name</option>
																								<?php $result = $conn->query("select distinct h.id,u.company from waitingpics wp join hotels h on wp.id=h.id join users u on u.id=h.user order by u.company");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																									<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																									<?php
																								} ?>
																																																																																						</select>
																																																																																					</div>
																																																																																					<div class="btn-group pull-right">
																																																																																						<a href="?Pg=workshops"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																					</div>
																																																																																					<div class="btn-group pull-right">
																																																																																						<input type="submit" class="btn btn-success" value="Apply">
																																																																																					</div>
																																																																																				</div>
																																																																																				<input type="hidden" name="deleteid" id="deleteid">
																																																																																				<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																				<input type="hidden" name="verifyid" id="verifyid">
																																																																																				<input type="hidden" name="blockid" id="blockid">
																																																																																				<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																				<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																			</form>
																																																																																			<div class="table-responsive" style="overflow-x:scroll">
																					<?php modal("City", "city") ?>
																																																																																				<table class="table table-th-block table-hover">
																																																																																					<thead>
																																																																																						<tr style="font-size:11px">
																																																																																							<th style="width: 40px">Partner ID</th>
																																																																																							<th>City</th>
																																																																																							<th>Hotel Name</th>
																																																																																							<th>Email Verified</th>
																																																																																							<th>Phone Verified</th>
																																																																																							<th>Partner Verified</th>
																																																																																							<th>Total Images To Approve</th>
																																																																																							<th>View Images</th>
																																																																																						</tr>
																																																																																					</thead>
																																																																																					<tbody>
																								<?php

																								$result = $conn->query($qry);
																								if ($result->num_rows > 0) {
																									$str = "";
																									$i = (($current_page - 1) * $pagesize + 1);
																									while ($row = $result->fetch_assoc()) {
																										$str .= "<tr>
																<td>$row[id]</td>
																<td>$row[city]</td>
																<td>$row[company]</td>";

																										if ($row['emailverified'])
																											$str .= "<td align=center ><i class='fa fa-check text-success'></i></td>";
																										else
																											$str .= "<td align=center ><i class='fa fa-times text-danger'></i></td>";

																										if ($row['mobileverified'])
																											$str .= "<td align=center ><i class='fa fa-check text-success'></i></td>";
																										else
																											$str .= "<td align=center ><i class='fa fa-times text-danger'></i></td>";

																										if ($row['approved'])
																											$str .= "<td align=center ><i class='fa fa-check text-success'></i></td>";
																										else
																											$str .= "<td align=center ><i class='fa fa-times text-danger'></i></td>";

																										$str .= "<td id='td1id$i'>$row[pics]</td>
																<td><a href='LBF_viewimages.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>View Images</span></a></td>
																</tr>";
																										$i++;
																									}
																									echo $str;
																								} else {
																									echo "<tr><td colspan='6'>No images to approve</td></tr>";
																								} ?>
																																																																																					</tbody>
																																																																																				</table>
																																																																																			</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																		</div>
																																																																																	</div>
																																																																																</div>
																<?php
							} else if ($_GET['Pg'] == "verifyreviews" and $page_access) {
								if (col("approvenshowid") != "") {
									$conn->query("update reviews set approved=1 where id=$_POST[approvenshowid]");
									$msg = "Review has been published";
								} ?>
																																																																																	<h1 class="page-heading">APPROVE Reviews</h1>
																																																																																	<div class="row">
																																																																																		<div class="col-sm-12">
																																																																																			<div class="the-box">
																				<?php if ($msg != "")
																					alertbox("success", $msg); ?>
																																																																																				<h4 class="small-title">APPROVE REVIEWS</h4>
																																																																																				<form name="filter_form" method="POST">
																																																																																					<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																						<div class="btn-group">
																																																																																							<select class="form-control chosen-select" name="hotel" style="width:160px">
																																																																																								<option value="">Hotel</option>
																								<?php $result = $conn->query("select distinct h.id,u.company from reviews rw left join hotels h on h.id=rw.hotel left join users u on u.id=h.user");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																										<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																									<?php
																								} ?>
																																																																																							</select>
																																																																																						</div>
																																																																																						<div class="btn-group">
																																																																																							<select class="form-control chosen-select" name="reviewer" style="width:180px">
																																																																																								<option value="">Reviewer</option>
																								<?php $result = $conn->query("select coalesce(u.fullname,rw.reviewer)reviewer from reviews rw left join hotels h on h.id=rw.hotel left join users u on u.id=rw.user");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																										<option value="<?= $row['reviewer'] ?>" <?= selected(col("reviewer"), $row['reviewer']) ?>><?= $row['reviewer'] ?></option>
																									<?php
																								} ?>
																																																																																							</select>
																																																																																						</div>
																																																																																						<div class="btn-group pull-right">
																																																																																							<a href="?Pg=verifyreviews"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																						</div>
																																																																																						<div class="btn-group pull-right">
																																																																																							<input type="submit" class="btn btn-success" value="Apply">
																																																																																						</div>
																																																																																					</div>
																																																																																					<input type="hidden" name="deleteid" id="deleteid">
																																																																																					<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																					<input type="hidden" name="verifyid" id="verifyid">
																																																																																					<input type="hidden" name="blockid" id="blockid">
																																																																																					<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																					<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																				</form>
																																																																																				<div class="table-responsive" style="overflow-x:scroll">
																					<?php approvenshowmodal("Review", "review") ?>
																																																																																					<table class="table table-th-block table-hover">
																																																																																						<thead>
																																																																																							<tr style="font-size:11px">
																																																																																								<th>Sr.No.</th>
																																																																																								<th>Hotel</th>
																																																																																								<th>Reviewer</th>
																																																																																								<th>Overall Rating</th>
																																																																																								<th>Service Quality</th>
																																																																																								<th>Amenities</th>
																																																																																								<th>Cleanliness</th>
																																																																																								<th>Location</th>
																																																																																								<th>Value for Money</th>
																																																																																								<th style="min-width:150px;">Title</th>
																																																																																								<th style="min-width:350px;">Review</th>
																																																																																								<th>Publish</th>
																																																																																							</tr>
																																																																																						</thead>
																																																																																						<tbody>
																							<?php $pagesize = 20;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select rw.id,hu.company,rw.rating,rw.title,rw.review,coalesce(u.fullname,rw.reviewer)reviewer, rw.servicequality,rw.amenities,rw.cleanliness,rw.location,rw.valueformoney from reviews rw left join users u on u.id=rw.user left join hotels h on h.id=rw.hotel left join users hu on hu.id=h.user where rw.approved=0";

																							//echo $base_query;
																							$filt = "";
																							if (col("hotel") != "")
																								$filt .= " and h.id='" . col("hotel") . "'";

																							if (col("reviewer") != "")
																								$filt .= " and (rw.reviewer='" . col("reviewer") . "' or u.fullname='" . col("reviewer") . "')";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by rw.id desc limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "
																<tr>
																<td>$i</td>
																<td>$row[company]</td>
																<td>$row[reviewer]</td>
																<td><img src='images/$row[rating].png' border='0' alt='$row[rating] Star'></td>
																<td>$row[servicequality]</td>
																<td>$row[amenities]</td>
																<td>$row[cleanliness]</td>
																<td>$row[location]</td>
																<td>$row[valueformoney]</td>
																<td>$row[title]</td>
																<td>$row[review]</td>
																<td><a href='javascript:void(0)' class='redlink' onClick='modal_button_updater5($row[id])'><span class='label label-warning' data-toggle='modal' data-target='#WarningModalColor2' title='Publish this review'>Publish</span></a></td>
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='6'>No reviews to approve</td></tr>";
																							} ?>
																																																																																						</tbody>
																																																																																					</table>
																																																																																				</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																			</div>
																																																																																		</div>
																																																																																	</div>
																<?php
							} else if ($_GET['Pg'] == "partnerhotel" and $page_access) { ?>
																																																																																		<h1 class="page-heading">Partner Hotel</h1>
																																																																																		<div class="row">
																																																																																			<div class="col-sm-12">
																																																																																				<div class="the-box">
																																																																																					<h4 class="small-title">VIEW PARTNER HOTEL</h4>
																																																																																					<div class="table-responsive" style="overflow-x:scroll;">
																																																																																						<form name="filter_form" method="POST">
																																																																																							<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px">
																																																																																								<div class="btn-group">
																																																																																									<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#">
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control" name="source">
																																																																																										<option value="">Source</option>
																																																																																										<option value="Direct" <?= selected(col("source"), "Direct") ?>>Direct</option>
																																																																																										<option value="Agent" <?= selected(col("source"), "Agent") ?>>Agent</option>
																																																																																										<option value="Corporate" <?= selected(col("source"), "Corporate") ?>>Corporate</option>
																																																																																									</select>
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control" name="bookingstatus">
																																																																																										<option value="">Booking Status</option>
																																																																																										<option value="Scheduled" <?= selected(col("bookingstatus"), "Scheduled") ?>>Scheduled</option>
																																																																																										<option value="Cancelled" <?= selected(col("bookingstatus"), "Cancelled") ?>>Cancelled</option>
																																																																																										<option value="Checkedin" <?= selected(col("bookingstatus"), "Checkedin") ?>>Checkedin</option>
																																																																																										<option value="Checkedout" <?= selected(col("bookingstatus"), "Checkedout") ?>>Checkedout</option>
																																																																																										<option value="Refunded" <?= selected(col("bookingstatus"), "Refunded") ?>>Refunded</option>
																																																																																									</select>
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control" name="promocode">
																																																																																										<option value="">Promocode</option>
																																																																																										<option value="Applied" <?= selected(col("promocode"), "Applied") ?>>Promocode applied</option>
																																																																																										<option value="Cancelled" <?= selected(col("promocode"), "Cancelled") ?>>Promocode not applied</option>
																																																																																									</select>
																																																																																								</div>
																							<?php if ($_SESSION['groupid'] == 0) { ?>
																																																																																										<div class="btn-group">
																																																																																											<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																												<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																																														<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																																											</select>
																																																																																										</div>
																								<?php
																							} else if ($_SESSION['groupid'] == 1) { ?>
																																																																																											<div class="btn-group">
																																																																																												<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																													<option value="">Hotel</option>
																											<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2 and u.admin=$_SESSION[id]");
																											while ($row = $result->fetch_assoc()) { ?>
																																																																																															<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																												<?php
																											} ?>
																																																																																												</select>
																																																																																											</div>
																								<?php
																							} ?>
																																																																																								<div class="btn-group pull-right">
																																																																																									<input type="submit" class="btn btn-success" value="Apply">
																																																																																								</div>
																																																																																							</div>
																																																																																							<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px">
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control" name="paymentstatus">
																																																																																										<option value="">Payment Status</option>
																																																																																										<option value="Paid" <?= selected(col("paymentstatus"), "Paid") ?>>Paid</option>
																																																																																										<option value="Unpaid" <?= selected(col("paymentstatus"), "Unpaid") ?>>Unpaid</option>
																																																																																									</select>
																																																																																								</div>
																																																																																								<div class="btn-group pull-right">
																																																																																									<a href="?Pg=partnerhotel"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																								</div>
																																																																																							</div>
																																																																																							<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																						</form>
																																																																																						<table class="table table-th-block table-hover">
																																																																																							<thead>
																																																																																								<tr style='font-size:11px'>
																																																																																									<th style="width:40px">Sr No.</th>
																																																																																									<th>BR#</th>
																																																																																									<th>Booking Status</th> <!-- Scheduled / Travelled / Cancelled / Refunded -->
																																																																																									<th>Name of the Hotel</th>
																																																																																									<th>Location of the Hotel Booked </th>
																																																																																									<th>Source Of Booking</th><!-- (Direct/Agent/Corp) -->
																																																																																									<th>Booking Details</th><!--(Individual / Group) -->
																																																																																									<th>Date of Booking</th>
																																																																																									<th>Hotel/Frotel Booking</th>
																																																																																									<th>No. of Guests</th>
																																																																																									<th>Check In Date </th>
																																																																																									<th>Check Out Date</th>
																																																																																									<th>No of Hours</th>
																																																																																									<th>Check In Time</th>
																																																																																									<th>Check Out Time</th>
																																																																																									<th>Hotel Room Type booked</th>
																																																																																									<th>Actual room tariff of Hotel</th>
																																																																																									<th>Frotel's Commission</th>
																																																																																									<th>Declared Tariff on Frotels.com</th>
																																																																																									<th>Promocode Discount if any</th>
																																																																																									<th>Service Tax collected for Hotel</th>
																																																																																									<th>Swatch Bharat Cess Collected for Hotel</th>
																																																																																									<th>Krishi Kalyan Cess Collected for Hotel</th>
																																																																																									<th>Frotels.com Service Taxes</th>
																																																																																									<th>Swatch Bharat Cess Collected for Frotels.com</th>
																																																																																									<th>Krishi Kalyan Cess Collected for Frotels.com</th>
																																																																																									<th>Luxury Taxes</th>
																																																																																									<th>Service Charges</th>
																																																																																									<th>Service Tax on Service Charges</th>
																																																																																									<th>Total invoiced to customer / Paid by customer</th>
																																																																																									<th>Total Amount payable to Hotel</th>
																																																																																									<th>Previous payment with Hotel / Adjustmnets</th>
																																																																																									<th>Hotel Accountant</th>
																																																																																									<th>Total Amount to be transferred to Hotel</th>
																																																																																									<th>Account No</th>
																																																																																									<th>Bank Name</th>
																																																																																									<th>Branch Name</th>
																																																																																									<th>IFSC Code </th>
																																																																																									<th>Payment Status</th>
																																																																																									<th>Remark</th>
																																																																																								</tr>
																																																																																							</thead>
																																																																																							<tbody>
																							<?php $pagesize = 4;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select x.* from (select b.id,(case when b.usercheckedout<>'0000-00-00 00:00:00' then 'Checkedout' when b.usercheckedin<>'0000-00-00 00:00:00' then 'Checkedout' else b.status end)status,hu.company,l.location, b.source,b.reg_date,(case when b.hours>0 and b.hours<24 then 'Frotel' else 'Hotel' end)hf, (sum(rd.adults)+sum(rd.children))guests,b.checkindatetime,b.checkoutdatetime, b.hours,r.roomtype,b.hoteltariff, b.declaredtariff,(b.declaredtariff-b.hoteltariff)frotelcommission,b.pcdiscount, b.hotelst,b.hsbc,b.hkcc, b.frotelst,b.fsbc,b.fkcc,b.lt,b.sc,b.stonsc,(b.declaredtariff-b.pcdiscount+b.hotelst+ b.hsbc+b.hkcc+b.frotelst+ b.fsbc+b.fkcc+b.lt+b.sc+b.stonsc)total,(b.hoteltariff+b.hotelst+b.hsbc+b.hkcc+b.lt+b.sc+ b.stonsc)payabletohotel, h.accountant,h.accountnumber,h.bank,h.branch,h.ifsc,(case when b.paid_to_hotel=1 then 'Paid' else 'Unpaid' end)paid_to_hotel,b.promocode,h.id as hotelid from bookings b join room_distribution rd on b.id=rd.bookingid join roomnumbers rn on rn.id=rd.roomnumber join roomtypes r on r.id=rn.roomtype join users u on u.id=b.guestid join hotels h on h.id=r.hotel join users hu on hu.id=h.user join locations l on l.id=h.location group by b.id)x where 1";

																							$filt = "";

																							if (col("bookingid") != "") {
																								$bookingid = str_replace("FR", "", col("bookingid"));
																								$filt .= " and x.id=" . $bookingid;
																							}

																							if ($_SESSION['groupid'] == 2)
																								$filt .= " and x.hotelid=$_SESSION[hotel]";
																							else if ($_SESSION['groupid'] == 1)
																								$filt .= " and x.hotelid in (select id from hotels where admin=$_SESSION[id])";
																							else if (col("hotel") != "")
																								$filt .= " and x.hotelid=" . col("hotel");

																							if (col("source") != "")
																								$filt .= " and x.source='" . col("source") . "'";

																							if (col("bookingstatus") != "")
																								$filt .= " and x.status='" . col("bookingstatus") . "'";

																							if (col("promocode") != "") {
																								if (col("promocode") == "Applied")
																									$filt .= " and x.promocode>0";
																								else
																									$filt .= " and x.promocode=0";
																							}

																							if (col("paymentstatus") != "")
																								$filt .= " and x.paid_to_hotel='" . col("paymentstatus") . "'";

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by x.id limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>FR$row[id]</td>
																<td id='td3id$i'>$row[status]</td>
																<td id='td4id$i'>$row[company]</td>
																<td id='td5id$i'>$row[location]</td>
																<td id='td6id$i'>$row[source]</td>
																<td id='td7id$i'></td>
																<td id='td8id$i'>" . popdate($row['reg_date']) . "</td>
																<td id='td9id$i'>$row[hf]</td>
																<td id='td10id$i'>$row[guests]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>$row[hours]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>$row[roomtype]</td>
																<td id='td5id$i'>$row[hoteltariff]</td>
																<td id='td5id$i'>$row[frotelcommission]</td>
																<td id='td5id$i'>$row[declaredtariff]</td>
																<td id='td5id$i'>$row[pcdiscount]</td>
																<td id='td5id$i'>$row[hotelst]</td>
																<td id='td5id$i'>$row[hsbc]</td>
																<td id='td5id$i'>$row[hkcc]</td>
																<td id='td5id$i'>$row[frotelst]</td>
																<td id='td5id$i'>$row[fsbc]</td>
																<td id='td5id$i'>$row[fkcc]</td>
																<td id='td5id$i'>$row[lt]</td>
																<td id='td5id$i'>$row[sc]</td>
																<td id='td5id$i'>$row[stonsc]</td>
																<td id='td5id$i'>" . round($row['total'], 2) . "</td>
																<td id='td5id$i'>" . round($row['payabletohotel'], 2) . "</td>
																<td id='td5id$i'>0</td>
																<td id='td5id$i'>$row[accountant]</td>
																<td id='td5id$i'>" . round($row['payabletohotel'], 2) . "</td>
																<td id='td5id$i'>$row[accountnumber]</td>
																<td id='td5id$i'>$row[bank]</td>
																<td id='td5id$i'>$row[branch]</td>
																<td id='td5id$i'>$row[ifsc]</td>
																<td id='td5id$i'>$row[paid_to_hotel]</td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Remark</span></a></td>
																
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='39'>No bookings to display</td></tr>";
																							} ?>
																																																																																							</tbody>
																																																																																						</table>
																																																																																					</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																				</div>
																																																																																			</div>
																																																																																		</div>
																<?php
							} else if ($_GET['Pg'] == "agents" and $page_access) { ?>
																																																																																			<h1 class="page-heading">AGENTS</h1>
																																																																																			<div class="row">
																																																																																				<div class="col-sm-12">
																																																																																					<div class="the-box">
																				<?php if (col("blockid") != "") {
																					$conn->query("update users set active=(case when active=0 then 1 else 0 end) where id=" . col("blockid"));
																					alertbox("success", "User status changed");
																				} ?>
																																																																																						<h4 class="small-title">VIEW AGENTS</h4>
																																																																																						<form name="filter_form" method="POST">
																																																																																							<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																								<div class="btn-group">
																																																																																									<input type="text" class="form-control" name="fullname" placeholder="Agents's full name" value="<?= col("fullname") ?>">
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<input type="text" class="form-control" name="email" placeholder="Agents's email" value="<?= col("email") ?>">
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<input type="text" class="form-control" name="contact" placeholder="Agents's contact no." value="<?= col("contact") ?>">
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control chosen-select" name="travelercity" style="width:180px;" placeholder="City">
																																																																																										<option value="">City</option>
																								<?php $result = $conn->query("select distinct travelercity from users where groupid=3 order by travelercity");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																												<option value="<?= $row['travelercity'] ?>" <?= selected(col("travelercity"), $row['travelercity']) ?>><?= $row['travelercity'] ?></option>
																									<?php
																								} ?>
																																																																																									</select>
																																																																																								</div>
																																																																																								<div class="btn-group">
																																																																																									<select class="form-control" name="status">
																																																																																										<option value="">Status</option>
																																																																																										<option value="1" <?= selected(col("status"), "1") ?>>Active</option>
																																																																																										<option value="0" <?= selected(col("status"), "0") ?>>Blocked</option>
																																																																																									</select>
																																																																																								</div>
																																																																																								<div class="btn-group pull-right">
																																																																																									<a href="?Pg=agents"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																								</div>
																																																																																								<div class="btn-group pull-right">
																																																																																									<input type="submit" class="btn btn-success" value="Apply">
																																																																																								</div>
																																																																																							</div>
																																																																																							<input type="hidden" name="deleteid" id="deleteid">
																																																																																							<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																							<input type="hidden" name="verifyid" id="verifyid">
																																																																																							<input type="hidden" name="blockid" id="blockid">
																																																																																							<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																							<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																						</form>
																																																																																						<div class="table-responsive" style="overflow-x:scroll;">
																					<?php blockmodal("Agent", "agent");
																					unblockmodal("Agent", "agent") ?>
																																																																																							<table class="table table-th-block table-hover">
																																																																																								<thead>
																																																																																									<tr>
																																																																																										<th style="width:40px;">ID</th>
																																																																																										<th>Name</th>
																																																																																										<th>Email</th>
																																																																																										<th>Contact</th>
																																																																																										<th>Address</th>
																																																																																										<th>City</th>
																																																																																										<th>State</th>
																																																																																										<th>Block</th>
																																																																																										<th>View</th>
																																																																																									</tr>
																																																																																								</thead>
																																																																																								<tbody>
																							<?php $pagesize = 50;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select u.id,u.fullname,u.travelercity,u.email,u.contact,u.address1,s.state,u.active from users u left join states s on s.id=u.travelerstate where u.groupid=3";

																							$filt = "";

																							if (col("fullname") != "")
																								$filt .= " and u.fullname like '%" . col("fullname") . "%'";
																							if (col("email") != "")
																								$filt .= " and u.email='" . col("email") . "'";
																							if (col("contact") != "")
																								$filt .= " and u.contact='" . col("contact") . "'";
																							if (col("travelercity") != "")
																								$filt .= " and u.travelercity='" . col("travelercity") . "'";

																							if (col("status") != "") {
																								if (col("status"))
																									$filt .= " and u.active=1";
																								else
																									$filt .= " and u.active=0";
																							}

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by 1 limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td id='td1id$i'>$row[id]</td>
																<td id='td2id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[email]</td>
																<td id='td4id$i'>$row[contact]</td>
																<td id='td5id$i'>$row[address1]</td>
																<td id='td6id$i'>$row[travelercity]</td>
																<td id='td7id$i'>$row[state]</td>";

																									if ($row['active'])
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";
																									else
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater5($row[id])'><span class='label label-success' data-toggle='modal' data-target='#SuccessModalColor5'>Unblock</span></a></td>";

																									$str .= "<td><a href='LBF_viewagent.php?id=$row[id]' class='fancybox fancybox.iframe'><span class='label label-purple'>View</span></a></td>
																
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='9'>No agents to display</td></tr>";
																							} ?>
																																																																																								</tbody>
																																																																																							</table>
																																																																																						</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																					</div>
																																																																																				</div>
																																																																																			</div>
																<?php
							} else if ($_GET['Pg'] == "corporates" and $page_access) { ?>
																																																																																				<h1 class="page-heading">CORPORATE</h1>
																																																																																				<div class="row">
																																																																																					<div class="col-sm-12">
																																																																																						<div class="the-box">
																				<?php if (col("blockid") != "") {
																					$conn->query("update users set active=(case when active=0 then 1 else 0 end) where id=" . col("blockid"));
																					alertbox("success", "User status changed");
																				} ?>
																																																																																							<h4 class="small-title">VIEW CORPORATES</h4>
																																																																																							<form name="filter_form" method="POST">
																																																																																								<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																									<div class="btn-group">
																																																																																										<input type="text" class="form-control" name="fullname" placeholder="Corporate's full name" value="<?= col("fullname") ?>">
																																																																																									</div>
																																																																																									<div class="btn-group">
																																																																																										<input type="text" class="form-control" name="email" placeholder="Corporate's email" value="<?= col("email") ?>">
																																																																																									</div>
																																																																																									<div class="btn-group">
																																																																																										<input type="text" class="form-control" name="contact" placeholder="Corporate's contact no." value="<?= col("contact") ?>">
																																																																																									</div>
																																																																																									<div class="btn-group">
																																																																																										<select class="form-control chosen-select" name="travelercity" style="width:180px;" placeholder="City">
																																																																																											<option value="">City</option>
																								<?php $result = $conn->query("select distinct travelercity from users where groupid=4 order by travelercity");
																								while ($row = $result->fetch_assoc()) { ?>
																																																																																													<option value="<?= $row['travelercity'] ?>" <?= selected(col("travelercity"), $row['travelercity']) ?>><?= $row['travelercity'] ?></option>
																									<?php
																								} ?>
																																																																																										</select>
																																																																																									</div>
																																																																																									<div class="btn-group">
																																																																																										<select class="form-control" name="status">
																																																																																											<option value="">Status</option>
																																																																																											<option value="1" <?= selected(col("status"), "1") ?>>Active</option>
																																																																																											<option value="0" <?= selected(col("status"), "0") ?>>Blocked</option>
																																																																																										</select>
																																																																																									</div>
																																																																																									<div class="btn-group pull-right">
																																																																																										<a href="?Pg=corporates"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																									</div>
																																																																																									<div class="btn-group pull-right">
																																																																																										<input type="submit" class="btn btn-success" value="Apply">
																																																																																									</div>
																																																																																								</div>
																																																																																								<input type="hidden" name="deleteid" id="deleteid">
																																																																																								<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																								<input type="hidden" name="verifyid" id="verifyid">
																																																																																								<input type="hidden" name="blockid" id="blockid">
																																																																																								<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																								<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																							</form>
																																																																																							<div class="table-responsive" style="overflow-x:scroll;">
																					<?php blockmodal("Corporate", "corporate");
																					unblockmodal("Corporate", "corporate") ?>
																																																																																								<table class="table table-th-block table-hover">
																																																																																									<thead>
																																																																																										<tr>
																																																																																											<th style="width:40px;">ID</th>
																																																																																											<th>Name</th>
																																																																																											<th>Email</th>
																																																																																											<th>Contact</th>
																																																																																											<th>Address</th>
																																																																																											<th>City</th>
																																																																																											<th>State</th>
																																																																																											<th>Block</th>
																																																																																											<th>View</th>
																																																																																										</tr>
																																																																																									</thead>
																																																																																									<tbody>
																							<?php $pagesize = 50;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select u.id,u.fullname,u.travelercity,u.email,u.contact,u.address1,s.state,u.active from users u left join states s on s.id=u.travelerstate where u.groupid=4";

																							$filt = "";

																							if (col("fullname") != "")
																								$filt .= " and u.fullname like '%" . col("fullname") . "%'";
																							if (col("email") != "")
																								$filt .= " and u.email='" . col("email") . "'";
																							if (col("contact") != "")
																								$filt .= " and u.contact='" . col("contact") . "'";
																							if (col("travelercity") != "")
																								$filt .= " and u.travelercity='" . col("travelercity") . "'";

																							if (col("status") != "") {
																								if (col("status"))
																									$filt .= " and u.active=1";
																								else
																									$filt .= " and u.active=0";
																							}

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by 1 limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td id='td1id$i'>$row[id]</td>
																<td id='td2id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[email]</td>
																<td id='td4id$i'>$row[contact]</td>
																<td id='td5id$i'>$row[address1]</td>
																<td id='td6id$i'>$row[travelercity]</td>
																<td id='td7id$i'>$row[state]</td>";

																									if ($row['active'])
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";
																									else
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater5($row[id])'><span class='label label-success' data-toggle='modal' data-target='#SuccessModalColor5'>Unblock</span></a></td>";

																									$str .= "<td><a href='LBF_viewcorporate.php?id=$row[id]' class='fancybox fancybox.iframe'><span class='label label-purple'>View</span></a></td>
																
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='9'>No corporates to display</td></tr>";
																							} ?>
																																																																																									</tbody>
																																																																																								</table>
																																																																																							</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																						</div>
																																																																																					</div>
																																																																																				</div>
																<?php
							} else if ($_GET['Pg'] == "users" and $page_access) { ?>
																																																																																					<h1 class="page-heading">TRAVELERS</h1>
																																																																																					<div class="row">
																																																																																						<div class="col-sm-12">
																																																																																							<div class="the-box">
																				<?php if (col("blockid") != "") {
																					$conn->query("update users set active=(case when active=0 then 1 else 0 end) where id=" . col("blockid"));
																					alertbox("success", "User status changed");
																				} ?>
																																																																																								<h4 class="small-title">VIEW TRAVELERS</h4>
																																																																																								<div class="table-responsive" style="overflow-x:scroll;">
																					<?php blockmodal("Traveler", "traveler");
																					unblockmodal("Traveler", "traveler") ?>
																																																																																									<form name="filter_form" method="POST">
																																																																																										<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																											<div class="btn-group">
																																																																																												<input type="text" class="form-control" name="fullname" placeholder="Traveler's full name" value="<?= col("fullname") ?>">
																																																																																											</div>
																																																																																											<div class="btn-group">
																																																																																												<input type="text" class="form-control" name="email" placeholder="Traveler's email" value="<?= col("email") ?>">
																																																																																											</div>
																																																																																											<div class="btn-group">
																																																																																												<input type="text" class="form-control" name="contact" placeholder="Traveler's contact no." value="<?= col("contact") ?>">
																																																																																											</div>
																																																																																											<div class="btn-group">
																																																																																												<select class="form-control chosen-select" name="travelercity" style="width:180px;" placeholder="City">
																																																																																													<option value="">City</option>
																									<?php $result = $conn->query("select distinct travelercity from users where groupid=5 order by travelercity");
																									while ($row = $result->fetch_assoc()) { ?>
																																																																																															<option value="<?= $row['travelercity'] ?>" <?= selected(col("travelercity"), $row['travelercity']) ?>><?= $row['travelercity'] ?></option>
																										<?php
																									} ?>
																																																																																												</select>
																																																																																											</div>
																																																																																											<div class="btn-group">
																																																																																												<select class="form-control" name="status">
																																																																																													<option value="">Status</option>
																																																																																													<option value="1" <?= selected(col("status"), "1") ?>>Active</option>
																																																																																													<option value="0" <?= selected(col("status"), "0") ?>>Blocked</option>
																																																																																												</select>
																																																																																											</div>
																																																																																											<div class="btn-group pull-right">
																																																																																												<a href="?Pg=users"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																											</div>
																																																																																											<div class="btn-group pull-right">
																																																																																												<input type="submit" class="btn btn-success" value="Apply">
																																																																																											</div>
																																																																																										</div>
																																																																																										<input type="hidden" name="deleteid" id="deleteid">
																																																																																										<input type="hidden" name="deleteid2" id="deleteid2">
																																																																																										<input type="hidden" name="verifyid" id="verifyid">
																																																																																										<input type="hidden" name="blockid" id="blockid">
																																																																																										<input type="hidden" name="approvenshowid" id="approvenshowid">
																																																																																										<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																									</form>
																																																																																									<table class="table table-th-block table-hover">
																																																																																										<thead>
																																																																																											<tr>
																																																																																												<th style="width:40px;">ID</th>
																																																																																												<th>Name</th>
																																																																																												<th>Email</th>
																																																																																												<th>Contact</th>
																																																																																												<th>Address</th>
																																																																																												<th>City</th>
																																																																																												<th>State</th>
																																																																																												<th>Block</th>
																																																																																												<th>View</th>
																																																																																											</tr>
																																																																																										</thead>
																																																																																										<tbody>
																							<?php $pagesize = 50;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select u.id,u.fullname,u.travelercity,u.email,u.contact,u.address1,s.state,u.active from users u left join states s on s.id=u.travelerstate where u.groupid=5";

																							$filt = "";

																							if (col("fullname") != "")
																								$filt .= " and u.fullname like '%" . col("fullname") . "%'";
																							if (col("email") != "")
																								$filt .= " and u.email='" . col("email") . "'";
																							if (col("contact") != "")
																								$filt .= " and u.contact='" . col("contact") . "'";
																							if (col("travelercity") != "")
																								$filt .= " and u.travelercity='" . col("travelercity") . "'";

																							if (col("status") != "") {
																								if (col("status"))
																									$filt .= " and u.active=1";
																								else
																									$filt .= " and u.active=0";
																							}

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by 1 limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																<td id='td1id$i'>$row[id]</td>
																<td id='td2id$i'>$row[fullname]</td>
																<td id='td3id$i'>$row[email]</td>
																<td id='td4id$i'>$row[contact]</td>
																<td id='td5id$i'>$row[address1]</td>
																<td id='td6id$i'>$row[travelercity]</td>
																<td id='td7id$i'>$row[state]</td>";

																									if ($row['active'])
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater4($row[id])'><span class='label label-danger' data-toggle='modal' data-target='#DangerModalColor4'>Block</span></a></td>";
																									else
																										$str .= "<td><a href='javascript:void(0)' onClick='modal_button_updater5($row[id])'><span class='label label-success' data-toggle='modal' data-target='#SuccessModalColor5'>Unblock</span></a></td>";

																									$str .= "<td><a href='LBF_viewtraveler.php?id=$row[id]' class='fancybox fancybox.iframe'><span class='label label-purple'>View</span></a></td>
																
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='9'>No travelers to display</td></tr>";
																							} ?>
																																																																																										</tbody>
																																																																																									</table>
																																																																																								</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																							</div>
																																																																																						</div>
																																																																																					</div>
																<?php
							} else if ($_GET['Pg'] == "taxreport" and $page_access) {
								pms_info_status(); ?>
																																																																																						<h1 class="page-heading">Tax Report</h1>
																																																																																						<div class="row">
																																																																																							<div class="col-sm-12">
																																																																																								<div class="the-box">
																																																																																									<h4 class="small-title">VIEW TAX REPORT</h4>
																																																																																									<form name="filter_form" method="POST">
																																																																																										<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																											<div class="btn-group">
																																																																																												<input type="text" class="form-control" name="bookingid" value="<?= col("bookingid") ?>" placeholder="BR#">
																																																																																											</div>
																						<?php if ($_SESSION['groupid'] == 0) { ?>
																																																																																													<div class="btn-group">
																																																																																														<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																															<option value="">Hotel</option>
																										<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																																	<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																											<?php
																										} ?>
																																																																																														</select>
																																																																																													</div>
																							<?php
																						} else if ($_SESSION['groupid'] == 1) { ?>
																																																																																														<div class="btn-group">
																																																																																															<select class="form-control chosen-select" name="hotel" style="width:220px">
																																																																																																<option value="">Hotel</option>
																										<?php $result = $conn->query("select h.id,u.company from hotels h join users u on u.id=h.user where u.approved=1 and u.active=1 and u.groupid=2 and h.id in (select id from hotels where admin=$_SESSION[id])");
																										while ($row = $result->fetch_assoc()) { ?>
																																																																																																		<option value="<?= $row['id'] ?>" <?= selected(col("hotel"), $row['id']) ?>><?= $row['company'] ?></option>
																											<?php
																										} ?>
																																																																																															</select>
																																																																																														</div>
																							<?php
																						} ?>
																																																																																											<div class="btn-group pull-right">
																																																																																												<a href="?Pg=taxreport"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																											</div>
																																																																																											<div class="btn-group pull-right">
																																																																																												<input type="submit" class="btn btn-success" value="Apply">
																																																																																											</div>
																																																																																										</div>
																																																																																										<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																									</form>
																																																																																									<div class="table-responsive" style="overflow-x:scroll;">
																																																																																										<table class="table table-th-block table-hover">
																																																																																											<thead>
																																																																																												<tr style='font-size: 11px'>
																																																																																													<th style="width:40px;">SR No.</th>
																																																																																													<th>BR#</th>
																																																																																													<th>Booking Status</th><!-- Scheduled / Travelled / Cancelled / Refunded -->
																																																																																													<th>Name of the Hotel</th>
																																																																																													<th>Total invoiced to customer/Paid by customer</th>
																																																																																													<th>Actual room tariff of Hotel</th>
																																																																																													<th>Frotel's Commission</th>
																																																																																													<th>Service Tax Collected For Hotel</th>
																																																																																													<th>Swatch Bharat Cess Collected for Hotel</th>
																																																																																													<th>Krishi Kalyan Cess Collected for Hotel</th>
																																																																																													<th>Frotel Taxes</th>
																																																																																												</tr>
																																																																																											</thead>
																																																																																											<tbody>
																							<?php $pagesize = 5;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select b.id,b.status,u.company,l.location,b.reg_date,b.source,b.checkindatetime,b.hoteltariff, b.checkoutdatetime,r.roomtype,(b.declaredtariff-b.hoteltariff)frotelcommission,b.declaredtariff,b.pcdiscount, b.hotelst,b.hsbc,b.hkcc,(b.fkcc+b.frotelst+b.fsbc+b.lt+b.sc+b.stonsc)froteltaxes,(b.declaredtariff-b.pcdiscount+b.hotelst+ b.hsbc+b.hkcc+b.frotelst+b.fsbc+b.fkcc+b.lt+b.sc+b.stonsc)total from bookings b join room_distribution rd on rd.bookingid=b.id join roomnumbers rn on rn.id=rd.roomnumber join roomtypes r on r.id=rn.roomtype join hotels h on h.id=r.hotel join users u on u.id=h.user join locations l on l.id=h.location group by b.id";

																							$filt = "";

																							if (col("bookingid") != "") {
																								$bookingid = str_replace("FR", "", col("bookingid"));
																								$filt .= " and b.id=" . $bookingid;
																							}

																							if (col("hotel") != "")
																								$filt .= " and h.id=" . col("hotel");

																							if ($_SESSION['groupid'] == 2)
																								$filt .= " and h.id=$_SESSION[hotel]";
																							else if ($_SESSION['groupid'] == 1)
																								$filt .= " and h.id in (select id from hotels where admin=$_SESSION[id])";
																							else if (col("hotel") != "")
																								$filt .= " and h.id=" . col("hotel");

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by b.id limit " . $a->offset_ . ",$pagesize";

																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>FR$row[id]</td>
																<td id='td3id$i'>$row[status]</td>
																<td id='td4id$i'>$row[company]</td>
																<td id='td5id$i'>" . round($row['total'], 2) . "</td>
																<td id='td5id$i'>" . round($row['hoteltariff'], 2) . "</td>
																<td id='td5id$i'>" . round($row['frotelcommission'], 2) . "</td>
																<td id='td5id$i'>" . round($row['hotelst'], 2) . "</td>
																<td id='td5id$i'>" . round($row['hsbc'], 2) . "</td>
																<td id='td5id$i'>" . round($row['hkcc'], 2) . "</td>
																<td id='td5id$i'>" . round($row['froteltaxes'], 2) . "</td>
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='6'>No bookings to display</td></tr>";
																							} ?>
																																																																																											</tbody>
																																																																																										</table>
																																																																																									</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																								</div>
																																																																																							</div>
																																																																																						</div>
																<?php
							} else if ($_GET['Pg'] == "cancellationrequests" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																																																							
																																																																																							<div class="row" style="margin-left:-11px; margin-right:-11px">
																																																																																								<div class="col-sm-12">
																																																																																									<div class="the-box">
																																																																																										<h1 class="page-heading">Cancellation Requests</h1>
                                                                                                                                                                                    <form name="filter_form" method="POST">
																																																																																												<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																													<div class="btn-group">
																																																																																														<input type="text" class="form-control" name="bookingid" placeholder="#BRN" value="<?= col("bookingid") ?>">
																																																																																													</div>
																																																																																													<!-- <div class="btn-group">
															<select class="form-control chosen-select" name="city">
																<option value="">City</option>
																<?php $result = $conn->query("select id,city from cities order by city");
																while ($row = $result->fetch_assoc()) { ?>
																	<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																	<?php
																} ?>
															</select>
														</div> -->

																																																																																													<div class="btn-group pull-right" style="margin-top: -50px; margin-right:65px">
																																																																																														<a href="?Pg=cancellationrequests"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																													</div>
																																																																																													<div class="btn-group pull-right" style="margin-top: -50px;">
																																																																																														<input type="submit" class="btn btn-success" value="Apply">
																																																																																													</div>
																																																																																												</div>
																																																																																												<input type="hidden" name="deleteid" id="deleteid">
																																																																																												<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																											</form>
																																																																																										<div class="table-responsive" style="overflow-x:scroll;">
																																																																																											
																																																																																											<table class="table table-th-block table-hover">
																																																																																												<thead>
																																																																																													<tr style='font-size: 11px'>
																																																																																														<th style="width:40px;">Sr. No.</th>
																																																																																														<th>BR#</th>
																																																																																														<th>Booking Status</th>
																																																																																														<th>Name of the Hotel</th>
																																																																																														<th>Location of the Hotel Booked</th>
																																																																																														<th>Source Of Booking </th> <!--(Direct/Agent/Corp) -->
																																																																																														<th>Booking Details</th> <!--(Individual / Group) -->
																																																																																														<th>Date of Booking</th>
																																																																																														<th>Name of the Guests</th>
																																																																																														<th>Hotel/Frotel Booking</th>
																																																																																														<th>No. of Guests</th>
																																																																																														<th>Check In Date </th>
																																																																																														<th>Check Out Date</th>
																																																																																														<th>No of Hours</th>
																																																																																														<th>Check In Time</th>
																																																																																														<th>Check Out Time</th>
																																																																																														<th>Hotel Room Type booked</th>
																																																																																														<th>Actual room tariff of Hotel</th>
																																																																																														<th>Frotel's Commission</th>
																																																																																														<th>Declared Tariff on Frotels.com</th>
																																																																																														<th>Promocode Discount if any</th>
																																																																																														<th>Service Tax collected for Hotel</th>
																																																																																														<th>Swatch Bharat Cess Collected for Frotels.com</th>
																																																																																														<th>Krishi Kalyan Cess Collected for Frotels.com</th>
																																																																																														<th>Luxury Taxes</th>
																																																																																														<th>Service Charges</th>
																																																																																														<th>Service Tax on Service Charges</th>
																																																																																														<th>Total invoiced to customer/Paid by customer</th>
																																																																																														<th>Cancellation Date</th>
																																																																																														<th>Cancellation Time</th>
																																																																																														<th>Cancelled By</th>
																																																																																														<th>Cancellation Reason</th>
																																																																																														<th>How many hours prior to Check In time Booking got cancelled?</th>
																																																																																														<th>Cancel</th>
																																																																																													</tr>
																																																																																												</thead>
																																																																																												<tbody>
																							<?php $pagesize = 5;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select x.* from (
															select 
																b.id, b.status, hu.company, l.location, b.source, b.reg_date,
																(case when b.hours > 0 and b.hours < 24 then 'Frotel' else 'Hotel' end) as hf,
																(sum(rd.adults) + sum(rd.children)) as guests, 
																b.checkindatetime, b.checkoutdatetime, b.hours, r.roomtype, b.hoteltariff,
																b.declaredtariff, (b.declaredtariff - b.hoteltariff) as frotelcommission,
																b.pcdiscount, b.hotelst, b.hsbc, b.hkcc, b.frotelst, b.fsbc, b.fkcc, 
																b.lt, b.sc, b.stonsc, 
																(b.declaredtariff - b.pcdiscount + b.hotelst + b.hsbc + b.hkcc + b.frotelst + b.fsbc + b.fkcc + b.lt + b.sc + b.stonsc) as total,
																(b.hoteltariff + b.hotelst + b.hsbc + b.hkcc + b.lt + b.sc + b.stonsc) as payabletohotel,
																h.accountant, h.accountnumber, h.bank, h.branch, h.ifsc,
																(case when b.paid_to_hotel = 1 then 'Paid' else 'Unpaid' end) as paid_to_hotel, 
																b.promocode, h.id as hotelid, u.fullname, b.cancellationrequestdate, 
																b.cancellationreason, b.refund_amount, 
																TIMESTAMPDIFF(HOUR, b.cancellationrequestdate, b.checkindatetime) as cancellationpriortocheckin 
															from bookings b 
															join room_distribution rd on b.id = rd.bookingid 
															join roomnumbers rn on rn.id = rd.roomnumber 
															join roomtypes r on r.id = rn.roomtype 
															join users u on u.id = b.guestid 
															join hotels h on h.id = r.hotel 
															join users hu on hu.id = h.user 
															join locations l on l.id = h.location 
															group by b.id
														) x where x.status = 'Cancelled'";

																							// Initialize filter string
																							$filt = "";

																							// Add booking ID filter if provided
																							if (col("bookingid") != "") {
																								$bookingid = str_replace("FR", "", col("bookingid"));
																								$filt .= " and x.id=" . $bookingid;
																							}

																							// Add hotel ID filter based on group ID
																							if ($_SESSION['groupid'] == 2) {
																								$filt .= " and x.hotelid=" . $_SESSION['hotel'];
																							} else if ($_SESSION['groupid'] == 1) {
																								$filt .= " and x.hotelid in (select id from hotels where admin=" . $_SESSION['id'] . ")";
																							} else if (col("hotel") != "") {
																								$filt .= " and x.hotelid=" . col("hotel");
																							}

																							// Pagination setup
																							$a = new pagination($base_query . $filt, $current_page, $pagesize);
																							$current_page = $a->current_page_;

																							// Construct the final query with pagination
																							$qry = $base_query . $filt . " order by x.id limit " . $a->offset_ . " $pagesize";
																							echo "<a>$_SESSION[hotel]</a>";
																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>FR$row[id]</td>
																<td id='td3id$i'>$row[status]</td>
																<td id='td4id$i'>$row[company]</td>
																<td id='td5id$i'>$row[location]</td>
																<td id='td6id$i'>$row[source]</td>
																<td id='td7id$i'></td>
																<td id='td8id$i'>" . popdate($row['reg_date']) . "</td>
																<td id='td9id$i'>$row[fullname]</td>
																<td id='td9id$i'>$row[hf]</td>
																<td id='td10id$i'>$row[guests]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>$row[hours]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>$row[roomtype]</td>
																<td id='td5id$i'>$row[hoteltariff]</td>
																<td id='td5id$i'>$row[frotelcommission]</td>
																<td id='td5id$i'>$row[declaredtariff]</td>
																<td id='td5id$i'>$row[pcdiscount]</td>
																<td id='td5id$i'>$row[hotelst]</td>
																<td id='td5id$i'>$row[fsbc]</td>
																<td id='td5id$i'>$row[fkcc]</td>
																<td id='td5id$i'>$row[lt]</td>
																<td id='td5id$i'>$row[sc]</td>
																<td id='td5id$i'>$row[stonsc]</td>
																<td id='td5id$i'>" . round($row['total'], 2) . "</td>
																<td id='td5id$i'>" . date_create($row['cancellationrequestdate'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>" . date_create($row['cancellationrequestdate'])->format("h:i A") . "</td>
																<td id='td5id$i'>$row[fullname]</td>
																<td id='td5id$i'>$row[cancellationreason]</td>
																<td id='td5id$i'>$row[cancellationpriortocheckin]</td>
																<td><a href='LBF_cancelbooking.php?id=$row[id]&cntr=$i' class='fancybox2 fancybox.iframe'><span class='label label-danger'>Cancel Booking</span></a></td>
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='6'>No cancellation requests to display</td></tr>";
																							} ?>
																																																																																												</tbody>
																																																																																											</table>
																																																																																										</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																									</div>
																																																																																								</div>
																																																																																							</div>
																<?php
							} else if ($_GET['Pg'] == "cancellationreport" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																																																								
																																																																																								<div class="row" style="margin-left:-11px; margin-right:-11px;">
																																																																																									<div class="col-sm-12">
																																																																																										<div class="the-box">
																																																																																											<h1 class="page-heading">Cancellation Report</h1>
																																																																																											<form name="filter_form" method="POST">
																																																																																												<div class="btn-toolbar top-table" role="toolbar" style="margin-bottom:12px;">
																																																																																													<div class="btn-group">
																																																																																														<input type="text" class="form-control" name="bookingid" placeholder="#BRN" value="<?= col("bookingid") ?>">
																																																																																													</div>
																																																																																													<!-- <div class="btn-group">
														<select class="form-control chosen-select" name="city">
															<option value="">City</option>
															<?php $result = $conn->query("select id,city from cities order by city");
															while ($row = $result->fetch_assoc()) { ?>
																<option value="<?= $row['id'] ?>"><?= $row['city'] ?></option>
																<?php
															} ?>
														</select>
													</div> -->
																																																																																													<div class="btn-group pull-right" style=" margin-top: -50px; margin-right: 65px;">
																																																																																														<a href="?Pg=cancellationreport"><input type="button" class="btn btn-danger" value="Reset"></a>
																																																																																													</div>
																																																																																													<div class="btn-group pull-right" style=" margin-top: -50px;">
																																																																																														<input type="submit" class="btn btn-success" value="Apply">
																																																																																													</div>
																																																																																												</div>
																																																																																												<input type="hidden" name="deleteid" id="deleteid">
																																																																																												<input type="hidden" name="cnt" id="cnt" value="<?= col("cnt") ?>">
																																																																																											</form>
																																																																																											<div class="table-responsive" style="overflow-x:scroll;">
																																																																																												<table class="table table-th-block table-hover">
																																																																																													<thead>
																																																																																														<tr style='font-size: 11px'>
																																																																																															<th style="width:40px;">Sr. No.</th>
																																																																																															<th>BR#</th>
																																																																																															<th>Booking Status</th>
																																																																																															<th>Name of the Hotel</th>
																																																																																															<th>Location of the Hotel Booked</th>
																																																																																															<th>Source Of Booking </th> <!--(Direct/Agent/Corp) -->
																																																																																															<th>Booking Details</th> <!--(Individual / Group) -->
																																																																																															<th>Date of Booking</th>
																																																																																															<th>Name of the Guests</th>
																																																																																															<th>Hotel/Frotel Booking</th>
																																																																																															<th>No. of Guests</th>
																																																																																															<th>Check In Date </th>
																																																																																															<th>Check Out Date</th>
																																																																																															<th>No of Hours</th>
																																																																																															<th>Check In Time</th>
																																																																																															<th>Check Out Time</th>
																																																																																															<th>Hotel Room Type booked</th>
																																																																																															<th>Actual room tariff of Hotel</th>
																																																																																															<th>Frotel's Commission</th>
																																																																																															<th>Declared Tariff on Frotels.com</th>
																																																																																															<th>Promocode Discount if any</th>
																																																																																															<th>Service Tax collected for Hotel</th>
																																																																																															<th>Swatch Bharat Cess Collected for Frotels.com</th>
																																																																																															<th>Krishi Kalyan Cess Collected for Frotels.com</th>
																																																																																															<th>Luxury Taxes</th>
																																																																																															<th>Service Charges</th>
																																																																																															<th>Service Tax on Service Charges</th>
																																																																																															<th>Total invoiced to customer/Paid by customer</th>
																																																																																															<th>Cancellation Date</th>
																																																																																															<th>Cancellation Time</th>
																																																																																															<th>Cancelled By</th>
																																																																																															<th>Cancellation Reason</th>
																																																																																															<th>How many hours prior to Check In time Booking got cancelled?</th>
																																																																																															<th>Total refund to be paid to the user.</th>
																																																																																															<th>Total Amount paid to Hotel if any between booking & cancellation.</th>
																																																																																															<th>Remark</th>
																																																																																														</tr>
																																																																																													</thead>
																																																																																													<tbody>


																							<?php $pagesize = 5;

																							if (col('cnt') != "") {
																								$current_page = $_POST['cnt'];
																							} else {
																								$current_page = 1;
																							}

																							$base_query = "select x.* from (select b.id,b.status,hu.company,l.location, b.source,b.reg_date,(case when b.hours>0 and b.hours<24 then 'Frotel' else 'Hotel' end)hf,(sum(rd.adults)+sum(rd.children))guests, b.checkindatetime,b.checkoutdatetime,b.hours,r.roomtype,b.hoteltariff,b.declaredtariff, (b.declaredtariff-b.hoteltariff)frotelcommission,b.pcdiscount,b.hotelst,b.hsbc,b.hkcc,b.frotelst,b.fsbc,b.fkcc, b.lt,b.sc,b.stonsc,(b.declaredtariff-b.pcdiscount+b.hotelst+ b.hsbc+b.hkcc+b.frotelst+ b.fsbc+b.fkcc+b.lt+b.sc+ b.stonsc)total,(b.hoteltariff+b.hotelst+b.hsbc+b.hkcc+b.lt+b.sc+ b.stonsc)payabletohotel,h.accountant, h.accountnumber,h.bank,h.branch,h.ifsc,(case when b.paid_to_hotel=1 then 'Paid' else 'Unpaid' end)paid_to_hotel, b.promocode,h.id as hotelid,u.fullname,b.cancellationrequestdate,b.cancellationreason, TIMESTAMPDIFF(HOUR,b.cancellationrequestdate,b.checkindatetime)cancellationpriortocheckin,b.refund_amount from bookings b join room_distribution rd on rd.bookingid=b.id join roomnumbers rn on rn.id=rd.roomnumber join roomtypes r on r.id=rn.roomtype join users u on u.id=b.guestid join hotels h on h.id=r.hotel join users hu on hu.id=h.user join locations l on l.id=h.location  group by b.id)x where x.status='Refunded'";

																							$filt = "";

																							if (col("bookingid") != "") {
																								$bookingid = str_replace("FR", "", col("bookingid"));
																								$filt .= " and x.id=" . $bookingid;
																							}

																							if ($_SESSION['groupid'] == 2)
																								$filt .= " and x.hotelid=$_SESSION[hotel]";
																							else if ($_SESSION['groupid'] == 1)
																								$filt .= " and x.hotelid in (select id from hotels where admin=$_SESSION[id])";
																							else if (col("hotel") != "")
																								$filt .= " and x.hotelid=" . col("hotel");

																							$a = new pagination($base_query . $filt, $current_page, $pagesize);

																							$current_page = $a->current_page_;

																							$qry = $base_query . $filt . " order by x.id limit " . $a->offset_ . "$pagesize";
																							echo "<a>$qry</a>";
																							$result = $conn->query($qry);
																							if ($result->num_rows > 0) {
																								$str = "";
																								$i = (($current_page - 1) * $pagesize + 1);
																								while ($row = $result->fetch_assoc()) {
																									$str .= "<tr>
																
																<td id='td1id$i'>$i</td>
																<td id='td2id$i'>FR$row[id]</td>
																<td id='td3id$i'>$row[status]</td>
																<td id='td4id$i'>$row[company]</td>
																<td id='td5id$i'>$row[location]</td>
																<td id='td6id$i'>$row[source]</td>
																<td id='td7id$i'></td>
																<td id='td8id$i'>" . popdate($row['reg_date']) . "</td>
																<td id='td9id$i'>$row[fullname]</td>
																<td id='td9id$i'>$row[hf]</td>
																<td id='td10id$i'>$row[guests]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>$row[hours]</td>
																<td id='td5id$i'>" . date_create($row['checkindatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>" . date_create($row['checkoutdatetime'])->format("h:i A") . "</td>
																<td id='td5id$i'>$row[roomtype]</td>
																<td id='td5id$i'>$row[hoteltariff]</td>
																<td id='td5id$i'>$row[frotelcommission]</td>
																<td id='td5id$i'>$row[declaredtariff]</td>
																<td id='td5id$i'>$row[pcdiscount]</td>
																<td id='td5id$i'>$row[hotelst]</td>
																<td id='td5id$i'>$row[fsbc]</td>
																<td id='td5id$i'>$row[fkcc]</td>
																<td id='td5id$i'>$row[lt]</td>
																<td id='td5id$i'>$row[sc]</td>
																<td id='td5id$i'>$row[stonsc]</td>
																<td id='td5id$i'>" . round($row['total'], 2) . "</td>
																<td id='td5id$i'>" . date_create($row['cancellationrequestdate'])->format("d-M-Y") . "</td>
																<td id='td5id$i'>" . date_create($row['cancellationrequestdate'])->format("h:i A") . "</td>
																<td id='td5id$i'>$row[fullname]</td>
																<td id='td5id$i'>$row[cancellationreason]</td>
																<td id='td5id$i'>$row[cancellationpriortocheckin]</td>
																<td id='td5id$i'>$row[refund_amount]</td>
																<td id='td5id$i'>$row[refund_amount]</td>
																<td><a href='LBF_editcity.php?id=$row[id]&cntr=$i' class='fancybox fancybox.iframe'><span class='label label-info'>Remark</span></a></td>
																</tr>";
																									$i++;
																								}
																								echo $str;
																							} else {
																								echo "<tr><td colspan='36'>No cancellations to display</td></tr>";
																							} ?>
																																																																																													</tbody>
																																																																																												</table>
																																																																																											</div>
																				<?php mypagination($a->row_count_, $pagesize, '?Pg=' . $_GET['Pg'], ''); ?>
																																																																																										</div>
																																																																																									</div>
																																																																																								</div>
																<?php
							} else if ($_GET['Pg'] == "payment" and $page_access) {
								if ($_SESSION['hotel'] > 0)
									pms_info_status(); ?>
																																																																																									<h1 class="page-heading">Payment</h1>
																																																																																									<div class="row">
																																																																																										<div class="col-sm-12">
																																																																																											<div class="the-box">
																				<?php if (col("paymentterms") != "") {
																					$row = execute("update hotels set paymentterm=" . col("paymentterms") . " where id=$_SESSION[hotel]");
																					alertbox("success", "Payment terms updated");
																				}

																				$row = execute("select paymentterm from hotels where id=$_SESSION[hotel]"); ?>
																																																																																												<h4 class="small-title">PAYMENT TERMS</h4>
																																																																																												<div>
																																																																																													<form method="post" action="">
																																																																																														<div>
																																																																																															<input type="radio" class="form-control" name="paymentterms" value="1" <?= ($row['paymentterm'] == 1 or $row['paymentterm'] == 0) ? "checked" : ""; ?>>
																																																																																															<label>Recocilation between Frotels.com & us within 7 days is ok with us.</label>
																																																																																														</div>
																																																																																														<div>
																																																																																															<input type="radio" class="form-control" name="paymentterms" value="2" <?= ($row['paymentterm'] == 2) ? "checked" : ""; ?>>
																																																																																															<label>Ok if Frotels.com pays us within 2-3 days after guest checks out</label>
																																																																																														</div>
																																																																																														<div>
																																																																																															<input type="radio" class="form-control" name="paymentterms" value="3" <?= ($row['paymentterm'] == 3) ? "checked" : ""; ?>>
																																																																																															<label>We want to get paid before guest arrives. After booking is done & guest arrives.</label>
																																																																																														</div>
																																																																																														<!-- <div class="" style="">	
														<input type="checkbox" class="form-control" name="paymentterm[]" value="1">		
														<label>We allow "Pay At Hotel", in this situation reconciliation of 7 days is ok with us.</label>
													</div> -->
																																																																																														<div style="margin-top:10px">
																																																																																															<input type="submit" value="Save" class="btn btn-primary">
																																																																																														</div>
																																																																																													</form>
																																																																																												</div>
																																																																																											</div>
																																																																																										</div>
																																																																																									</div>
																<?php
							}
							////////////////////////////////// SUSHANT'S CODE ENDS HERE/////////////////////////////////////////////////////
							else if ($_GET['Pg'] == "be_api_token") { ?>
																																																																																										<h1 class="page-heading">Banqueteasy API Token</h1>
																																																																																										<div class="row">
																																																																																											<div class="col-sm-12">
																																																																																												<div class="the-box">
																				<?php
																				$token = execute("select be_api_token from hotels where id=$_SESSION[hotel]")['be_api_token'];

																				if ($token == '') {
																					$token = generateRandomString(32);
																					$conn->query("update hotels set be_api_token='$token' where id=$_SESSION[hotel]");
																				}

																				echo $token; ?>
																																																																																												</div>
																																																																																											</div>
																																																																																										</div>
																	<?php
							} else { ?>
																																																																																										<h1 class="page-heading">ACCESS DENIED</h1>
																																																																																										<div class="the-box" style="padding-bottom:0px;">
																		<?php alertbox("danger", "The page you are trying to access is either doesn't exist or requires access permission or requires hotel to be selected."); ?>
																																																																																										</div>
																<?php
							}
						} else {
							if ($_SESSION['hotel'] > 0) {
								pms_info_status(); ?>
																		<h1 class="page-heading">DASHBOARD</h1>
															<?php
							}
						} ?>
															</div>
														</div>
													</div>

													<div id="back-top">
														<a href="#top"><i class="fa fa-chevron-up"></i></a>
													</div>
													<script>
														(function(i, s, o, g, r, a, m) {
															i['GoogleAnalyticsObject'] = r;
															i[r] = i[r] || function() {
																(i[r].q = i[r].q || []).push(arguments)
															}, i[r].l = 1 * new Date();
															a = s.createElement(o),
																m = s.getElementsByTagName(o)[0];
															a.async = 1;
															a.src = g;
															m.parentNode.insertBefore(a, m)
														})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
														ga('create', 'UA-89304319-1', 'auto');
														ga('send', 'pageview');
													</script>
			</body>
		<?php include("js.php"); ?>

			</html>
	<?php
} else
	echo "<h1>Error 401</h1><h3>This page is inaccessible</h3>";
ob_end_flush(); ?>